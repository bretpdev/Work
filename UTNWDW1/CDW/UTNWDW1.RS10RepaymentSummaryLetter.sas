/*TEST*/
/*%LET TESTMSG = - THIS IS A TEST;
%LET RPTLIB = T:\SAS;
%LET LOGLIB = Y:\Batch\Logs;
%LET CODELIB = Y:\Codebase\SAS\CDW;
%LET ODBCFILE = BSYS_TEST;
%LET DB = CDW_test;
%LET ODBCFILE_CSYS = CSYSTest;*/

/*LIVE*/
%LET TESTMSG = - THIS IS LIVE;
%LET RPTLIB = Z:\Batch\FTP;
%LET LOGLIB = Z:\Batch\Logs;
%LET CODELIB = Z:\Codebase\SAS\CDW;
%LET ODBCFILE = BSYS;
%LET DB = CDW;
%LET ODBCFILE_CSYS = CSYS;

%INCLUDE "&CODELIB\UTNWDW1 CDW DAILY UPDATE.FOLDER AND DATABASE.SAS"  ;
%FILECHECK(41);

DATA REPAY_SUM(drop=trunc);
	INFILE REPORT41 DSD DLM = ',' FIRSTOBS=1 MISSOVER end = eof LRECL = 32767;
	INPUT 
		DF_SPE_ACC_ID :$10.
		LN_SEQ :6.
		LN_RPS_SEQ :6.
		LN_GRD_RPS_SEQ :6.
		LD_CRT_LON65 :DATE9.
		LC_TYP_SCH_DIS :$2.
		LA_TOT_RPD_DIS :8.2
		LR_INT_RPD_DIS :5.3
		LA_ANT_CAP :7.2
		LC_STA_LON65 :$1.
		LF_LST_DTS_LN65 :DATETIME25.3
		LA_RPS_ISL :7.2
		LD_CRT_LON66 :DATE9.
		LN_RPS_TRM :6.
		LF_LST_DTS_LN66 :DATETIME25.3
		LD_RPS_1_PAY_DU :DATE9.
	;
	%TRUNCAT(41);
RUN;

/*convert SAS dates to SQL Server datetime*/
DATA REPAY_SUM;
	SET REPAY_SUM;
	LD_CRT_LON65 = LD_CRT_LON65*86400;
	LD_CRT_LON66 = LD_CRT_LON66*86400;
	LD_RPS_1_PAY_DU = LD_RPS_1_PAY_DU*86400;
RUN;

%COPYERROR;

%ENCHILADA
	(
		REPAY_SUM,
		RS10_RepaymentSummaryLetter,
		DF_SPE_ACC_ID
		LN_SEQ
		LN_RPS_SEQ
		LN_GRD_RPS_SEQ,
		LD_CRT_LON65
		LC_TYP_SCH_DIS
		LA_TOT_RPD_DIS
		LR_INT_RPD_DIS
		LA_ANT_CAP
		LC_STA_LON65
		LF_LST_DTS_LN65
		LA_RPS_ISL
		LD_CRT_LON66
		LN_RPS_TRM
		LF_LST_DTS_LN66
		LD_RPS_1_PAY_DU,
/*		no filter*/
	);

%FINISH(SOURCE=RS10RepaymentSummaryLetter);
