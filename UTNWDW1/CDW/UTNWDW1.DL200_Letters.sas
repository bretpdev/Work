/*TEST*/
/*%LET TESTMSG = - THIS IS A TEST;
%LET RPTLIB = T:\SAS;
%LET LOGLIB = Y:\Batch\Logs;
%LET CODELIB = Y:\Codebase\SAS\CDW;
%LET ODBCFILE = BSYS_TEST;
%LET DB = CDW_test;
%LET ODBCFILE_CSYS = CSYSTest;*/

/*LIVE*/
%LET TESTMSG = - THIS IS LIVE;
%LET RPTLIB = Z:\Batch\FTP;
%LET LOGLIB = Z:\Batch\Logs;
%LET CODELIB = Z:\Codebase\SAS\CDW;
%LET ODBCFILE = BSYS;
%LET DB = CDW;
%LET ODBCFILE_CSYS = CSYS;

%INCLUDE "&CODELIB\UTNWDW1 CDW DAILY UPDATE.FOLDER AND DATABASE.SAS";
%FILECHECK(9);

DATA DL200_LET (drop=trunc);
	INFILE REPORT9 DSD DLM = ',' FIRSTOBS=1 MISSOVER end = eof;
	INPUT DF_SPE_ACC_ID :$10. LN_ATY_SEQ :6. LC_STA_ACTY10 :$1. LD_ATY_REQ_RCV :$10.;
%TRUNCAT(9);
RUN;
%COPYERROR;
PROC SORT DATA=DL200_LET ; BY DF_SPE_ACC_ID LN_ATY_SEQ; RUN;
DATA DL200_LET; SET DL200_LET; BY DF_SPE_ACC_ID LN_ATY_SEQ; IF LAST.LN_ATY_SEQ; RUN;

%ENCHILADA(DL200_LET,AY10_20DAYLETTER,DF_SPE_ACC_ID LN_ATY_SEQ,LC_STA_ACTY10 LD_ATY_REQ_RCV,WHERE LC_STA_ACTY10 = 'A');

%GOODBYE_NULL(AY10_20DAYLETTER,LD_ATY_REQ_RCV,'');

PROC SQL NOPRINT;
CONNECT TO ODBC AS DB (REQUIRED="FILEDSN=X:\PADR\ODBC\&DB..dsn; update_lock_typ=nolock; bl_keepnulls=no");
SELECT COUNT(*)
FROM CONNECTION TO DB (
	DELETE
	FROM AY10_20DAYLETTER
	WHERE CAST(LD_ATY_REQ_RCV AS DATETIME) <  DATEADD(YEAR, - 3, GETDATE()) );

DISCONNECT FROM DB;
QUIT;

%FINISH(SOURCE=DL200_Letters);
