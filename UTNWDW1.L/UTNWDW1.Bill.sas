/*TEST*/
/*%LET TESTMSG = - THIS IS A TEST;
%LET RPTLIB = T:\SAS;
%LET LOGLIB = Y:\Batch\Logs;
%LET CODELIB = Y:\Codebase\SAS\CDW;
%LET ODBCFILE = BSYS_TEST;
%LET DB = CDW_test;
%LET ODBCFILE_CSYS = CSYSTest;*/

/*LIVE*/
%LET TESTMSG = - THIS IS LIVE;
%LET RPTLIB = Z:\Batch\FTP;
%LET LOGLIB = Z:\Batch\Logs;
%LET CODELIB = Z:\Codebase\SAS\CDW;
%LET ODBCFILE = BSYS;
%LET DB = CDW;
%LET ODBCFILE_CSYS = CSYS;

%INCLUDE "&CODELIB\UTNWDW1 CDW DAILY UPDATE.FOLDER AND DATABASE.SAS"  ;
%FILECHECK(4);
DATA LN80(drop=trunc);
INFILE REPORT4 DSD DLM = ',' FIRSTOBS=1 MISSOVER end = eof;
INPUT DF_SPE_ACC_ID :$10. LN_SEQ :6. LD_BIL_CRT :$10. LN_SEQ_BIL_WI_DTE :3. 
	LD_BIL_STS_RIR_TOL :$10. LD_BIL_DU_LON :$10. LC_STA_LON80 :$1. 
	LA_BIL_CUR_DU :9.2 LA_BIL_PAS_DU :9.2 LC_BIL_MTD :$1. 
	LC_IND_BIL_SNT :$1. LC_STA_BIL10 :$1. LA_TOT_BIL_STS :9.2
	LA_INT_PD_LST_STM :9.2
	LA_FEE_PD_LST_STM :9.2
	LA_PRI_PD_LST_STM :9.2
	LA_TTL_PD_LST_STM :9.2
	LA_LTE_FEE_OTS_PRT :9.2
;	
BIL_MTD = PUT(LC_BIL_MTD,$BILMTD.);
IF LC_IND_BIL_SNT in ('N','5') AND INPUT(LD_BIL_DU_LON,MMDDYY10.) > TODAY() THEN PAID_AHEAD = 'Y';
	ELSE PAID_AHEAD = 'N';
IF LA_BIL_CUR_DU = 0 THEN LD_BIL_STS_RIR_TOL = '0.00 PFH'; 
IF PAID_AHEAD = 'Y' THEN LD_BIL_STS_RIR_TOL = LD_BIL_CRT;
IF LA_BIL_CUR_DU = LA_TOT_BIL_STS  THEN BIL_SAT = 'Y';
	ELSE IF LA_TOT_BIL_STS > 0 THEN BIL_SAT = 'P';
	ELSE BIL_SAT = 'N';
%TRUNCAT(4);
RUN;
%COPYERROR;
PROC SORT DATA=LN80; BY DF_SPE_ACC_ID LN_SEQ LD_BIL_CRT LN_SEQ_BIL_WI_DTE; RUN;
DATA LN80; SET LN80; BY DF_SPE_ACC_ID LN_SEQ LD_BIL_CRT LN_SEQ_BIL_WI_DTE; IF LAST.LN_SEQ_BIL_WI_DTE; RUN;

%ENCHILADA(LN80,BL10_BILL,DF_SPE_ACC_ID LN_SEQ LD_BIL_CRT LN_SEQ_BIL_WI_DTE,LD_BIL_STS_RIR_TOL BIL_SAT LD_BIL_DU_LON
	LC_BIL_MTD BIL_MTD LC_IND_BIL_SNT LC_STA_BIL10 LA_BIL_CUR_DU LA_BIL_PAS_DU LA_TOT_BIL_STS LC_STA_LON80 PAID_AHEAD
	LA_INT_PD_LST_STM
	LA_FEE_PD_LST_STM
	LA_PRI_PD_LST_STM
	LA_TTL_PD_LST_STM
	LA_LTE_FEE_OTS_PRT
	,WHERE LC_STA_BIL10 = 'A' AND LC_STA_LON80 = 'A');

%GOODBYE_NULL(BL10_BILL,LC_IND_BIL_SNT,'');
%GOODBYE_NULL(BL10_BILL,LD_BIL_STS_RIR_TOL,'');
%GOODBYE_NULL(BL10_BILL,LA_BIL_CUR_DU,0);
%GOODBYE_NULL(BL10_BILL,LA_BIL_PAS_DU,0);
%GOODBYE_NULL(BL10_BILL,LA_TOT_BIL_STS,0);
%GOODBYE_NULL(BL10_BILL,LA_INT_PD_LST_STM,0);
%GOODBYE_NULL(BL10_BILL,LA_FEE_PD_LST_STM,0);
%GOODBYE_NULL(BL10_BILL,LA_PRI_PD_LST_STM,0);
%GOODBYE_NULL(BL10_BILL,LA_TTL_PD_LST_STM,0);
%GOODBYE_NULL(BL10_BILL,LA_LTE_FEE_OTS_PRT,0);

%FINISH(SOURCE=Bill);
