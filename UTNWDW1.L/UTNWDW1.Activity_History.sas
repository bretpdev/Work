/*TEST*/
/*%LET TESTMSG = - THIS IS A TEST;
%LET RPTLIB = T:\SAS;
%LET LOGLIB = Y:\Batch\Logs;
%LET CODELIB = Y:\Codebase\SAS\CDW;
%LET ODBCFILE = BSYS_TEST;
%LET DB = CDW_test;
%LET ODBCFILE_CSYS = CSYSTest;*/

/*LIVE*/
%LET TESTMSG = - THIS IS LIVE;
%LET RPTLIB = Z:\Batch\FTP;
%LET LOGLIB = Z:\Batch\Logs;
%LET CODELIB = Z:\Codebase\SAS\CDW;
%LET ODBCFILE = BSYS;
%LET DB = CDW;
%LET ODBCFILE_CSYS = CSYS;

%INCLUDE "&CODELIB\UTNWDW1 CDW DAILY UPDATE.FOLDER AND DATABASE.SAS";
%FILECHECK(28);

DATA ARCHIST(drop=trunc LF_ATY_RCP LC_ATY_RCP) REFHIST(drop=trunc);
	INFILE REPORT28 DSD DLM = ',' FIRSTOBS=1 MISSOVER end = eof LRECL = 32767;
	INPUT DF_SPE_ACC_ID :$10. LN_ATY_SEQ :6. LC_STA_ACTY10 :$1. PF_REQ_ACT :$5. PF_RSP_ACT :$5.
		PX_ACT_DSC_REQ :$20. LD_ATY_REQ_RCV :$10. LD_ATY_RSP :$10. LF_USR_REQ_ATY :$8. LT_ATY_RSP :$8.
LX_ATY :$1000. lc_aty_rcp :$1. LF_ATY_RCP :$9.;
IF lc_aty_rcp = 'B' THEN OUTPUT ARCHIST;
/*ELSE OUTPUT REFHIST;*/
ELSE IF lc_aty_rcp = 'R' THEN OUTPUT REFHIST;

%TRUNCAT(28);
RUN;
%COPYERROR;
PROC SORT DATA=ARCHIST ; BY DF_SPE_ACC_ID LN_ATY_SEQ; RUN;
DATA ARCHIST; SET ARCHIST; BY DF_SPE_ACC_ID LN_ATY_SEQ; IF LAST.LN_ATY_SEQ; RUN;

%ENCHILADA(ARCHIST,AY10_HISTORY,DF_SPE_ACC_ID LN_ATY_SEQ
	,LC_STA_ACTY10 PF_REQ_ACT PF_RSP_ACT PX_ACT_DSC_REQ LD_ATY_REQ_RCV LD_ATY_RSP LF_USR_REQ_ATY LT_ATY_RSP LX_ATY 
	,WHERE LC_STA_ACTY10 = 'A');

%GOODBYE_NULL(AY10_HISTORY,PF_REQ_ACT,'');
%GOODBYE_NULL(AY10_HISTORY,PF_RSP_ACT,'');
%GOODBYE_NULL(AY10_HISTORY,PX_ACT_DSC_REQ,'');
%GOODBYE_NULL(AY10_HISTORY,LD_ATY_REQ_RCV,'');
%GOODBYE_NULL(AY10_HISTORY,LD_ATY_RSP,'');
%GOODBYE_NULL(AY10_HISTORY,LT_ATY_RSP,'');
%GOODBYE_NULL(AY10_HISTORY,LX_ATY,'');

PROC SORT DATA=REFHIST ; BY DF_SPE_ACC_ID LF_ATY_RCP LN_ATY_SEQ; RUN;
DATA REFHIST; SET REFHIST; BY DF_SPE_ACC_ID LF_ATY_RCP LN_ATY_SEQ; IF LAST.LN_ATY_SEQ; RUN;

%ENCHILADA(REFHIST,AY10_REFERENCEHISTORY,DF_SPE_ACC_ID LF_ATY_RCP LN_ATY_SEQ
	,LC_STA_ACTY10 PF_REQ_ACT PF_RSP_ACT PX_ACT_DSC_REQ LD_ATY_REQ_RCV LD_ATY_RSP LF_USR_REQ_ATY LT_ATY_RSP LX_ATY LC_ATY_RCP
	,WHERE LC_STA_ACTY10 = 'A');

%GOODBYE_NULL(AY10_REFERENCEHISTORY,PF_REQ_ACT,'');
%GOODBYE_NULL(AY10_REFERENCEHISTORY,PF_RSP_ACT,'');
%GOODBYE_NULL(AY10_REFERENCEHISTORY,PX_ACT_DSC_REQ,'');
%GOODBYE_NULL(AY10_REFERENCEHISTORY,LD_ATY_REQ_RCV,'');
%GOODBYE_NULL(AY10_REFERENCEHISTORY,LD_ATY_RSP,'');
%GOODBYE_NULL(AY10_REFERENCEHISTORY,LT_ATY_RSP,'');
%GOODBYE_NULL(AY10_REFERENCEHISTORY,LX_ATY,'');
%GOODBYE_NULL(AY10_REFERENCEHISTORY,LC_ATY_RCP,'');

%FINISH(SOURCE=Activity_History);
