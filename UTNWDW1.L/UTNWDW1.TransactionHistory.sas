/*TEST*/
/*%LET TESTMSG = - THIS IS A TEST;
%LET RPTLIB = T:\SAS;
%LET LOGLIB = Y:\Batch\Logs;
%LET CODELIB = Y:\Codebase\SAS\CDW;
%LET ODBCFILE = BSYS_TEST;
%LET DB = CDW_test;
%LET ODBCFILE_CSYS = CSYSTest;*/

/*LIVE*/
%LET TESTMSG = - THIS IS LIVE;
%LET RPTLIB = Z:\Batch\FTP;
%LET LOGLIB = Z:\Batch\Logs;
%LET CODELIB = Z:\Codebase\SAS\CDW;
%LET ODBCFILE = BSYS;
%LET DB = CDW;
%LET ODBCFILE_CSYS = CSYS;

%INCLUDE "&CODELIB\UTNWDW1 CDW DAILY UPDATE.FOLDER AND DATABASE.SAS"  ;
%FILECHECK(33);

DATA LN90_HIST(drop=trunc);
	INFILE REPORT33 DSD DLM = ',' FIRSTOBS=1 MISSOVER end = eof;
	INPUT 
		DF_SPE_ACC_ID :$10.
		LN_SEQ :6.
		LN_FAT_SEQ :6.
		LC_FAT_REV_REA :$1.
		LD_FAT_APL :$10.
		LD_FAT_PST :$10.
		LD_FAT_EFF :$10.
		LD_STA_LON90 :$10.
		LC_STA_LON90 :$1.
		LA_FAT_PCL_FEE :7.2
		LA_FAT_NSI :7.2
		LA_FAT_LTE_FEE :7.2
		LA_FAT_ILG_PRI :7.2
		LA_FAT_CUR_PRI :10.2
		PC_FAT_TYP  :$2.
		PC_FAT_SUB_TYP  :$2.
		LA_FAT_NSI_ACR :7.2
	;
	LC_FAT_REV_REA = PUT(LC_FAT_REV_REA,$REVREA.);
	%TRUNCAT(33);
RUN;
%COPYERROR;

PROC SORT DATA=LN90_HIST; 
	BY 
		DF_SPE_ACC_ID 
		LN_SEQ 
		LN_FAT_SEQ 
	;
RUN;

DATA LN90_HIST; 
	SET LN90_HIST; 
	BY 
		DF_SPE_ACC_ID 
		LN_SEQ 
		LN_FAT_SEQ;
	IF LAST.LN_FAT_SEQ;
RUN;

%ENCHILADA
	(
		LN90_HIST,
		LN90_FinancialHistory,
		DF_SPE_ACC_ID
		LN_SEQ 
		LN_FAT_SEQ,
		LC_FAT_REV_REA
		LD_FAT_APL
		LD_FAT_PST
		LD_FAT_EFF
		LD_STA_LON90
		LC_STA_LON90
		LA_FAT_PCL_FEE
		LA_FAT_NSI
		LA_FAT_LTE_FEE
		LA_FAT_ILG_PRI
		LA_FAT_CUR_PRI
		PC_FAT_TYP
		PC_FAT_SUB_TYP
		LA_FAT_NSI_ACR,
/*		no filter*/
	);

%GOODBYE_NULL(LN90_FinancialHistory,LC_FAT_REV_REA,'');
%GOODBYE_NULL(LN90_FinancialHistory,LD_FAT_APL,'');
%GOODBYE_NULL(LN90_FinancialHistory,LD_FAT_PST,'');
%GOODBYE_NULL(LN90_FinancialHistory,LD_FAT_EFF,'');
%GOODBYE_NULL(LN90_FinancialHistory,LD_STA_LON90,'');
%GOODBYE_NULL(LN90_FinancialHistory,LC_STA_LON90,'');
%GOODBYE_NULL(LN90_FinancialHistory,LA_FAT_PCL_FEE,0);
%GOODBYE_NULL(LN90_FinancialHistory,LA_FAT_NSI,0);
%GOODBYE_NULL(LN90_FinancialHistory,LA_FAT_LTE_FEE,0);
%GOODBYE_NULL(LN90_FinancialHistory,LA_FAT_ILG_PRI,0);
%GOODBYE_NULL(LN90_FinancialHistory,LA_FAT_CUR_PRI,0);
%GOODBYE_NULL(LN90_FinancialHistory,PC_FAT_TYP,'');
%GOODBYE_NULL(LN90_FinancialHistory,PC_FAT_SUB_TYP,'');
%GOODBYE_NULL(LN90_FinancialHistory,LA_FAT_NSI_ACR,0);

%FINISH(SOURCE=TransactionHistory);

