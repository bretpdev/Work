/*TEST*/
/*%LET TESTMSG = - THIS IS A TEST;
%LET RPTLIB = T:\SAS;
%LET LOGLIB = Y:\Batch\Logs;
%LET CODELIB = Y:\Codebase\SAS\CDW;
%LET ODBCFILE = BSYS_TEST;
%LET DB = CDW_test;
%LET ODBCFILE_CSYS = CSYSTest;*/

/*LIVE*/
%LET TESTMSG = - THIS IS LIVE;
%LET RPTLIB = Z:\Batch\FTP;
%LET LOGLIB = Z:\Batch\Logs;
%LET CODELIB = Z:\Codebase\SAS\CDW;
%LET ODBCFILE = BSYS;
%LET DB = CDW;
%LET ODBCFILE_CSYS = CSYS;

%INCLUDE "&CODELIB\UTNWDW1 CDW DAILY UPDATE.FOLDER AND DATABASE.SAS"  ;
%FILECHECK(50);

DATA RM30(drop=trunc);
	INFILE REPORT50 DSD DLM = ',' FIRSTOBS=1 MISSOVER end = eof LRECL = 32767;
	INPUT 
		LD_RMT_BCH_INI :DATE9.
		LC_RMT_BCH_SRC_IPT :$1.
		LN_RMT_BCH_SEQ :2.
		LN_RMT_SEQ :6.0
		LN_RMT_ITM :3.0
		LN_RMT_ITM_SEQ :2.
		LC_RMT_STA :$1.
		LA_BR_RMT :8.2
		LC_RMT_REV_REA :$1.
		LI_RMT_PD_AHD :1.
		LD_RMT_PAY_EFF :DATE9.
		LF_RMT_EDS :$9.
		LF_RMT_IST :$8.
		LX_SPS_REA :$5.
		LD_RMT_SPS :DATE9.
		LD_RMT_PST :DATE9.
		LD_UPD_REMT30 :DATE9.
		LD_CRT_REMT30 :DATE9.
		LD_RMT_BCH_INI_REV :DATE9.
		LC_RMT_BCH_IPT_REV :$1.
		LN_RMT_BCH_SEQ_REV :2.
		LN_RMT_SEQ_REV :6.0
		LN_RMT_ITM_REV :3.0
		LN_RMT_ITM_SEQ_REV :2.
		LF_LST_DTS_RM30 :DATETIME25.
		PC_FAT_TYP :$2.
		PC_FAT_SUB_TYP :$2.
		BF_SSN :$9.
		LD_BIL_CRT :DATE9.
		LN_SEQ_BIL_WI_DTE :2.
		LI_DPS_RMT_PIO_CVN :$1.
		BN_CPN_BK_SEQ :2.
		LD_BIL_CPN_DU :DATE9.
		LI_PHD_PAS_DU :1.
		LI_PHD_PAS_RPS :1.
		LI_PHD_PAS_OPT :1.
		LI_PHD_BCH_OVR :$1.
		LC_RMT_REV_REA_REJ :$2.
		LC_STP_SPS_OVR :$1.
		LC_RMT_PAY_SRC :$2.
		LC_RMT_SPS_OVR_FRD :1.
		LI_DPL_ACC_RMT :$1.
		LC_WAV_MSC_FEE_ASS :1.
		LD_SCH_RMT_PAY :DATE9.
		LF_LCK_BOX_TRC :$7.
		LF_BR_RMT_SCH_NUM :$10.
		LC_BR_RMT_SCH_TYP :$2.
		LI_CON_SPS_OVR :$1.
		LD_RMT_SCH_NUM_DPS :DATE9.
	;
	%TRUNCATNUM(50, LD_RMT_BCH_INI, '01JAN1960', '01JAN1960', date9.);
RUN;

/*convert SAS dates to SQL Server datetime*/
DATA RM30;
	SET RM30;
		LD_RMT_BCH_INI = LD_RMT_BCH_INI * 86400;
		LD_RMT_PAY_EFF = LD_RMT_PAY_EFF * 86400;
		LD_RMT_SPS = LD_RMT_SPS * 86400;
		LD_RMT_PST = LD_RMT_PST * 86400;
		LD_UPD_REMT30 = LD_UPD_REMT30 * 86400;
		LD_CRT_REMT30 = LD_CRT_REMT30 * 86400;
		LD_RMT_BCH_INI_REV = LD_RMT_BCH_INI_REV * 86400;
		LD_BIL_CRT = LD_BIL_CRT * 86400;
		LD_BIL_CPN_DU = LD_BIL_CPN_DU * 86400;
		LD_SCH_RMT_PAY = LD_SCH_RMT_PAY * 86400;
		LD_RMT_SCH_NUM_DPS = LD_RMT_SCH_NUM_DPS * 86400;
RUN;

%COPYERROR;

%ENCHILADA
	(
		RM30,
		RM30_BR_RMT,
		LD_RMT_BCH_INI  
		LC_RMT_BCH_SRC_IPT  
		LN_RMT_BCH_SEQ  
		LN_RMT_SEQ  
		LN_RMT_ITM  
		LN_RMT_ITM_SEQ,  
		LC_RMT_STA  
		LA_BR_RMT  
		LC_RMT_REV_REA  
		LI_RMT_PD_AHD  
		LD_RMT_PAY_EFF  
		LF_RMT_EDS  
		LF_RMT_IST  
		LX_SPS_REA  
		LD_RMT_SPS  
		LD_RMT_PST  
		LD_UPD_REMT30  
		LD_CRT_REMT30  
		LD_RMT_BCH_INI_REV  
		LC_RMT_BCH_IPT_REV  
		LN_RMT_BCH_SEQ_REV  
		LN_RMT_SEQ_REV  
		LN_RMT_ITM_REV  
		LN_RMT_ITM_SEQ_REV  
		LF_LST_DTS_RM30  
		PC_FAT_TYP  
		PC_FAT_SUB_TYP  
		BF_SSN  
		LD_BIL_CRT  
		LN_SEQ_BIL_WI_DTE  
		LI_DPS_RMT_PIO_CVN  
		BN_CPN_BK_SEQ  
		LD_BIL_CPN_DU  
		LI_PHD_PAS_DU  
		LI_PHD_PAS_RPS  
		LI_PHD_PAS_OPT  
		LI_PHD_BCH_OVR  
		LC_RMT_REV_REA_REJ  
		LC_STP_SPS_OVR  
		LC_RMT_PAY_SRC  
		LC_RMT_SPS_OVR_FRD  
		LI_DPL_ACC_RMT  
		LC_WAV_MSC_FEE_ASS  
		LD_SCH_RMT_PAY  
		LF_LCK_BOX_TRC  
		LF_BR_RMT_SCH_NUM  
		LC_BR_RMT_SCH_TYP  
		LI_CON_SPS_OVR  
		LD_RMT_SCH_NUM_DPS  
/*		no filter*/
	);

%FINISH(SOURCE=RM30_BR_RMT);
