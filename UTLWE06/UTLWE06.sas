/*UTLWE06 UCCU MONTHEND DATAFILE*/
/*PLEASE NOTE: THIS DIRECTORY HAS BEEN CHANGED TO PROGREVW BECAUSE OF THE SIZE OF THE OUTPUT FILE*/
LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;
%LET RPTLIB = /sas/whse/progrevw   ; 
/*%LET RPTLIB = T:\SAS; */
FILENAME REPORT2 "&RPTLIB/ULWE06.LWE06R2";
/*LIBNAME  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=WORK;*/
/*RSUBMIT;*/
PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE UCCUDF AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT A.BF_SSN 
	,A.LF_DOE_SCL_ORG
	,A.IC_LON_PGM
	,B.IF_GTR
	,B.LC_ACA_GDE_LEV
	,C.WX_ACA_GDE_LEV
	,A.IF_OWN
	,A.WD_RPY_BEG
	,A.WA_CUR_PRI
	,A.WA_CUR_BR_INT
	,A.WA_CUR_GOV_INT
	,A.WM_BR_1
	,A.WM_BR_MID
	,A.WM_BR_LST
	,A.WM_BR_LST_SFX
	,B.DD_BRT
	,B.WM_STU_1
	,B.WM_STU_MID
	,B.WM_STU_LST
	,B.WM_STU_LST_SFX
	,B.WX_STR_ADR_1
	,B.WX_STR_ADR_2
	,B.WX_STR_ADR_3
	,B.WM_CT
	,B.DC_DOM_ST
	,B.DF_ZIP_CDE
	,B.DN_PHN_XTN
	,B.DN_DOM_PHN_LCL
	,B.DN_DOM_PHN_XCH
	,B.DN_DOM_PHN_ARA
	,A.LD_SCL_SPR
	,B.LA_LON_AMT_GTR
	,B.LD_LON_GTR
	,B.WX_ADR_EML
	,B.AF_LON_ALT
	,B.AN_SEQ_COM_LN_APL
	,A.WR_ITR_1
	,A.WR_ITR_2
	,A.WR_ITR_3
	,A.WR_ITR_4
	,C.WD_ITR_EFF_END_1 
	,C.WD_ITR_EFF_END_2 
	,C.WD_ITR_EFF_END_3 
	,C.WD_ITR_EFF_END_4

FROM OLWHRM1.MR5A_MR_LON_MTH_01 A
INNER JOIN OLWHRM1.MR5B_MR_LON_MTH_02 B
		 ON A.BF_SSN = B.BF_SSN
		 AND A.LN_SEQ = B.LN_SEQ
		 AND A.IF_OWN = B.IF_OWN
INNER JOIN OLWHRM1.MR5C_MR_LON_MTH_03 C
		 ON A.BF_SSN = C.BF_SSN
		 AND A.LN_SEQ = C.LN_SEQ
		 AND A.IF_OWN = C.IF_OWN
WHERE A.IF_OWN = '829123'
AND A.WA_CUR_PRI > 0
);
DISCONNECT FROM DB2;
/*ENDRSUBMIT;*/
/*DATA UCCUDF;*/
/*SET WORKLOCL.UCCUDF;*/
/*RUN;*/
%MACRO INT_RATE(DS,VAR1,VAR2);
DATA &DS (RENAME=(&VAR1 = WR_ITR &VAR2 = WD_ITR_EFF_END));
SET UCCUDF (KEEP=BF_SSN &VAR1 &VAR2);
RUN;
%MEND INT_RATE;
%INT_RATE(INT1,WR_ITR_1,WD_ITR_EFF_END_1);
%INT_RATE(INT2,WR_ITR_2,WD_ITR_EFF_END_2);
%INT_RATE(INT3,WR_ITR_3,WD_ITR_EFF_END_3);
%INT_RATE(INT4,WR_ITR_4,WD_ITR_EFF_END_4);

DATA INTRST (WHERE=(WD_ITR_EFF_END NE .));
SET INT1 INT2 INT3 INT4;
RUN;

PROC SORT DATA=INTRST;BY BF_SSN WD_ITR_EFF_END;RUN;

DATA INTRST;
SET INTRST;
BY BF_SSN;
IF FIRST.BF_SSN;
RUN;

DATA UCCUDF (DROP=WR_ITR_1 WR_ITR_2 WR_ITR_3 WR_ITR_4 
			 WD_ITR_EFF_END_1 WD_ITR_EFF_END_2 WD_ITR_EFF_END_3 WD_ITR_EFF_END_4);
SET UCCUDF;
RUN;

PROC SQL;
CREATE TABLE UCCUDFU AS 
SELECT DISTINCT A.*
	,B.WR_ITR
FROM UCCUDF A
INNER JOIN INTRST B
	ON A.BF_SSN = B.BF_SSN
ORDER BY BF_SSN
;
QUIT;

PROC DATASETS;
DELETE UCCUDF INTRST INT1-INT4;
QUIT;

DATA _NULL_;
SET  WORK.UCCUDFU;
FILE REPORT2 DELIMITER=',' DSD DROPOVER LRECL=32767;
FORMAT BF_SSN $9. ;
FORMAT LF_DOE_SCL_ORG $8. ;
FORMAT IC_LON_PGM $6. ;
FORMAT IF_GTR $6. ;
FORMAT LC_ACA_GDE_LEV $2. ;
FORMAT WX_ACA_GDE_LEV $20. ;
FORMAT IF_OWN $8. ;
FORMAT WD_RPY_BEG YYMMDDd10. ;
FORMAT WA_CUR_PRI 10.2 ;
FORMAT WA_CUR_BR_INT 10.2 ;
FORMAT WA_CUR_GOV_INT 9.2 ;
FORMAT WM_BR_1 $13. ;
FORMAT WM_BR_MID $13. ;
FORMAT WM_BR_LST $23. ;
FORMAT WM_BR_LST_SFX $4. ;
FORMAT DD_BRT YYMMDDd10. ;
FORMAT WM_STU_1 $13. ;
FORMAT WM_STU_MID $13. ;
FORMAT WM_STU_LST $23. ;
FORMAT WM_STU_LST_SFX $4. ;
FORMAT WX_STR_ADR_1 $30. ;
FORMAT WX_STR_ADR_2 $30. ;
FORMAT WX_STR_ADR_3 $30. ;
FORMAT WM_CT $20. ;
FORMAT DC_DOM_ST $2. ;
FORMAT DF_ZIP_CDE $17. ;
FORMAT DN_PHN_XTN $5. ;
FORMAT DN_DOM_PHN_LCL $4. ;
FORMAT DN_DOM_PHN_XCH $3. ;
FORMAT DN_DOM_PHN_ARA $3. ;
FORMAT LD_SCL_SPR YYMMDDd10. ;
FORMAT LA_LON_AMT_GTR 10.2 ;
FORMAT LD_LON_GTR YYMMDDd10. ;
FORMAT WX_ADR_EML $75. ;
FORMAT AF_LON_ALT $17. ;
FORMAT AN_SEQ_COM_LN_APL 6. ;
FORMAT WR_ITR 7.3 ;
IF _N_ = 1 THEN        /* WRITE COLUMN NAMES */
DO;
PUT
'BF_SSN'
','
'LF_DOE_SCL_ORG'
','
'IC_LON_PGM'
','
'IF_GTR'
','
'LC_ACA_GDE_LEV'
','
'WX_ACA_GDE_LEV'
','
'IF_OWN'
','
'WD_RPY_BEG'
','
'WA_CUR_PRI'
','
'WA_CUR_BR_INT'
','
'WA_CUR_GOV_INT'
','
'WM_BR_1'
','
'WM_BR_MID'
','
'WM_BR_LST'
','
'WM_BR_LST_SFX'
','
'DD_BRT'
','
'WM_STU_1'
','
'WM_STU_MID'
','
'WM_STU_LST'
','
'WM_STU_LST_SFX'
','
'WX_STR_ADR_1'
','
'WX_STR_ADR_2'
','
'WX_STR_ADR_3'
','
'WM_CT'
','
'DC_DOM_ST'
','
'DF_ZIP_CDE'
','
'DN_PHN_XTN'
','
'DN_DOM_PHN_LCL'
','
'DN_DOM_PHN_XCH'
','
'DN_DOM_PHN_ARA'
','
'LD_SCL_SPR'
','
'LA_LON_AMT_GTR'
','
'LD_LON_GTR'
','
'WX_ADR_EML'
','
'AF_LON_ALT'
','
'AN_SEQ_COM_LN_APL'
','
'WR_ITR'
;
END;
DO;
PUT BF_SSN $ @;
PUT LF_DOE_SCL_ORG $ @;
PUT IC_LON_PGM $ @;
PUT IF_GTR $ @;
PUT LC_ACA_GDE_LEV $ @;
PUT WX_ACA_GDE_LEV $ @;
PUT IF_OWN $ @;
PUT WD_RPY_BEG @;
PUT WA_CUR_PRI @;
PUT WA_CUR_BR_INT @;
PUT WA_CUR_GOV_INT @;
PUT WM_BR_1 $ @;
PUT WM_BR_MID $ @;
PUT WM_BR_LST $ @;
PUT WM_BR_LST_SFX $ @;
PUT DD_BRT @;
PUT WM_STU_1 $ @;
PUT WM_STU_MID $ @;
PUT WM_STU_LST $ @;
PUT WM_STU_LST_SFX $ @;
PUT WX_STR_ADR_1 $ @;
PUT WX_STR_ADR_2 $ @;
PUT WX_STR_ADR_3 $ @;
PUT WM_CT $ @;
PUT DC_DOM_ST $ @;
PUT DF_ZIP_CDE $ @;
PUT DN_PHN_XTN $ @;
PUT DN_DOM_PHN_LCL $ @;
PUT DN_DOM_PHN_XCH $ @;
PUT DN_DOM_PHN_ARA $ @;
PUT LD_SCL_SPR @;
PUT LA_LON_AMT_GTR @;
PUT LD_LON_GTR @;
PUT WX_ADR_EML $ @;
PUT AF_LON_ALT $ @;
PUT AN_SEQ_COM_LN_APL @;
PUT WR_ITR ;
;
END;
RUN;
