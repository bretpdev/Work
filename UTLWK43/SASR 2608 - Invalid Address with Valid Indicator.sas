/*%LET RPTLIB = %SYSGET(reportdir);*/
%LET RPTLIB = T:\SAS;
FILENAME REPORT2 "&RPTLIB/NA_DEMOS.R2";
FILENAME REPORT3 "&RPTLIB/NA_DEMOS.R3";
FILENAME REPORT4 "&RPTLIB/NA_DEMOS.R4";
FILENAME REPORT5 "&RPTLIB/NA_DEMOS.R5";

LIBNAME  DUSTER  REMOTE  SERVER=DUSTER  SLIBREF=WORK;
RSUBMIT;
LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;
%LET REJECT = ('N/A','n/a','N/A/','N A','na','NA','NADA','NN','NNN',
					'NNNN','NNNNN','NO ADD','NO ADD AVAIL','NO ADD AVAILABLE','NO ADD GIVEN',
					'NO ADD GVN','NO ADD LISTED','NO ADD ON APP','NO ADD ON FILE','NO ADDR',
					'NO ADDRESS','NO ADDRESS AVAILABLE','NO ADDRESS GIVEN','NO ADDRESS LISTED',
					'NO ADDRESS ON APP','NO ADDRESS PROVIDED','NO ADDRESS TO ADD','NO ADDRESS WAS GIVEN',
					'NO ADDRESSS GIVEN','NO ADDRSS','NO CITY','NO IDEA','NO INFO','NO NOT THAT ONE',
					'NO REFS AVAIL','NO ST','NO ST ADD','NO ST ADD GIVEN','NO ST ADDRESS','NO ST GIVEN',
					'NO ST NAME','NO STREET ADDRESS','NO STREET ADDRESS GIVEN',
					'NO STREET ADDRESS NECESSAR',
					'NO STREET ADRS','NOADD','NOADDRESS','NON GIVEN','NONE','NONE GIVEN',
					'NOT AVAIL','NOT AVAILABLE','NOT GIVEN','NOT KNOW','NOT KNOWN','NOT KNOWNT',
					'NOT LISTED','NOT PROVIDED','NOT SURE','NOT SURE YET SHE JUST MOVED',
					'NECESSARY','NEEDS PARENTS','NON RD','NONE','NOT WNT CONTCT','N/','NN','NNNN',
					'NO','NO ACITY','NO ADD','NO CITY','NO CITY ON APP','NO CIYT','NO STATE',
					'NON','NONE','NONE GIVEN');

PROC SQL;
CREATE TABLE BOR_NA AS
SELECT DISTINCT A.DF_PRS_ID		
	,A.DF_SPE_ACC_ID
	,A.DM_PRS_1 	
	,A.DM_PRS_LST
	,A.DX_STR_ADR_1
	,A.DX_STR_ADR_2
	,A.DM_CT
	,A.DC_DOM_ST
	,A.DF_ZIP
FROM DLGSUTWH.PD01_PDM_INF A
inner join DLGSUTWH.GA01_APP C
	ON A.DF_PRS_ID = C.DF_PRS_ID_BR
INNER JOIN DLGSUTWH.GA10_LON_APP B
	ON C.AF_APL_ID = B.AF_APL_ID
WHERE A.DI_VLD_ADR = 'Y'
	AND B.AA_CUR_PRI > 0
	AND (A.DX_STR_ADR_1 IN &REJECT
		OR A.DX_STR_ADR_2 IN &REJECT
		OR A.DM_CT IN &REJECT
		OR A.DC_DOM_ST IN &REJECT
		OR A.DF_ZIP IN &REJECT)
;

CREATE TABLE REF_NA AS
SELECT DISTINCT B.DF_PRS_ID_BR
	,B.DF_PRS_ID_RFR
	,B.BM_RFR_1
	,B.BM_RFR_LST
	,B.BX_RFR_STR_ADR_1 
	,B.BX_RFR_STR_ADR_2
	,B.BM_RFR_CT
	,B.BC_RFR_ST
	,B.BF_RFR_ZIP
FROM DLGSUTWH.BR03_BR_REF B
inner join DLGSUTWH.GA01_APP C
	ON B.DF_PRS_ID_BR = C.DF_PRS_ID_BR
INNER JOIN DLGSUTWH.GA10_LON_APP B
	ON C.AF_APL_ID = B.AF_APL_ID
WHERE B.BI_VLD_ADR = 'Y'
	AND B.BC_STA_BR03 = 'A'
	AND B.AA_CUR_PRI > 0
	AND (B.BX_RFR_STR_ADR_1 IN &REJECT
		OR B.BX_RFR_STR_ADR_2 IN &REJECT
		OR B.BM_RFR_CT IN &REJECT
		OR B.BC_RFR_ST IN &REJECT
		OR B.BF_RFR_ZIP IN &REJECT)
;

CREATE TABLE COM_BOR_NA AS
SELECT DISTINCT COALESCE(C.BF_SSN,A.DF_PRS_ID) AS BF_SSN
	,CASE
		WHEN C.BF_SSN IS NULL THEN A.DF_SPE_ACC_ID
		ELSE A.DF_PRS_ID
	END AS ACC_RFR
	,A.DM_PRS_1 	
	,A.DM_PRS_LST
	,B.DX_STR_ADR_1
	,B.DX_STR_ADR_2
	,B.DM_CT
	,B.DC_DOM_ST
	,B.DF_ZIP_CDE
FROM DLGSUTWH.PD10_PRS_NME A
INNER JOIN DLGSUTWH.PD30_PRS_ADR B
	ON A.DF_PRS_ID = B.DF_PRS_ID
LEFT OUTER JOIN DLGSUTWH.RF10_RFR C
	ON B.DF_PRS_ID = C.BF_RFR
LEFT OUTER JOIN DLGSUTWH.LN10_LON D
	ON A.DF_PRS_ID = D.BF_SSN
LEFT OUTER JOIN DLGSUTWH.LN10_LON E
	ON C.BF_SSN = E.BF_SSN
WHERE B.DI_VLD_ADR = 'Y'
	AND (B.DX_STR_ADR_1 IN &REJECT
		OR B.DX_STR_ADR_2 IN &REJECT
		OR B.DM_CT IN &REJECT
		OR B.DC_DOM_ST IN &REJECT
		OR B.DF_ZIP_CDE IN &REJECT)
	AND (D.LA_CUR_PRI > 0 OR E.LA_CUR_PRI > 0)
;
QUIT;

ENDRSUBMIT;
DATA BOR_NA; SET DUSTER.BOR_NA; RUN;
DATA REF_NA; SET DUSTER.REF_NA; RUN; 
DATA COM_BOR_NA; SET DUSTER.COM_BOR_NA; RUN;
DATA COM_BOR COM_REF;
SET COM_BOR_NA;
IF SUBSTR(ACC_RFR,1,1) = 'P' THEN OUTPUT COM_REF;
ELSE OUTPUT COM_BOR;
RUN;

PROC SORT DATA=BOR_NA; BY DF_PRS_ID; RUN;
PROC SORT DATA=REF_NA; BY DF_PRS_ID_RFR; RUN;
PROC SORT DATA=COM_BOR; BY BF_SSN; RUN;
PROC SORT DATA=COM_REF; BY BF_SSN; RUN;

PROC PRINTTO PRINT=REPORT2 NEW;
RUN;
/*FOR LANDSCAPE REPORTS:*/
OPTIONS ORIENTATION = LANDSCAPE;
OPTIONS PS=39 LS=142;
TITLE 'INVALID ADDRESS WITH VALID INDICATOR';
TITLE2	"BAD BORROWER ADDRESSES IN ONELINK";
PROC PRINT NOOBS SPLIT='/' DATA=BOR_NA WIDTH=UNIFORM WIDTH=MIN LABEL;
VAR DF_PRS_ID DF_SPE_ACC_ID DM_PRS_1 DM_PRS_LST DX_STR_ADR_1 DX_STR_ADR_2 DM_CT DC_DOM_ST DF_ZIP;
LABEL DF_PRS_ID = 'BORROWER SSN'
	DF_SPE_ACC_ID = 'ACCOUNT NUMBER'
	DM_PRS_1 = 'FIRST'
	DM_PRS_LST = 'LAST'
	DX_STR_ADR_1 = 'STREET 1'
	DX_STR_ADR_2 = 'STREET 2'
	DM_CT = 'CITY'
	DC_DOM_ST = 'STATE'
	DF_ZIP = 'ZIP';
RUN;
PROC PRINTTO PRINT=REPORT3 NEW;
RUN;
OPTIONS PS=39 LS=152;

TITLE2	"BAD REFERENCE ADDRESSES IN ONELINK";

PROC PRINT NOOBS SPLIT='/' DATA=REF_NA WIDTH=UNIFORM WIDTH=MIN LABEL;
VAR DF_PRS_ID_BR DF_PRS_ID_RFR BM_RFR_1 BM_RFR_LST BX_RFR_STR_ADR_1 BX_RFR_STR_ADR_2
BM_RFR_CT BC_RFR_ST BF_RFR_ZIP;
LABEL DF_PRS_ID_BR = 'BORROWER SSN'
	DF_PRS_ID_RFR = 'REFERENCE ID'
	BM_RFR_1 = 'FIRST'
	BM_RFR_LST = 'LAST'
	BX_RFR_STR_ADR_1 = 'STREET 1'
	BX_RFR_STR_ADR_2 = 'STREET 2'
	BM_RFR_CT = 'CITY'
	BC_RFR_ST = 'STATE'
	BF_RFR_ZIP = 'ZIP';
RUN;

PROC PRINTTO PRINT=REPORT4 NEW;
RUN;

TITLE2	"BAD BORROWER ADDRESSES IN COMPASS";

PROC PRINT NOOBS SPLIT='/' DATA=COM_BOR WIDTH=UNIFORM WIDTH=MIN LABEL;
VAR BF_SSN ACC_RFR DM_PRS_1 DM_PRS_LST DX_STR_ADR_1 DX_STR_ADR_2 DM_CT DC_DOM_ST 
DF_ZIP_CDE;
LABEL BF_SSN = 'BORROWER SSN'
	ACC_RFR = 'ACCOUNT NUMBER'
	DM_PRS_1 = 'FIRST'
	DM_PRS_LST = 'LAST'
	DX_STR_ADR_1 = 'STREET 1'
	DX_STR_ADR_2 = 'STREET 2'
	DM_CT = 'CITY'
	DC_DOM_ST = 'STATE'
	DF_ZIP_CDE = 'ZIP';
RUN;
PROC PRINTTO PRINT=REPORT5 NEW;
RUN;

TITLE2	"BAD REFERENCE ADDRESSES IN COMPASS";

PROC PRINT NOOBS SPLIT='/' DATA=COM_REF WIDTH=UNIFORM WIDTH=MIN LABEL;
VAR BF_SSN ACC_RFR DM_PRS_1 DM_PRS_LST DX_STR_ADR_1 DX_STR_ADR_2 DM_CT DC_DOM_ST 
DF_ZIP_CDE;
LABEL BF_SSN = 'BORROWER SSN'
	ACC_RFR = 'REFERENCE ID'
	DM_PRS_1 = 'FIRST'
	DM_PRS_LST = 'LAST'
	DX_STR_ADR_1 = 'STREET 1'
	DX_STR_ADR_2 = 'STREET 2'
	DM_CT = 'CITY'
	DC_DOM_ST = 'STATE'
	DF_ZIP_CDE = 'ZIP';
RUN;

PROC PRINTTO;
RUN;
TITLE1;
