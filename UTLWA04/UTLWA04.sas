/*LOANS DISBURSED - MONTHLY ACCOUNTING REPORT*/

/*LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;
%LET RPTLIB = %SYSGET(reportdir);
FILENAME REPORT2 "&RPTLIB/ULWA04.LWA04R2";*/

DATA _NULL_;
     CALL SYMPUT('BEGIN',"'"||PUT(INTNX('MONTH',TODAY() + 3,-1,'beginning'), MMDDYYD10.)||"'");
     CALL SYMPUT('END',"'"||PUT(INTNX('MONTH',TODAY()+3,-1,'end'), MMDDYYD10.)||"'");
     CALL SYMPUT('EFFDATE',TRIM(LEFT(UPCASE(
		PUT(INTNX('MONTH',TODAY()+3,-1), MONNAME9.)||' '||
		PUT(INTNX('MONTH',TODAY()+3,-1), YEAR4.)))));
RUN;
%SYSLPUT BEGIN = &BEGIN;
%SYSLPUT END = &END;

LIBNAME  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=WORK;
RSUBMIT;
OPTIONS MPRINT SYMBOLGEN;

PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE DISBTOTS AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT
	SUM(AA_DSB_ADJ)							AS DSB_AMT,
	B.ac_lon_typ							AS TYPE
FROM OLWHRM1.GA11_LON_DSB_ATY A
INNER JOIN OLWHRM1.GA10_LON_APP B
	ON B.AF_APL_ID = A.AF_APL_ID
	AND B.AF_APL_ID_SFX = A.AF_APL_ID_SFX
WHERE A.AC_DSB_ADJ = 'A' /*ACTUAL DISB*/
AND A.AC_DSB_ADJ_STA = 'A' /*ACTIVE ROW*/
AND A.AD_DSB_ADJ BETWEEN &BEGIN AND &END
GROUP BY B.ac_lon_typ
);
DISCONNECT FROM DB2;

ENDRSUBMIT;
DATA DISBTOTS;
	SET WORKLOCL.DISBTOTS;
RUN;

/*PROC PRINTTO PRINT=REPORT2;
RUN;*/
OPTIONS CENTER NODATE NONUMBER PAGENO=1 LS=90 ;
PROC PRINT NOOBS DATA = DISBTOTS LABEL;
VAR	TYPE DSB_AMT;
SUM	DSB_AMT;
FORMAT	DSB_AMT DOLLAR17.2;
LABEL DSB_AMT='DISBURSED AMOUNT';
TITLE "MONTHLY DISBURSEMENTS FOR &EFFDATE";
FOOTNOTE 'JOB = UTLWA04     REPORT = ULWA04.LWA04R2';
RUN;

*testfile;
/*
LIBNAME  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=WORK;
RSUBMIT;
OPTIONS MPRINT SYMBOLGEN;

PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE tstDISBS AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT DISTINCT
	C.DF_PRS_ID_BR
	,B.AF_APL_ID||B.AF_APL_ID_SFX			AS CLUID
	,A.AN_DSB_SEQ
	,A.AD_DSB_ADJ
	,A.AA_DSB_ADJ							AS DSB_AMT
	,B.ac_lon_typ							AS TYPE
FROM OLWHRM1.GA11_LON_DSB_ATY A
INNER JOIN OLWHRM1.GA10_LON_APP B
	ON B.AF_APL_ID = A.AF_APL_ID
	AND B.AF_APL_ID_SFX = A.AF_APL_ID_SFX
INNER JOIN OLWHRM1.GA01_APP C
	ON B.AF_APL_ID = C.AF_APL_ID
WHERE A.AC_DSB_ADJ = 'A'
AND A.AC_DSB_ADJ_STA = 'A'
AND A.AD_DSB_ADJ BETWEEN &BEGIN AND &END
);
DISCONNECT FROM DB2;

ENDRSUBMIT;
DATA tstDISBS;
	SET WORKLOCL.tstDISBS;
RUN;
PROC EXPORT DATA= TSTDISBS
            OUTFILE= "T:\SAS\TSTDISBS.xls" 
            DBMS=EXCEL2000 REPLACE;
RUN;
*/
