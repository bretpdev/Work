/*UTLWD09 DUPLICATE REFERENCE REVIEW*/
/*LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;
%LET RPTLIB = %SYSGET(reportdir);
FILENAME REPORT2 "&RPTLIB/ULWAB1.LWAB1R2";*/

LIBNAME  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=WORK;
RSUBMIT;
PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE DUPL AS
SELECT *
FROM CONNECTION TO DB2 (

SELECT DISTINCT
		A.DF_PRS_ID_BR
	
FROM OLWHRM1.CT30_CALL_QUE A 
	INNER JOIN OLWHRM1.BR03_BR_REF B 
ON A.DF_PRS_ID_BR = B.DF_PRS_ID_BR

WHERE B.BC_STA_BR03 = 'A' 
AND A.IF_WRK_GRP = 'DUPLREFS'
AND NOT EXISTS
	(SELECT *
	FROM OLWHRM1.BR03_BR_REF X
	WHERE X.DF_PRS_ID_BR = B.DF_PRS_ID_BR
	AND NOT EXISTS
		(SELECT *
		FROM OLWHRM1.AY01_BR_ATY Y
		WHERE Y.DF_PRS_ID = X.DF_PRS_ID_RFR
		AND Y.PF_ACT = 'KDUPL'
		)
	)

);
DISCONNECT FROM DB2;
ENDRSUBMIT;

DATA DUPL;
SET WORKLOCL.DUPL;
RUN;

data _null_;
set  WORK.Dupl;
file 'T:\SAS\ULWD09.LWD09R2' delimiter=',' DSD DROPOVER lrecl=32767;
*file REPORT2 delimiter=',' DSD DROPOVER lrecl=32767;
format DF_PRS_ID_BR $9.;
put DF_PRS_ID_BR $;
run;
