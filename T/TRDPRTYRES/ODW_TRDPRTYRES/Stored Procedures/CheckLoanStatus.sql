CREATE PROCEDURE [trdprtyres].[CheckLoanStatus]
	@BF_SSN VARCHAR(9)
AS
	SELECT
		COUNT(PD01.DF_PRS_ID)
	FROM
		ODW..PD01_PDM_INF PD01
		INNER JOIN ODW..GA01_APP GA01
			ON GA01.DF_PRS_ID_BR = PD01.DF_PRS_ID
		INNER JOIN ODW..GA14_LON_STA GA14
			ON GA14.AF_APL_ID = GA01.AF_APL_ID
		INNER JOIN ODW..DC01_LON_CLM_INF DC01
			ON DC01.AF_APL_ID = GA14.AF_APL_ID
			AND DC01.AF_APL_ID_SFX = GA14.AF_APL_ID_SFX
	WHERE
		(GA14.AC_LON_STA_TYP IN ('CR', 'AL', 'DA', 'FB', 'IA', 'ID', 'IG', 'IM', 'RP', 'UA', 'UB')
		OR (GA14.AC_LON_STA_TYP = 'CP' AND DC01.LC_STA_DC10 = '03'))
		AND PD01.DF_PRS_ID = @BF_SSN