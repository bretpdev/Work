CREATE PROCEDURE [acurintc].[GetBorrowerRecentAddressHistory]
	@Ssn CHAR(9)
AS

SELECT
	RTRIM(PD31.DX_STR_ADR_1_HST) Address1,
	RTRIM(NULLIF(PD31.DX_STR_ADR_2_HST, '')) Address2,
	RTRIM(PD31.DM_CT_HST) City,
	RTRIM(PD31.DC_DOM_ST_HST) StateCode,
	RTRIM(PD31.DF_ZIP_CDE_HST) Zip,
	RTRIM(NULLIF(PD31.DM_FGN_CNY_HST, '')) Country,
	RTRIM(NULLIF(PD31.DM_FGN_ST_HST, '')) ForeignState,
	CAST(
		CASE PD31.DI_VLD_ADR_HST WHEN 'Y' THEN 1 ELSE 0 END 
	AS BIT) AddressIsValid,
	PD31.DD_VER_ADR_HST VerificationDate
FROM
	UDW..PD31_PRS_INA PD31
WHERE
	PD31.DC_STA_PDEM31 = 'H'
	AND
	DC_ADR_HST = 'L'
	AND
	PD31.DD_VER_ADR_HST > DATEADD(YEAR, -1, GETDATE())
	AND
	PD31.DF_PRS_ID = @Ssn
	
RETURN 0
