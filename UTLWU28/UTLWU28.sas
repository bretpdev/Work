*------------------------------------------------*
| UTLWU28 QC REPORT FOR VIP AND SPECIAL HANDLING |
*------------------------------------------------*;
/*LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;*/
/*%LET RPTLIB = %SYSGET(reportdir);*/
%LET RPTLIB = T:\SAS;
FILENAME REPORT2 "&RPTLIB/ULWU28.LWU28R2";
FILENAME REPORTZ "&RPTLIB/ULWU28.LWU28RZ";
DATA _NULL_;
	CALL SYMPUT('BEGIN',"'"||PUT(INTNX('MONTH',TODAY(),-1,'BEGINNING'), MMDDYYD10.)||"'");
	CALL SYMPUT('END',"'"||PUT(INTNX('MONTH',TODAY(),-1,'END'), MMDDYYD10.)||"'");
	CALL SYMPUT('RUNDATE',PUT(INTNX('DAY',TODAY(),0,'beginning'), MMDDYY10.));
RUN;
%SYSLPUT BEGIN = &BEGIN;
%SYSLPUT END = &END;
LIBNAME  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=WORK;
RSUBMIT;
%MACRO SQLCHECK (SQLRPT= );
%IF &SQLXRC NE 0 %THEN %DO;
	DATA _NULL_;
    FILE REPORTZ NOTITLES;
    PUT @01 " ********************************************************************* "
      / @01 " ****  THE SQL CODE ABOVE HAS EXPERIENCED AN ERROR.               **** "
      / @01 " ****  THE SAS LOG IN &SQLRPT SHOULD BE REVIEWED.          **** "       
      / @01 " ********************************************************************* "
      / @01 " ****  THE SQL ERROR CODE IS  &SQLXRC  AND THE SQL ERROR MESSAGE  **** "
      / @01 " ****  &SQLXMSG   **** "
      / @01 " ********************************************************************* ";
	RUN;
%END;
%MEND;
PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE QRVSH AS
SELECT *
FROM CONNECTION TO DB2 (
	SELECT DISTINCT B.DF_SPE_ACC_ID
		,A.PF_ACT
	FROM OLWHRM1.AY01_BR_ATY A
	INNER JOIN OLWHRM1.PD01_PDM_INF B
		ON A.DF_PRS_ID = B.DF_PRS_ID
	LEFT OUTER JOIN OLWHRM1.AY10_BR_LON_ATY C
		ON A.DF_PRS_ID = C.BF_SSN
	LEFT OUTER JOIN OLWHRM1.CT30_CALL_QUE D
		ON A.DF_PRS_ID = D.DF_PRS_ID_TGT
	WHERE A.PF_ACT IN ('VIPSS','SPHAN')
		AND 
		(
			(
				C.LD_ATY_RSP BETWEEN &BEGIN AND &END
			)
		OR 
			(
				D.LD_LST_CNC BETWEEN &BEGIN AND &END
			)
		)
FOR READ ONLY WITH UR
);
DISCONNECT FROM DB2;
/*%PUT  SQLXRC= >>> &SQLXRC <<< ||| SQLXMSG= >>> &SQLXMSG >>>  ;  * INCLUDES ERROR MESSAGES TO SAS LOG  ;*/
/*%SQLCHECK (SQLRPT=ULWU28.LWU28RZ);*/
/*QUIT;*/
ENDRSUBMIT;
DATA QRVSH ;
SET WORKLOCL.QRVSH;
RUN;
PROC SORT DATA=QRVSH ;
	BY DF_SPE_ACC_ID;
RUN;
PROC PRINTTO PRINT=REPORT2 NEW;
RUN;
OPTIONS ORIENTATION = LANDSCAPE;
OPTIONS PS=39 LS=127 CENTER NODATE PAGENO=1;
TITLE "QC REPORT FOR VIP AND SPECIAL HANDLING";
TITLE2 "&RUNDATE";
FOOTNOTE4   "JOB = UTLWU28  	 REPORT = ULWU28.LWU28R2";
PROC CONTENTS DATA=QRVSH OUT=EMPTYSET NOPRINT;
DATA _NULL_;
SET EMPTYSET;
FILE PRINT;
IF  NOBS=0 AND _N_ =1 THEN DO;
	PUT // 126*'-';
	PUT      //////
		@51 '**** NO OBSERVATIONS FOUND ****';
	PUT //////
		@57 '-- END OF REPORT --';
	PUT //////////////
		@46 "JOB = UTLWU28  	 REPORT = ULWU28.LWU28R2";
	END;
RETURN;
RUN;
PROC PRINT NOOBS SPLIT='/' DATA=QRVSH WIDTH=UNIFORM WIDTH=MIN LABEL;
	VAR DF_SPE_ACC_ID PF_ACT;
	LABEL DF_SPE_ACC_ID = 'ACCOUNT #'
		PF_ACT = 'ACTION/CODE';
RUN;
PROC PRINTTO;
RUN;
