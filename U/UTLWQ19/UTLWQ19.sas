/*411 Important Borrower Information QC Report*/
/*UTLWQ19*/
/*LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;*/
/*%LET RPTLIB = %SYSGET(reportdir);*/
%LET RPTLIB = T:\SAS;
FILENAME REPORT2 "&RPTLIB/ULWQ19.LWQ19R2";

options symbolgen;
DATA _NULL_;		
	CALL SYMPUT('BEGIN',"'"||PUT(INTNX('MONTH',TODAY(),-1,'beginning'), MMDDYY10.)||"'");
	CALL SYMPUT('END',"'"||PUT(INTNX('MONTH',TODAY(),-1,'end'), MMDDYY10.)||"'");
	CALL SYMPUT('BEGINT',PUT(INTNX('MONTH',TODAY(),-1,'beginning'), MMDDYY10.));
	CALL SYMPUT('ENDT',PUT(INTNX('MONTH',TODAY(),-1,'end'), MMDDYY10.));

RUN;
/*%SYSLPUT BEGIN = &BEGIN;*/
/*%SYSLPUT END = &END;*/
/*%SYSLPUT BEGINT = &BEGINT;*/
/*%SYSLPUT ENDT = &ENDT;*/
LIBNAME  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=WORK;
RSUBMIT;

PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE DEMO AS
SELECT *
FROM CONNECTION TO DB2 (

SELECT AC01.PF_ACT AS ACTION
/*	,AC01.PX_ACT_DSC AS DESCRIPTION*/
	,PD01.DF_SPE_ACC_ID AS ANO
	,AY01.DF_PRS_ID AS SSN
	,AY01.BD_ATY_PRF AS DATE
	,AY01.BF_LST_USR_AY01 AS USERID
	,RTRIM(AY01.BX_CMT) AS COMMENT
FROM	OLWHRM1.AC01_ACT AC01 
INNER JOIN OLWHRM1.AY01_BR_ATY AY01
ON AY01.PF_ACT = AC01.PF_ACT
INNER JOIN OLWHRM1.PD01_PDM_INF PD01
ON AY01.DF_PRS_ID = PD01.DF_PRS_ID
WHERE AC01.PF_ACT = 'M1411'
AND BD_ATY_PRF BETWEEN &BEGIN AND &END


);
DISCONNECT FROM DB2;
ENDRSUBMIT;
DATA DEMO; SET WORKLOCL.DEMO; RUN;

PROC SORT DATA=DEMO;
BY USERID;
RUN;

DATA _NULL_;
	SET DEMO ;
	LENGTH DESCRIPTION $600.;
	USER = USERID;
	ACT_DT = DATE;
	DESCRIPTION = CATX(',',ANO,ACTION,COMMENT);
	FILE REPORT2 DELIMITER=',' DSD DROPOVER LRECL=32767;
	FORMAT USER $10. ;
	FORMAT ACT_DT MMDDYY10. ;
	FORMAT DESCRIPTION $600. ;
	IF _N_ = 1 THEN DO;
		PUT "USER,ACT_DT,DESCRIPTION";
	END;
	DO;
	   PUT USER $ @;
	   PUT ACT_DT @;
	   PUT DESCRIPTION $ ;
	END;
RUN;
