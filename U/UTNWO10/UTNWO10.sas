/*%LET RPTLIB = %SYSGET(reportdir);*/
%LET RPTLIB = T:\SAS;
FILENAME REPORT2 "&RPTLIB/UNWO10.NWO10R2";
LIBNAME  LEGEND  REMOTE  SERVER=LEGEND SLIBREF=work  ;
RSUBMIT;
OPTIONS NOCENTER NODATE NONUMBER LS=132;
PROC SQL;
CONNECT TO DB2 (DATABASE=DNFPUTDL);
CREATE TABLE NORS AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT DISTINCT E.DF_SPE_ACC_ID
FROM  pkub.LN10_LON A 
INNER JOIN pkub.DW01_DW_CLC_CLU B
	ON A.BF_SSN = B.BF_SSN
	AND A.LN_SEQ = B.LN_SEQ
INNER JOIN pkub.PD10_PRS_NME E
	ON A.BF_SSN = E.DF_PRS_ID
LEFT OUTER JOIN pkub.LN65_LON_RPS C
	ON A.BF_SSN = C.BF_SSN
	AND A.LN_SEQ = C.LN_SEQ
	AND C.LC_STA_LON65 = 'A'
WHERE A.LC_STA_LON10 = 'R'
	AND A.LA_CUR_PRI BETWEEN 0.01 AND 49.99
	AND B.WC_DW_LON_STA NOT IN ('06','07','08','11','12','16','17','18','19','20','21','22')
	AND DAYS(A.LD_END_GRC_PRD) BETWEEN DAYS(CURRENT DATE) AND DAYS(CURRENT DATE) + 30
	AND C.BF_SSN IS NULL);
DISCONNECT FROM DB2;
QUIT;
endrsubmit  ;

DATA NORS; 
SET LEGEND.NORS; 
RUN;

PROC SORT DATA=NORS;
BY DF_SPE_ACC_ID;
RUN;

DATA _NULL_;
SET NORS ;
ARC = 'NRSGE';
FROM_DATE = '';
TO_DATE = '';
NEEDED_BY_DATE = '';
RECIPIENT_ID = '';
REGARDS_TO_CODE = '';
REGARDS_TO_ID = '';
LOAN_SEQ = 'ALL';
COMMENTS = '';
FILE REPORT2 DELIMITER=',' DSD DROPOVER LRECL=32767;
DO;
   PUT DF_SPE_ACC_ID @;
   PUT ARC @;
   PUT FROM_DATE @;
   PUT TO_DATE @;
   PUT NEEDED_BY_DATE @;
   PUT RECIPIENT_ID @;
   PUT REGARDS_TO_CODE @;
   PUT REGARDS_TO_ID @;
   PUT LOAN_SEQ @;
   PUT COMMENTS $;
END;
RUN;
