*--------------------------------------------------*
| UTLWA20 LARS - Special Allowance SAP Detail File |
*--------------------------------------------------*;
/*LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;*/
/*%LET RPTLIB = %SYSGET(reportdir);*/
%LET RPTLIB = T:\SAS;
FILENAME REPORT2 "&RPTLIB/ULWA20.LWA20R2";
FILENAME REPORTZ "&RPTLIB/ULWA20.LWA20RZ";
LIBNAME  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=WORK;
RSUBMIT;
%MACRO SQLCHECK (SQLRPT= );
%IF &SQLXRC NE 0 %THEN %DO;
	DATA _NULL_;
    FILE REPORTZ NOTITLES;
    PUT @01 " ********************************************************************* "
      / @01 " ****  THE SQL CODE ABOVE HAS EXPERIENCED AN ERROR.               **** "
      / @01 " ****  THE SAS LOG IN &SQLRPT SHOULD BE REVIEWED.          **** "       
      / @01 " ********************************************************************* "
      / @01 " ****  THE SQL ERROR CODE IS  &SQLXRC  AND THE SQL ERROR MESSAGE  **** "
      / @01 " ****  &SQLXMSG   **** "
      / @01 " ********************************************************************* ";
	RUN;
%END;
%MEND;
PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE MR83 AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT *
FROM OLWHRM1.MR83_MR_799_SPA
FOR READ ONLY WITH UR
);
DISCONNECT FROM DB2;
/*%PUT  SQLXRC= >>> &SQLXRC <<< ||| SQLXMSG= >>> &SQLXMSG >>>  ;  * INCLUDES ERROR MESSAGES TO SAS LOG  ;*/
/*%SQLCHECK (SQLRPT=ULWA20.LWA20RZ);*/
/*QUIT;*/
ENDRSUBMIT;

DATA MR83 ;
SET WORKLOCL.MR83;
RUN;

PROC SORT DATA=MR83;BY IF_OWN BF_SSN LN_SEQ;RUN;

DATA _NULL_;
SET WORK.MR83 ;
FILE REPORT2 DELIMITER=',' DSD DROPOVER LRECL=32767;
   FORMAT IF_799_RPT $8. ;
   FORMAT IF_BND_ISS $8. ;
   FORMAT WC_799_LON_PGM $2. ;
   FORMAT BF_SSN $9. ;
   FORMAT LN_SEQ 6. ;
   FORMAT WC_CAL_YR $2. ;
   FORMAT WC_CAL_QTR $1. ;
   FORMAT WC_799_SPA_CAT $2. ;
   FORMAT LR_ITR 7.3 ;
   FORMAT WC_799_SPA_ITR $6. ;
   FORMAT WC_799_SPA_BIL $2. ;
   FORMAT WA_799_PRI_END_SPA 11.2 ;
   FORMAT WA_799_AVG_BAL_SPA 11.2 ;
   FORMAT LD_LON_1_DSB DATE9. ;
   FORMAT LD_TRM_BEG DATE9. ;
   FORMAT LD_SPA_RTT DATE9. ;
   FORMAT LD_SPA_STP DATE9. ;
   FORMAT IF_OWN $8. ;
IF _N_ = 1 THEN DO;
	PUT
		'799 FEDERAL REPORTING CODE'
		','
		'OWNER BOND ISSUE IDENTIFIER'
		','
		'799 LOAN TYPE'
		','
		'BORROWER SSN'
		','
		'LOAN SEQUENCE NUMBER'
		','
		'799 PART IV YEAR CODE'
		','
		'799 PART IV QUARTER CODE'
		','
		'799 PART IV SPECIAL ALLOWANCE CATEGORY'
		','
		'INTEREST RATE'
		','
		'799 SPECIAL ALLOWANCE INTEREST RATE CODE (PART IV)'
		','
		'799 SPECIAL ALLOWANCE BILLING CODE (PART IV)'
		','
		'ENDING PRINCIPLE BALANCE REPORTED IN 799 PART IV'
		','
		'AVERAGE DAILY BALANCE (OR ADJUSTMENT) FOR 799 SPECIAL ALLOWANCE'
		','
		'DATE OF 1ST DISBURSEMENT FOR LOAN'
		','
		'LOAN TERM BEGIN DATE'
		','
		'SPECIAL ALLOWANCE RESTART DATE'
		','
		'SPECIAL ALLOWANCE STOP DATE'
		','
		'OWNER CODE';
END;
DO;
	PUT IF_799_RPT $ @;
	PUT IF_BND_ISS $ @;
	PUT WC_799_LON_PGM $ @;
	PUT BF_SSN $ @;
	PUT LN_SEQ @;
	PUT WC_CAL_YR $ @;
	PUT WC_CAL_QTR $ @;
	PUT WC_799_SPA_CAT $ @;
	PUT LR_ITR @;
	PUT WC_799_SPA_ITR $ @;
	PUT WC_799_SPA_BIL $ @;
	PUT WA_799_PRI_END_SPA @;
	PUT WA_799_AVG_BAL_SPA @;
	PUT LD_LON_1_DSB @;
	PUT LD_TRM_BEG @;
	PUT LD_SPA_RTT @;
	PUT LD_SPA_STP @;
	PUT IF_OWN $ ;
END;
RUN;
