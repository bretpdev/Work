*----------------------------*
|UTLWK28 SKIP LOCATE SUCCESS |
*----------------------------*;
/*LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;*/
%LET RPTLIB = %SYSGET(reportdir);
/*%LET RPTLIB = T:\SAS;*/
FILENAME REPORT2 "&RPTLIB/ULWK28.LWK28R2";
FILENAME REPORT3 "&RPTLIB/ULWK28.LWK28R3";
FILENAME REPORT4 "&RPTLIB/ULWK28.LWK28R4";
FILENAME REPORT5 "&RPTLIB/ULWK28.LWK28R5";
FILENAME REPORT7 "&RPTLIB/ULWK28.LWK28R7";
FILENAME REPORT8 "&RPTLIB/ULWK28.LWK28R8";
FILENAME REPORT9 "&RPTLIB/ULWK28.LWK28R9";
FILENAME REPORT11 "&RPTLIB/ULWK28.LWK28R11";
FILENAME REPORT12 "&RPTLIB/ULWK28.LWK28R12";
FILENAME REPORTZ "&RPTLIB/ULWK28.LWK28RZ";
DATA _NULL_;
    CALL SYMPUT('BEGIN',"'"||PUT(INTNX('MONTH',TODAY(),-2,'BEGINNING'), MMDDYYD10.)||"'");
	CALL SYMPUT('END',"'"||PUT(INTNX('MONTH',TODAY(),-1,'END'), MMDDYYD10.)||"'");
	CALL SYMPUT('EFFDATE',TRIM(LEFT(UPCASE(
		PUT(INTNX('MONTH',TODAY(),-1), MONNAME9.)||' '||
		PUT(INTNX('MONTH',TODAY(),-1), YEAR4.)))));
RUN;
/*%SYSLPUT BEGIN = &BEGIN;*/
/*%SYSLPUT END = &END;*/
/*LIBNAME  WORKLOCL  REMOTE  SERVER=DUSTER  SLIBREF=WORK;*/
/*RSUBMIT;*/
%MACRO SQLCHECK (SQLRPT= );
%IF &SQLXRC NE 0 %THEN %DO;
	DATA _NULL_;
    FILE REPORTZ NOTITLES;
    PUT @01 " ********************************************************************* "
      / @01 " ****  THE SQL CODE ABOVE HAS EXPERIENCED AN ERROR.               **** "
      / @01 " ****  THE SAS LOG IN &SQLRPT SHOULD BE REVIEWED.          **** "       
      / @01 " ********************************************************************* "
      / @01 " ****  THE SQL ERROR CODE IS  &SQLXRC  AND THE SQL ERROR MESSAGE  **** "
      / @01 " ****  &SQLXMSG   **** "
      / @01 " ********************************************************************* ";
	RUN;
%END;
%MEND;

PROC SQL;
	CONNECT TO DB2 (DATABASE=DLGSUTWH);

	CREATE TABLE SKPLSU_RDAT AS
		SELECT 
			*
		FROM 
			CONNECTION TO DB2 
				(
				SELECT DISTINCT
					PD10.DF_SPE_ACC_ID
					,PD10.DF_PRS_ID
					,COALESCE(AY01.BD_ATY_PRF, AY10.LD_ATY_REQ_RCV) AS BD_ATY_PRF
					,COALESCE(AY01.BX_CMT, AY20.LX_ATY) AS BX_CMT
					,COALESCE(AY01.BF_LST_USR_AY01, AY10.LF_USR_REQ_ATY) AS BF_LST_USR_AY01
					,COALESCE(AY01.BF_CRT_DTS_AY01, AY10.LF_LST_DTS_AY10) AS BF_CRT_DTS_AY01
					,COALESCE(PD01.DC_SKP_TRC_STA, SKP.DC_SKP_TRC_STA, ' ') AS DC_SKP_TRC_STA
					,COALESCE(PD01.DD_SKP_TRC_EFF, SKP.DD_SKP_BEG) AS DD_SKP_TRC_EFF
					,CASE 
						WHEN DC01.LC_STA_DC10 = '03' and GA14.AC_LON_STA_REA IN ('DF','DQ','IN') AND DC01.LD_CLM_ASN_DOE IS NULL
							THEN 'DEFAULT'
						WHEN GA14.AC_LON_STA_TYP = 'CP' and GA14.AC_LON_STA_REA IN ('DF','DQ')
							THEN 'DEFAULT'
						WHEN DW01.WC_DW_LON_STA = '12' /*and LN10B.LF_LON_CUR_OWN in ('826717','830248')*/
							THEN 'DEFAULT'
						WHEN DC01.LC_STA_DC10 = '01' and GA14.AC_LON_STA_REA IN ('DF','DQ')
							THEN 'PRECLAIM'
						WHEN DW01.WC_DW_LON_STA = '14' /*and LN10B.LF_LON_CUR_OWN in ('826717','830248')*/
							THEN 'PRECLAIM'
						ELSE 'OTHER'
					END STATUS
					,COALESCE(DC01.LF_CUR_LON_SER_AGY, SV30.PF_SER_AGY) AS LF_CUR_LON_SER_AGY
					,TLP.HAS_TILP
					,CASE
						WHEN LN10.LA_CUR_PRI > 0 THEN 'Y'
						ELSE 'N'
					END COMP_BOR
				FROM
					OLWHRM1.PD10_PRS_NME PD10
					LEFT JOIN OLWHRM1.AY10_BR_LON_ATY AY10
						ON PD10.DF_PRS_ID = AY10.BF_SSN
						AND AY10.PF_REQ_ACT = 'SFNDM'
						AND AY10.LD_ATY_REQ_RCV BETWEEN &BEGIN AND &END
					LEFT JOIN OLWHRM1.AY01_BR_ATY AY01
						ON PD10.DF_PRS_ID = AY01.DF_PRS_ID
						AND AY01.PF_ACT = 'SFNDM'
						AND AY01.BD_ATY_PRF BETWEEN &BEGIN AND &END
					LEFT JOIN OLWHRM1.AY20_ATY_TXT AY20
						ON PD10.DF_PRS_ID = AY20.BF_SSN
						AND AY10.LN_ATY_SEQ = AY20.LN_ATY_SEQ
					LEFT JOIN OLWHRM1.PD01_PDM_INF PD01
						ON PD10.DF_PRS_ID = PD01.DF_PRS_ID
					LEFT JOIN (
							SELECT
								PD27.DF_PRS_ID
								,PD27.DD_SKP_BEG
								,'R' AS DC_SKP_TRC_STA
							FROM
								OLWHRM1.PD27_PRS_SKP_PRC PD27
							WHERE PD27.DC_STA_SKP = '2'
								) SKP
						ON AY10.BF_SSN = SKP.DF_PRS_ID
						AND DAYS(SKP.DD_SKP_BEG) BETWEEN DAYS(AY10.LD_ATY_REQ_RCV) AND DAYS(AY10.LD_ATY_REQ_RCV) + 31
					LEFT JOIN OLWHRM1.DC01_LON_CLM_INF DC01
						ON PD10.DF_PRS_ID = DC01.BF_SSN
					LEFT JOIN OLWHRM1.GA14_LON_STA GA14
						ON DC01.AF_APL_ID = GA14.AF_APL_ID
						AND DC01.AF_APL_ID_SFX = GA14.AF_APL_ID_SFX
						AND GA14.AC_STA_GA14 = 'A'
					LEFT JOIN (
							SELECT
								DW01.BF_SSN
								,DW01.LN_SEQ
								,DW01.WC_DW_LON_STA
							FROM OLWHRM1.DW01_DW_CLC_CLU DW01
								INNER JOIN (
										SELECT DISTINCT
											LN10.BF_SSN
											,LN10.LN_SEQ
										FROM 
											OLWHRM1.LN10_LON LN10
										WHERE 
											LN10.LF_LON_CUR_OWN IN ('826717','830248','829769','82976901','82976902','82976903','82976904','82976905','82976906' ,'82976907','82976908')
											AND
											LN10.LD_LON_EFF_ADD > '01/01/2014'
											AND
											LN10.LC_STA_LON10 = 'R'
											AND 
											LN10.LA_CUR_PRI > 0
											) LN10
									ON DW01.BF_SSN = LN10.BF_SSN
									AND DW01.LN_SEQ = LN10.LN_SEQ
								)DW01
						ON PD10.DF_PRS_ID = DW01.BF_SSN
					LEFT JOIN OLWHRM1.SV30_SER_TXT SV30
						ON PD10.DF_PRS_ID = SV30.BF_SSN
					LEFT JOIN (
							SELECT 
								LN10.BF_SSN
								,1 AS HAS_TILP
							FROM OLWHRM1.LN10_LON LN10
							WHERE LN10.IC_LON_PGM = 'TILP' 
								) TLP
						ON PD10.DF_PRS_ID = TLP.BF_SSN 
					LEFT JOIN (
							SELECT DISTINCT
								LN10.BF_SSN
								,SUM(LN10.LA_CUR_PRI) AS LA_CUR_PRI
							FROM OLWHRM1.LN10_LON LN10
							GROUP BY 
								LN10.BF_SSN
								) LN10
						ON PD10.DF_PRS_ID = LN10.BF_SSN
/*					LEFT JOIN (*/
/*							SELECT DISTINCT*/
/*								LN10.BF_SSN*/
/*								,LN10.LF_LON_CUR_OWN*/
/*							FROM OLWHRM1.LN10_LON LN10*/
/*								) LN10B*/
/*						ON PD10.DF_PRS_ID = LN10B.BF_SSN*/
		WHERE	
			AY10.BF_SSN IS NOT NULL
			OR 
			AY01.DF_PRS_ID IS NOT NULL

					FOR READ ONLY WITH UR
				)
	;

	DISCONNECT FROM DB2;

	/*%PUT  SQLXRC= >>> &SQLXRC <<< ||| SQLXMSG= >>> &SQLXMSG >>> ;  ** INCLUDES ERROR MESSAGES TO SAS LOG  ;*/
	/*%SQLCHECK;*/
QUIT;

/*ENDRSUBMIT;*/

/*DATA SKPLSU_RDAT;
	SET WORKLOCL.SKPLSU_RDAT;
RUN;*/

DATA SKPLSU_RDAT (DROP=START FINISH GET);
	SET SKPLSU_RDAT;
	LENGTH ENDESC $ 100;
	START = INDEX(BX_CMT,'-')+1;
	FINISH = INDEX(BX_CMT,'{')-1;
	GET = FINISH-START;
	ENDESC = LEFT(TRIM(SUBSTR(BX_CMT,START,GET)));
	PRV_SKP_TYP = SUBSTR(BX_CMT,17,1);
	LOC_TYP = SUBSTR(BX_CMT,32,3);
	LC = 1;
RUN;

/*SEPARATE TILP DATA*/;
DATA TILP_DATA SKPLSU_RDAT;
	SET SKPLSU_RDAT;
	IF HAS_TILP THEN OUTPUT TILP_DATA;
		ELSE OUTPUT SKPLSU_RDAT;
RUN;

PROC SQL;
CREATE TABLE SETSTATUS AS
SELECT DISTINCT DF_SPE_ACC_ID
	,SKPLSU.DF_PRS_ID
	,BD_ATY_PRF
	,BX_CMT
	,BF_LST_USR_AY01
	,BF_CRT_DTS_AY01
	,DC_SKP_TRC_STA
	,DD_SKP_TRC_EFF
	,CASE
		WHEN SKPLSUD.STATUS = 'DEFAULT' 
			THEN 'DEFAULT'
		WHEN SKPLSUP.STATUS = 'PRECLAIM' 
			THEN 'PRECLAIM'
		ELSE 'OTHER'
	END AS STATUS
	,LF_CUR_LON_SER_AGY 
	,ENDESC
	,PRV_SKP_TYP 
	,LOC_TYP 
	,LC
	,COMP_BOR
FROM SKPLSU_RDAT SKPLSU
LEFT OUTER JOIN (SELECT DISTINCT S.DF_PRS_ID, S.STATUS 
				FROM SKPLSU_RDAT S
				WHERE S.STATUS = 'DEFAULT'
				) SKPLSUD
	ON SKPLSU.DF_PRS_ID = SKPLSUD.DF_PRS_ID
LEFT OUTER JOIN (SELECT DISTINCT S.DF_PRS_ID, S.STATUS 
				FROM SKPLSU_RDAT S
				WHERE S.STATUS = 'PRECLAIM'
				) SKPLSUP
	ON SKPLSU.DF_PRS_ID = SKPLSUP.DF_PRS_ID
;
QUIT;
DATA SKPLSU_RDAT;
	SET SETSTATUS;
RUN;
DATA PREV RSTRTS;
	SET SKPLSU_RDAT;
	IF MONTH(BD_ATY_PRF) = MONTH(INTNX('MONTH',TODAY(),-1,'END')) THEN 
		OUTPUT PREV ;
	ELSE 
		OUTPUT RSTRTS;
RUN;
DATA R7TB R8TB R9TB;
	SET PREV;
	IF STATUS = 'DEFAULT' THEN 
		OUTPUT R9TB;
	ELSE IF COMP_BOR EQ 'Y' THEN 
		OUTPUT R8TB;
	ELSE 
		OUTPUT R7TB;
RUN;
/*GET DATASET FOR RESTARTS*/
DATA RSTRTS;
	SET PREV RSTRTS;
	WHERE DC_SKP_TRC_STA IN ('R','S');
RUN;
/*CALCULATE RESTART SKIPS*/
DATA RSTRTS;
	SET RSTRTS;
	IF BD_ATY_PRF < DD_SKP_TRC_EFF < BD_ATY_PRF+30 THEN 
		OUTPUT;
RUN;
%MACRO GET_INT(DS,BYVARS,FRSTVAR,INT);
PROC SORT DATA=&DS ; BY &BYVARS ;RUN;
DATA &DS;
	SET &DS;
	BY &BYVARS;
	IF FIRST.&FRSTVAR THEN 
		&INT=1;
RUN;
%MEND GET_INT;

%GET_INT(PREV,DF_PRS_ID ENDESC,ENDESC,LOC_I);
%GET_INT(PREV,DF_PRS_ID BF_LST_USR_AY01,BF_LST_USR_AY01,USR_I);
%GET_INT(RSTRTS,DF_PRS_ID ENDESC,ENDESC,ENDESC_RESKP_I);

PROC SORT DATA=RSTRTS;BY STATUS ENDESC BF_LST_USR_AY01 BD_ATY_PRF DF_SPE_ACC_ID;RUN;

PROC SORT DATA=PREV;BY STATUS ENDESC;RUN;

PROC PRINTTO PRINT=REPORT2 NEW;/*APPENDING OTHER STATUSES*/
RUN;

%MACRO PRINT_R2(STA);
	DATA DS;
		SET PREV;
		WHERE STATUS = "&STA" AND LOC_I = 1;
	RUN;

	PROC PRINTTO PRINT=REPORT2;/*APPENDING OTHER STATUSES*/
	RUN;
		OPTIONS ORIENTATION = LANDSCAPE;
		OPTIONS PS=39 LS=127 PAGENO=1 DATE;
		TITLE "TOTAL SKIP LOCATES FOR &EFFDATE BY LOCATE TYPE";
		FOOTNOTE 'JOB = UTLWK28  	 REPORT = ULWK28.LWK28R2';

	PROC CONTENTS DATA=DS OUT=EMPTYSET NOPRINT;
	DATA _NULL_;
		SET EMPTYSET;
		FILE PRINT;
		IF  NOBS=0 AND _N_ =1 THEN DO;
			PUT // 132*'-';
			PUT      ////////
				@51 '**** NO RECORDS FOUND ****';
			PUT ////////
				@57 '-- END OF REPORT --';
			PUT ////////////////
				@46 "JOB = UTLWK28  	 REPORT = ULWK28.LWK28R2";
	END;
	RETURN;
	RUN;

	PROC REPORT DATA=DS NOWD HEADSKIP SPLIT='*';
		COLUMNS ENDESC STATUS LOC_I;
		DEFINE ENDESC / GROUP 'TYPE' WIDTH=50 ;
		DEFINE STATUS / GROUP 'LOAN STATUS' WIDTH=9 ;
		DEFINE LOC_I / ANALYSIS "TOTAL LOCATES BY TYPE" ;
		COMPUTE AFTER ;
		LINE @34 61*'-';
		LINE @34 'TOTAL' @83 LOC_I.SUM;
		ENDCOMP;
	RUN;
%MEND ;

%PRINT_R2(DEFAULT);
%PRINT_R2(PRECLAIM);
%PRINT_R2(OTHER);
/*REPORT TOTALS*/
PROC REPORT DATA=PREV NOWD HEADSKIP SPLIT='*' HEADLINE;
	COLUMNS LOC_I LOC;
	DEFINE LOC_I / ANALYSIS NOPRINT ;
	DEFINE LOC / COMPUTED "GRAND TOTAL";
	COMPUTE LOC;
	LOC = LOC_I.SUM;
	ENDCOMP;
RUN;

PROC PRINTTO PRINT=REPORT3 NEW;
RUN;

	OPTIONS ORIENTATION = LANDSCAPE;
	OPTIONS PS=39 LS=127 PAGENO=1 DATE;
	TITLE "TOTAL SKIP LOCATES FOR &EFFDATE BY USER ID";
	FOOTNOTE 'JOB = UTLWK28  	 REPORT = ULWK28.LWK28R3';

PROC REPORT DATA=PREV NOWD HEADSKIP SPLIT='*';
	COLUMNS BF_LST_USR_AY01 USR_I;
	DEFINE BF_LST_USR_AY01 / GROUP 'USER ID' WIDTH=50 ;
	DEFINE USR_I / SUM "TOTAL LOCATES BY USER" ;
	COMPUTE AFTER ;
	LINE @34 61*'-';
	LINE @34 'TOTAL' @83 USR_I.SUM;
	ENDCOMP;
RUN;

PROC PRINTTO PRINT=REPORT4 NEW;
RUN;

	OPTIONS ORIENTATION = LANDSCAPE;
	OPTIONS PS=39 LS=127 PAGENO=1 DATE;
	TITLE "TOTAL SKIP RESTARTS FOR &EFFDATE BY TYPE";
	FOOTNOTE 'JOB = UTLWK28  	 REPORT = ULWK28.LWK28R4';

PROC REPORT DATA=RSTRTS NOWD HEADSKIP SPLIT='*';
	COLUMNS ENDESC ENDESC_RESKP_I;
	DEFINE ENDESC / GROUP 'USER ID' WIDTH=50 ;
	DEFINE ENDESC_RESKP_I / SUM "TOTAL SKIP RESTARTS BY TYPE" ;
	COMPUTE AFTER ;
	LINE @34 61*'-';
	LINE @34 'TOTAL' @83 ENDESC_RESKP_I.SUM;
	ENDCOMP;
RUN;

PROC PRINTTO PRINT=REPORT5 NEW;
RUN;

	OPTIONS ORIENTATION = LANDSCAPE;
	OPTIONS PS=39 LS=127 PAGENO=1 DATE;
	TITLE "TOTAL SKIP RESTARTS FOR &EFFDATE DETAIL REPORT";
	FOOTNOTE 'JOB = UTLWK28  	 REPORT = ULWK28.LWK28R5';

PROC REPORT DATA=RSTRTS NOWD HEADSKIP SPLIT='*';
	COLUMNS DF_SPE_ACC_ID BD_ATY_PRF DD_SKP_TRC_EFF ENDESC BF_LST_USR_AY01;
	WHERE ENDESC_RESKP_I = 1;
	DEFINE DF_SPE_ACC_ID / DISPLAY 'ACCOUNT #' WIDTH=10 ;
	DEFINE BD_ATY_PRF / DISPLAY "ACTIVITY DATE" WIDTH=10 FORMAT=MMDDYY10.;
	DEFINE DD_SKP_TRC_EFF / DISPLAY "SKIP START" WIDTH=10 FORMAT=MMDDYY10.;
	DEFINE ENDESC / DISPLAY "LOCATE TYPE" WIDTH=50 FLOW;
	DEFINE BF_LST_USR_AY01 / DISPLAY "USER ID" WIDTH=10;
RUN;

PROC PRINTTO;
RUN;
/*----------------------------------------------------------*/
/*PRINT R7*/
%GET_INT(R7TB,DF_PRS_ID ENDESC,ENDESC,LOC_I);

PROC PRINTTO PRINT=REPORT7 NEW;/*APPENDING OTHER STATUSES*/
RUN;

%MACRO PRINT_R7(STA);
	DATA DS;
		SET R7TB;
		WHERE STATUS = "&STA" AND LOC_I = 1;
	RUN;

	PROC PRINTTO PRINT=REPORT7;/*APPENDING OTHER STATUSES*/
	RUN;
		OPTIONS ORIENTATION = LANDSCAPE;
		OPTIONS PS=39 LS=127 PAGENO=1 DATE;
		TITLE "LOAN STATUS AND LOCATE TYPE - NON-SERVICED LOANS";
		FOOTNOTE 'JOB = UTLWK28  	 REPORT = ULWK28.LWK28R7';

	PROC CONTENTS DATA=DS OUT=EMPTYSET NOPRINT;
		DATA _NULL_;
		SET EMPTYSET;
		FILE PRINT;
		IF  NOBS=0 AND _N_ =1 THEN DO;
			PUT // 132*'-';
			PUT      ////////
				@51 '**** NO RECORDS FOUND ****';
			PUT ////////
				@57 '-- END OF REPORT --';
			PUT ////////////////
				@46 "JOB = UTLWK28  	 REPORT = ULWK28.LWK28R7";
		END;
	RETURN;
	RUN;

	PROC REPORT DATA=DS NOWD HEADSKIP SPLIT='*';
		COLUMNS ENDESC STATUS LOC_I;
		DEFINE ENDESC / GROUP 'TYPE' WIDTH=50 ;
		DEFINE STATUS / GROUP 'LOAN STATUS' WIDTH=9 ;
		DEFINE LOC_I / ANALYSIS "TOTAL LOCATES BY TYPE" ;
		COMPUTE AFTER ;
		LINE @34 61*'-';
		LINE @34 'TOTAL' @83 LOC_I.SUM;
		ENDCOMP;
	RUN;
%MEND ;

%PRINT_R7(PRECLAIM);
%PRINT_R7(OTHER);

/*REPORT TOTALS*/
PROC REPORT DATA=R7TB NOWD HEADSKIP SPLIT='*' HEADLINE;
	COLUMNS LOC_I LOC;
	DEFINE LOC_I / ANALYSIS NOPRINT ;
	DEFINE LOC / COMPUTED "GRAND TOTAL";
	COMPUTE LOC;
	LOC = LOC_I.SUM;
	ENDCOMP;
RUN;

/*----------------------------------------------------------*/
/*----------------------------------------------------------*/
/*PRINT R8*/
%GET_INT(R8TB,DF_PRS_ID ENDESC,ENDESC,LOC_I);

PROC PRINTTO PRINT=REPORT8 NEW;/*APPENDING OTHER STATUSES*/
RUN;

%MACRO PRINT_R8(STA);
	DATA DS;
		SET R8TB;
		WHERE STATUS = "&STA" AND LOC_I = 1;
	RUN;

	PROC PRINTTO PRINT=REPORT8;/*APPENDING OTHER STATUSES*/
	RUN;
		OPTIONS ORIENTATION = LANDSCAPE;
		OPTIONS PS=39 LS=127 PAGENO=1 DATE;
		TITLE "LOAN STATUS AND LOCATE TYPE - INHOUSE SERVICED LOANS";
		FOOTNOTE 'JOB = UTLWK28  	 REPORT = ULWK28.LWK28R8';

	PROC CONTENTS DATA=DS OUT=EMPTYSET NOPRINT;
	DATA _NULL_;
		SET EMPTYSET;
		FILE PRINT;
		IF  NOBS=0 AND _N_ =1 THEN DO;
			PUT // 132*'-';
			PUT      ////////
				@51 '**** NO RECORDS FOUND ****';
			PUT ////////
				@57 '-- END OF REPORT --';
			PUT ////////////////
				@46 "JOB = UTLWK28  	 REPORT = ULWK28.LWK28R8";
	END;
	RETURN;
	RUN;

	PROC REPORT DATA=DS NOWD HEADSKIP SPLIT='*';
		COLUMNS ENDESC STATUS LOC_I;
		DEFINE ENDESC / GROUP 'TYPE' WIDTH=50 ;
		DEFINE STATUS / GROUP 'LOAN STATUS' WIDTH=9 ;
		DEFINE LOC_I / ANALYSIS "TOTAL LOCATES BY TYPE" ;
		COMPUTE AFTER ;
		LINE @34 61*'-';
		LINE @34 'TOTAL' @83 LOC_I.SUM;
		ENDCOMP;
	RUN;
%MEND ;

%PRINT_R8(PRECLAIM);
%PRINT_R8(OTHER);

/*REPORT TOTALS*/
PROC REPORT DATA=R8TB NOWD HEADSKIP SPLIT='*' HEADLINE;
	COLUMNS LOC_I LOC;
	DEFINE LOC_I / ANALYSIS NOPRINT ;
	DEFINE LOC / COMPUTED "GRAND TOTAL";
	COMPUTE LOC;
	LOC = LOC_I.SUM;
	ENDCOMP;
RUN;

/*----------------------------------------------------------*/
/*----------------------------------------------------------*/
/*PRINT R9*/
%GET_INT(R9TB,DF_PRS_ID ENDESC,ENDESC,LOC_I);

PROC PRINTTO PRINT=REPORT9 NEW;/*APPENDING OTHER STATUSES*/
RUN;

%MACRO PRINT_R9(STA);
	DATA DS;
		SET R9TB;
		WHERE STATUS = "&STA" AND LOC_I = 1;
	RUN;

	PROC PRINTTO PRINT=REPORT9;/*APPENDING OTHER STATUSES*/
	RUN;
		OPTIONS ORIENTATION = LANDSCAPE;
		OPTIONS PS=39 LS=127 PAGENO=1 DATE;
		TITLE "LOAN STATUS AND LOCATE TYPE - DEFAULT";
		FOOTNOTE 'JOB = UTLWK28  	 REPORT = ULWK28.LWK28R9';

	PROC CONTENTS DATA=DS OUT=EMPTYSET NOPRINT;
	DATA _NULL_;
		SET EMPTYSET;
		FILE PRINT;
		IF  NOBS=0 AND _N_ =1 THEN DO;
			PUT // 132*'-';
			PUT      ////////
				@51 '**** NO RECORDS FOUND ****';
			PUT ////////
				@57 '-- END OF REPORT --';
			PUT ////////////////
				@46 "JOB = UTLWK28  	 REPORT = ULWK28.LWK28R8";
	END;
	RETURN;
	RUN;

	PROC REPORT DATA=DS NOWD HEADSKIP SPLIT='*';
		COLUMNS ENDESC STATUS LOC_I;
		DEFINE ENDESC / GROUP 'TYPE' WIDTH=50 ;
		DEFINE STATUS / GROUP 'LOAN STATUS' WIDTH=9 ;
		DEFINE LOC_I / ANALYSIS "TOTAL LOCATES BY TYPE" ;
		COMPUTE AFTER ;
		LINE @34 61*'-';
		LINE @34 'TOTAL' @83 LOC_I.SUM;
		ENDCOMP;
	RUN;
%MEND ;
%PRINT_R9(DEFAULT);

/*REPORT TOTALS*/
PROC REPORT DATA=R9TB NOWD HEADSKIP SPLIT='*' HEADLINE;
	COLUMNS LOC_I LOC;
	DEFINE LOC_I / ANALYSIS NOPRINT ;
	DEFINE LOC / COMPUTED "GRAND TOTAL";
	COMPUTE LOC;
	LOC = LOC_I.SUM;
	ENDCOMP;
RUN;

/*----------------------------------------------------------*/

PROC PRINTTO;
RUN;

PROC PRINTTO PRINT=REPORT11 NEW;
RUN;

	OPTIONS ORIENTATION = LANDSCAPE;
	OPTIONS PS=39 LS=127 PAGENO=1 CENTER DATE;
	TITLE 'TILP LOCATES';
	FOOTNOTE   'JOB = UTLWK28  	 REPORT = ULWK28.LWK28R11';

PROC CONTENTS DATA=TILP_DATA OUT=EMPTYSET NOPRINT;

DATA _NULL_;
	SET EMPTYSET;
	FILE PRINT;
	IF  NOBS=0 AND _N_ =1 THEN DO;
		PUT // 126*'-';
		PUT      ////
			@51 '**** NO OBSERVATIONS FOUND ****';
		PUT ////
			@57 '-- END OF REPORT --';
		PUT ////////////
			@46 "JOB = UTLWK28  	 REPORT = ULWK28.LWK28R11";
	END;
	RETURN;
RUN;

PROC REPORT DATA=TILP_DATA NOWD HEADSKIP SPLIT='*' HEADLINE;
	WHERE INTNX('MONTH',TODAY(),-1,'B') <= BD_ATY_PRF <= INTNX('MONTH',TODAY(),-1,'E');
	COLUMNS BF_LST_USR_AY01 ENDESC DF_SPE_ACC_ID LC;
	DEFINE BF_LST_USR_AY01  / 'USER ID' GROUP;
	DEFINE ENDESC / 'LOCATE TYPE' GROUP WIDTH = 30;
	DEFINE DF_SPE_ACC_ID / 'BORROWER' GROUP;
	DEFINE LC / ANALYSIS '*' FORMAT=COMMA7.;
	BREAK AFTER ENDESC / SUMMARIZE SUPPRESS SKIP OL;
	COMPUTE AFTER BF_LST_USR_AY01;
		LINE @34 61*'-';
		LINE @34 'LOCATES FOR ' BF_LST_USR_AY01 $8. ': ' @ 88 LC.SUM COMMA7.;
		LINE '';
	ENDCOMP;
	COMPUTE AFTER;
		LINE ' ';
		LINE @34 'TOTAL NUMBER OF LOCATES: ' @ 88 LC.SUM COMMA7.;
	ENDCOMP;
RUN;

PROC PRINTTO;
RUN;

DATA K28_R12;
	SET TILP_DATA;
	WHERE INTNX('MONTH',TODAY(),-1,'B') <= BD_ATY_PRF <= INTNX('MONTH',TODAY(),-1,'E');
RUN; 

PROC SORT DATA=K28_R12 NODUPKEY;
	BY DF_PRS_ID BF_CRT_DTS_AY01;
RUN;

PROC PRINTTO PRINT=REPORT12 NEW;
RUN;

	OPTIONS ORIENTATION = LANDSCAPE;
	OPTIONS PS=39 LS=127 PAGENO=1 CENTER DATE;
	TITLE 'SKIP LOCATE SUCCESS DETAIL';
	FOOTNOTE   'JOB = UTLWK28  	 REPORT = ULWK28.LWK28R12';

PROC CONTENTS DATA=K28_R12 OUT=EMPTYSET NOPRINT;

DATA _NULL_;
	SET EMPTYSET;
	FILE PRINT;
	IF  NOBS=0 AND _N_ =1 THEN DO;
		PUT // 126*'-';
		PUT      ////
			@51 '**** NO OBSERVATIONS FOUND ****';
		PUT ////
			@57 '-- END OF REPORT --';
		PUT ////////////
			@46 "JOB = UTLWK28  	 REPORT = ULWK28.LWK28R12";
	END;
	RETURN;
RUN;

PROC REPORT DATA=K28_R12 NOWD HEADSKIP SPLIT='*' HEADLINE;
	COLUMNS BF_LST_USR_AY01 DF_SPE_ACC_ID LC;
	DEFINE BF_LST_USR_AY01  / 'USER ID' GROUP;
	DEFINE DF_SPE_ACC_ID / 'BORROWER' GROUP;
	DEFINE LC / ANALYSIS '*' FORMAT=COMMA7.;
	BREAK AFTER BF_LST_USR_AY01 / SUMMARIZE SUPPRESS SKIP OL;
	COMPUTE AFTER;
		LINE ' ';
		LINE @47 'TOTAL NUMBER OF LOCATES: ' LC.SUM COMMA7.;
	ENDCOMP;
RUN;

PROC PRINTTO;
RUN;


/*DETAIL FILES*/
/*%MACRO DETAIL(DS,FILE);*/
/*PROC EXPORT DATA=&DS*/
/*            OUTFILE= "T:\SAS\&FILE.xls" */
/*            DBMS=EXCEL2000 REPLACE;*/
/*RUN;*/
/*%MEND DETAIL;*/
/*%DETAIL(PREV,UTLWK28_DETAIL_1);*/
/*%DETAIL(RSTRTS,UTLWK28_DETAIL_2);*/
