*----------------------------------------*
| UTLWO60 - FOREIGN SCHOOL SET UP REPORT |
*----------------------------------------*;
/*LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;*/
/*%LET RPTLIB = %SYSGET(reportdir);*/
%LET RPTLIB = T:\SAS;
FILENAME REPORT2 "&RPTLIB/ULWO60.LWO60R2";
FILENAME REPORTZ "&RPTLIB/ULWO60.LWO60RZ";
DATA _NULL_;
     CALL SYMPUT('RUNDT',PUT(INTNX('DAY',TODAY(),0,'BEGINNING'), MMDDYYD10.));
RUN;
LIBNAME  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=WORK;
RSUBMIT;
%MACRO SQLCHECK (SQLRPT= );
%IF &SQLXRC NE 0 %THEN %DO;
	DATA _NULL_;
    FILE REPORTZ NOTITLES;
    PUT @01 " ********************************************************************* "
      / @01 " ****  THE SQL CODE ABOVE HAS EXPERIENCED AN ERROR.               **** "
      / @01 " ****  THE SAS LOG IN &SQLRPT SHOULD BE REVIEWED.          **** "       
      / @01 " ********************************************************************* "
      / @01 " ****  THE SQL ERROR CODE IS  &SQLXRC  AND THE SQL ERROR MESSAGE  **** "
      / @01 " ****  &SQLXMSG   **** "
      / @01 " ********************************************************************* ";
	RUN;
%END;
%MEND;
PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE FSSUR AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT DISTINCT A.IF_DOE_SCL
	,C.IM_SCL_FUL
	,B.IC_LON_PGM
	,B.IF_LST_USR_SC22
	,DATE(B.IF_LST_DTS_SC22) AS IF_LST_DTS_SC22
FROM OLWHRM1.SC25_SCH_DPT A
INNER JOIN OLWHRM1.SC22_SCH_STA_TRK B
	ON A.IF_DOE_SCL = B.IF_DOE_SCL
INNER JOIN OLWHRM1.SC10_SCH_DMO C
	ON A.IF_DOE_SCL = C.IF_DOE_SCL
WHERE A.IC_SCL_DOM_ST IN ('','FC')
AND A.IC_SCL_DPT = '000' 
AND B.IC_STA_SCL_DOE NOT IN ('I','K','G')
AND C.IC_CUR_SCL_STA = 'O'
FOR READ ONLY WITH UR
);
DISCONNECT FROM DB2;
/*%PUT  SQLXRC= >>> &SQLXRC <<< ||| SQLXMSG= >>> &SQLXMSG >>>  ;  * INCLUDES ERROR MESSAGES TO SAS LOG  ;*/
/*%SQLCHECK (SQLRPT=ULWO60.LWO60RZ);*/
/*QUIT;*/
ENDRSUBMIT;
DATA FSSUR;
	SET WORKLOCL.FSSUR;
RUN;
PROC SORT DATA=FSSUR;BY IF_DOE_SCL;RUN;
DATA _NULL_;
	SET FSSUR ;
	LENGTH DESCRIPTION $600.;
	USER = IF_LST_USR_SC22;
	ACT_DT = IF_LST_DTS_SC22;
	DESCRIPTION = CATX(',',IF_DOE_SCL,IM_SCL_FUL,IC_LON_PGM);
	FILE REPORT2 DELIMITER=',' DSD DROPOVER LRECL=32767;
	FORMAT USER $10. ;
	FORMAT ACT_DT MMDDYY10. ;
	FORMAT DESCRIPTION $600. ;
	IF _N_ = 1 THEN DO;
		PUT "USER,ACT_DT,DESCRIPTION";
	END;
	DO;
	   PUT USER $ @;
	   PUT ACT_DT @;
	   PUT DESCRIPTION $ ;
	END;
RUN;
