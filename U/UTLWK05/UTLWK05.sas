/*LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;
%LET RPTLIB = %SYSGET(reportdir);
FILENAME REPORT2 "&RPTLIB/ULWK05.LWK05R2";*/

LIBNAME  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=WORK;
options symbolgen;
DATA _NULL_;
	EFFDT = TODAY() - 1;
    CALL SYMPUT('EFFDATE',put(EFFDT,MMDDYY10.));
	CALL SYMPUT('RUNDATE',"'"||put(EFFDT,MMDDYY10.)||"'");
RUN;

%SYSLPUT RUNDATE = &RUNDATE;	
RSUBMIT;
PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
/*ONELINK*/
CREATE TABLE DEMO AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT
	A.BF_LST_USR_AY01 AS USERID
	,A.PF_ACT AS ARC 
	,A.DF_PRS_ID AS SSN
FROM	OLWHRM1.AY01_BR_ATY A 
WHERE A.PF_ACT IN ('KLINV', 'KSLRF', 'KULRF', 'KSRVH')
	AND A.BD_ATY_PRF = &RUNDATE 

);
/*COMPASS*/
CREATE TABLE DEMO1 AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT
	A.LF_USR_REQ_ATY AS USERID
	,A.PF_REQ_ACT AS ARC 
	,A.BF_SSN AS SSN
FROM	OLWHRM1.AY10_BR_LON_ATY A 
WHERE A.PF_REQ_ACT IN ('S4LRM')
	AND A.LD_REQ_RSP_ATY_PRF = &RUNDATE 

);

DISCONNECT FROM DB2;
ENDRSUBMIT;
DATA WORKLOCL.DEMO3;
	SET WORKLOCL.DEMO WORKLOCL.DEMO1;


PROC SORT DATA=WORKLOCL.DEMO3;
BY USERID;
RUN;
/*PROC PRINTTO PRINT=REPORT2;
RUN;*/
OPTIONS PAGENO=1 ORIENTATION=PORTRAIT;
OPTIONS PS=52 LS=96;

PROC PRINT NOOBS SPLIT='/' DATA=WORKLOCL.DEMO3 N='TOTAL = ' WIDTH = MIN;
BY USERID;
VAR ARC SSN;
TITLE	"Locate Services' Returned Mail Audit Report";
TITLE2  "For &EFFDATE";
FOOTNOTE  'JOB = UTLWK05     REPORT = ULWK05.LWK05R2';
RUN;
