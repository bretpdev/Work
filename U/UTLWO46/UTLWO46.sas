/*=================================*/
/*UTLWO46 48 On Time Disqualification - Lns 1st Disb GE 05-01-06 - Non In Schl*/
/*=================================*/
/*LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;*/
/*%LET RPTLIB = %SYSGET(reportdir);*/
/*FILENAME REPORT2 "&RPTLIB/ULWO46.LWO46R2";*/
/*FILENAME REPORTZ "&RPTLIB/ULWO46.LWO46RZ";*/
FILENAME REPORT2 'T:\SAS\ULWO46.LWO46R2';
LIBNAME  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=WORK;
RSUBMIT;
%MACRO SQLCHECK (SQLRPT= );
%IF &SQLXRC NE 0 %THEN %DO;
	DATA _NULL_;
    FILE REPORTZ NOTITLES;
    PUT @01 " ********************************************************************* "
      / @01 " ****  THE SQL CODE ABOVE HAS EXPERIENCED AN ERROR.               **** "
      / @01 " ****  THE SAS LOG IN &SQLRPT SHOULD BE REVIEWED.          **** "       
      / @01 " ********************************************************************* "
      / @01 " ****  THE SQL ERROR CODE IS  &SQLXRC  AND THE SQL ERROR MESSAGE  **** "
      / @01 " ****  &SQLXMSG   **** "
      / @01 " ********************************************************************* ";
	RUN;
%END;
%MEND;
PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE FEOTD AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT DISTINCT A.BF_SSN 
	,A.LN_SEQ
	,B.LD_DLQ_ITL
	,A.LD_LON_1_DSB
FROM OLWHRM1.LN10_LON A
INNER JOIN OLWHRM1.LN16_LON_DLQ_HST B
	ON A.BF_SSN = B.BF_SSN 
	AND A.LN_SEQ = B.LN_SEQ
INNER JOIN OLWHRM1.LN54_LON_BBS C
	ON B.BF_SSN = C.BF_SSN
	AND B.LN_SEQ = C.LN_SEQ
WHERE A.IC_LON_PGM NOT IN('SUBCNS', 'UNCNS', 'SUBSPC', 'UNSPC')
AND A.LA_CUR_PRI > 0
AND A.LC_STA_LON10 = 'R'
AND A.LF_LON_CUR_OWN = '828476'
AND DAYS(B.LD_DLQ_ITL)+15 < DAYS(CURRENT DATE)
AND B.LC_STA_LON16 = '1'
AND A.LD_LON_1_DSB  >= '2006-05-01'
AND C.LC_BBS_ELG = 'Y'
AND C.PM_BBS_PGM = 'N48'
AND NOT EXISTS (
	SELECT *
	FROM OLWHRM1.PD24_PRS_BKR X
	WHERE X.DF_PRS_ID = A.BF_SSN
	AND X.DC_BKR_ST IN ('04','06')
	AND X.DC_BKR_TYP = '07'
	)
FOR READ ONLY WITH UR
);
DISCONNECT FROM DB2;
/*%PUT  SQLXRC= >>> &SQLXRC <<< ||| SQLXMSG= >>> &SQLXMSG >>>  ;  * INCLUDES ERROR MESSAGES TO SAS LOG  ;*/
/*%SQLCHECK (SQLRPT=ULWO46.LWO46RZ);*/
/*QUIT;*/
ENDRSUBMIT;
DATA FEOTD;
SET WORKLOCL.FEOTD;
RUN;

DATA FEOTD;
SET FEOTD;
LD_DLQ_ITL = LD_DLQ_ITL+16;
RUN;

PROC SORT DATA=FEOTD;
BY BF_SSN LN_SEQ;
RUN;

DATA _NULL_;
SET  WORK.FEOTD ;
FILE REPORT2 DELIMITER=',' DSD DROPOVER LRECL=32767;
   FORMAT BF_SSN $9. ;
   FORMAT LN_SEQ 6. ;
   FORMAT LD_DLQ_ITL MMDDYYn8. ;
DO;
   PUT BF_SSN $ @;
   PUT LN_SEQ @;
   PUT LD_DLQ_ITL ;
END;
RUN;
