/*TEST*/
/*%LET TESTMSG = - THIS IS A TEST;
%LET RPTLIB = T:\SAS;
%LET LOGLIB = Y:\Batch\Logs;
%LET CODELIB = Y:\Codebase\SAS\CDW;
%LET ODBCFILE = BSYS_TEST;
%LET DB = CDW_test;
%LET ODBCFILE_CSYS = CSYSTest;*/

/*LIVE*/
%LET TESTMSG = - THIS IS LIVE;
%LET RPTLIB = Z:\Batch\FTP;
%LET LOGLIB = Z:\Batch\Logs;
%LET CODELIB = Z:\Codebase\SAS\CDW;
%LET ODBCFILE = BSYS;
%LET DB = CDW;
%LET ODBCFILE_CSYS = CSYS;

%INCLUDE "&CODELIB\UTNWDW1 CDW DAILY UPDATE.FOLDER AND DATABASE.SAS"  ;
%FILECHECK(47);

DATA OW30(drop=trunc);
	INFILE REPORT47 DSD DLM = ',' FIRSTOBS=1 MISSOVER end = eof LRECL = 32767;
	INPUT 
		IF_LON_SLE :$7.
		IC_LON_SLE_STA :$1.
		IC_LON_SLE_TYP :$1.
		ID_LON_SLE :DATE9.
		IF_SLL_OWN :$8.
		IM_SLL_CNC_1 :$13.
		IM_SLL_CNC_LST :$23.
		IN_SLL_CNC_PHN_ARA :$3.
		IN_SLL_CNC_PHN_XCH :$3.
		IN_SLL_CNC_PHN_LCL :$4.
		IN_SLL_CNC_PHN_XTN :$4.
		IF_SLL_BND_ISS :$8.
		ID_SLL_LON_SLE_APV :DATE9.
		IF_BUY_OWN :$8.
		IM_BUY_CNC_1 :$13.
		IM_BUY_CNC_LST :$23.
		IN_BUY_CNC_PHN_ARA :$3.
		IN_BUY_CNC_PHN_XCH :$3.
		IN_BUY_CNC_PHN_LCL :$4.
		IN_BUY_CNC_PHN_XTN :$4.
		IF_BUY_BND_ISS :$8.
		ID_BUY_LON_SLE_APV :DATE9.
		IM_MKT_CNC_1 :$13.
		IM_MKT_CNC_LST :$23.
		IN_MKT_CNC_PHN_ARA :$3.
		IN_MKT_CNC_PHN_XCH :$3.
		IN_MKT_CNC_PHN_LCL :$4.
		IN_MKT_CNC_PHN_XTN :$4.
		IM_TRF_CNC_1 :$13.
		IM_TRF_CNC_LST :$23.
		IN_TRF_CNC_PHN_ARA :$3.
		IN_TRF_CNC_PHN_XCH :$3.
		IN_TRF_CNC_PHN_LCL :$4.
		IN_TRF_CNC_PHN_XTN :$4.
		IM_LEG_CNC_1 :$13.
		IM_LEG_CNC_LST :$23.
		IN_LEG_CNC_PHN_ARA :$3.
		IN_LEG_CNC_PHN_XCH :$3.
		IN_LEG_CNC_PHN_LCL :$4.
		IN_LEG_CNC_PHN_XTN :$4.
		IC_FEE_ORG_RSB :$1.
		II_ACP_NEW_LON_SLE :$1.
		IA_LON_TOT_MAX :11.2
		II_INT_ICL :$1.
		IN_LON_MAX :7.0
		II_SLE_LTR_TRG :1.
		IF_SLE_LTR_SPC :$10.
		IF_LST_DTS_OW30 :DATETIME25.
		IF_BUY_POR :$20.
		IC_SLL_PNT_LOC :$3.
		IC_BUY_PNT_LOC :$3.
		IC_TIR_PCE_ASN :$1.
		II_LTE_FEE_WOF :1.
		IC_LON_SLE_SEL_TYP :$1.
		II_LTE_FEE_MAX_VAL :$1.
		II_STP_SLE_LON_MAX :$1.
		II_LEV_BR_LON_ELG :$1.
		IC_SEL_CRI_USR_APV :$1.
		ID_SEL_CRI_USR_APV :DATE9.
		IF_SEL_CRI_USR_APV :$8.
		ID_SEL_NXT_PLR :DATE9.
		ID_LON_SLE_LST_PLR :DATE9.
		IT_SLE_LST_PLR :$8.
		IN_LON_SLE_BR_ELG :4.
		IN_LON_SLE_LON_ELG :4.
		IA_CUR_PRI_ELG_LON :12.2
		IA_NSI_ELG_LON :11.2
		IA_LTE_FEE_ELG_LON :11.2
		IN_IVL_SCH_NXT_SLE :2.
		IC_IVL_SCH_NXT_SLE :$1.
		IN_IVL_SCH_NXT_PLR :2.
		IC_IVL_SCH_NXT_PLR :$1.
		IX_TRG_FIL_SEL_CRI :$1024.
		IC_RGN_RCV_DCV_LON :$2.
		IX_DSC_BUY_OWN :$144.
		LA_BR_PRI_BAL_SLE :12.2
		LC_BR_PRI_REL_SLE :$2.
		II_ORG_RGT_PUR_SLE :$1.
		IF_GRP_SLE_KEY :$8.
		IC_EFT_RIR_RSB :$1.
		IX_LON_SLE_CMT :$70.
		IC_BBS_RSB :$1.
		IC_LON_SLE_SUB_TYP :$1.
		IA_SLE_LVL_TRF_FEE :7.2
		IC_TRF_FEE_TYP :$1.
		IR_PRI_PER_FEE_RTE :5.3
		II_ICL_CON_STP_PUR :1.
		ID_ECA_DCV_CRT_FIL :DATE9.
		II_ECA_PUT_DCV_APV :$1.
		ID_ECA_CRT_BIL_SLE :DATE9.
		ID_CDU_REM_NTF :DATE9.
		IC_FED_PGM_YR :$3.
		IF_FLS_DEA :$5.
		IF_DEA_IST_LIN_HLD :$8.
		II_LON_SLE_ICL_IDT :1.
		II_ICL_CON_GRP_RLP :1.
		LI_PCV_OWN_EFF_DTE :1.
		II_PRE_SLE_LTR :1.
		IC_DLA_CAN_LTR :$2.
		IC_PRE_SLE_LST_PRC :$2.
	;
	%TRUNCAT1(47, IF_LON_SLE);
RUN;

%COPYERROR;

/*convert SAS dates to SQL Server datetime*/
DATA OW30;
	SET OW30;
		ID_LON_SLE = ID_LON_SLE * 86400;
		ID_SLL_LON_SLE_APV = ID_SLL_LON_SLE_APV * 86400;
		ID_BUY_LON_SLE_APV = ID_BUY_LON_SLE_APV * 86400;
		ID_SEL_CRI_USR_APV = ID_SEL_CRI_USR_APV * 86400;
		ID_SEL_NXT_PLR = ID_SEL_NXT_PLR * 86400;
		ID_LON_SLE_LST_PLR = ID_LON_SLE_LST_PLR * 86400;
		ID_ECA_DCV_CRT_FIL = ID_ECA_DCV_CRT_FIL * 86400;
		ID_ECA_CRT_BIL_SLE = ID_ECA_CRT_BIL_SLE * 86400;
		ID_CDU_REM_NTF = ID_CDU_REM_NTF * 86400;
/*		PUT (IT_SLE_LST_PLR , TIME8.);*/
		
RUN;

%ENCHILADA
	(
		OW30,
		OW30_LON_SLE_CTL,
		IF_LON_SLE,  
		IC_LON_SLE_STA  
		IC_LON_SLE_TYP  
		ID_LON_SLE  
		IF_SLL_OWN  
		IM_SLL_CNC_1  
		IM_SLL_CNC_LST  
		IN_SLL_CNC_PHN_ARA  
		IN_SLL_CNC_PHN_XCH  
		IN_SLL_CNC_PHN_LCL  
		IN_SLL_CNC_PHN_XTN  
		IF_SLL_BND_ISS  
		ID_SLL_LON_SLE_APV  
		IF_BUY_OWN  
		IM_BUY_CNC_1  
		IM_BUY_CNC_LST  
		IN_BUY_CNC_PHN_ARA  
		IN_BUY_CNC_PHN_XCH  
		IN_BUY_CNC_PHN_LCL  
		IN_BUY_CNC_PHN_XTN  
		IF_BUY_BND_ISS  
		ID_BUY_LON_SLE_APV  
		IM_MKT_CNC_1  
		IM_MKT_CNC_LST  
		IN_MKT_CNC_PHN_ARA  
		IN_MKT_CNC_PHN_XCH  
		IN_MKT_CNC_PHN_LCL  
		IN_MKT_CNC_PHN_XTN  
		IM_TRF_CNC_1  
		IM_TRF_CNC_LST  
		IN_TRF_CNC_PHN_ARA  
		IN_TRF_CNC_PHN_XCH  
		IN_TRF_CNC_PHN_LCL  
		IN_TRF_CNC_PHN_XTN  
		IM_LEG_CNC_1  
		IM_LEG_CNC_LST  
		IN_LEG_CNC_PHN_ARA  
		IN_LEG_CNC_PHN_XCH  
		IN_LEG_CNC_PHN_LCL  
		IN_LEG_CNC_PHN_XTN  
		IC_FEE_ORG_RSB  
		II_ACP_NEW_LON_SLE  
		IA_LON_TOT_MAX  
		II_INT_ICL  
		IN_LON_MAX  
		II_SLE_LTR_TRG  
		IF_SLE_LTR_SPC  
		IF_LST_DTS_OW30  
		IF_BUY_POR  
		IC_SLL_PNT_LOC  
		IC_BUY_PNT_LOC  
		IC_TIR_PCE_ASN  
		II_LTE_FEE_WOF  
		IC_LON_SLE_SEL_TYP  
		II_LTE_FEE_MAX_VAL  
		II_STP_SLE_LON_MAX  
		II_LEV_BR_LON_ELG  
		IC_SEL_CRI_USR_APV  
		ID_SEL_CRI_USR_APV  
		IF_SEL_CRI_USR_APV  
		ID_SEL_NXT_PLR  
		ID_LON_SLE_LST_PLR  
		IT_SLE_LST_PLR  
		IN_LON_SLE_BR_ELG  
		IN_LON_SLE_LON_ELG  
		IA_CUR_PRI_ELG_LON  
		IA_NSI_ELG_LON  
		IA_LTE_FEE_ELG_LON  
		IN_IVL_SCH_NXT_SLE  
		IC_IVL_SCH_NXT_SLE  
		IN_IVL_SCH_NXT_PLR  
		IC_IVL_SCH_NXT_PLR  
		IX_TRG_FIL_SEL_CRI  
		IC_RGN_RCV_DCV_LON  
		IX_DSC_BUY_OWN  
		LA_BR_PRI_BAL_SLE  
		LC_BR_PRI_REL_SLE  
		II_ORG_RGT_PUR_SLE  
		IF_GRP_SLE_KEY  
		IC_EFT_RIR_RSB  
		IX_LON_SLE_CMT  
		IC_BBS_RSB  
		IC_LON_SLE_SUB_TYP  
		IA_SLE_LVL_TRF_FEE  
		IC_TRF_FEE_TYP  
		IR_PRI_PER_FEE_RTE  
		II_ICL_CON_STP_PUR  
		ID_ECA_DCV_CRT_FIL  
		II_ECA_PUT_DCV_APV  
		ID_ECA_CRT_BIL_SLE  
		ID_CDU_REM_NTF  
		IC_FED_PGM_YR  
		IF_FLS_DEA  
		IF_DEA_IST_LIN_HLD  
		II_LON_SLE_ICL_IDT  
		II_ICL_CON_GRP_RLP  
		LI_PCV_OWN_EFF_DTE  
		II_PRE_SLE_LTR  
		IC_DLA_CAN_LTR  
		IC_PRE_SLE_LST_PRC  
/*		no filter*/
	);

%FINISH(SOURCE=OW30_LON_SLE_CTL);
