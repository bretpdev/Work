/*TEST*/
/*%LET TESTMSG = - THIS IS A TEST;
%LET RPTLIB = T:\SAS;
%LET LOGLIB = Y:\Batch\Logs;
%LET CODELIB = Y:\Codebase\SAS\CDW;
%LET ODBCFILE = BSYS_TEST;
%LET DB = CDW_test;
%LET ODBCFILE_CSYS = CSYSTest;*/

/*LIVE*/
%LET TESTMSG = - THIS IS LIVE;
%LET RPTLIB = Z:\Batch\FTP;
%LET LOGLIB = Z:\Batch\Logs;
%LET CODELIB = Z:\Codebase\SAS\CDW;
%LET ODBCFILE = BSYS;
%LET DB = CDW;
%LET ODBCFILE_CSYS = CSYS;

%INCLUDE "&CODELIB\UTNWDW1 CDW DAILY UPDATE.FOLDER AND DATABASE.SAS"  ;
%FILECHECK(40);

DATA FOR_LTR(drop=trunc);
	INFILE REPORT40 DSD DLM = ',' FIRSTOBS=1 MISSOVER end = eof LRECL = 32767;
	INPUT 
		DF_SPE_ACC_ID :$10.
		LN_SEQ :6.
		LF_FOR_CTL_NUM :$3.
		LN_FOR_OCC_SEQ :6.
		LC_FOR_TYP :$2.
		LD_FOR_INF_CER :DATE9.
		LD_CRT_REQ_FOR :DATE9.
		LC_FOR_STA :$1.
		LC_STA_FOR10 :$1.
		LD_STA_FOR10 :DATE9.
		LF_LST_DTS_FB10 :DATETIME25.3
		LD_FOR_BEG :DATE9.
		LD_FOR_END :DATE9.
		LC_STA_LON60 :$1.
		LC_LON_LEV_FOR_CAP :$1.
		LF_LST_DTS_LN60 :DATETIME25.3
		LD_STA_LON60 :DATE9.
		LD_FOR_APL :DATE9.
	;
	%TRUNCAT(40);
RUN;

/*convert SAS dates to SQL Server datetime*/
DATA FOR_LTR;
	SET FOR_LTR;
	LD_FOR_INF_CER = LD_FOR_INF_CER*86400;
	LD_CRT_REQ_FOR = LD_CRT_REQ_FOR*86400;
	LD_STA_FOR10 = LD_STA_FOR10*86400;
	LD_FOR_BEG = LD_FOR_BEG*86400;
	LD_FOR_END = LD_FOR_END*86400;
	LD_STA_LON60 = LD_STA_LON60*86400;
	LD_FOR_APL = LD_FOR_APL*86400;
RUN;

%COPYERROR;

%ENCHILADA
	(
		FOR_LTR,
		FB10_ForbearanceLetter,
		DF_SPE_ACC_ID
		LN_SEQ
		LF_FOR_CTL_NUM
		LN_FOR_OCC_SEQ,
		LC_FOR_TYP
		LD_FOR_INF_CER
		LD_CRT_REQ_FOR
		LC_FOR_STA
		LC_STA_FOR10
		LD_STA_FOR10
		LF_LST_DTS_FB10
		LD_FOR_BEG
		LD_FOR_END
		LC_STA_LON60
		LC_LON_LEV_FOR_CAP
		LF_LST_DTS_LN60
		LD_STA_LON60
		LD_FOR_APL,
/*		no filter*/
	);
	
%FINISH(SOURCE=FB10ForbearanceLetter);
