/*THIS SPECIFICIES WHAT DIRECTORY TO READ REPORTS FROM AND WHICH DATABASE TO UPDATE.*/
/*LIVE*/
%INCLUDE "X:\Sessions\Local SAS Schedule\UDW\UTLWDW1 UHEAA Data Warehouse Load.Folder and Database.sas";
%LET REPORT = X:\PADD\FTP;

/*TEST*/
/*%INCLUDE "X:\PADU\SAS\UDW\UTLWDW1 UHEAA Data Warehouse Load.Folder and Database.sas" ;
%LET REPORT = T:\SAS;*/

%FILECHECK(6);

DATA DF10(drop=trunc);
INFILE REPORT6 DSD DLM = ',' FIRSTOBS=1 MISSOVER end = eof;
INPUT DF_SPE_ACC_ID :$10. LN_SEQ :6. LF_DFR_CTL_NUM :$3. LN_DFR_OCC_SEQ :6. LC_DFR_TYP :$2. 
	LD_DFR_INF_CER :$10. LD_DFR_BEG :$10. LD_DFR_END :$10. LC_LON_LEV_DFR_CAP :$1. 
	LC_STA_LON50 :$1. LC_DFR_STA :$1. LC_STA_DFR10 :$1. ;
	DFR_TYP = PUT(LC_DFR_TYP,$DEFSTA.);
	MONTHS_USED = ROUND((INPUT(LD_DFR_END,MMDDYY10.) - INPUT(LD_DFR_BEG,MMDDYY10.)+1)/365 * 12,.1);
 %TRUNCAT(6,DF_SPE_ACC_ID);
RUN;
%copyerror;

PROC SORT DATA=DF10; BY DF_SPE_ACC_ID LN_SEQ LF_DFR_CTL_NUM LN_DFR_OCC_SEQ ; RUN;
DATA DF10; SET DF10; BY DF_SPE_ACC_ID LN_SEQ LF_DFR_CTL_NUM LN_DFR_OCC_SEQ; IF LAST.LN_DFR_OCC_SEQ; RUN;

%ENCHILADA(DF10,DF10_DEFERMENT,DF_SPE_ACC_ID LN_SEQ LF_DFR_CTL_NUM LN_DFR_OCC_SEQ,LC_DFR_TYP DFR_TYP LD_DFR_INF_CER LD_DFR_BEG
	LD_DFR_END LC_LON_LEV_DFR_CAP LC_STA_LON50 LC_DFR_STA LC_STA_DFR10 MONTHS_USED
	,WHERE LC_DFR_STA = 'A'
		AND LC_STA_LON50 = 'A'
		AND LC_STA_DFR10 = 'A');

%GOODBYE_NULL(DF10_DEFERMENT,LC_DFR_TYP,'');
%GOODBYE_NULL(DF10_DEFERMENT,DFR_TYP,'');
%GOODBYE_NULL(DF10_DEFERMENT,LD_DFR_INF_CER,'');
%GOODBYE_NULL(DF10_DEFERMENT,LD_DFR_BEG,'');
%GOODBYE_NULL(DF10_DEFERMENT,LD_DFR_END,'');
%GOODBYE_NULL(DF10_DEFERMENT,LC_LON_LEV_DFR_CAP,'');
%GOODBYE_NULL(DF10_DEFERMENT,LC_STA_LON50,'');
%GOODBYE_NULL(DF10_DEFERMENT,LC_DFR_STA,'');
%GOODBYE_NULL(DF10_DEFERMENT,LC_STA_DFR10,'');
%GOODBYE_NULL(DF10_DEFERMENT,MONTHS_USED,0);

%FINISH;
