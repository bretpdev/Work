*------------------------------------------------------------------------------*
|UTLWO70 - COMPASS PAYMENTS RECEIVED ON LOANS GREATER THAN 270 DAYS DELINQUENT |
*------------------------------------------------------------------------------*;
/*LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;*/
/*%LET RPTLIB = %SYSGET(reportdir);*/
%LET RPTLIB = T:\SAS;
FILENAME REPORT2 "&RPTLIB/ULWO70.LWO70R2";
FILENAME REPORTZ "&RPTLIB/ULWO70.LWO70RZ";
DATA _NULL_;
	CALL SYMPUT('RUNDATE',PUT(INTNX('DAY',TODAY(),0,'beginning'), MMDDYY10.));
	CALL SYMPUT('RUNTIME',PUT(TIME(), TIME.));
RUN;
LIBNAME  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=WORK;
RSUBMIT;
%MACRO SQLCHECK (SQLRPT= );
%IF &SQLXRC NE 0 %THEN %DO;
	DATA _NULL_;
    FILE REPORTZ NOTITLES;
    PUT @01 " ********************************************************************* "
      / @01 " ****  THE SQL CODE ABOVE HAS EXPERIENCED AN ERROR.               **** "
      / @01 " ****  THE SAS LOG IN &SQLRPT SHOULD BE REVIEWED.          **** "       
      / @01 " ********************************************************************* "
      / @01 " ****  THE SQL ERROR CODE IS  &SQLXRC  AND THE SQL ERROR MESSAGE  **** "
      / @01 " ****  &SQLXMSG   **** "
      / @01 " ********************************************************************* ";
	RUN;
%END;
%MEND;
PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE CPROLG AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT A.BF_SSN
	,A.LN_SEQ
	,D.DF_SPE_ACC_ID
	,ABS(COALESCE(C.LA_FAT_NSI,0) + 
		COALESCE(C.LA_FAT_LTE_FEE,0) + 
		COALESCE(C.LA_FAT_CUR_PRI,0)) AS PMT_REC
	,C.LD_FAT_PST
	,DAYS(CURRENT DATE) - DAYS(B.LD_DLQ_OCC) AS DAYS_DELQ
FROM OLWHRM1.LN10_LON A
INNER JOIN OLWHRM1.LN16_LON_DLQ_HST B
	ON A.BF_SSN = B.BF_SSN
	AND A.LN_SEQ = B.LN_SEQ
INNER JOIN OLWHRM1.LN90_FIN_ATY C
	ON B.BF_SSN = C.BF_SSN
	AND B.LN_SEQ = C.LN_SEQ
INNER JOIN OLWHRM1.PD10_PRS_NME D
	ON A.BF_SSN = D.DF_PRS_ID
WHERE A.LA_CUR_PRI > 0
	AND A.LC_STA_LON10 = 'R'
	AND DAYS(CURRENT DATE) - DAYS(B.LD_DLQ_OCC) >= 270
	AND B.LC_STA_LON16 = '1'
	AND C.PC_FAT_TYP = '10'
	AND C.LC_FAT_REV_REA = ''
	AND C.LC_STA_LON90 = 'A'
	AND DAYS(CURRENT DATE) - DAYS(C.LD_FAT_EFF) <= 7
FOR READ ONLY WITH UR
);
DISCONNECT FROM DB2;
/*%PUT  SQLXRC= >>> &SQLXRC <<< ||| SQLXMSG= >>> &SQLXMSG >>>  ;  * INCLUDES ERROR MESSAGES TO SAS LOG  ;*/
/*%SQLCHECK (SQLRPT=ULWO70.LWO70RZ);*/
/*QUIT;*/
ENDRSUBMIT;

DATA CPROLG ;
SET WORKLOCL.CPROLG;
RUN;

PROC SORT DATA=CPROLG; BY DF_SPE_ACC_ID; RUN;

PROC PRINTTO PRINT=REPORT2 NEW;
RUN;
OPTIONS ORIENTATION = LANDSCAPE;
OPTIONS PS=39 LS=127 NODATE CENTER PAGENO=1;
TITLE 'PAYMENTS ON LOANS > 270 DAYS DELINQUENT';
TITLE2	"&RUNDATE - &RUNTIME";
FOOTNOTE1  	"This document may contain borrowers' sensitive information that UHEAA has pledged to protect.";
FOOTNOTE2	'Please take appropriate precautions to safeguard this information.';
FOOTNOTE3	;
FOOTNOTE4   'JOB = UTLWO70  	 REPORT = ULWO70.LWO70R2';
PROC CONTENTS DATA=CPROLG OUT=EMPTYSET NOPRINT;
DATA _NULL_;
SET EMPTYSET;
FILE PRINT;
IF  NOBS=0 AND _N_ =1 THEN DO;
	PUT // 126*'-';
	PUT      //////
		@51 '**** NO OBSERVATIONS FOUND ****';
	PUT //////
		@57 '-- END OF REPORT --';
	PUT //////////////
		@46 "JOB = UTLWO70  	 REPORT = ULWO70.LWO70R2";
	END;
RETURN;
RUN;
PROC PRINT NOOBS SPLIT='/' DATA=CPROLG WIDTH=UNIFORM WIDTH=MIN LABEL;
FORMAT PMT_REC 10.2 LD_FAT_PST MMDDYY10.;
VAR DF_SPE_ACC_ID LN_SEQ PMT_REC LD_FAT_PST DAYS_DELQ;
LABEL DF_SPE_ACC_ID = 'ACCOUNT #'
LN_SEQ = 'LOAN SEQ'
PMT_REC = 'PAYMNET AMOUNT RECEIVED'
LD_FAT_PST = 'PAYMENT POSTED DATE'
DAYS_DELQ = '# OF DAYS DELINQUENT';
RUN;
PROC PRINTTO;
RUN;
