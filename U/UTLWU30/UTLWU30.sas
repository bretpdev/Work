*---------------------------------------------*
| UTLWU30 - QC - BORROWER BENEFIT FEE CHANGES |
*---------------------------------------------*;
/*LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;*/
/*%LET RPTLIB = %SYSGET(reportdir);*/
%LET RPTLIB = T:\SAS;
FILENAME REPORT2 "&RPTLIB/ULWU30.LWU30R2";
FILENAME REPORTZ "&RPTLIB/ULWU30.LWU30RZ";
LIBNAME  WORKLOCL  REMOTE  SERVER=DUSTER  SLIBREF=WORK;
RSUBMIT;
%MACRO SQLCHECK (SQLRPT= );
%IF &SQLXRC NE 0 %THEN %DO;
	DATA _NULL_;
    FILE REPORTZ NOTITLES;
    PUT @01 " ********************************************************************* "
      / @01 " ****  THE SQL CODE ABOVE HAS EXPERIENCED AN ERROR.               **** "
      / @01 " ****  THE SAS LOG IN &SQLRPT SHOULD BE REVIEWED.          **** "       
      / @01 " ********************************************************************* "
      / @01 " ****  THE SQL ERROR CODE IS  &SQLXRC  AND THE SQL ERROR MESSAGE  **** "
      / @01 " ****  &SQLXMSG   **** "
      / @01 " ********************************************************************* ";
	RUN;
%END;
%MEND;
PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE QCBBFC AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT DISTINCT C.AF_DOE_LDR
	,D.DF_SPE_ACC_ID
	,RTRIM(D.DM_PRS_1)||' '||D.DM_PRS_LST AS NAME
	,C.AF_APL_ID
	,A.LD_LON_1_DSB
	,B.LD_DSB
FROM OLWHRM1.LN10_LON A
INNER JOIN OLWHRM1.LN15_DSB B
	ON A.BF_SSN = B.BF_SSN
	AND A.LN_SEQ = B.LN_SEQ
INNER JOIN OLWHRM1.AP03_MASTER_APL C
	ON B.AF_APL_ID = C.AF_APL_ID
INNER JOIN OLWHRM1.PD10_PRS_NME D
	ON A.BF_SSN = D.DF_PRS_ID
LEFT OUTER JOIN OLWHRM1.LN18_DSB_FEE OFEE
	ON B.BF_SSN = OFEE.BF_SSN 
	AND B.LN_BR_DSB_SEQ = OFEE.LN_BR_DSB_SEQ
	AND OFEE.LC_DSB_FEE = '02'
LEFT OUTER JOIN OLWHRM1.LN18_DSB_FEE GFEE
	ON B.BF_SSN = GFEE.BF_SSN 
	AND B.LN_BR_DSB_SEQ = GFEE.LN_BR_DSB_SEQ
	AND GFEE.LC_DSB_FEE = '21'
WHERE A.LD_LON_1_DSB >= '07/02/2009'
	AND B.LC_DSB_TYP = '2'
	AND B.LC_STA_LON15 IN ('1','3')
	AND 
	(
		COALESCE(OFEE.LA_DSB_FEE,0) = 0 
	OR 
		COALESCE(GFEE.LA_DSB_FEE,0) = 0
	)
	AND A.LC_STA_LON10 = 'R'
FOR READ ONLY WITH UR
);
DISCONNECT FROM DB2;
/*%PUT  SQLXRC= >>> &SQLXRC <<< ||| SQLXMSG= >>> &SQLXMSG >>>  ;  * INCLUDES ERROR MESSAGES TO SAS LOG  ;*/
/*%SQLCHECK (SQLRPT=ULWU30.LWU30RZ);*/
/*QUIT;*/
ENDRSUBMIT;
DATA QCBBFC ;
	SET WORKLOCL.QCBBFC;
RUN;
PROC SORT DATA=QCBBFC;
	BY AF_DOE_LDR DF_SPE_ACC_ID;
RUN;
PROC PRINTTO PRINT=REPORT2 NEW;
RUN;
OPTIONS ORIENTATION = LANDSCAPE;
OPTIONS PS=39 LS=127 PAGENO=1 CENTER DATE;
TITLE 'LOANS DISB ON OR AFTER 7/2/09 WHERE ALL FEES EQUAL ZERO';
FOOTNOTE4   'JOB = UTLWU30  	 REPORT = ULWU30.LWU30R2';
PROC CONTENTS DATA=QCBBFC OUT=EMPTYSET NOPRINT;
DATA _NULL_;
SET EMPTYSET;
FILE PRINT;
IF  NOBS=0 AND _N_ =1 THEN DO;
	PUT // 132*'-';
	PUT      //////
		@51 '**** NO OBSERVATIONS FOUND ****';
	PUT //////
		@57 '-- END OF REPORT --';
	PUT //////////////
		@46 "JOB = UTLWU30  	 REPORT = ULWU30.LWU30R2";
	END;
RETURN;
RUN;
PROC PRINT NOOBS SPLIT='/' DATA=QCBBFC WIDTH=UNIFORM WIDTH=MIN LABEL;
FORMAT LD_DSB LD_LON_1_DSB MMDDYY10.;
VAR AF_DOE_LDR
	DF_SPE_ACC_ID
	NAME
	AF_APL_ID
	LD_LON_1_DSB
	LD_DSB;
LABEL AF_DOE_LDR = 'LENDER/ID'
	DF_SPE_ACC_ID = 'ACCOUNT/NUMBER'
	AF_APL_ID = 'APP/ID'
	LD_LON_1_DSB = '1ST/DISB/DATE'
	LD_DSB = 'DISB/DATE';
RUN;
PROC PRINTTO;
RUN;
