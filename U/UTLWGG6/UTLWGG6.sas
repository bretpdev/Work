/*UTLWGG6 GARNISHMENT REFUND FOR OPEN BANKRUPTCY*/
/*LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;*/
/*%LET RPTLIB = %SYSGET(reportdir);*/
%LET RPTLIB = T:\SAS;
FILENAME REPORT2 "&RPTLIB/ULWGG6.LWGG6R2";
DATA _NULL_;
	CALL SYMPUT('YESTERDAY',"'"||PUT(INTNX('DAY',TODAY(),-1,'BEGINNING'),MMDDYY10.)||"'");
	CALL SYMPUT('RUNDATE',PUT(INTNX('DAY',TODAY(),0,'BEGINNING'),MMDDYY10.));
RUN;
%SYSLPUT YESTERDAY = &YESTERDAY;
LIBNAME  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=WORK;
RSUBMIT;
PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE GRNRF AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT DISTINCT	A.BF_SSN
	,B.LA_TRX
	,C.LD_BKR_FIL
	,D.DF_SPE_ACC_ID
FROM OLWHRM1.DC01_LON_CLM_INF A
INNER JOIN OLWHRM1.DC11_LON_FAT B
	ON A.AF_APL_ID = B.AF_APL_ID
	AND A.AF_APL_ID_SFX = B.AF_APL_ID_SFX
	AND A.LF_CRT_DTS_DC10 = B.LF_CRT_DTS_DC10
INNER JOIN OLWHRM1.DC18_BKR C
	ON A.AF_APL_ID = C.AF_APL_ID
	AND A.AF_APL_ID_SFX = C.AF_APL_ID_SFX
	AND A.LF_CRT_DTS_DC10 = C.LF_CRT_DTS_DC10
INNER JOIN OLWHRM1.PD01_PDM_INF D
	ON A.BF_SSN = D.DF_PRS_ID
WHERE A.LC_STA_DC10 = '03'
AND A.LC_AUX_STA = '07'
AND B.LC_TRX_TYP = 'GP'
AND B.LD_TRX_EFF = &YESTERDAY
/*AND B.LC_REV_IND_TYP = ' '*/
);
DISCONNECT FROM DB2;
ENDRSUBMIT;

DATA GRNRF;
SET WORKLOCL.GRNRF;
RUN;

PROC SORT DATA=GRNRF;
BY BF_SSN;
RUN;

PROC PRINTTO PRINT=REPORT2 NEW;
RUN;
OPTIONS ORIENTATION = LANDSCAPE;
OPTIONS PS=39 LS=127 NODATE PAGENO=1;
PROC REPORT DATA= GRNRF HEADSKIP SPLIT='*' NOWD;
TITLE 'GARNISHMENT REFUND FOR OPEN BANKRUPTCY';
TITLE2 "RUN DATE: &RUNDATE";
FOOTNOTE 'JOB = UTLWGG6    REPORT = ULWGG6.LWGG6R2';
COLUMN DF_SPE_ACC_ID LA_TRX LD_BKR_FIL;
DEFINE DF_SPE_ACC_ID / GROUP "ACCT #" WIDTH=10;
DEFINE LA_TRX / DISPLAY "PAYMENT*AMOUNT" FORMAT=DOLLAR10.2;
DEFINE LD_BKR_FIL / DISPLAY "DATE*BANKRUPTCY*FILED" FORMAT=MMDDYY10.;
BREAK AFTER BF_SSN / OL SUMMARIZE SUPPRESS SKIP;
RUN;
PROC PRINTTO;
RUN;
