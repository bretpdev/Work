/*===========================================*/
/*UTLWN03 US BANK MR80 81,82,83,84 DATA FILES*/
/*===========================================*/

/*LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;*/
/*%LET RPTLIB = /sas/whse/progrevw   ; */
/*FILENAME REPORT2 "&RPTLIB/ULWN03.LWN03R2";*/
/*FILENAME REPORTZ "&RPTLIB/ULWN03.LWN03RZ";*/

FILENAME REPORT2 'T:\SAS\ULWN03.ULWN03R2';

LIBNAME  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=WORK;
RSUBMIT;

%MACRO SQLCHECK (SQLRPT= );
%IF &SQLXRC NE 0 %THEN %DO;
	DATA _NULL_;
    FILE REPORTZ NOTITLES;
    PUT @01 " ********************************************************************* "
      / @01 " ****  THE SQL CODE ABOVE HAS EXPERIENCED AN ERROR.               **** "
      / @01 " ****  THE SAS LOG IN &SQLRPT SHOULD BE REVIEWED.          **** "       
      / @01 " ********************************************************************* "
      / @01 " ****  THE SQL ERROR CODE IS  &SQLXRC  AND THE SQL ERROR MESSAGE  **** "
      / @01 " ****  &SQLXMSG   **** "
      / @01 " ********************************************************************* ";
	RUN;
%END;
%MEND;

PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE XEMO AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT 
/*MR81_MR_799_ORG B*/
B.IF_799_RPT
,B.IF_BND_ISS
,B.WC_799_LON_PGM 		AS WC_799_LON_PGM_MR81
,B.BF_SSN 				AS BF_SSN_MR81
,B.LN_SEQ				AS LN_SEQ_MR81
,B.WC_799_RTE_ORG_FEE
,B.WC_799_ORG_FEE
,B.WC_799_ITR_ORG_FEE
,B.WA_PRI_AMT_ORG
,B.WA_799_ORG_FEE
,B.LN_BR_DSB_SEQ
,B.PC_FAT_TYP
,B.PC_FAT_SUB_TYP
,B.LN_FAT_SEQ
,B.IF_OWN 				AS IF_OWN_MR81
/*MR82_MR_799_INT C*/
,C.IF_799_RPT
,C.IF_BND_ISS
,C.WC_799_LON_PGM		AS WC_799_LON_PGM_MR82
,C.BF_SSN				AS BF_SSN_MR82
,C.LN_SEQ				AS LN_SEQ_MR82
,C.LR_ITR
,C.WC_799_INT_BIL
,C.WA_799_PRI_END_INT
,C.WA_799_AVG_BAL_INT
,C.WA_799_CUR_GOV_INT
,C.IF_OWN 				AS IF_OWN_MR82
/*MR83_MR_799_SPA D*/
,D.IF_799_RPT
,D.IF_BND_ISS
,D.WC_799_LON_PGM 		AS WC_799_LON_PGM_MR83
,D.BF_SSN 				AS BF_SSN_MR83
,D.LN_SEQ 				AS LN_SEQ_MR83
,D.WC_CAL_YR
,D.WC_CAL_QTR
,D.WC_799_SPA_CAT
,D.LR_ITR
,D.WC_799_SPA_ITR
,D.WC_799_SPA_BIL
,D.WA_799_PRI_END_SPA
,D.WA_799_AVG_BAL_SPA
,D.LD_LON_1_DSB
,D.LD_TRM_BEG
,D.LD_SPA_RTT
,D.LD_SPA_STP
,D.IF_OWN 				AS IF_OWN_MR83
/*MR84_MR_799_CAL E*/
,E.IF_799_RPT
,E.IF_BND_ISS
,E.WC_799_LON_PGM 		AS WC_799_LON_PGM_MR84
,E.BF_SSN 				AS BF_SSN_MR84
,E.LN_SEQ 				AS LN_SEQ_MR84
,E.WC_799_DLQ_PRT_LN
,E.WA_PIO_QTR_ADJ
,E.WA_PRI_BEG_BAL
,E.WA_PRI_DSB
,E.WA_PRI_ADD
,E.WA_PRI_PR
,E.WA_PRI_CU
,E.WA_PRI_SLD
,E.WA_PRI_CLM_PAY
,E.WA_PRI_GTE_VOI
,E.WA_PRI_LES
,E.WA_PRI_END_BAL
,E.LD_CU_ENT
,E.LD_CU_END
,E.ID_LON_SLE
,E.WN_799_DAY_DLQ
,E.IF_OWN				AS IF_OWN_MR84

FROM OLWHRM1.MR81_MR_799_ORG B
INNER JOIN OLWHRM1.MR82_MR_799_INT C
	ON C.BF_SSN = B.BF_SSN
	AND C.LN_SEQ = B.LN_SEQ
	AND C.IF_OWN = B.IF_OWN
	AND C.WC_799_LON_PGM = B.WC_799_LON_PGM 
INNER JOIN OLWHRM1.MR83_MR_799_SPA D
	ON B.BF_SSN = D.BF_SSN
	AND B.LN_SEQ = D.LN_SEQ
	AND B.IF_OWN = D.IF_OWN
	AND B.WC_799_LON_PGM = D.WC_799_LON_PGM 
INNER JOIN OLWHRM1.MR84_MR_799_CAL E
	ON D.BF_SSN = E.BF_SSN
	AND D.LN_SEQ = E.LN_SEQ
	AND D.IF_OWN = E.IF_OWN
	AND D.WC_799_LON_PGM = E.WC_799_LON_PGM 

WHERE B.IF_OWN = '811698'

FOR READ ONLY WITH UR
);
DISCONNECT FROM DB2;

/*%PUT  SQLXRC= >>> &SQLXRC <<< ||| SQLXMSG= >>> &SQLXMSG >>>  ;  *INCLUDES ERROR MESSAGES TO SAS LOG  ;*/
/*%SQLCHECK (SQLRPT=ULWN03.LWN03RZ);*/
/*QUIT;*/

ENDRSUBMIT;

DATA XEMO;
SET WORKLOCL.XEMO;
RUN;

PROC SORT DATA=XEMO;
BY BF_SSN_MR83;
RUN;

DATA _NULL_;
SET  WORK.XEMO  ;
FILE REPORT2 DELIMITER=',' DSD DROPOVER LRECL=32767;
FORMAT IF_799_RPT $8. ;
FORMAT IF_BND_ISS $8. ;
FORMAT WC_799_LON_PGM_MR81 $2. ;
FORMAT BF_SSN_MR81 $9. ;
FORMAT LN_SEQ_MR81 6. ;
FORMAT WC_799_RTE_ORG_FEE $5. ;
FORMAT WC_799_ORG_FEE $2. ;
FORMAT WC_799_ITR_ORG_FEE $6. ;
FORMAT WA_PRI_AMT_ORG 13.2 ;
FORMAT WA_799_ORG_FEE 13.2 ;
FORMAT LN_BR_DSB_SEQ 6. ;
FORMAT PC_FAT_TYP $2. ;
FORMAT PC_FAT_SUB_TYP $2. ;
FORMAT LN_FAT_SEQ 6. ;
FORMAT IF_OWN_MR81 $8. ;
FORMAT IF_799_RPT0 $8. ;
FORMAT IF_BND_ISS0 $8. ;
FORMAT WC_799_LON_PGM_MR82 $2. ;
FORMAT BF_SSN_MR82 $9. ;
FORMAT LN_SEQ_MR82 6. ;
FORMAT LR_ITR 7.3 ;
FORMAT WC_799_INT_BIL $2. ;
FORMAT WA_799_PRI_END_INT 11.2 ;
FORMAT WA_799_AVG_BAL_INT 11.2 ;
FORMAT WA_799_CUR_GOV_INT 11.2 ;
FORMAT IF_OWN_MR82 $8. ;
FORMAT IF_799_RPT1 $8. ;
FORMAT IF_BND_ISS1 $8. ;
FORMAT WC_799_LON_PGM_MR83 $2. ;
FORMAT BF_SSN_MR83 $9. ;
FORMAT LN_SEQ_MR83 6. ;
FORMAT WC_CAL_YR $2. ;
FORMAT WC_CAL_QTR $1. ;
FORMAT WC_799_SPA_CAT $2. ;
FORMAT LR_ITR0 7.3 ;
FORMAT WC_799_SPA_ITR $6. ;
FORMAT WC_799_SPA_BIL $2. ;
FORMAT WA_799_PRI_END_SPA 11.2 ;
FORMAT WA_799_AVG_BAL_SPA 11.2 ;
FORMAT LD_LON_1_DSB MMDDYY10. ;
FORMAT LD_TRM_BEG MMDDYY10. ;
FORMAT LD_SPA_RTT MMDDYY10. ;
FORMAT LD_SPA_STP MMDDYY10. ;
FORMAT IF_OWN_MR83 $8. ;
FORMAT IF_799_RPT2 $8. ;
FORMAT IF_BND_ISS2 $8. ;
FORMAT WC_799_LON_PGM_MR84 $2. ;
FORMAT BF_SSN_MR84 $9. ;
FORMAT LN_SEQ_MR84 6. ;
FORMAT WC_799_DLQ_PRT_LN $2. ;
FORMAT WA_PIO_QTR_ADJ 11.2 ;
FORMAT WA_PRI_BEG_BAL 11.2 ;
FORMAT WA_PRI_DSB 11.2 ;
FORMAT WA_PRI_ADD 11.2 ;
FORMAT WA_PRI_PR 11.2 ;
FORMAT WA_PRI_CU 11.2 ;
FORMAT WA_PRI_SLD 11.2 ;
FORMAT WA_PRI_CLM_PAY 11.2 ;
FORMAT WA_PRI_GTE_VOI 11.2 ;
FORMAT WA_PRI_LES 11.2 ;
FORMAT WA_PRI_END_BAL 11.2 ;
FORMAT LD_CU_ENT MMDDYY10. ;
FORMAT LD_CU_END MMDDYY10. ;
FORMAT ID_LON_SLE MMDDYY10. ;
FORMAT WN_799_DAY_DLQ 5. ;
FORMAT IF_OWN_MR84 $8. ;
DO;
PUT IF_799_RPT $ @;
PUT IF_BND_ISS $ @;
PUT WC_799_LON_PGM_MR81 $ @;
PUT BF_SSN_MR81 $ @;
PUT LN_SEQ_MR81 @;
PUT WC_799_RTE_ORG_FEE $ @;
PUT WC_799_ORG_FEE $ @;
PUT WC_799_ITR_ORG_FEE $ @;
PUT WA_PRI_AMT_ORG @;
PUT WA_799_ORG_FEE @;
PUT LN_BR_DSB_SEQ @;
PUT PC_FAT_TYP $ @;
PUT PC_FAT_SUB_TYP $ @;
PUT LN_FAT_SEQ @;
PUT IF_OWN_MR81 $ @;
PUT IF_799_RPT0 $ @;
PUT IF_BND_ISS0 $ @;
PUT WC_799_LON_PGM_MR82 $ @;
PUT BF_SSN_MR82 $ @;
PUT LN_SEQ_MR82 @;
PUT LR_ITR @;
PUT WC_799_INT_BIL $ @;
PUT WA_799_PRI_END_INT @;
PUT WA_799_AVG_BAL_INT @;
PUT WA_799_CUR_GOV_INT @;
PUT IF_OWN_MR82 $ @;
PUT IF_799_RPT1 $ @;
PUT IF_BND_ISS1 $ @;
PUT WC_799_LON_PGM_MR83 $ @;
PUT BF_SSN_MR83 $ @;
PUT LN_SEQ_MR83 @;
PUT WC_CAL_YR $ @;
PUT WC_CAL_QTR $ @;
PUT WC_799_SPA_CAT $ @;
PUT LR_ITR0 @;
PUT WC_799_SPA_ITR $ @;
PUT WC_799_SPA_BIL $ @;
PUT WA_799_PRI_END_SPA @;
PUT WA_799_AVG_BAL_SPA @;
PUT LD_LON_1_DSB @;
PUT LD_TRM_BEG @;
PUT LD_SPA_RTT @;
PUT LD_SPA_STP @;
PUT IF_OWN_MR83 $ @;
PUT IF_799_RPT2 $ @;
PUT IF_BND_ISS2 $ @;
PUT WC_799_LON_PGM_MR84 $ @;
PUT BF_SSN_MR84 $ @;
PUT LN_SEQ_MR84 @;
PUT WC_799_DLQ_PRT_LN $ @;
PUT WA_PIO_QTR_ADJ @;
PUT WA_PRI_BEG_BAL @;
PUT WA_PRI_DSB @;
PUT WA_PRI_ADD @;
PUT WA_PRI_PR @;
PUT WA_PRI_CU @;
PUT WA_PRI_SLD @;
PUT WA_PRI_CLM_PAY @;
PUT WA_PRI_GTE_VOI @;
PUT WA_PRI_LES @;
PUT WA_PRI_END_BAL @;
PUT LD_CU_ENT @;
PUT LD_CU_END @;
PUT ID_LON_SLE @;
PUT WN_799_DAY_DLQ @;
PUT IF_OWN_MR84 $ ;
;
END;
RUN;

