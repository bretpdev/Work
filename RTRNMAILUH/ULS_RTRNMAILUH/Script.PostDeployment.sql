/*
Post-Deployment Script Template							
--------------------------------------------------------------------------------------
 This file contains SQL statements that will be appended to the build script.		
 Use SQLCMD syntax to include a file in the post-deployment script.			
 Example:      :r .\myfile.sql								
 Use SQLCMD syntax to reference a variable in the post-deployment script.		
 Example:      :setvar TableName MyTable							
               SELECT * FROM [$(TableName)]					
--------------------------------------------------------------------------------------
*/
IF (EXISTS (SELECT * 
                 FROM INFORMATION_SCHEMA.TABLES 
                 WHERE TABLE_SCHEMA = 'bcsretmail' 
                 AND  TABLE_NAME = 'BarcodeData'))
BEGIN
    INSERT INTO rtrnmailuh.BarcodeData(AccountIdentifier, LetterId, CreateDate, ReceivedDate, ProcessedAt, AddedAt, AddedBy, DeletedAt, DeletedBy)
    SELECT
	    RecipientId,
	    LetterId,
	    CreateDate,
	    ReceivedDate,
	    ProcessedAt,
	    AddedAt,
	    AddedBy,
	    DeletedAt,
	    DeletedBy
    FROM
	    bcsretmail.BarcodeData
    WHERE
        LetterId NOT IN ('1098E','120DLQSR','120DLQENSR','SBDL30D-RE','30DAYEND','AL 30DAY','30DAYAMD','ULASBLL45D','RHB5PMTS','RHB6PMTS','RHB7PMTS','70DYDLQSR','70DLQBRSR','70DLQENDSR','ULASBLL75D','RHB8PMTS','SONLE','RPMTCN','ULASBDLAOW','AMDOOW7106','AMNSTY240','AMNSTY420','AMNSTY600','AMNSTY060','AMNSTYRB','AMNSTYLBAL','AMNRES','AUDAPPRVL','ULPSBALSQD','AWGEMP1','AWGNOT3','AWGEMP1','AWGEMP2','AWGNOT1','EMPLTR03','EMPLTR01','EMPLTR02','EMPADDUP','AWGGP2','AWGNOT2','BKREFUND','ULDSBDBILL','ULDSBBILL3','DL BILLC','TRANSHISTO','ULDSBDLRFD','DPAAWG','VWAAWG','RBMT9PMT','BRKDWN','ULDSBDLRAB','ULDSBDLRS4','EMPADDUP','COLFEESR','COLLFENDSR','BLNGSTMNT','CBSTXT','COMPAPRV','COMPCOV','COMEVQ','REHAB2','RHLST','CONSINFO','CSFBSRHB','DL DSCBR','DL DNCBR','CURRENT','CUSTOM','DCRTREQ','ULDSBDLDF1','ULDSBDLCO1','ULDSBDLDF2','ULDSBDLCO2','ULDSBDLDF3','ULDSBDLCO3','ULDSBDLDF4','ULDSBDLCO4','DARECMSG','UNATTFU','DANOPHND1','DANOPHND2','DANOPHND3','DANOPHND4','DANOPHND5','DANOPHND6','DANPHN1','DAH','PIFC','DFNOPHN1','DFNOPHN2','DFNOPHN3','DFNOPHN4','DFNOPHN5','DFNOPHN6','RHVERS','ULDSBDLPIF','PIF','ULDSBDLPFJ','DFINCOMP','DFSUPDOC','DFCRIT','ULPSBALPLU','DPACONF','DPA','DPACANO','DPACANP','DIROPSLT','BNKDISCH','PMTSRED','ULPSBALDD1','ULPSBALND1','ULPSBALED1','ULPSBALEN1','ULPSBALDD2','ULPSBALDE2','ULPSBALDD3','ULPSBALDE3','ULPSBALDD4','ULPSBALND4','ULPSBALDE4','ULPSBALEN4','ULPSBALDD5','ULPSBALDE5','ULPSBALDD6','ULPSBALDE6','ULPSBALDD7','ULPSBALDE7','ULPSBALFAL','ULPSBALEFA','ULPSBALHRD','ULPSBALEDU','SLCT2','ULDSBDLRS2','ULDSBDLRS1','ETEST','EAWW','ENCE','EMPVWA','ULDSRHBNO','FRPYDFTSR','FRPDFTBSR3','FLRSVDLQSR','FRSDLQENSR','FBSDOC','FBS FORM','FBS','FBSAWG','LMFAX','FBSDEN','NPCTOP','FILETRAN','HDSHEVAL','ULPSBALFRB','SCGENCON','SCPLCON','DFORBDEN','STATCHNG','BANKLETTER','CONSOL','HERADEF','AMNHIBAL','AMNSTYJD','IAL','SOINJSPREL','ULPSBALSCH','EMPLLETTER','ULDSBDLRS3','IBSRPMTS','SOISFR','SOISPR','REHAB2 JUD','SATABST','SATJUDG','CSDIALOGS','ASSIGNED','REHAB4','LMSDAGEVAL','LMSDEFEVAL','RFDCHKRQST','LOANTRANSH','REHABINFO','WRTOFFAP','EMPFLP0X','LVCFFELP','FDNOHV','MNGARLT','DFMXTIME','ULPSBALMIL','ULDSBKLEMP','NRDFTDLQSR','NDFDLQENSR','DL DLRC2','DL DLRC1','ULDSBDLND3','NOTDEFFUSR','NTDFTFUBSR','NTFNDMSR','NTFDBRSR4','SLMAFAX','ULDSBDLND1','ULDSBDLND2','ULDSBOFF1','ULDSBDLTXI','ULDSBDLTXP','ULDSBOFF3','ULASBDL30D','ULDSBDLINA','DLCONOVRP','BNKCONCL','INSTOWE','OOWLGL','ULASBDLOOW','ULASBDLOOW','OOW','OOWED','PIFTC','ULPSBALPLW','DLPRTLFND','DLBILL','PMTS','AWGRA','AWGRAR','NPCBOR','DATREDEF','ULGSBPRIV','ULPSBALPUB','ULDSBOFF2','ROSTERS','REFLOC','REHAB3 JUD','REHAB2-12','REHAB2 JUD','REHAB2-11','ULDSBDLRAV','ULDSBDLRAN','RHVERSC','RHVERCR','RHVERFA','REINAPVB','REINAPVS','REINDENB','REINDENS','REINSTINFO','REINREVB','OTHNOTSAT','ULASBDLTRD','ULASBDLSAT','SOBK','VWANOTSAT','NOTSAT','DL SLCT2','NELNET','SALLIE MAE','ULRSBRLRPB','RPCHLN','ULSSBKDADV','VITAL','REFRCAL','ULSSBKLREF','FORB','RQFORBOCR','REQHRG','PAYOFF','BVWAAWG','NSF','NSFDPA','SOFR','RVWCOLLCST','ENRVER','SCDLBILL','SMBALCLS','SCDRPINIT','SCDRP2SCH','SCCHRDEL','SCDRPRPMT','SCDRPNOCON','SCHIBAL','SCPLNOCON','DSOP','STMTINC','STLLDLQSR','STDLQENDSR','TOHARD','NONIVRDIAL','ULPSBALTDS','PMTINC','TXTROH','3RDPRTYDL','TLP3PRTY','US09BTLPFD','TLPAGREF','EVWAAWG','ULPSBALPDS','DISBCERT','DSBLTY','BTHFORM','DELQ150','FRGN','DAI','DAG','ULPSBALUNE','UDF','ULDSBOFF1','DS01SCR','DIJS','DL DS01','DL DS01','VRBRHBEML','VRBRHBINS1','VRBRHBINS2','VRBRHBINS3','VRBRHBINS4','VRBRHBINS5','VRBRHBINS6','EMPVER','VADDPHN','VOLSUBRQST','TS09B60CP','RQRCVDLGP','DFTSUBRO','NOTSUSP')

    DROP TABLE [bcsretmail].[BarcodeData]
END

IF EXISTS ( SELECT * 
            FROM   sysobjects 
            WHERE  id = object_id(N'[bcsretmail].[GetBarcodeInfoToInvalidate]') 
                   and OBJECTPROPERTY(id, N'IsProcedure') = 1 )
BEGIN
    DROP PROCEDURE [bcsretmail].[GetBarcodeInfoToInvalidate]
END


IF EXISTS ( SELECT * 
            FROM   sysobjects 
            WHERE  id = object_id(N'[bcsretmail].[GetCampaignIdFromHtml]') 
                   and OBJECTPROPERTY(id, N'IsProcedure') = 1 )
BEGIN
    DROP PROCEDURE [bcsretmail].[GetCampaignIdFromHtml]
END


IF EXISTS ( SELECT * 
            FROM   sysobjects 
            WHERE  id = object_id(N'[bcsretmail].[MarkBarcodeRecordCompleted]') 
                   and OBJECTPROPERTY(id, N'IsProcedure') = 1 )
BEGIN
    DROP PROCEDURE [bcsretmail].[MarkBarcodeRecordCompleted]
END


IF EXISTS ( SELECT * 
            FROM   sysobjects 
            WHERE  id = object_id(N'[bcsretmail].[SaveScannedInfo]') 
                   and OBJECTPROPERTY(id, N'IsProcedure') = 1 )
BEGIN
    DROP PROCEDURE[bcsretmail].[SaveScannedInfo]
END

UPDATE
    ULS.emailbatch.EmailCampaigns
SET
    SourceFile = 'RTRNMAILUH'
WHERE
    HtmlFileId = (SELECT HtmlFileId FROM ULS.emailbatch.HtmlFiles WHERE HtmlFile = 'CARTMAILUH.html')
    

UPDATE
	ULS.emailbatch.EmailCampaigns
SET
	ArcId = NULL,
	CommentId = NULL
WHERE
	ArcId = (SELECT ArcId FROM ULS.emailbatch.Arcs WHERE Arc = 'CAEEM')


IF EXISTS (SELECT * FROM sys.schemas WHERE name = 'bcsretmail')
BEGIN
    DROP SCHEMA bcsretmail
END


GRANT EXECUTE ON SCHEMA::rtrnmailuh TO db_executor