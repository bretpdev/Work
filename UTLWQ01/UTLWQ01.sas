/*This report identifies borrowers that have a Cross Reference hold date*/
/*>= 45 days from the current date, and the account is not satisfied.*/
/*LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;*/
/*%LET RPTLIB = %SYSGET(reportdir);*/
%LET RPTLIB = T:\SAS;
FILENAME REPORT2 "&RPTLIB/ULWQ01.LWQ01R2";

libname  WORKLOCL  REMOTE  SERVER=DUSTER  SLIBREF=work  ;
RSUBMIT;
OPTIONS NOCENTER NODATE NONUMBER LS=132;
PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE CRHOLD AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT
	d.DF_SPE_ACC_ID,
	c.BD_HLD						AS HOLDDT,
	c.bc_hld_rea					AS HOLDREA,
	integer(D.DF_PRS_ID)			AS SSN,
case 
	when RTRIM(D.DM_PRS_MID) <> ' ' 
		then RTRIM(D.DM_PRS_1)||' '||RTRIM(D.DM_PRS_MID)||' '||RTRIM(D.DM_PRS_LST)
	when RTRIM(D.DM_PRS_MID) = ' ' 
		then RTRIM(D.DM_PRS_1)||' '||RTRIM(D.DM_PRS_LST)
end										
									AS NAME
FROM  OLWHRM1.BR01_BR_CRF C JOIN OLWHRM1.PD01_PDM_INF D
ON C.bf_ssn = D.DF_PRS_ID
WHERE DAYS(c.BD_HLD) >= (DAYS(CURRENT DATE) + 245)
and c.bd_acc_sts is null
);
DISCONNECT FROM DB2;
ENDRSUBMIT  ;

DATA CRHOLD;
SET WORKLOCL.CRHOLD;
RUN;
PROC SORT data=CRHOLD;
BY SSN HOLDDT;
RUN;

DATA _NULL_;
SET CRHOLD ;
LENGTH DESCRIPTION $600.;
USER = ' ';
ACT_DT = HOLDDT;
DESCRIPTION = CATX(',',
		DF_SPE_ACC_ID,
		NAME,
		HOLDREA
);
FILE REPORT2 DELIMITER=',' DSD DROPOVER LRECL=32767;
FORMAT USER $10. ;
FORMAT ACT_DT MMDDYY10. ;
FORMAT DESCRIPTION $600. ;
IF _N_ = 1 THEN DO;
	PUT "USER,ACT_DT,DESCRIPTION";
END;
DO;
   PUT USER $ @;
   PUT ACT_DT @;
   PUT DESCRIPTION $ ;
END;
RUN;
