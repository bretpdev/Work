/*THIS SPECIFICIES WHAT DIRECTORY TO READ REPORTS FROM AND WHICH DATABASE TO UPDATE.*/
/*LIVE*/
%INCLUDE "X:\Sessions\Local SAS Schedule\UDW\UTLWDW1 UHEAA Data Warehouse Load.Folder and Database.sas";
%LET REPORT = X:\PADD\FTP;

/*TEST*/
/*%INCLUDE "X:\PADU\SAS\UDW\UTLWDW1 UHEAA Data Warehouse Load.Folder and Database.sas" ;
%LET REPORT = T:\SAS;*/

%FILECHECK(32);

DATA DL200_LET (drop=trunc);
	INFILE REPORT32 DSD DLM = ',' FIRSTOBS=1 MISSOVER end = eof;
	INPUT DF_SPE_ACC_ID :$10. LN_ATY_SEQ :6. LC_STA_ACTY10 :$1. LD_ATY_REQ_RCV :$10.;
%TRUNCAT(32,DF_SPE_ACC_ID);
RUN;
%copyerror;

PROC SORT DATA=DL200_LET ; BY DF_SPE_ACC_ID LN_ATY_SEQ; RUN;
DATA DL200_LET; SET DL200_LET; BY DF_SPE_ACC_ID LN_ATY_SEQ; IF LAST.LN_ATY_SEQ; RUN;

%ENCHILADA(DL200_LET,AY10_20DAYLETTER,DF_SPE_ACC_ID LN_ATY_SEQ,LC_STA_ACTY10 LD_ATY_REQ_RCV,WHERE LC_STA_ACTY10 = 'A');

%GOODBYE_NULL(AY10_20DAYLETTER,LD_ATY_REQ_RCV,'');

DATA _NULL_;
	CALL SYMPUT('YR_3',"'" || PUT(INTNX('YEAR',TODAY(),-3,'S'),MMDDYY10.)|| "'");
RUN;
%PUT &YR_3;

PROC SQL NOPRINT;
CONNECT TO ODBC AS MD (&MD);
SELECT COUNT(*)
FROM CONNECTION TO MD (
	DELETE
	FROM AY10_20DAYLETTER
	WHERE CAST(LD_ATY_REQ_RCV AS DATETIME) < &YR_3 );

DISCONNECT FROM MD;
QUIT;

%FINISH;
