CREATE PROCEDURE [dbo].[GetLT20RecordSequences]
	@DF_SPE_ACC_ID CHAR(10),
	@RM_APL_PGM_PRC VARCHAR(8),
	@RT_RUN_SRT_DTS_PRC DATETIME,
	@RN_SEQ_LTR_CRT_PRC INT,
	@RM_DSC_LTR_PRC VARCHAR(10),
	@IsCoborrower BIT = 0
AS
BEGIN
	IF @IsCoborrower = 0
	BEGIN
		SELECT
			LT20.RN_SEQ_REC_PRC
		FROM
			LT20_LTR_REQ_PRC LT20
			LEFT JOIN CLS.dbo.SpecialLetterRecipients SR
				ON LT20.RM_DSC_LTR_PRC = SR.LetterId
		WHERE
			LT20.DF_SPE_ACC_ID = @DF_SPE_ACC_ID
			AND LT20.RM_APL_PGM_PRC = @RM_APL_PGM_PRC
			AND LT20.RT_RUN_SRT_DTS_PRC = @RT_RUN_SRT_DTS_PRC
			AND LT20.RN_SEQ_LTR_CRT_PRC = @RN_SEQ_LTR_CRT_PRC
			AND LT20.RM_DSC_LTR_PRC = @RM_DSC_LTR_PRC
			AND
			(
				(LT20.PrintedAt IS NULL AND LT20.OnEcorr = 0)
				OR
				(LT20.EcorrDocumentCreatedAt IS NULL)
				OR
				(LT20.PrintedAt IS NULL AND SR.LetterId IS NOT NULL)
			)
			AND InactivatedAt IS NULL
	END

	ELSE
	BEGIN
		SELECT
			LT20.RN_SEQ_REC_PRC
		FROM
			LT20_LTR_REQ_PRC_Coborrower LT20
			LEFT JOIN CLS.dbo.SpecialLetterRecipients SR
				ON LT20.RM_DSC_LTR_PRC = SR.LetterId
		WHERE
			LT20.DF_SPE_ACC_ID = @DF_SPE_ACC_ID
			AND LT20.RM_APL_PGM_PRC = @RM_APL_PGM_PRC
			AND LT20.RT_RUN_SRT_DTS_PRC = @RT_RUN_SRT_DTS_PRC
			AND LT20.RN_SEQ_LTR_CRT_PRC = @RN_SEQ_LTR_CRT_PRC
			AND LT20.RM_DSC_LTR_PRC = @RM_DSC_LTR_PRC
			AND
			(
				(LT20.PrintedAt IS NULL AND LT20.OnEcorr = 0)
				OR
				(LT20.EcorrDocumentCreatedAt IS NULL)
				OR
				(LT20.PrintedAt IS NULL AND SR.LetterId IS NOT NULL)
			)
			AND InactivatedAt IS NULL
	END
END
GO