LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;
%LET RPTLIB = %SYSGET(reportdir);
/*%LET RPTLIB = C:\WINDOWS\TEMP;*/
FILENAME REPORT2 "&RPTLIB/ULWG96.LWG96R2";
FILENAME REPORT3 "&RPTLIB/ULWG96.LWG96R3";
FILENAME REPORT4 "&RPTLIB/ULWG96.LWG96R4";
FILENAME REPORT5 "&RPTLIB/ULWG96.LWG96R5";
FILENAME REPORT6 "&RPTLIB/ULWG96.LWG96R6";
FILENAME REPORT7 "&RPTLIB/ULWG96.LWG96R7";
FILENAME REPORT8 "&RPTLIB/ULWG96.LWG96R8";
FILENAME REPORT9 "&RPTLIB/ULWG96.LWG96R9";
FILENAME REPORT10 "&RPTLIB/ULWG96.LWG96R10";
FILENAME REPORTZ "&RPTLIB/ULWG96.LWG96RZ";

/*LIBNAME  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=WORK;*/
/*RSUBMIT;*/

PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
%MACRO RUNR2();
/*REPORT 2 CRITIRIA*/
CREATE TABLE REP2 AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT DISTINCT LN10.BF_SSN
	,PD10.DF_SPE_ACC_ID
	,PD10.DM_PRS_1
	,PD10.DM_PRS_LST
	,PD30.DX_STR_ADR_1
	,PD30.DX_STR_ADR_2
	,PD30.DM_CT
	,CASE 
		WHEN PD30.DM_FGN_CNY = ''
			THEN PD30.DC_DOM_ST
		WHEN PD30.DM_FGN_CNY <> ''
			THEN PD30.DM_FGN_ST
	END AS DC_DOM_ST
	,PD30.DF_ZIP_CDE
	,PD30.DM_FGN_CNY
	,PD30.DC_DOM_ST AS STATE_CODE
	,'MA2324' AS CCC
/*	,A.LD_STA_STU10*/
FROM OLWHRM1.LN10_LON LN10
INNER JOIN (SELECT SD10.LF_STU_SSN, SD10.LD_STA_STU10
				FROM OLWHRM1.SD10_STU_SPR SD10
				WHERE SD10.LC_STA_STU10 = 'A'
				AND SD10.LC_REA_SCL_SPR = '01'
				AND SD10.LD_STA_STU10 > CURRENT DATE - 5 DAYS
				) A
	ON A.LF_STU_SSN = LN10.LF_STU_SSN
INNER JOIN OLWHRM1.PD10_PRS_NME PD10
	ON LN10.BF_SSN = PD10.DF_PRS_ID
INNER JOIN OLWHRM1.PD30_PRS_ADR PD30
	ON LN10.BF_SSN = PD30.DF_PRS_ID
	AND PD30.DC_ADR = 'L'
LEFT OUTER JOIN (SELECT AY10.BF_SSN, AY10.LD_ATY_REQ_RCV, 'X' AS EX
						FROM OLWHRM1.AY10_BR_LON_ATY AY10 
						WHERE AY10.PF_REQ_ACT = 'TLPGR' 
						) EXCLU
	ON LN10.BF_SSN = EXCLU.BF_SSN
	AND EXCLU.LD_ATY_REQ_RCV >= A.LD_STA_STU10

/*WHERE LN10.BF_SSN LIKE '0%'*/
WHERE LN10.IC_LON_PGM = 'TILP'
AND LN10.LA_CUR_PRI > 0
AND EXCLU.EX IS NULL

FOR READ ONLY WITH UR
);
%MEND RUNR2;
%MACRO RUNR3();
/*REPORT 3 CRITIRIA*/
CREATE TABLE REP3 AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT DISTINCT LN10.BF_SSN
	,PD10.DF_SPE_ACC_ID
	,PD10.DM_PRS_1
	,PD10.DM_PRS_LST
	,PD30.DX_STR_ADR_1
	,PD30.DX_STR_ADR_2
	,PD30.DM_CT
	,CASE 
		WHEN PD30.DM_FGN_CNY = ''
			THEN PD30.DC_DOM_ST
		WHEN PD30.DM_FGN_CNY <> ''
			THEN PD30.DM_FGN_ST
	END AS DC_DOM_ST
	,PD30.DF_ZIP_CDE
	,PD30.DM_FGN_CNY
	,CURRENT DATE + 30 DAYS AS D_DATE
	,PD30.DC_DOM_ST AS STATE_CODE
	,'MA2324' AS CCC
FROM OLWHRM1.LN10_LON LN10
INNER JOIN (SELECT SD10.LF_STU_SSN, SD10.LD_STA_STU10
				FROM OLWHRM1.SD10_STU_SPR SD10
				WHERE SD10.LC_STA_STU10 = 'A'
				AND SD10.LC_REA_SCL_SPR = '01'
				AND SD10.LD_SCL_SPR < CURRENT DATE - 60 DAYS
				) A
	ON A.LF_STU_SSN = LN10.LF_STU_SSN
INNER JOIN OLWHRM1.PD10_PRS_NME PD10
	ON LN10.BF_SSN = PD10.DF_PRS_ID
INNER JOIN OLWHRM1.PD30_PRS_ADR PD30
	ON LN10.BF_SSN = PD30.DF_PRS_ID
	AND PD30.DC_ADR = 'L'
LEFT OUTER JOIN (SELECT AY10.BF_SSN, AY10.LD_ATY_REQ_RCV, 'X' AS EX
						FROM OLWHRM1.AY10_BR_LON_ATY AY10 
						WHERE AY10.PF_REQ_ACT = 'TLPTL' 
						) EXCLU
	ON LN10.BF_SSN = EXCLU.BF_SSN

/*WHERE LN10.BF_SSN LIKE '0%'*/
WHERE LN10.IC_LON_PGM = 'TILP'
AND LN10.LA_CUR_PRI > 0
AND EXCLU.EX IS NULL
/*EXCLUDE SSNS WITH TLCNO, TLTCR, OTLTC ARCS*/
AND LN10.BF_SSN NOT IN (
							SELECT DISTINCT AY10_2.BF_SSN
							FROM OLWHRM1.AY10_BR_LON_ATY AY10_2
							WHERE AY10_2.PF_REQ_ACT IN ('TLCNO','TLTCR','OTLTC')
						)
/*EXCLUDES SSNS WITH FINANCIAL TRANS OF 1054*/
AND LN10.BF_SSN NOT IN (
							SELECT DISTINCT FIN.BF_SSN
							FROM OLWHRM1.LN90_FIN_ATY FIN
							WHERE FIN.PC_FAT_TYP = '10' AND FIN.PC_FAT_SUB_TYP = '54'
						)
/*EXCLUDES SSNS WITH DEFERMENT TYPES OF 06 OR 33*/
AND LN10.BF_SSN NOT IN (
							SELECT DISTINCT DEF.BF_SSN
							FROM OLWHRM1.DF10_BR_DFR_REQ DEF
							WHERE DEF.LC_DFR_TYP IN ('06','33') AND LC_DFR_STA = 'A'
						)

FOR READ ONLY WITH UR
);
%MEND RUNR3;
%MACRO RUNR4();
/*REPORT 4 CRITIRIA*/
CREATE TABLE REP4 AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT DISTINCT LN10.BF_SSN
	,PD10.DF_SPE_ACC_ID
	,PD10.DM_PRS_1
	,PD10.DM_PRS_LST
	,PD30.DX_STR_ADR_1
	,PD30.DX_STR_ADR_2
	,PD30.DM_CT
	,CASE 
		WHEN PD30.DM_FGN_CNY = ''
			THEN PD30.DC_DOM_ST
		WHEN PD30.DM_FGN_CNY <> ''
			THEN PD30.DM_FGN_ST
	END AS DC_DOM_ST
	,PD30.DF_ZIP_CDE
	,PD30.DM_FGN_CNY
	,A.LD_SCL_SPR AS D_DATE
	,PD30.DC_DOM_ST AS STATE_CODE
	,'MA2324' AS CCC
FROM OLWHRM1.LN10_LON LN10
INNER JOIN (SELECT SD10.LF_STU_SSN, SD10.LD_STA_STU10, SD10.LD_SCL_SPR
				FROM OLWHRM1.SD10_STU_SPR SD10
				WHERE SD10.LC_STA_STU10 = 'A'
				AND SD10.LC_REA_SCL_SPR = '05'
				AND SD10.LD_SCL_SPR <= CURRENT DATE + 30 DAYS
				) A
	ON A.LF_STU_SSN = LN10.LF_STU_SSN
INNER JOIN OLWHRM1.PD10_PRS_NME PD10
	ON LN10.BF_SSN = PD10.DF_PRS_ID
INNER JOIN OLWHRM1.PD30_PRS_ADR PD30
	ON LN10.BF_SSN = PD30.DF_PRS_ID
	AND PD30.DC_ADR = 'L'
LEFT OUTER JOIN (SELECT AY10.BF_SSN, AY10.LD_ATY_REQ_RCV, 'X' AS EX
						FROM OLWHRM1.AY10_BR_LON_ATY AY10 
						WHERE AY10.PF_REQ_ACT = 'TLLAE' 
						) EXCLU
	ON LN10.BF_SSN = EXCLU.BF_SSN
	AND DAYS(A.LD_SCL_SPR) - DAYS(EXCLU.LD_ATY_REQ_RCV) <= 30
/*WHERE LN10.BF_SSN LIKE '0%'*/
WHERE LN10.IC_LON_PGM = 'TILP'
AND LN10.LA_CUR_PRI > 0
AND EXCLU.EX IS NULL

FOR READ ONLY WITH UR
);
%MEND RUNR4;
%MACRO RUNR5();
/*REPORT 5 CRITIRIA*/
CREATE TABLE REP5 AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT DISTINCT LN10.BF_SSN
	,PD10.DF_SPE_ACC_ID
	,PD10.DM_PRS_1
	,PD10.DM_PRS_LST
	,PD30.DX_STR_ADR_1
	,PD30.DX_STR_ADR_2
	,PD30.DM_CT
	,CASE 
		WHEN PD30.DM_FGN_CNY = ''
			THEN PD30.DC_DOM_ST
		WHEN PD30.DM_FGN_CNY <> ''
			THEN PD30.DM_FGN_ST
	END AS DC_DOM_ST
	,PD30.DF_ZIP_CDE
	,PD30.DM_FGN_CNY
	,A.LD_SCL_SPR AS D_DATE
	,PD30.DC_DOM_ST AS STATE_CODE
	,'MA2324' AS CCC
FROM OLWHRM1.LN10_LON LN10
INNER JOIN (SELECT SD10.LF_STU_SSN, SD10.LD_STA_STU10, SD10.LD_SCL_SPR
				FROM OLWHRM1.SD10_STU_SPR SD10
				WHERE SD10.LC_STA_STU10 = 'A'
				AND SD10.LC_REA_SCL_SPR = '05'
				AND SD10.LD_SCL_SPR <= CURRENT DATE - 5 DAYS
				) A
	ON A.LF_STU_SSN = LN10.LF_STU_SSN
INNER JOIN OLWHRM1.PD10_PRS_NME PD10
	ON LN10.BF_SSN = PD10.DF_PRS_ID
INNER JOIN OLWHRM1.PD30_PRS_ADR PD30
	ON LN10.BF_SSN = PD30.DF_PRS_ID
	AND PD30.DC_ADR = 'L'
LEFT OUTER JOIN (SELECT AY10.BF_SSN, AY10.LD_ATY_REQ_RCV, 'X' AS EX
						FROM OLWHRM1.AY10_BR_LON_ATY AY10 
						WHERE AY10.PF_REQ_ACT = 'TLLAX' 
						) EXCLU
	ON LN10.BF_SSN = EXCLU.BF_SSN
	AND EXCLU.LD_ATY_REQ_RCV >= A.LD_SCL_SPR
/*WHERE LN10.BF_SSN LIKE '0%'*/
WHERE LN10.IC_LON_PGM = 'TILP'
AND LN10.LA_CUR_PRI > 0
AND EXCLU.EX IS NULL

FOR READ ONLY WITH UR
);
%MEND RUNR5;
%MACRO RUNR6();
/*REPORT 6 CRITIRIA*/
CREATE TABLE REP6 AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT DISTINCT LN10.BF_SSN
	,PD10.DF_SPE_ACC_ID
	,PD10.DM_PRS_1
	,PD10.DM_PRS_LST
	,PD30.DX_STR_ADR_1
	,PD30.DX_STR_ADR_2
	,PD30.DM_CT
	,CASE 
		WHEN PD30.DM_FGN_CNY = ''
			THEN PD30.DC_DOM_ST
		WHEN PD30.DM_FGN_CNY <> ''
			THEN PD30.DM_FGN_ST
	END AS DC_DOM_ST
	,PD30.DF_ZIP_CDE
	,PD30.DM_FGN_CNY
	,CURRENT DATE + 30 DAYS AS D_DATE
	,PD30.DC_DOM_ST AS STATE_CODE
	,'MA2324' AS CCC
FROM OLWHRM1.LN10_LON LN10
INNER JOIN OLWHRM1.AY10_BR_LON_ATY AY10
	ON AY10.BF_SSN = LN10.BF_SSN
	AND AY10.PF_REQ_ACT = 'TLPDR'
	AND AY10.LD_ATY_REQ_RCV >= CURRENT DATE
INNER JOIN OLWHRM1.PD10_PRS_NME PD10
	ON LN10.BF_SSN = PD10.DF_PRS_ID
INNER JOIN OLWHRM1.PD30_PRS_ADR PD30
	ON LN10.BF_SSN = PD30.DF_PRS_ID
	AND PD30.DC_ADR = 'L'
LEFT OUTER JOIN (SELECT AY10.BF_SSN, AY10.LD_ATY_REQ_RCV, 'X' AS EX
						FROM OLWHRM1.AY10_BR_LON_ATY AY10 
						WHERE AY10.PF_REQ_ACT = 'TLPDP' 
						) EXCLU
	ON LN10.BF_SSN = EXCLU.BF_SSN
	AND EXCLU.LD_ATY_REQ_RCV >= AY10.LD_ATY_REQ_RCV

/*WHERE LN10.BF_SSN LIKE '0%'*/
WHERE LN10.IC_LON_PGM = 'TILP'
AND LN10.LA_CUR_PRI > 0
AND EXCLU.EX IS NULL

FOR READ ONLY WITH UR
);
%MEND RUNR6;
%MACRO RUNR7();
/*REPORT 7 CRITIRIA*/
CREATE TABLE REP7 AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT DISTINCT LN10.BF_SSN
	,PD10.DF_SPE_ACC_ID
	,PD10.DM_PRS_1
	,PD10.DM_PRS_LST
	,PD30.DX_STR_ADR_1
	,PD30.DX_STR_ADR_2
	,PD30.DM_CT
	,CASE 
		WHEN PD30.DM_FGN_CNY = ''
			THEN PD30.DC_DOM_ST
		WHEN PD30.DM_FGN_CNY <> ''
			THEN PD30.DM_FGN_ST
	END AS DC_DOM_ST
	,PD30.DF_ZIP_CDE
	,PD30.DM_FGN_CNY
	,CURRENT DATE + 30 DAYS AS D_DATE
	,PD30.DC_DOM_ST AS STATE_CODE
	,'MA2324' AS CCC
FROM OLWHRM1.LN10_LON LN10
INNER JOIN OLWHRM1.AY10_BR_LON_ATY AY10
	ON AY10.BF_SSN = LN10.BF_SSN
	AND AY10.PF_REQ_ACT = 'TLPNA'
	AND AY10.LD_ATY_REQ_RCV <= CURRENT DATE
INNER JOIN OLWHRM1.PD10_PRS_NME PD10
	ON LN10.BF_SSN = PD10.DF_PRS_ID
INNER JOIN OLWHRM1.PD30_PRS_ADR PD30
	ON LN10.BF_SSN = PD30.DF_PRS_ID
	AND PD30.DC_ADR = 'L'
LEFT OUTER JOIN (SELECT AY10.BF_SSN, AY10.LD_ATY_REQ_RCV, 'X' AS EX
						FROM OLWHRM1.AY10_BR_LON_ATY AY10 
						WHERE AY10.PF_REQ_ACT = 'TLBNA' 
						) EXCLU
	ON LN10.BF_SSN = EXCLU.BF_SSN
	AND EXCLU.LD_ATY_REQ_RCV >= AY10.LD_ATY_REQ_RCV
INNER JOIN (SELECT Z.BF_SSN 
					FROM OLWHRM1.LN10_LON Z 
					INNER JOIN OLWHRM1.DW01_DW_CLC_CLU Z2
						ON Z.BF_SSN = Z2.BF_SSN
						AND Z.LN_SEQ = Z2.LN_SEQ
						AND Z2.WC_DW_LON_STA = '02'
					WHERE Z.IC_LON_PGM = 'TILP'
					GROUP BY Z.BF_SSN
					HAVING COUNT(*) >= 6) INCLUDE
	ON INCLUDE.BF_SSN = LN10.BF_SSN

/*WHERE LN10.BF_SSN LIKE '0%'*/
WHERE LN10.IC_LON_PGM = 'TILP'
AND LN10.LA_CUR_PRI > 0
AND EXCLU.EX IS NULL

FOR READ ONLY WITH UR
);
%MEND RUNR7;
%MACRO RUNR8();
/*REPORT 8 CRITIRIA*/
CREATE TABLE REP8 AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT DISTINCT LN10.BF_SSN
	,PD10.DF_SPE_ACC_ID
	,PD10.DM_PRS_1
	,PD10.DM_PRS_LST
	,PD30.DX_STR_ADR_1
	,PD30.DX_STR_ADR_2
	,PD30.DM_CT
	,CASE 
		WHEN PD30.DM_FGN_CNY = ''
			THEN PD30.DC_DOM_ST
		WHEN PD30.DM_FGN_CNY <> ''
			THEN PD30.DM_FGN_ST
	END AS DC_DOM_ST
	,PD30.DF_ZIP_CDE
	,PD30.DM_FGN_CNY
	,CURRENT DATE + 60 DAYS AS D_DATE
	,PD30.DC_DOM_ST AS STATE_CODE
	,'MA2324' AS CCC
FROM OLWHRM1.LN10_LON LN10
INNER JOIN (SELECT SD10.LF_STU_SSN, SD10.LD_STA_STU10
				FROM OLWHRM1.SD10_STU_SPR SD10
				WHERE SD10.LC_STA_STU10 = 'A'
				AND SD10.LC_REA_SCL_SPR = '01'
				) A
	ON A.LF_STU_SSN = LN10.LF_STU_SSN
INNER JOIN OLWHRM1.PD10_PRS_NME PD10
	ON LN10.BF_SSN = PD10.DF_PRS_ID
INNER JOIN OLWHRM1.PD30_PRS_ADR PD30
	ON LN10.BF_SSN = PD30.DF_PRS_ID
	AND PD30.DC_ADR = 'L'
INNER JOIN OLWHRM1.DW01_DW_CLC_CLU DW01
	ON DW01.BF_SSN = LN10.BF_SSN
	AND DW01.LN_SEQ = LN10.LN_SEQ
	AND WC_DW_LON_STA = '04'
INNER JOIN OLWHRM1.DF10_BR_DFR_REQ DF10
	ON DF10.BF_SSN = LN10.BF_SSN
	AND DF10.LC_DFR_TYP = '33'
	AND DF10.LC_STA_DFR10 = 'A'
INNER JOIN OLWHRM1.LN50_BR_DFR_APV LN50
	ON DF10.BF_SSN = LN50.BF_SSN
	AND DF10.LF_DFR_CTL_NUM = LN50.LF_DFR_CTL_NUM
	AND LN50.LD_DFR_BEG < (CURRENT DATE - 365 DAYS)
LEFT OUTER JOIN (SELECT AY10.BF_SSN, 'X' AS EX
						FROM OLWHRM1.AY10_BR_LON_ATY AY10 
						WHERE AY10.PF_REQ_ACT = 'TI1YR' 
						) EXCLU
	ON LN10.BF_SSN = EXCLU.BF_SSN

/*WHERE LN10.BF_SSN LIKE '0%'*/
WHERE LN10.IC_LON_PGM = 'TILP'
AND LN10.LA_CUR_PRI > 0
AND EXCLU.EX IS NULL

FOR READ ONLY WITH UR
);
%MEND RUNR8;
%MACRO RUNR9();
/*REPORT 9 CRITIRIA*/
CREATE TABLE REP9 AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT DISTINCT LN10.BF_SSN
	,PD10.DF_SPE_ACC_ID
	,PD10.DM_PRS_1
	,PD10.DM_PRS_LST
	,PD30.DX_STR_ADR_1
	,PD30.DX_STR_ADR_2
	,PD30.DM_CT
	,CASE 
		WHEN PD30.DM_FGN_CNY = ''
			THEN PD30.DC_DOM_ST
		WHEN PD30.DM_FGN_CNY <> ''
			THEN PD30.DM_FGN_ST
	END AS DC_DOM_ST
	,PD30.DF_ZIP_CDE
	,PD30.DM_FGN_CNY
	,CURRENT DATE + 30 DAYS AS D_DATE
	,PD30.DC_DOM_ST AS STATE_CODE
	,'MA2324' AS CCC
FROM OLWHRM1.LN10_LON LN10
INNER JOIN (SELECT SD10.LF_STU_SSN, SD10.LD_STA_STU10, SD10.LD_SCL_SPR
				FROM OLWHRM1.SD10_STU_SPR SD10
				WHERE SD10.LC_STA_STU10 = 'A'
				AND SD10.LC_REA_SCL_SPR = '05'
				AND SD10.LD_SCL_SPR >= CURRENT DATE + 4 MONTHS
				) A
	ON A.LF_STU_SSN = LN10.LF_STU_SSN
INNER JOIN OLWHRM1.PD10_PRS_NME PD10
	ON LN10.BF_SSN = PD10.DF_PRS_ID
INNER JOIN OLWHRM1.PD30_PRS_ADR PD30
	ON LN10.BF_SSN = PD30.DF_PRS_ID
	AND PD30.DC_ADR = 'L'
INNER JOIN OLWHRM1.DW01_DW_CLC_CLU DW01
	ON DW01.BF_SSN = LN10.BF_SSN
	AND DW01.LN_SEQ = LN10.LN_SEQ
	AND WC_DW_LON_STA = '02'
LEFT OUTER JOIN (SELECT AY10.BF_SSN, AY10.LD_ATY_REQ_RCV, 'X' AS EX
						FROM OLWHRM1.AY10_BR_LON_ATY AY10 
						WHERE AY10.PF_REQ_ACT = 'TLMSA' 
						) EXCLU
	ON LN10.BF_SSN = EXCLU.BF_SSN
INNER JOIN (SELECT TILP8.BF_SSN 
			FROM OLWHRM1.LN10_LON TILP8 
			WHERE TILP8.IC_LON_PGM = 'TILP'
			GROUP BY TILP8.BF_SSN
			HAVING COUNT(*) > 8
			) TIL8
	ON LN10.BF_SSN = TIL8.BF_SSN

/*WHERE LN10.BF_SSN LIKE '0%'*/
WHERE LN10.IC_LON_PGM = 'TILP'
AND LN10.LA_CUR_PRI > 0
AND EXCLU.EX IS NULL

FOR READ ONLY WITH UR
);
%MEND RUNR9;
%MACRO RUNR10();
/*REPORT 10 CRITIRIA*/
CREATE TABLE REP10 AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT DISTINCT LN10.BF_SSN
	,PD10.DF_SPE_ACC_ID
	,PD10.DM_PRS_1
	,PD10.DM_PRS_LST
	,PD30.DX_STR_ADR_1
	,PD30.DX_STR_ADR_2
	,PD30.DM_CT
	,CASE 
		WHEN PD30.DM_FGN_CNY = ''
			THEN PD30.DC_DOM_ST
		WHEN PD30.DM_FGN_CNY <> ''
			THEN PD30.DM_FGN_ST
	END AS DC_DOM_ST
	,PD30.DF_ZIP_CDE
	,PD30.DM_FGN_CNY
	,PD30.DC_DOM_ST AS STATE_CODE
	,'MA2324' AS CCC
FROM OLWHRM1.LN10_LON LN10
INNER JOIN (SELECT DISTINCT Z.BF_SSN 
		FROM OLWHRM1.AY10_BR_LON_ATY Z 
		WHERE Z.PF_REQ_ACT = 'TI1YR'
		AND Z.LD_ATY_REQ_RCV <= CURRENT DATE - 60 DAYS
		) AY10
	ON LN10.BF_SSN = AY10.BF_SSN
INNER JOIN OLWHRM1.PD10_PRS_NME PD10
	ON LN10.BF_SSN = PD10.DF_PRS_ID
INNER JOIN OLWHRM1.PD30_PRS_ADR PD30
	ON LN10.BF_SSN = PD30.DF_PRS_ID
	AND PD30.DC_ADR = 'L'
LEFT OUTER JOIN (SELECT AY10.BF_SSN, AY10.LD_ATY_REQ_RCV, 'X' AS EX
						FROM OLWHRM1.AY10_BR_LON_ATY AY10 
						WHERE AY10.PF_REQ_ACT IN ('TI1RT','TI1FU')
						) EXCLU
	ON LN10.BF_SSN = EXCLU.BF_SSN


/*WHERE LN10.BF_SSN LIKE '0%'*/
WHERE LN10.IC_LON_PGM = 'TILP'
AND LN10.LA_CUR_PRI > 0
AND EXCLU.EX IS NULL

FOR READ ONLY WITH UR
);
%MEND RUNR10;

%RUNR2();
%RUNR3();
%RUNR4();
%RUNR5();
%RUNR6();
%RUNR7();
%RUNR8();
%RUNR9();
%RUNR10();


DISCONNECT FROM DB2;
/*ENDRSUBMIT;*/

/*DATA REP2; SET WORKLOCL.REP2; RUN;*/
/*DATA REP3; SET WORKLOCL.REP3; RUN;*/
/*DATA REP4; SET WORKLOCL.REP4; RUN;*/
/*DATA REP5; SET WORKLOCL.REP5; RUN;*/
/*DATA REP6; SET WORKLOCL.REP6; RUN;*/
/*DATA REP7; SET WORKLOCL.REP7; RUN;*/
/*DATA REP8; SET WORKLOCL.REP8; RUN;*/
/*DATA REP9; SET WORKLOCL.REP9; RUN;*/
/*DATA REP10; SET WORKLOCL.REP10; RUN;*/

%MACRO ADD_ACSKEY(DS);
*CALCULATE KEYLINE;
DATA &DS (DROP = KEYSSN MODAY KEYLINE CHKDIG DIG I 
	CHKDIG CHK1 CHK2 CHK3 CHKDIGIT CHECK);
SET &DS;
KEYSSN = TRANSLATE(BF_SSN,'MYLAUGHTER','0987654321');
MODAY = PUT(DATE(),MMDDYYN4.);
KEYLINE = "P"||KEYSSN||MODAY||'L';
CHKDIG = 0;
LENGTH DIG $2.;
DO I = 1 TO LENGTH(KEYLINE);
	IF I/2 NE ROUND(I/2,1) 
		THEN DIG = PUT(INPUT(SUBSTR(KEYLINE,I,1),BITS4.4) * 2, 2.);
	ELSE DIG = PUT(INPUT(SUBSTR(KEYLINE,I,1),BITS4.4), 2.);
	IF SUBSTR(DIG,1,1) = " " 
		THEN CHKDIG = CHKDIG + INPUT(SUBSTR(DIG,2,1),1.);
		ELSE DO;
			CHK1 = INPUT(SUBSTR(DIG,1,1),1.);
			CHK2 = INPUT(SUBSTR(DIG,2,1),1.);
			IF CHK1 + CHK2 >= 10
				THEN DO;
					CHK3 = PUT(CHK1 + CHK2,2.);
					CHK1 = INPUT(SUBSTR(CHK3,1,1),1.);
					CHK2 = INPUT(SUBSTR(CHK3,2,1),1.);
				END;
			CHKDIG = CHKDIG + CHK1 + CHK2;
		END;
END;
CHKDIGIT = 10 - INPUT(SUBSTR((RIGHT(PUT(CHKDIG,3.))),3,1),3.);
IF CHKDIGIT = 10 THEN CHKDIGIT = 0;
CHECK = PUT(CHKDIGIT,1.);
ACSKEY = "#"||KEYLINE||CHECK||"#";
RUN;
%MEND ADD_ACSKEY;

/*%ADD_ACSKEY(REP2);*/
/*%ADD_ACSKEY(REP3);*/
/*%ADD_ACSKEY(REP4);*/
/*%ADD_ACSKEY(REP5);*/
/*%ADD_ACSKEY(REP6);*/
/*%ADD_ACSKEY(REP7);*/
/*%ADD_ACSKEY(REP8);*/
%ADD_ACSKEY(REP9);
/*%ADD_ACSKEY(REP10);*/


%MACRO PRIN(DS,REPNO);
data _null_;
set  &DS;
file REPORT&REPNO delimiter=',' DSD DROPOVER lrecl=32767;
   format BF_SSN $9. ;
   format DF_SPE_ACC_ID $10. ;
   format DM_PRS_1 $13. ;
   format DM_PRS_LST $23. ;
   format DX_STR_ADR_1 $30. ;
   format DX_STR_ADR_2 $30. ;
   format DM_CT $20. ;
   format DC_DOM_ST $15. ;
   format DF_ZIP_CDE $17. ;
   format DM_FGN_CNY $25. ;
   format STATE_CODE $2. ;
   format CCC $6. ;
   format ACSKEY $18. ;
if _n_ = 1 then        /* write column names */
 do;
   put
   'BF_SSN'
   ','
   'DF_SPE_ACC_ID'
   ','
   'DM_PRS_1'
   ','
   'DM_PRS_LST'
   ','
   'DX_STR_ADR_1'
   ','
   'DX_STR_ADR_2'
   ','
   'DM_CT'
   ','
   'DC_DOM_ST'
   ','
   'DF_ZIP_CDE'
   ','
   'DM_FGN_CNY'
   ','
   'ACSKEY'
   ','
   'STATE_CODE'
   ','
   'COST_CENTER_CODE'
   ;
 end;
 do;
   EFIOUT + 1;
   put BF_SSN $ @;
   put DF_SPE_ACC_ID $ @;
   put DM_PRS_1 $ @;
   put DM_PRS_LST $ @;
   put DX_STR_ADR_1 $ @;
   put DX_STR_ADR_2 $ @;
   put DM_CT $ @;
   put DC_DOM_ST $ @;
   put DF_ZIP_CDE $ @;
   put DM_FGN_CNY $ @;
   put ACSKEY $ @;
   put STATE_CODE $ @;
   put CCC $ ;
   ;
 end;
run;

%MEND PRIN;

%MACRO PRIN2(DS,REPNO);
data _null_;
set  &DS;
file REPORT&REPNO delimiter=',' DSD DROPOVER lrecl=32767;
   format BF_SSN $9. ;
   format DF_SPE_ACC_ID $10. ;
   format DM_PRS_1 $13. ;
   format DM_PRS_LST $23. ;
   format DX_STR_ADR_1 $30. ;
   format DX_STR_ADR_2 $30. ;
   format DM_CT $20. ;
   format DC_DOM_ST $15. ;
   format DF_ZIP_CDE $17. ;
   format DM_FGN_CNY $25. ;
   format D_DATE MMDDYY10. ;
   format STATE_CODE $2. ;
   format CCC $6. ;
   format ACSKEY $18. ;
if _n_ = 1 then        /* write column names */
 do;
   put
   'BF_SSN'
   ','
   'DF_SPE_ACC_ID'
   ','
   'DM_PRS_1'
   ','
   'DM_PRS_LST'
   ','
   'DX_STR_ADR_1'
   ','
   'DX_STR_ADR_2'
   ','
   'DM_CT'
   ','
   'DC_DOM_ST'
   ','
   'DF_ZIP_CDE'
   ','
   'DM_FGN_CNY'
   ','
   'D_DATE'
   ','
   'ACSKEY'
   ','
   'STATE_CODE'
   ','
   'COST_CENTER_CODE'
   ;
 end;
 do;
   EFIOUT + 1;
   put BF_SSN $ @;
   put DF_SPE_ACC_ID $ @;
   put DM_PRS_1 $ @;
   put DM_PRS_LST $ @;
   put DX_STR_ADR_1 $ @;
   put DX_STR_ADR_2 $ @;
   put DM_CT $ @;
   put DC_DOM_ST $ @;
   put DF_ZIP_CDE $ @;
   put DM_FGN_CNY $ @;
   put D_DATE @;
   put ACSKEY $ @;
   put STATE_CODE $ @;
   put CCC $ ;

   ;
 end;
run;
%MEND PRIN2;

%PRIN(REP2,2);
%PRIN2(REP3,3);
%PRIN2(REP4,4);
%PRIN2(REP5,5);
%PRIN2(REP6,6);
%PRIN2(REP7,7);
%PRIN2(REP8,8);
%PRIN2(REP9,9);
%PRIN(REP10,10);






