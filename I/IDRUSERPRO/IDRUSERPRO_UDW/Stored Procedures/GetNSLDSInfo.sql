CREATE PROCEDURE [idruserpro].[GetNSLDSInfo]
	@SSN CHAR(9)
AS
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

		SELECT 
			CASE GRSP.IC_LON_PGM
				WHEN 'CL' THEN 'CNSLDN'
				WHEN 'D3' THEN 'DLPLGB'
				WHEN 'D4' THEN 'DLPLUS'
				WHEN 'D6' THEN 'DLSCNS'
				WHEN 'D65' THEN 'DLSSPL'
				WHEN 'D1' THEN 'DLSTFD'
				WHEN 'D5' THEN 'DLUCNS'
				WHEN 'D2' THEN 'DLUNST'
				WHEN 'D55' THEN'DLUSPL'
				WHEN 'PL' THEN 'PLUS'
				WHEN 'GB' THEN 'PLUSGB'
				WHEN 'SL' THEN 'SLS'
				WHEN 'SF' THEN 'STFFRD'
				WHEN 'D8' THEN 'TEACH'
				WHEN 'SU' THEN 'UNSTFD'
				WHEN 'D7' THEN 'DLPCNS'
				WHEN 'FI' THEN 'FISL'
				WHEN 'PU' THEN 'PERKNS'
				WHEN 'D0' THEN 'DLSTFD'
				WHEN 'D9' THEN 'DLSCNS'
				ELSE GRSP.IC_LON_PGM
			END AS LoanType,
			GRSP.LF_CUR_SER AS OwnerLender,
			COALESCE(GRSP.LA_CUR_PRI,0) AS OutstandingBalance,
			COALESCE(GRSP.WA_TOT_BRI_OTS,0) AS OutstandingInterest,
			GRSP.LR_STT_ITR AS InterestRate,
			GRSP.IdrIneligible,
			GRSP.IcrIneligible,
			GRSP.LF_FED_AWD,
			GRSP.DF_PRS_ID,
			GRSP.LN_FED_AWD_SEQ
		FROM 
			CDW..GRSP_NDS_LON_RSP GRSP 	
			INNER JOIN
			(
				SELECT
					DF_PRS_ID,
					MAX(LD_NDS_LIS_REQ) AS LD_NDS_LIS_REQ
				FROM
					CDW..GRSP_NDS_LON_RSP
				GROUP BY
					DF_PRS_ID
			)POP
				ON POP.DF_PRS_ID = GRSP.DF_PRS_ID
				AND POP.LD_NDS_LIS_REQ = GRSP.LD_NDS_LIS_REQ
		WHERE 
			GRSP.DF_PRS_ID = @SSN
			AND GRSP.LF_CUR_SER != '502'
			AND IC_LON_PGM NOT IN ('PU','FI','NU', 'DU', 'EU', 'IC', 'PL')
			AND LA_CUR_PRI > 0

RETURN 0


