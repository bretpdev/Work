CREATE PROCEDURE [idruserpro].[GetOriginalLoans]
	@AccountIdentifier VARCHAR(10)
AS
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
	SELECT
		LN10.LN_SEQ [LoanSequence],
		SUM(LN15.LA_DSB) [OriginalBalance],
		LN72.LR_INT_RDC_PGM_ORG / 100 [InterestRate]
	FROM
		PD10_PRS_NME PD10
		INNER JOIN LN10_LON LN10 ON LN10.BF_SSN = PD10.DF_PRS_ID
		INNER JOIN LN15_DSB LN15 ON LN15.BF_SSN = LN10.BF_SSN AND LN10.LN_SEQ = LN15.LN_SEQ
		INNER JOIN LN72_INT_RTE_HST LN72 
			ON LN72.BF_SSN = LN10.BF_SSN 
			AND LN72.LN_SEQ = LN10.LN_SEQ 
			AND LN72.LC_STA_LON72 = 'A' 
			AND GETDATE() BETWEEN LN72.LD_ITR_EFF_BEG AND LN72.LD_ITR_EFF_END
	WHERE
		LN10.LC_STA_LON10 != 'D'
		AND (PD10.DF_PRS_ID = @AccountIdentifier OR PD10.DF_SPE_ACC_ID = @AccountIdentifier)
		AND	LN10.LA_CUR_PRI > 0
	GROUP BY
		LN10.LN_SEQ, LN72.LR_INT_RDC_PGM_ORG

RETURN 0
