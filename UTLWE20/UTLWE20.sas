/*UTLWE20 - MONTH-END DATA FILE FOR USU CU*/

/*LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;
%LET RPTLIB = %SYSGET(reportdir);
FILENAME REPORT2 "&RPTLIB/ULWE20.LWE20R2";*/

FILENAME REPORT2 'T:\SAS\UTLWE20.txt';
LIBNAME  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=WORK;
RSUBMIT;
PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE DEMO AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT DISTINCT
	A.BF_SSN
	,A.LF_DOE_SCL_ORG
	,A.IC_LON_PGM
	,A.IF_GTR
	,B.LC_ACA_GDE_LEV
	,C.WX_ACA_GDE_LEV
	,A.IF_OWN
	,A.WD_RPY_BEG
	,A.WA_CUR_PRI
	,A.WA_CUR_BR_INT
	,A.WA_CUR_GOV_INT
	,A.WM_BR_1
	,A.WM_BR_MID
	,A.WM_BR_LST
	,A.WM_BR_LST_SFX
	,B.DD_BRT
	,B.WM_STU_1
	,B.WM_STU_MID
	,B.WM_STU_LST
	,B.WM_STU_LST_SFX
	,B.WX_STR_ADR_1
	,B.WX_STR_ADR_2
	,B.WX_STR_ADR_3
	,B.WM_CT
	,B.DC_DOM_ST
	,B.DF_ZIP_CDE
	,B.DN_PHN_XTN
	,B.DN_DOM_PHN_LCL
	,B.DN_DOM_PHN_XCH
	,B.DN_DOM_PHN_ARA
	,A.LD_SCL_SPR
	,B.LA_LON_AMT_GTR
	,B.LD_LON_GTR
	,B.WX_ADR_EML
	,B.AF_LON_ALT
	,B.AN_SEQ_COM_LN_APL
FROM	OLWHRM1.MR5A_MR_LON_MTH_01 A
		LEFT OUTER JOIN OLWHRM1.MR5B_MR_LON_MTH_02 B ON
			A.BF_SSN = B.BF_SSN
			AND A.LN_SEQ = B.LN_SEQ
		LEFT OUTER JOIN OLWHRM1.MR5C_MR_LON_MTH_03 C ON
			A.BF_SSN = C.BF_SSN
			AND A.LN_SEQ = C.LN_SEQ
		
WHERE	A.IF_OWN = '830146'
		AND A.WA_CUR_PRI > 0
ORDER BY A.BF_SSN
);
DISCONNECT FROM DB2;
ENDRSUBMIT;

DATA DEMO;
SET WORKLOCL.DEMO;
RUN;

DATA _NULL_;
SET DEMO;
%let _EFIERR_ = 0; /* set the ERROR detection macro variable */
%let _EFIREC_ = 0;     /* clear export record count macro variable */
FILE REPORT2 DELIMITER=',' DSD LRECL=32767;

FORMAT BF_SSN $9. ;
FORMAT LF_DOE_SCL_ORG $8. ;
FORMAT IC_LON_PGM $6. ;
FORMAT IF_GTR $6. ;
FORMAT LC_ACA_GDE_LEV $2. ;
FORMAT WX_ACA_GDE_LEV $20. ;
FORMAT IF_OWN $8. ;
FORMAT WD_RPY_BEG YYMMDDD10. ;
FORMAT WA_CUR_PRI DOLLAR10.2 ;
FORMAT WA_CUR_BR_INT DOLLAR10.2 ;
FORMAT WA_CUR_GOV_INT DOLLAR10.2 ;
FORMAT WM_BR_1 $13. ;
FORMAT WM_BR_MID $13. ;
FORMAT WM_BR_LST $23. ;
FORMAT WM_BR_LST_SFX $4. ;
FORMAT DD_BRT YYMMDDD10. ;
FORMAT WM_STU_1 $13. ;
FORMAT WM_STU_MID $13. ;
FORMAT WM_STU_LST $23. ;
FORMAT WM_STU_LST_SFX $4. ;
FORMAT WX_STR_ADR_1 $30. ;
FORMAT WX_STR_ADR_2 $30. ;
FORMAT WX_STR_ADR_3 $30. ;
FORMAT WM_CT $20. ;
FORMAT DC_DOM_ST $2. ;
FORMAT DF_ZIP_CDE $17. ;
FORMAT DN_PHN_XTN $5. ;
FORMAT DN_DOM_PHN_LCL $4. ;
FORMAT DN_DOM_PHN_XCH $3. ;
FORMAT DN_DOM_PHN_ARA $3. ;
FORMAT LD_SCL_SPR YYMMDDD10. ;
FORMAT LA_LON_AMT_GTR DOLLAR10.2 ;
FORMAT LD_LON_GTR YYMMDDD10. ;
FORMAT WX_ADR_EML $75. ;
FORMAT AF_LON_ALT $17. ;
FORMAT AN_SEQ_COM_LN_APL 8. ;
IF _N_ = 1 THEN DO;       /* WRITE COLUMN NAMES */
	PUT
	'BF_SSN'			','
	'LF_DOE_SCL_ORG'	','
	'IC_LON_PGM'		','
	'IF_GTR'			','
	'LC_ACA_GDE_LEV'	','
	'WX_ACA_GDE_LEV'	','
	'IF_OWN'			','
	'WD_RPY_BEG'		','
	'WA_CUR_PRI'		','
	'WA_CUR_BR_INT'		','
	'WA_CUR_GOV_INT'	','
	'WM_BR_1'			','
	'WM_BR_MID'			','
	'WM_BR_LST'			','
	'WM_BR_LST_SFX'		','
	'DD_BRT'			','
	'WM_STU_1'			','
	'WM_STU_MID'		','
	'WM_STU_LST'		','
	'WM_STU_LST_SFX'	','
	'WX_STR_ADR_1'		','
	'WX_STR_ADR_2'		','
	'WX_STR_ADR_3'		','
	'WM_CT'				','
	'DC_DOM_ST'			','
	'DF_ZIP_CDE'		','
	'DN_PHN_XTN'		','
	'DN_DOM_PHN_LCL'	','
	'DN_DOM_PHN_XCH'	','
	'DN_DOM_PHN_ARA'	','
	'LD_SCL_SPR'		','
	'LA_LON_AMT_GTR'	','
	'LD_LON_GTR'		','
	'WX_ADR_EML'		','
	'AF_LON_ALT'		','
	'AN_SEQ_COM_LN_APL'
	;
	END;
DO;
	PUT BF_SSN $ @;
	PUT LF_DOE_SCL_ORG $ @;
	PUT IC_LON_PGM $ @;
	PUT IF_GTR $ @;
	PUT LC_ACA_GDE_LEV $ @;
	PUT WX_ACA_GDE_LEV $ @;
	PUT IF_OWN $ @;
	PUT WD_RPY_BEG $ @;
	PUT WA_CUR_PRI $ @;
	PUT WA_CUR_BR_INT $ @;
	PUT WA_CUR_GOV_INT $ @;
	PUT WM_BR_1 $ @;
	PUT WM_BR_MID $ @;
	PUT WM_BR_LST $ @;
	PUT WM_BR_LST_SFX $ @;
	PUT DD_BRT $ @;
	PUT WM_STU_1 $ @;
	PUT WM_STU_MID $ @;
	PUT WM_STU_LST $ @;
	PUT WM_STU_LST_SFX $ @;
	PUT WX_STR_ADR_1 $ @;
	PUT WX_STR_ADR_2 $ @;
	PUT WX_STR_ADR_3 $ @;
	PUT WM_CT $ @;
	PUT DC_DOM_ST $ @;
	PUT DF_ZIP_CDE $ @;
	PUT DN_PHN_XTN $ @;
	PUT DN_DOM_PHN_LCL $ @;
	PUT DN_DOM_PHN_XCH $ @;
	PUT DN_DOM_PHN_ARA $ @;
	PUT LD_SCL_SPR $ @;
	PUT LA_LON_AMT_GTR $ @;
	PUT LD_LON_GTR $ @;
	PUT WX_ADR_EML $ @;
	PUT AF_LON_ALT $ @;
	PUT AN_SEQ_COM_LN_APL $ ;
	END;
if _ERROR_ then call symput('_EFIERR_',1);  /* set ERROR detection macro variable */
If EFIEOD then
   call symput('_EFIREC_',EFIOUT);
RUN;
