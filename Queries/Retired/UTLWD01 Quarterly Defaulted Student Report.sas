/*LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;*/
/*%LET RPTLIB = %SYSGET(reportdir);*/
%LET RPTLIB = C:\WINDOWS\TEMP;
FILENAME REPORT2 "&RPTLIB/ULWD01.LWD01R2";
FILENAME REPORT3 "&RPTLIB/ULWD01.LWD01R3";
FILENAME REPORT4 "&RPTLIB/ULWD01.LWD01R4";
FILENAME REPORT10 "&RPTLIB/ULWD01.LWD01R10";
FILENAME REPORT11 "&RPTLIB/ULWD01.LWD01R11";
FILENAME REPORT12 "&RPTLIB/ULWD01.LWD01R12";
FILENAME REPORT13 "&RPTLIB/ULWD01.LWD01R13";
FILENAME REPORT14 "&RPTLIB/ULWD01.LWD01R14";
FILENAME REPORT15 "&RPTLIB/ULWD01.LWD01R15";
FILENAME REPORT16 "&RPTLIB/ULWD01.LWD01R16";
FILENAME REPORT17 "&RPTLIB/ULWD01.LWD01R17";
FILENAME REPORT18 "&RPTLIB/ULWD01.LWD01R18";
FILENAME REPORT19 "&RPTLIB/ULWD01.LWD01R19";
FILENAME REPORT20 "&RPTLIB/ULWD01.LWD01R20";
FILENAME REPORT21 "&RPTLIB/ULWD01.LWD01R21";
FILENAME REPORT22 "&RPTLIB/ULWD01.LWD01R22";
FILENAME REPORT23 "&RPTLIB/ULWD01.LWD01R23";
FILENAME REPORT24 "&RPTLIB/ULWD01.LWD01R24";
FILENAME REPORT25 "&RPTLIB/ULWD01.LWD01R25";
FILENAME REPORT26 "&RPTLIB/ULWD01.LWD01R26";
FILENAME REPORT27 "&RPTLIB/ULWD01.LWD01R27";
FILENAME REPORT28 "&RPTLIB/ULWD01.LWD01R28";
FILENAME REPORT29 "&RPTLIB/ULWD01.LWD01R29";
FILENAME REPORT30 "&RPTLIB/ULWD01.LWD01R30";
FILENAME REPORT31 "&RPTLIB/ULWD01.LWD01R31";
FILENAME REPORT32 "&RPTLIB/ULWD01.LWD01R32";
FILENAME REPORT33 "&RPTLIB/ULWD01.LWD01R33";
FILENAME REPORT34 "&RPTLIB/ULWD01.LWD01R34";
FILENAME REPORT35 "&RPTLIB/ULWD01.LWD01R35";
FILENAME REPORT36 "&RPTLIB/ULWD01.LWD01R36";
FILENAME REPORT37 "&RPTLIB/ULWD01.LWD01R37";
FILENAME REPORT38 "&RPTLIB/ULWD01.LWD01R38";
FILENAME REPORT39 "&RPTLIB/ULWD01.LWD01R39";
FILENAME REPORT40 "&RPTLIB/ULWD01.LWD01R40";
FILENAME REPORT41 "&RPTLIB/ULWD01.LWD01R41";
FILENAME REPORT42 "&RPTLIB/ULWD01.LWD01R42";
FILENAME REPORT43 "&RPTLIB/ULWD01.LWD01R43";
FILENAME REPORT44 "&RPTLIB/ULWD01.LWD01R44";
FILENAME REPORT45 "&RPTLIB/ULWD01.LWD01R45";
FILENAME REPORT46 "&RPTLIB/ULWD01.LWD01R46";
FILENAME REPORT47 "&RPTLIB/ULWD01.LWD01R47";
FILENAME REPORT48 "&RPTLIB/ULWD01.LWD01R48";
FILENAME REPORT49 "&RPTLIB/ULWD01.LWD01R49";
FILENAME REPORT50 "&RPTLIB/ULWD01.LWD01R50";
FILENAME REPORT51 "&RPTLIB/ULWD01.LWD01R51";
FILENAME REPORT52 "&RPTLIB/ULWD01.LWD01R52";
FILENAME REPORT53 "&RPTLIB/ULWD01.LWD01R53";
FILENAME REPORT54 "&RPTLIB/ULWD01.LWD01R54";
FILENAME REPORT55 "&RPTLIB/ULWD01.LWD01R55";
FILENAME REPORT56 "&RPTLIB/ULWD01.LWD01R56";
FILENAME REPORT57 "&RPTLIB/ULWD01.LWD01R57";
FILENAME REPORT58 "&RPTLIB/ULWD01.LWD01R58";
FILENAME REPORT59 "&RPTLIB/ULWD01.LWD01R59";
LIBNAME  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=WORK;
RSUBMIT;
PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE DEFAULTS AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT DISTINCT
	A.af_apl_id||A.af_apl_id_sfx					AS CLID,
	A.bf_ssn										AS SSN,
	A.ld_ldr_pof									AS LPOF,
	A.la_tot_itl_clm_pd								AS CLPD,
	A.lc_rea_clm_asn_doe							AS EDREA,
	A.ld_clm_asn_doe								AS EDDATE,
	A.la_pay_xpc									AS PMTAMT,
	RTRIM(B.dm_prs_lst)||', '||RTRIM(B.dm_prs_1)	AS NAME,
	B.di_vld_adr									AS SKIP,
	C.af_apl_ops_scl								AS SCHID,
	D.im_ist_ful									AS SCHNAME,
	D.ix_gen_str_adr_1								AS SADD1,
	D.ix_gen_str_adr_2								AS SADD2,
	D.ix_gen_str_adr_3								AS SADD3,
	D.im_gen_ct										AS SCITY,
	D.ic_gen_st										AS SSTATE,
	D.if_gen_zip									AS SZIP,
	E.ad_dsb_adj									AS DISBDATE,
	F.la_clm_bal									AS BAL

FROM	OLWHRM1.DC01_LON_CLM_INF A 
INNER JOIN OLWHRM1.PD01_PDM_INF B 
	ON A.bf_ssn = B.df_prs_id 
	AND A.lc_sta_dc10 IN ('03') 
	AND A.lc_pcl_rea IN ('DF','DQ','DU','RD','RS','DB') 
INNER JOIN OLWHRM1.GA01_APP C 
	ON A.af_apl_id = C.af_apl_id 
INNER JOIN 
	(SELECT DISTINCT
	IF_IST
	,im_ist_ful
	,ix_gen_str_adr_1
	,ix_gen_str_adr_2
	,ix_gen_str_adr_3
	,im_gen_ct
	,ic_gen_st
	,if_gen_zip
	,ic_doe_scl_sta
	FROM 	OLWHRM1.SC01_LGS_SCL_INF 
	WHERE 	ic_doe_scl_sta NOT IN ('C') 
	)D 
	ON C.af_apl_ops_scl = D.if_ist 
INNER JOIN OLWHRM1.GA11_LON_DSB_ATY E 
	ON A.af_apl_id = E.af_apl_id 
	AND A.af_apl_id_sfx = E.af_apl_id_sfx 
	AND	E.an_dsb_seq = 0001 
	AND E.ac_dsb_adj = 'A' 
LEFT OUTER JOIN OLWHRM1.DC02_BAL_INT F 
	ON A.af_apl_id = F.af_apl_id 
	AND A.af_apl_id_sfx = F.af_apl_id_sfx
);
DISCONNECT FROM DB2;

PROC SQL;
CREATE TABLE DEFCLID AS
SELECT 
	SCHID,
	COUNT(CLID)	AS CLIDCT
FROM DEFAULTS
GROUP BY SCHID;

PROC SQL;
CREATE TABLE DEFSSNA AS
SELECT DISTINCT
	SCHID,
	SSN
FROM DEFAULTS;

PROC SQL;
CREATE TABLE DEFSSN AS
SELECT DISTINCT
	SCHID,
	COUNT(SSN)	AS SSNCT
FROM DEFSSNA
GROUP BY SCHID;

PROC SQL;
CREATE TABLE DEFAULTC AS
SELECT *
FROM	DEFAULTS A INNER JOIN
		DEFSSN B ON
			A.SCHID = B.SCHID INNER JOIN
		DEFCLID C ON
			A.SCHID = C.SCHID;

DATA DEFAULTF;
	SET DEFAULTC;
	LENGTH STA $ 40;
	IF PMTAMT = 0 AND SKIP = 'N' THEN STA = 'DELINQUENT';
	IF PMTAMT = 0 AND SKIP = 'Y' THEN STA = 'DELINQUENT - SKIP';
	IF PMTAMT NE 0 THEN STA = 'CURRENT';
	IF EDREA = '08' THEN STA = 'ASSIGNMENT PENDING';
/*	IF EDREA = '03' AND EDDATE = '31MAY2001'D THEN EDREA = '00';*/
/*	IF EDREA = '03' AND EDDATE = '01JUN2001'D THEN EDREA = '00';*/
	IF EDREA = '23' THEN STA = 'ASSIGNED TO ED -/CONDITIONAL DISABILITY';
	ELSE IF EDDATE NE . THEN STA = 'ASSIGNED TO ED';
	IF BAL = . THEN BAL = 0;
	SCITYST = TRIM(SCITY)||', '||SSTATE;
RUN;

PROC SORT DATA = DEFAULTF NODUPREC;
BY SCHNAME SCHID NAME;
RUN;

PROC SQL;
CREATE TABLE SCHINFO AS
SELECT	DISTINCT
		SCHNAME,
		SCHID,
		SADD1,
		SADD2,
		SADD3,
		SCITY,
		SSTATE,
		SZIP
FROM DEFAULTF
WHERE  SCHID IN ('00367101'	/*DIXIE STATE COLLEGE OF UTAH - HURRICANE*/
				,'00367102'	/*DIXIE STATE COLLEGE OF UTAH - KANAB*/
				,'00943300'	/*SHERMAN KENDALL'S ACADEMY OF BEAUTY*/
				,'01017300'	/*INTERNATIONAL INST OF HAIR DESIGN*/
				,'01147900'	/*BEAU LA REINE COL OF BEAUTY CULTURE*/
				,'02078800'	/*SHERMAN KENDALL'S ACADEMY OF BEAUTY*/
				,'02098805'	/*UNIVERSITY OF PHOENIX - UTAH*/
				,'02361000'	/*ITT TECHNICAL INSTITUTE*/
				,'02504000'	/*FRAN BROWN COLLEGE OF BEAUTY-LAYTON*/
				,'02516100'	/*STACEY'S HANDS OF CHAMP BTY COLG*/
				,'02556800'	/*HAIRITAGE COLLEGE OF BEAUTY, MURRAY*/
				,'02557700'	/*PREMIER HAIR ACADEMY*/
				,'02573100'	/*EVANS HAIRSTYLING COLLEGE CEDAR CIT*/
				,'02612200'	/*BON LOSEE ACADEMY OF HAIR ARTISTRY*/
				,'03108200'	/*FRANCOIS D HAIR DESIGN ACADEMY*/
				,'03110400'	/*HAIRITAGE HAIR ACADEMY*/
				,'03617300'	/*HEALING MOUNTAIN MASSAGE SCHOOL*/
				,'03838300'	/*OGDEN INSTITUTE OF MASSAGE THERAPY*/
				)
ORDER BY SCHNAME
;

ENDRSUBMIT;
DATA DEFAULTF;SET WORKLOCL.DEFAULTF;RUN;
DATA SCHINFO;SET WORKLOCL.SCHINFO;RUN;

DATA _NULL_;
     EFFDT = PUT(TODAY()-1, MMDDYY10.);
     CALL SYMPUT('EFFDATE',EFFDT);
RUN;

PROC SORT DATA = DEFAULTF NODUPREC;
BY SCHNAME SCHID NAME;
RUN;

OPTIONS ORIENTATION = LANDSCAPE;
OPTIONS NONUMBER LS=127 PS=39;


%MACRO PRINT(SCH=,REPNO=);

DATA DEFAULTG;
SET DEFAULTF;
WHERE SCHID IN ("&SCH");
RUN;

PROC PRINTTO PRINT=REPORT&REPNO NEW;
RUN;

PROC CONTENTS DATA=DEFAULTG OUT=EMPTYSET NOPRINT;
DATA _NULL_;
SET EMPTYSET;
FILE PRINT;
IF  NOBS=0 AND _N_ =1 THEN DO;
	PUT // 127*'-';
	PUT      ////////
		@51 '**** NO OBSERVATIONS FOUND ****';
	PUT ////////
		@57 '-- END OF REPORT --';
	PUT ////////////
		@46 "JOB = UTLWG03     REPORT = ULWG03.LWG03R&REPNO";
	TITLE1	'UTAH HIGHER EDUCATION ASSISTANCE AUTHORITY';
	TITLE2	'DEFAULTED LOAN DETAIL REPORT BY NAME';
	TITLE3	"DATE:  &EFFDATE";
	FOOTNOTE "JOB = UTLWD01     REPORT = ULWD01.LWD01R&REPNO";
END;
RETURN;
run;

PROC REPORT DATA = DEFAULTG NOWD HEADLINE HEADSKIP SPLIT = '/' SPACING=2;

TITLE1	'UTAH HIGHER EDUCATION ASSISTANCE AUTHORITY';
TITLE2	'DEFAULTED LOAN DETAIL REPORT BY NAME';
TITLE3	"DATE:  &EFFDATE";
FOOTNOTE "JOB = UTLWD01     REPORT = ULWD01.LWD01R&REPNO";

COLUMN
	SCHNAME
	SCHID
	SCITYST
	SSNCT
	CLIDCT
	NAME
	SSN
	DISBDATE
	LPOF
	CLPD
	BAL
	STA;

DEFINE	SCHNAME / GROUP NOPRINT;
DEFINE	SCHID / GROUP NOPRINT;
DEFINE  SCITYST / GROUP NOPRINT;
DEFINE	SSNCT / GROUP NOPRINT;
DEFINE	CLIDCT / GROUP NOPRINT;
DEFINE 	NAME / 'BORROWER/NAME' WIDTH = 30;
DEFINE	DISBDATE / DISPLAY FORMAT = MMDDYY10. 'DISBURSE/DATE' WIDTH = 12;
DEFINE	LPOF / DISPLAY FORMAT = MMDDYY10. 'CLAIM PAID/DATE' WIDTH = 12;
DEFINE	CLPD / FORMAT = DOLLAR13. 'CLAIM PAID/AMOUNT';
DEFINE	BAL / FORMAT = DOLLAR13. 'CURRENT/BALANCE';
DEFINE	STA / 'REPAYMENT/STATUS' WIDTH=26 FLOW;

COMPUTE BEFORE _PAGE_ / LEFT;
      LINE '(' SCHID $8. ')  ' @12 SCHNAME $35. @79 'Contact Persons:  Sharon Dennis    (801) 321-7260';
	  LINE @12 SCITYST $35. @79 '                  Chris Chidester  (801) 321-7261';
	  LINE 'Total Number of Borrowers = ' @29 SSNCT COMMA6. @79 'Outside the Salt Lake City Area:   1-800-418-8757';
	  LINE 'Total Number of Loans = ' @29 CLIDCT COMMA6.;
      LINE ' ';
ENDCOMP;

BREAK AFTER SCHID / OL SUMMARIZE PAGE;
RUN;

PROC PRINTTO;
RUN;
%MEND PRINT;

%PRINT(SCH="'00367101','00367102','00943300','01017300','01147900','02078800','02098805','02361000','02504000','02516100','02556800','02557700','02573100','02612200','03108200','03110400','03617300','03838300'",REPNO=2);
%PRINT(SCH="'00160600'",REPNO=10);	/*BRIGHAM YOUNG UNIVERSITY-HAWAII*/
%PRINT(SCH="'00162500'",REPNO=11);	/*BRIGHAM YOUNG UNIVERSITY-IDAHO*/
%PRINT(SCH="'00367100'",REPNO=12);	/*DIXIE STATE COLLEGE OF UTAH*/
%PRINT(SCH="'00367200'",REPNO=13);	/*LATTER DAY SAINTS BUSINESS COLLEGE*/
%PRINT(SCH="'00367400'",REPNO=14);	/*STEVENS HENAGER COLLEGE OGDEN*/
%PRINT(SCH="'00367401'",REPNO=15);	/*STEVENS-HENAGER COLLEGE PROVO*/
%PRINT(SCH="'00367403'",REPNO=16);	/*STEVENS-HENAGER COLLEGE OF BUSINESS*/
%PRINT(SCH="'00367404'",REPNO=17);	/*STEVENS HENAGER COLLEGE-BOUNTIFUL*/
%PRINT(SCH="'00367405'",REPNO=18);	/*STEVENS HENAGER COLLEGE PROVIDENCE*/
%PRINT(SCH="'00367500'",REPNO=19);	/*UNIVERSITY OF UTAH*/
%PRINT(SCH="'00367600'",REPNO=20);	/*COLLEGE OF EASTERN UTAH*/
%PRINT(SCH="'00367700'",REPNO=21);	/*UTAH STATE UNIVERSITY*/
%PRINT(SCH="'00367800'",REPNO=22);	/*SOUTHERN UTAH UNIVERSITY*/
%PRINT(SCH="'00367900'",REPNO=23);	/*SNOW COLLEGE*/
%PRINT(SCH="'00367901'",REPNO=24);	/*SNOW COLLEGE SOUTH*/
%PRINT(SCH="'00368000'",REPNO=25);	/*WEBER STATE UNIVERSITY*/
%PRINT(SCH="'00368100'",REPNO=26);	/*WESTMINSTER COLLEGE*/
%PRINT(SCH="'00402700'",REPNO=27);	/*UTAH VALLEY STATE COLLEGE*/
%PRINT(SCH="'00522000'",REPNO=28);	/*SALT LAKE COMMUNITY COLLEGE*/
%PRINT(SCH="'01009801'",REPNO=29);	/*NORTHFACE UNIVERSITY*/
%PRINT(SCH="'02178500'",REPNO=30);	/*EAGLE GATE COLLEGE*/
%PRINT(SCH="'02270800'",REPNO=31);	/*AMERICAN INST OF MED & DENTAL*/
%PRINT(SCH="'02270801'",REPNO=32);	/*AMERICAN INSTITUTE OF MED & DENT*/
%PRINT(SCH="'02298500'",REPNO=33);	/*MOUNTAIN WEST COLLEGE*/
%PRINT(SCH="'02360800'",REPNO=34);	/*PROVO COLLEGE*/
%PRINT(SCH="'02531800'",REPNO=35);	/*PAUL MITCHELL THE SCHOOL*/
%PRINT(SCH="'02531801'",REPNO=36);	/*PAUL MITCHELL THE SCHOOL*/
%PRINT(SCH="'02531802'",REPNO=37);	/*PAUL MITCHELL THE SCHOOL*/
%PRINT(SCH="'02531803'",REPNO=38);	/*PAUL MITCHELL THE SCHOOL - FLORIDA*/
%PRINT(SCH="'03030600'",REPNO=39);	/*UTAH SCHOOL OF MASSAGE THERAPY*/
%PRINT(SCH="'03030601'",REPNO=40);	/*UTAH COL OF MASSAGE THER--PROVO/ORE*/
%PRINT(SCH="'03030603'",REPNO=41);	/*UTAH COLLEGE OF MASSAGE THERAPY-NV*/
%PRINT(SCH="'03030604'",REPNO=42);	/*UTAH COLLEGE OF MASSAGE THERAPY-TEMPE*/
%PRINT(SCH="'03030605'",REPNO=43);	/*UTAH COLLEGE OF MASSAGE THERAPY-PHOENIX*/
%PRINT(SCH="'03030606'",REPNO=44);	/*UTAH COLLEGE OF MASSAGE THERAPY DENVER*/
%PRINT(SCH="'03082100'",REPNO=45);	/*MYOTHERAPY COLLEGE OF UTAH*/
%PRINT(SCH="'03829500'",REPNO=46);	/*SKINWORKS SCHOOL OF ADVANCED SKINCARE*/
%PRINT(SCH="'02556800'",REPNO=47);	/*PAUL MITCHELL THE SCHOOL - SLC*/
%PRINT(SCH="'02153100'",REPNO=48);	/*PAUL MITCHELL THE SCHOOL */
%PRINT(SCH="'02149900'",REPNO=49);	/*PAUL MITCHELL THE SCHOOL */
%PRINT(SCH="'01116601'",REPNO=50);
%PRINT(SCH="'01116600'",REPNO=51);	
%PRINT(SCH="'03463300'",REPNO=52);
%PRINT(SCH="'03598300'",REPNO=53);	/*PAUL MITCHELL THE SCHOOL - SANTA BARBARA*/
%PRINT(SCH="'03907300'",REPNO=54);	/*GREAT LAKES ACADEMY OF HAIR DESIGN*/
%PRINT(SCH="'04072300'",REPNO=55);	/*DALLAS ROBERTS ACADEMY OF HAIR DESIGN AND AESTHETICS*/
%PRINT(SCH="'03084602'",REPNO=56);	/*THE ART INSTITUTE OF SALT LAKE CITY*/
%PRINT(SCH="'02531806'",REPNO=57);	/*PAUL MITCHELL THE SCHOOL - STERLING HEIGHTS*/
%PRINT(SCH="'03490300'",REPNO=58);	/*UP ACADEMY OF HAIR DESIGN*/
%PRINT(SCH="'00161700'",REPNO=59);	/*COLLEGE OF IDAHO*/



/*DATA FILE FOR MAILING LABELS*/
data _null_;
SET		SCHINFO;
file REPORT3 delimiter=',' DSD DROPOVER lrecl=32767;
   format SCHID $8. ;
   format SCHNAME $49. ;
   format SADD1 $40. ;
   format SADD2 $40. ;
   format SADD3 $40. ;
   format SCITY $30. ;
   format SSTATE $2. ;
   format SZIP $9. ;
if _n_ = 1 then        /* write column names */
 do;
   put
   'ID'
   ','
   'NAME'
   ','
   'ADD1'
   ','
   'ADD2'
   ','
   'ADD3'
   ','
   'CITY'
   ','
   'ST'
   ','
   'ZIP'
   ;
 end;
 do;
   put SCHID $ @;
   put SCHNAME $ @;
   put SADD1 $ @;
   put SADD2 @;
   put SADD3 @;
   put SCITY @;
   put SSTATE @;
   put SZIP $ ;
   ;
 end;
run;
PROC PRINTTO;
RUN;

/*DATA FILE FOR BYU*/
data _null_;
set  DEFAULTF;
WHERE SCHID = "00367000";
file REPORT4 delimiter=',' DSD DROPOVER lrecl=32767;
   format SCHID $8. ;
   format NAME $49. ;
   format SSN $9. ;
   format DISBDATE MMDDYY10. ;
   format LPOF MMDDYY10. ;
   format CLPD 11.2 ;
   format BAL 13.2 ;
   format STA $40. ;
if _n_ = 1 then        /* write column names */
 do;
   put
   'SCHOOL ID'
   ','
   'BORROWER NAME'
   ','
   'SSN'
   ','
   'DISBURSE DATE'
   ','
   'CLAIM PAID DATE'
   ','
   'CLAIM PAID AMOUNT'
   ','
   'CURRENT BALANCE'
   ','
   'REPAYMENT STATUS'
   ;
 end;
 do;
   put SCHID $ @;
   put NAME $ @;
   put SSN $ @;
   put DISBDATE @;
   put LPOF @;
   put CLPD @;
   put BAL @;
   put STA $ ;
   ;
 end;
run;
PROC PRINTTO;
RUN;
