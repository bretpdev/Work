/*LCO Locate Add-Ons*/
/*DSASG16*/
LIBNAME  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=WORK;
RSUBMIT;

PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE DEMO AS
SELECT *
FROM CONNECTION TO DB2 (

SELECT LN10.BF_SSN AS SSN
,COUNT(*) AS CNT

,LN10.IC_LON_PGM
,LN90.LN_FAT_SEQ_REV
,LN90.PC_FAT_TYP
,LN90.PC_FAT_SUB_TYP
,LN90.LC_CSH_ADV
,AY10.PF_REQ_ACT
,LN10.LN_SEQ

FROM OLWHRM1.LN10_LON LN10
LEFT OUTER JOIN OLWHRM1.LN90_FIN_ATY LN90
ON LN10.BF_SSN = LN90.BF_SSN
AND LN10.LN_SEQ = LN90.LN_SEQ
LEFT OUTER JOIN OLWHRM1.LN85_LON_ATY LN85
ON LN10.BF_SSN = LN85.BF_SSN
AND LN10.LN_SEQ = LN85.LN_SEQ
LEFT OUTER JOIN OLWHRM1.AY10_BR_LON_ATY AY10
ON LN85.BF_SSN = AY10.BF_SSN
AND LN85.LN_ATY_SEQ = AY10.LN_ATY_SEQ

WHERE LN10.IC_LON_PGM IN ('SUBCNS','UNCNS','SUBSPC','UNSPC')
AND LN90.LN_FAT_SEQ_REV IS NULL
AND LN90.PC_FAT_TYP = '01'
AND LN90.PC_FAT_SUB_TYP = '01'
AND LN90.LC_CSH_ADV = 'A'
AND AY10.PF_REQ_ACT IN ('OC308')
AND AY10.LC_STA_ACTY10 = 'A'

GROUP BY LN10.BF_SSN

,LN10.IC_LON_PGM
,LN90.LN_FAT_SEQ_REV
,LN90.PC_FAT_TYP
,LN90.PC_FAT_SUB_TYP
,LN90.LC_CSH_ADV
,AY10.PF_REQ_ACT
,LN10.LN_SEQ
);

DISCONNECT FROM DB2;
ENDRSUBMIT;

DATA DEMO; SET WORKLOCL.DEMO; RUN;

PROC SORT DATA=DEMO;
BY SSN;
RUN;

PROC SQL;
CREATE TABLE DEMO2 AS
SELECT DISTINCT SSN
FROM DEMO
WHERE CNT > 1;
QUIT;
/*For portrait reports;*/
OPTIONS ORIENTATION = PORTRAIT;
OPTIONS CENTER NODATE NUMBER PAGENO=1 PS=52 LS=96;
/*PROC PRINTTO PRINT=REPORT2;
RUN;*/
PROC PRINT NOOBS SPLIT='/' DATA=DEMO2;
VAR SSN;
TITLE 'LCO Locate Add-Ons';
FOOTNOTE  'JOB = DSASG16     REPORT = DSASG16R2';
RUN;

/*PROC EXPORT DATA=WORKLOCL.DEMO*/
/*            OUTFILE= "T:\SAS\DEMO.xls" */
/*            DBMS=EXCEL2000 REPLACE;*/
/*RUN;*/