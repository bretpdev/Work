
%LET RPTLIB = T:\SAS;
FILENAME REPORT2 "&RPTLIB/Borrowers with Zions Loans.txt";



OPTIONS SYMBOLGEN NOCENTER NODATE NONUMBER LS=132;
DATA _NULL_;		
	EFFDT = TODAY(); 
	SCHL = '00368100';
    CALL SYMPUT('EFFDATE',put(EFFDT,MMDDYY10.)); 
	CALL SYMPUT('SCHL2',"'"||PUT(SCHL,$8.)||"'");
RUN;
/*%SYSLPUT EFFDATE = &EFFDATE;*/
%SYSLPUT SCHL2 = &SCHL2;



LIBNAME  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=WORK;
RSUBMIT;

PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE DEMO AS
SELECT *
FROM CONNECTION TO DB2 (

SELECT DISTINCT E.DM_PRS_1 AS FNAME
	,E.DM_PRS_LST AS LNAME
	,A.DF_PRS_ID_STU AS SSN
	,GA40.AF_BS_MPN_APL_ID AS EXCLUDE_ME

FROM	OLWHRM1.SD02_STU_ENR A
INNER JOIN OLWHRM1.GA01_APP B
	ON A.DF_PRS_ID_STU = B.DF_PRS_ID_STU
	OR A.DF_PRS_ID_STU = B.DF_PRS_ID_BR
INNER JOIN OLWHRM1.GA10_LON_APP C
	ON B.AF_APL_ID = C.AF_APL_ID
INNER JOIN OLWHRM1.GA16_ENR_RPT_CRF D
	ON C.AF_APL_ID = D.AF_APL_ID
	AND C.AF_APL_ID_SFX = D.AF_APL_ID_SFX
	AND	D.LF_STU_ENR_RPT_SEQ = A.LF_STU_ENR_RPT_SEQ
INNER JOIN OLWHRM1.PD01_PDM_INF E
	ON A.DF_PRS_ID_STU = E.DF_PRS_ID
LEFT OUTER JOIN OLWHRM1.GA40_BS_MPN_CTL GA40
	ON GA40.AF_BS_MPN_APL_ID = B.AF_BS_MPN_APL_ID 
	AND DAYS(GA40.AD_EXP) < DAYS(Current Date)
	AND GA40.AC_MPN_STA = 'I'


WHERE A.LC_STA_SD02 = 'A'
AND DAYS(A.LD_XPC_GRD) > DAYS(CURRENT DATE) 
AND A.IF_OPS_SCL_RPT  = &SCHL2
AND C.AC_PRC_STA = 'A'
AND B.AF_CUR_APL_OPS_LDR = '817455'
AND GA40.AF_BS_MPN_APL_ID IS NULL
ORDER BY A.DF_PRS_ID_STU
FOR READ ONLY WITH UR

);
DISCONNECT FROM DB2;



ENDRSUBMIT;

DATA DEMO; SET WORKLOCL.DEMO; RUN;

PROC PRINTTO PRINT=REPORT2 NEW;
RUN;

/*For portrait reports;*/
OPTIONS ORIENTATION = PORTRAIT;
OPTIONS CENTER NODATE NUMBER PAGENO=1 PS=52 LS=96;
PROC CONTENTS DATA=DEMO OUT=EMPTYSET NOPRINT;
/*PORTRAIT*/
DATA _NULL_;
SET EMPTYSET;
FILE PRINT;
IF  NOBS=0 AND _N_ =1 THEN DO;
	PUT // 96*'-';
	PUT      ////////
		@35 '**** NO RECORDS FOUND ****';
	PUT ////////
		@38 '-- END OF REPORT --';
	
	END;
RETURN;
TITLE 'Borrowers with Zions Loans';
TITLE2 'SCHOOL = ' &SCHL2;
FOOTNOTE1  	"This document may contain borrowers' sensitive information that UHEAA has pledged to protect.";
FOOTNOTE2	"Please take appropriate precautions to safeguard this information.";
FOOTNOTE3	;
RUN;

PROC PRINT NOOBS SPLIT='/' DATA=DEMO;
VAR FNAME LNAME SSN ;
LABEL	FNAME = 'FIRST NAME'
		LNAME = 'LAST NAME'
		SSN = 'SSN';

TITLE 'Borrowers with Zions Loans';
TITLE2 'SCHOOL = ' &SCHL2;
FOOTNOTE1  	"This document may contain borrowers' sensitive information that UHEAA has pledged to protect.";
FOOTNOTE2	"Please take appropriate precautions to safeguard this information.";
FOOTNOTE3	;

RUN;

PROC PRINTTO;
RUN;
