PROC SQL;
CREATE TABLE NO_GA10_DELTA AS
SELECT DISTINCT A.DF_SPE_ACC_ID
	,A.CLUID
	,A.LN_SEQ
FROM GA10 A
INNER JOIN DUDE.ONELINK_HANDLING B
      ON A.DF_SPE_ACC_ID = B.DF_SPE_ACC_ID
      AND A.BF_SSN = B.BF_SSN
	  AND A.CLUID = B.CLUID
	  AND A.LN_SEQ = B.LN_SEQ
	  AND A.FORWARDING = B.FORWARDING ;

CREATE TABLE GA10_DELTAS AS
SELECT DISTINCT A.*
FROM GA10 A
LEFT JOIN NO_GA10_DELTA B
	  ON A.DF_SPE_ACC_ID = B.DF_SPE_ACC_ID
      AND A.CLUID = B.CLUID
	  AND A.LN_SEQ = B.LN_SEQ
WHERE B.DF_SPE_ACC_ID IS NULL
	AND B.CLUID IS NULL
	AND B.LN_SEQ IS NULL;
QUIT;

DATA ONELINK_HANDLING_DELTAS (KEEP=DF_SPE_ACC_ID CLUID LN_SEQ);
	SET GA10_DELTAS;
RUN;

PROC SORT DATA=ONELINK_HANDLING_DELTAS NODUPKEY;
	BY DF_SPE_ACC_ID CLUID LN_SEQ;
RUN;

PROC SQL;
CREATE TABLE LOCL_ONELINK_HANDLING_DELTAS AS
      SELECT A.* 
      FROM DUDE.ONELINK_HANDLING A
      INNER JOIN ONELINK_HANDLING_DELTAS B
            ON A.DF_SPE_ACC_ID = B.DF_SPE_ACC_ID
			AND A.CLUID = B.CLUID
			AND A.LN_SEQ = B.LN_SEQ;

INSERT INTO DUDE.ONELINK_HANDLING_DELETE
      SELECT DF_SPE_ACC_ID
	  		,CLUID
			,LN_SEQ
      FROM LOCL_ONELINK_HANDLING_DELTAS; 
QUIT;

PROC SORT DATA=	LOCL_ONELINK_HANDLING_DELTAS NODUPKEY; BY DF_SPE_ACC_ID CLUID LN_SEQ; RUN; 

%UPDATE_DATA(LOCL_ONELINK_HANDLING_DELTAS,GA10_DELTAS,%STR(DF_SPE_ACC_ID CLUID LN_SEQ));
PROC SORT DATA=	LOCL_ONELINK_HANDLING_DELTAS NODUPKEY; BY DF_SPE_ACC_ID CLUID LN_SEQ; RUN; 
%GOODBYE_NULLCHAR(ONELINK_HANDLING_DELETE,CLUID);

PROC SQL NOPRINT;
CONNECT TO ODBC AS MD (&MD);
SELECT COUNT(*) 
FROM CONNECTION TO MD (
      DELETE ONELINK_HANDLING
      FROM ONELINK_HANDLING A
      INNER JOIN ONELINK_HANDLING_DELETE B
            ON A.DF_SPE_ACC_ID = B.DF_SPE_ACC_ID
			AND A.CLUID = B.CLUID
			AND A.LN_SEQ = B.LN_SEQ
      );
DISCONNECT FROM MD;
QUIT;

PROC SQL ;
INSERT INTO DUDE.ONELINK_HANDLING
      SELECT *
      FROM LOCL_ONELINK_HANDLING_DELTAS;
QUIT;
OPTIONS NOSOURCE;
%GOODBYE_NULLCHAR(ONELINK_HANDLING,CLUID);
%GOODBYE_NULLCHAR(ONELINK_HANDLING,FORWARDING);

PROC SQL NOPRINT;
      DELETE 
      FROM DUDE.ONELINK_HANDLING_DELETE ;
QUIT;
OPTIONS SOURCE;
