*------------------------------------------*
| UTLWG91 - UHEAA ONELINK GRTCR OPEN TASKS |
*------------------------------------------*;
/*LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;*/
/*%LET RPTLIB = %SYSGET(reportdir);*/
%LET RPTLIB = T:\SAS;
FILENAME REPORT2 "&RPTLIB/ULWG91.LWG91R2";
FILENAME REPORT3 "&RPTLIB/ULWG91.LWG91R3";
FILENAME REPORT4 "&RPTLIB/ULWG91.LWG91R4";
FILENAME REPORT5 "&RPTLIB/ULWG91.LWG91R5";
FILENAME REPORT6 "&RPTLIB/ULWG91.LWG91R6";
FILENAME REPORT7 "&RPTLIB/ULWG91.LWG91R7";
FILENAME REPORT8 "&RPTLIB/ULWG91.LWG91R8";
FILENAME REPORT9 "&RPTLIB/ULWG91.LWG91R9";
FILENAME REPORT10 "&RPTLIB/ULWG91.LWG91R10";
FILENAME REPORT11 "&RPTLIB/ULWG91.LWG91R11";
FILENAME REPORT12 "&RPTLIB/ULWG91.LWG91R12";
FILENAME REPORT13 "&RPTLIB/ULWG91.LWG91R13";
FILENAME REPORT14 "&RPTLIB/ULWG91.LWG91R14";
FILENAME REPORT15 "&RPTLIB/ULWG91.LWG91R15";
FILENAME REPORT16 "&RPTLIB/ULWG91.LWG91R16";
FILENAME REPORT17 "&RPTLIB/ULWG91.LWG91R17";
FILENAME REPORT18 "&RPTLIB/ULWG91.LWG91R18";
FILENAME REPORT19 "&RPTLIB/ULWG91.LWG91R19";
FILENAME REPORT20 "&RPTLIB/ULWG91.LWG91R20";
FILENAME REPORT21 "&RPTLIB/ULWG91.LWG91R21";
FILENAME REPORT22 "&RPTLIB/ULWG91.LWG91R22";
FILENAME REPORT23 "&RPTLIB/ULWG91.LWG91R23";
FILENAME REPORT24 "&RPTLIB/ULWG91.LWG91R24";
FILENAME REPORT25 "&RPTLIB/ULWG91.LWG91R25";
FILENAME REPORT26 "&RPTLIB/ULWG91.LWG91R26";
FILENAME REPORT27 "&RPTLIB/ULWG91.LWG91R27";
FILENAME REPORT28 "&RPTLIB/ULWG91.LWG91R28";
FILENAME REPORT29 "&RPTLIB/ULWG91.LWG91R29";
FILENAME REPORT30 "&RPTLIB/ULWG91.LWG91R30";
FILENAME REPORT31 "&RPTLIB/ULWG91.LWG91R31";
FILENAME REPORT32 "&RPTLIB/ULWG91.LWG91R32";
FILENAME REPORT33 "&RPTLIB/ULWG91.LWG91R33";
FILENAME REPORT34 "&RPTLIB/ULWG91.LWG91R34";
FILENAME REPORT35 "&RPTLIB/ULWG91.LWG91R35";
FILENAME REPORT36 "&RPTLIB/ULWG91.LWG91R36";
FILENAME REPORT37 "&RPTLIB/ULWG91.LWG91R37";
FILENAME REPORT38 "&RPTLIB/ULWG91.LWG91R38";
FILENAME REPORT39 "&RPTLIB/ULWG91.LWG91R39";
FILENAME REPORT40 "&RPTLIB/ULWG91.LWG91R40";
FILENAME REPORT41 "&RPTLIB/ULWG91.LWG91R41";
FILENAME REPORT42 "&RPTLIB/ULWG91.LWG91R42";
FILENAME REPORT43 "&RPTLIB/ULWG91.LWG91R43";
FILENAME REPORT44 "&RPTLIB/ULWG91.LWG91R44";
FILENAME REPORT45 "&RPTLIB/ULWG91.LWG91R45";
FILENAME REPORT46 "&RPTLIB/ULWG91.LWG91R46";
FILENAME REPORT47 "&RPTLIB/ULWG91.LWG91R47";
FILENAME REPORT48 "&RPTLIB/ULWG91.LWG91R48";
FILENAME REPORT49 "&RPTLIB/ULWG91.LWG91R49";
FILENAME REPORT50 "&RPTLIB/ULWG91.LWG91R50";
FILENAME REPORT51 "&RPTLIB/ULWG91.LWG91R51";
FILENAME REPORT52 "&RPTLIB/ULWG91.LWG91R52";
FILENAME REPORT53 "&RPTLIB/ULWG91.LWG91R53";
FILENAME REPORT54 "&RPTLIB/ULWG91.LWG91R54";

FILENAME REPORTZ "&RPTLIB/ULWG91.LWG91RZ";
DATA _NULL_;
    CALL SYMPUT('DCRIT',"'"||PUT(INTNX('DAY',TODAY(),-30,'BEGINNING'), MMDDYYD10.)||"'");
	CALL SYMPUT('RUNDATE',PUT(INTNX('DAY',TODAY(),0,'beginning'), MMDDYY10.));
	CALL SYMPUT('RUNTIME',PUT(TIME(), TIME.));
RUN;

%LET SDATE = '02/28/2006';

%SYSLPUT SDATE = &SDATE;
%SYSLPUT DCRIT = &DCRIT;
LIBNAME  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=WORK;
RSUBMIT;
%MACRO SQLCHECK (SQLRPT= );
%IF &SQLXRC NE 0 %THEN %DO;
	DATA _NULL_;
    FILE REPORTZ NOTITLES;
    PUT @01 " ********************************************************************* "
      / @01 " ****  THE SQL CODE ABOVE HAS EXPERIENCED AN ERROR.               **** "
      / @01 " ****  THE SAS LOG IN &SQLRPT SHOULD BE REVIEWED.          **** "       
      / @01 " ********************************************************************* "
      / @01 " ****  THE SQL ERROR CODE IS  &SQLXRC  AND THE SQL ERROR MESSAGE  **** "
      / @01 " ****  &SQLXMSG   **** "
      / @01 " ********************************************************************* ";
	RUN;
%END;
%MEND;
PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE UOGOT AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT DISTINCT A.DF_PRS_ID
	,DATE(A.BF_CRT_DTS_AY01) AS BF_CRT_DTS_AY01
	,A.BX_CMT
	,CASE 
		WHEN B.AF_APL_OPS_SCL IN (
			'02556800','02531800','02531801',
			'02531802','02531803','02531804'
			)
		THEN '025318XX'
		WHEN B.AF_APL_OPS_SCL IN (
			'00367400','00367401','00367403',
			'00367404','00367405'
			)
		THEN '003674XX'
		WHEN B.AF_APL_OPS_SCL IN (
			'02270800','02270801'
			)
		THEN '022708XX'
		WHEN B.AF_APL_OPS_SCL IN (
			'01009801'
			)
		THEN '01009800'	
		ELSE B.AF_APL_OPS_SCL
	 END AS AF_APL_OPS_SCL
	,C.IM_IST_FUL
FROM OLWHRM1.AY01_BR_ATY A
INNER JOIN OLWHRM1.GA01_APP B
	ON A.AF_APL_ID = B.AF_APL_ID
INNER JOIN (
	SELECT DISTINCT IF_IST
		,IM_IST_FUL
	FROM OLWHRM1.SC01_LGS_SCL_INF
	) C
	ON B.AF_APL_OPS_SCL = C.IF_IST
WHERE A.PF_ACT = 'GRTCR'
AND A.BD_ATY_CLO IS NULL
AND DATE(BF_CRT_DTS_AY01) <= &DCRIT
AND DATE(BF_CRT_DTS_AY01) > &SDATE

FOR READ ONLY WITH UR
);
DISCONNECT FROM DB2;
/*%PUT  SQLXRC= >>> &SQLXRC <<< ||| SQLXMSG= >>> &SQLXMSG >>>  ;  * INCLUDES ERROR MESSAGES TO SAS LOG  ;*/
/*%SQLCHECK (SQLRPT=ULWG91.LWG91RZ);*/
/*QUIT;*/
ENDRSUBMIT;
DATA UOGOT;
SET WORKLOCL.UOGOT;
RUN;
%MACRO PRINT(ID,SCHL_ID,RNUM);
DATA UOGOT_PRINT;
SET UOGOT;
WHERE AF_APL_OPS_SCL = "&ID";
RUN;
PROC CONTENTS DATA=UOGOT_PRINT OUT=EMPTYSET NOPRINT;RUN;
DATA _NULL_;
SET EMPTYSET;
	CALL SYMPUT('HAS_OBS',NOBS);
RUN; 
PROC SORT DATA=UOGOT_PRINT; BY DF_PRS_ID BF_CRT_DTS_AY01;RUN;
PROC PRINTTO PRINT=REPORT&RNUM NEW;
RUN;
OPTIONS ORIENTATION = LANDSCAPE;
OPTIONS PS=39 LS=127 PAGENO=1 CENTER NODATE;
%IF &HAS_OBS = 0 %THEN %DO;
	TITLE 'FUNDS REQUESTED TO BE RETURNED BY SCHOOL BUT NEVER RECEIVED BY UHEAA';
	TITLE2 "SCHOOL ID - &SCHL_ID";
	TITLE3	"&RUNDATE - &RUNTIME";
	DATA _NULL_;
	SET EMPTYSET;
	FILE PRINT;
	IF  NOBS=0 AND _N_ =1 THEN DO;
		PUT // 127*'-';
		PUT      ////
			@51 '**** NO OBSERVATIONS FOUND ****';
		PUT //////
			@57 '-- END OF REPORT --';
		PUT ///////////
			@46 "JOB = UTLWG91  	 REPORT = ULWG91.LWG91R&RNUM";
		END;
	RETURN;
	RUN;
%END;
%ELSE %DO;
	DATA _NULL_;
		SET UOGOT_PRINT;
		CALL SYMPUT('SCHL_NM',TRIM(IM_IST_FUL));
	RUN; 
	PROC SORT DATA=UOGOT_PRINT; 
		BY DF_PRS_ID BF_CRT_DTS_AY01; 
	RUN;
	TITLE 'FUNDS REQUESTED TO BE RETURNED BY SCHOOL BUT NEVER RECEIVED BY UHEAA';
	TITLE2 "&SCHL_NM - &SCHL_ID";
	TITLE3	"&RUNDATE - &RUNTIME";
	FOOTNOTE1 "This document may contain borrowers' sensitive information that UHEAA has pledged to protect.";
	FOOTNOTE2 "Please take appropriate precautions to safeguard this information.";
	FOOTNOTE3 ;
	FOOTNOTE4  "JOB = UTLWG91  	 REPORT = ULWG91.LWG91R&RNUM";
	PROC REPORT DATA=UOGOT_PRINT NOWD HEADSKIP SPLIT='+' SPACING=5;
		COLUMN DF_PRS_ID BF_CRT_DTS_AY01 BX_CMT;
		DEFINE DF_PRS_ID / GROUP FORMAT=$9. WIDTH=9 "SSN";
		DEFINE BF_CRT_DTS_AY01 / GROUP FORMAT=MMDDYY10. WIDTH=10 "ACTIVITY DATE";
		DEFINE BX_CMT / ORDER FORMAT=$600. WIDTH=80 FLOW "COMMENTS";
		BREAK AFTER BF_CRT_DTS_AY01 / SKIP;
	RUN;
%END;
PROC PRINTTO;
RUN;
%MEND PRINT;
%PRINT(00368000,00368000,2);
%PRINT(00367500,00367500,3);
%PRINT(00367100,00367100,4);
%PRINT(00402700,00402700,5);
%PRINT(00367800,00367800,6);
%PRINT(00367600,00367600,7);
%PRINT(00367000,00367000,8);
%PRINT(00162500,00162500,9);
%PRINT(00160600,00160600,10);
%PRINT(00367900,00367900,11);
%PRINT(00367700,00367700,12);
%PRINT(0522000,0522000,13);
%PRINT(00368100,00368100,14);
%PRINT(00367200,00367200,15);
%PRINT(003674XX,ALL BRANCHES,16);
%PRINT(02178500,02178500,17);
%PRINT(02178502,02178502,18);
%PRINT(02178501,02178501,19);
%PRINT(02360800,02360800,20);
%PRINT(025318XX,ALL BRANCHES,21);
%PRINT(022708XX,ALL BRANCHES,22);
%PRINT(03082100,03082100,23);
%PRINT(02298500,02298500,24);
%PRINT(01009800,01009800,25);
%PRINT(03829500,03829500,26);
%PRINT(03838300,03838300,27);
%PRINT(03909300,03909300,28);
%PRINT(00161900,00161900,29);
%PRINT(02531805,02531805,30);
%PRINT(02153100,02153100,31);
%PRINT(02149900,02149900,32);
%PRINT(01116600,01116600,33);
%PRINT(01116601,01116601,34);
%PRINT(03463300,03463300,35);
%PRINT(02357700,02357700,36);
%PRINT(03598300,03598300,37);
%PRINT(03907300,03907300,38);
%PRINT(04072300,04072300,39);
%PRINT(03084602,03084602,40);
%PRINT(02531806,02531806,41);
%PRINT(03490300,03490300,42);
%PRINT(00161700,00161700,43);
%PRINT(02351700,02351700,44);
%PRINT(02149901,02149901,45);
%PRINT(02179935,02179935,46);
%PRINT(02360802,02360802,47);
%PRINT(01179900,01179900,48);
%PRINT(01116602,01116602,49);
%PRINT(04145500,04145500,50);
%PRINT(02556801,02556801,51);
%PRINT(03490301,03490301,52);
%PRINT(04158200,04158200,53);
%PRINT(02612200,02612200,54);

/*PROC EXPORT DATA=UOGOT*/
/*            OUTFILE= "T:\SAS\UTLWG91_Detail.xls" */
/*            DBMS=EXCEL2000 REPLACE;*/
/*RUN;*/
