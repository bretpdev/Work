/*UTLWG15 INHOUSE BORROWERS WITH ANTICIPATED DISBURSEMENT*/
LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;
%LET RPTLIB = %SYSGET(reportdir);
/*%LET RPTLIB = T:\SAS;*/
FILENAME REPORT2 "&RPTLIB/ULWG15.LWG15R2";
/*LIBNAME  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=WORK;*/
/*RSUBMIT;*/
PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE IBWADLO AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT	A.BF_SSN AS SSN
	,RTRIM(F.DM_PRS_LST)||' '||RTRIM(F.DM_PRS_1)||' '||(F.DM_PRS_MID) AS NAME
	,A.LN_SEQ
	,B.LD_DSB
	,B.LA_DSB
	,B.LA_DSB_CAN 
	,A.IC_LON_PGM
	,C.AF_DOE_SCL 
	,E.IM_SCL_FUL
	,C.AF_DOE_LDR	
	,F.DF_SPE_ACC_ID
FROM OLWHRM1.PD10_PRS_NME F 
INNER JOIN OLWHRM1.LN10_LON A
	 ON F.DF_PRS_ID = A.BF_SSN
INNER JOIN OLWHRM1.DW01_DW_CLC_CLU G
	 ON A.BF_SSN = G.BF_SSN
	 AND A.LN_SEQ = G.LN_SEQ
INNER JOIN OLWHRM1.LN15_DSB B
     ON A.BF_SSN = B.BF_SSN
     AND A.LN_SEQ = B.LN_SEQ 
INNER JOIN OLWHRM1.AP03_MASTER_APL C 
	 ON B.AF_APL_ID = C.AF_APL_ID
INNER JOIN OLWHRM1.SC10_SCH_DMO E
     ON C.AF_DOE_SCL = E.IF_DOE_SCL 
WHERE A.LF_LON_CUR_OWN = '828476'
AND	A.LC_STA_LON10 = 'R'
AND	B.LC_DSB_TYP = '1'
AND	B.LC_STA_LON15 IN ('1', '3')
AND
(
	B.LA_DSB_CAN IS NULL 
	OR
    B.LA_DSB <> B.LA_DSB_CAN
) 
AND B.LD_DSB_ROS_PRT IS NULL
AND B.LC_LDR_DSB_MDM = ' '
AND G.WC_DW_LON_STA = '23'
AND C.AF_LDR_ORG <> '828476'
);
DISCONNECT FROM DB2;
/*ENDRSUBMIT;*/
/*DATA IBWADLO;*/
/*SET WORKLOCL.IBWADLO;*/
/*RUN;*/
PROC SORT DATA=IBWADLO;
BY SSN;
RUN;
DATA IBWADLO;
SET IBWADLO;
IF LA_DSB_CAN = '.' THEN LA_DSB_CANC = 0;
ELSE LA_DSB_CANC = LA_DSB_CAN;
DISAMNT = LA_DSB - LA_DSB_CANC;
RUN;
data _null_;                                      
current=today();                                  
call symput('curdate',put(current,MMDDYY10.));       
run;  
PROC PRINTTO PRINT=REPORT2 NEW;
RUN;
OPTIONS PAGENO=1 LS=126 CENTER NODATE;
PROC PRINT NOOBS SPLIT='/' DATA=IBWADLO WIDTH=MIN;
VAR DF_SPE_ACC_ID
	NAME
	LN_SEQ
	LD_DSB
	DISAMNT 
	IC_LON_PGM
	AF_DOE_SCL
	IM_SCL_FUL
	AF_DOE_LDR;
FORMAT LD_DSB MMDDYY10. DISAMNT 10.2;
LABEL	NAME = 'BORROWER NAME'
		LN_SEQ = 'LOAN SEQ #'
		LD_DSB = 'DISBURSEMENT DATE'
		DISAMNT = 'DISBURSEMENT AMOUNT'
		IC_LON_PGM = 'LOAN TYPE'
		AF_DOE_SCL = 'SCHOOL ID'
		IM_SCL_FUL = 'SCHOOL NAME'
		AF_DOE_LDR = 'ORIGINAL LID'
		DF_SPE_ACC_ID = 'ACCT #';
TITLE	"INHOUSE BORROWERS WITH ANTICIPATED DISBURSEMENT &curdate";
FOOTNOTE  'JOB = UTLWG15     REPORT = ULWG15.LWG15R2';
RUN;
PROC PRINTTO;
RUN;
