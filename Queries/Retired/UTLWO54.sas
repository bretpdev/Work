*---------------------------------------*
| UTLWO54 - OUTSTANDING REJECTED CLAIMS |
*---------------------------------------*;
LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;
%LET RPTLIB = %SYSGET(reportdir);
/*%LET RPTLIB = C:\WINDOWS\TEMP;*/
FILENAME REPORT2 "&RPTLIB/ULWO54.LWO54R2";
FILENAME REPORTZ "&RPTLIB/ULWO54.LWO54RZ";
/*LIBNAME  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=WORK;*/
/*RSUBMIT;*/
%MACRO SQLCHECK (SQLRPT= );
%IF &SQLXRC NE 0 %THEN %DO;
	DATA _NULL_;
    FILE REPORTZ NOTITLES;
    PUT @01 " ********************************************************************* "
      / @01 " ****  THE SQL CODE ABOVE HAS EXPERIENCED AN ERROR.               **** "
      / @01 " ****  THE SAS LOG IN &SQLRPT SHOULD BE REVIEWED.          **** "       
      / @01 " ********************************************************************* "
      / @01 " ****  THE SQL ERROR CODE IS  &SQLXRC  AND THE SQL ERROR MESSAGE  **** "
      / @01 " ****  &SQLXMSG   **** "
      / @01 " ********************************************************************* ";
	RUN;
%END;
%MEND;
PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE OREJC AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT DISTINCT A.BF_SSN
	,A.LN_SEQ
	,A.LD_CLM_REJ_LTR 
FROM OLWHRM1.LN40_LON_CLM_PCL A
INNER JOIN OLWHRM1.DW01_DW_CLC_CLU B
	ON A.BF_SSN = B.BF_SSN
	AND A.LN_SEQ = B.LN_SEQ
INNER JOIN OLWHRM1.LN10_LON C	
	ON B.BF_SSN = C.BF_SSN
	AND B.LN_SEQ = C.LN_SEQ
WHERE C.LC_STA_LON10 = 'R'
AND C.LA_CUR_PRI > 0
AND B.WC_DW_LON_STA = '10'
AND A.LD_CLM_REJ_LTR IS NOT NULL

FOR READ ONLY WITH UR
);
DISCONNECT FROM DB2;
%PUT  SQLXRC= >>> &SQLXRC <<< ||| SQLXMSG= >>> &SQLXMSG >>>  ;  * INCLUDES ERROR MESSAGES TO SAS LOG  ;
%SQLCHECK (SQLRPT=ULWO54.LWO54RZ);
QUIT;
/*ENDRSUBMIT;*/
/*DATA OREJC;*/
/*SET WORKLOCL.OREJC;*/
/*RUN;*/
PROC SORT DATA=OREJC;
BY BF_SSN LN_SEQ;
RUN;
DATA _NULL_;
SET  WORK.OREJC;
FILE REPORT2 DELIMITER=',' DSD DROPOVER LRECL=32767;
   FORMAT BF_SSN $9. ;
   FORMAT LN_SEQ 6. ;
   FORMAT LD_CLM_REJ_LTR MMDDYY10. ;
DO;
   PUT BF_SSN $ @;
   PUT LN_SEQ @;
   PUT LD_CLM_REJ_LTR ;
 END;
RUN;
