/* POST-CONVERSION SERIAL GUARANTEES - SASR 167 */

libname WORKLOCL REMOTE SERVER=CYPRUS SLIBREF=work;
RSUBMIT;
OPTIONS NOCENTER NODATE NONUMBER LS=132;
PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE SERIALS AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT	A.DF_PRS_ID_BR					as SSN,
		B.AF_APL_ID||B.AF_APL_ID_SFX	as CLUID,
CASE
	WHEN A.AF_CUR_APL_OPS_LDR = '817455'
	THEN 'ZIONS'
	ELSE 'LPP'
END										AS LENDER
FROM OLWHRM1.GA10_LON_APP B INNER JOIN OLWHRM1.GA01_APP A
		ON A.AF_APL_ID = B.AF_APL_ID
WHERE B.AD_PRC >= '06-01-2001'			/*GTY SINCE CONVERSION*/
AND A.AF_BS_MPN_APL_ID <> ' '			/*SERIAL*/
AND A.AF_BS_MPN_APL_ID <> A.AF_APL_ID
);
DISCONNECT FROM DB2;
ENDRSUBMIT;

DATA SERIALS;
SET WORKLOCL.SERIALS;
RUN;

PROC SORT DATA=SERIALS;
BY LENDER SSN CLUID;
RUN;

DATA _NULL_;
SET WORK.SERIALS		END=EFIEOD;
WHERE LENDER = 'LPP';
%LET _EFIERR_ = 0;
%LET _EFIREC_ = 0;
FILE 'T:\SAS\LPPserials.txt' DELIMITER=',' DSD DROPOVER LRECL=32767;
	FORMAT SSN $9. ;
	FORMAT CLUID $19. ;
DO;
	EFIOUT + 1;
	PUT SSN $ @;
	PUT CLUID $ ;
	;
END;
IF _ERROR_ THEN CALL SYMPUT('_EFIERR_',1);
IF EFIEOD THEN
	CALL SYMPUT('_EFIREC_',EFIOUT);
RUN;

DATA _NULL_;
SET WORK.SERIALS		END=EFIEOD;
WHERE LENDER = 'ZIONS';
%LET _EFIERR_ = 0;
%LET _EFIREC_ = 0;
FILE 'T:\SAS\Zionsserials.txt' DELIMITER=',' DSD DROPOVER LRECL=32767;
	FORMAT SSN $9. ;
	FORMAT CLUID $19. ;
DO;
	EFIOUT + 1;
	PUT SSN $ @;
	PUT CLUID $ ;
	;
END;
IF _ERROR_ THEN CALL SYMPUT('_EFIERR_',1);
IF EFIEOD THEN
	CALL SYMPUT('_EFIREC_',EFIOUT);
RUN;