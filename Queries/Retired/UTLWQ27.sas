*----------------------------------------*
| UTLWQ27 UHEAA FYTD Net Guaranty Volume |
*----------------------------------------*;
LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;
%LET RPTLIB = %SYSGET(reportdir);
/*%LET RPTLIB = C:\WINDOWS\TEMP;*/
FILENAME REPORT2 "&RPTLIB/ULWQ27.LWQ27R2";
FILENAME REPORTZ "&RPTLIB/ULWQ27.LWQ27RZ";
DATA _NULL_;
 	CALL SYMPUT('BEGIN',"'"||PUT(INTNX('YEAR.7',TODAY(),0,'BEGINNING'), MMDDYY10.)||"'");
	CALL SYMPUT('END',"'"||PUT(INTNX('YEAR.7',TODAY(),0,'END'), MMDDYY10.)||"'");
	CALL SYMPUT('FY',COMPRESS(YEAR(INTNX('YEAR.7',TODAY(),0,'END'))));
RUN;
/*%SYSLPUT BEGIN = &BEGIN;*/
/*%SYSLPUT END = &END;*/
/*%SYSLPUT FY = &FY;*/
/*LIBNAME  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=WORK;*/
/*RSUBMIT;*/
%MACRO SQLCHECK (SQLRPT= );
%IF &SQLXRC NE 0 %THEN %DO;
	DATA _NULL_;
    FILE REPORTZ NOTITLES;
    PUT @01 " ********************************************************************* "
      / @01 " ****  THE SQL CODE ABOVE HAS EXPERIENCED AN ERROR.               **** "
      / @01 " ****  THE SAS LOG IN &SQLRPT SHOULD BE REVIEWED.          **** "       
      / @01 " ********************************************************************* "
      / @01 " ****  THE SQL ERROR CODE IS  &SQLXRC  AND THE SQL ERROR MESSAGE  **** "
      / @01 " ****  &SQLXMSG   **** "
      / @01 " ********************************************************************* ";
	RUN;
%END;
%MEND;
PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE UFNGV AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT B.AF_APL_ID||B.AF_APL_ID_SFX AS CLUID
	,B.AC_PRC_STA
	,B.AD_PRC
	,B.AA_GTE_LON_AMT 
	,B.AA_TOT_CAN
	,B.AA_GTE_LON_AMT - COALESCE(B.AA_TOT_CAN,0) AS NET_GUAR_AMT
FROM OLWHRM1.GA10_LON_APP B
WHERE B.AC_PRC_STA = 'A'
	AND B.AD_PRC >= &BEGIN
	AND B.AD_PRC <= &END 
FOR READ ONLY WITH UR
);
DISCONNECT FROM DB2;
%PUT  SQLXRC= >>> &SQLXRC <<< ||| SQLXMSG= >>> &SQLXMSG >>>  ;  * INCLUDES ERROR MESSAGES TO SAS LOG  ;
%SQLCHECK (SQLRPT=ULWQ27.LWQ27RZ);
QUIT;
PROC SORT DATA=UFNGV NODUPKEY;
	BY CLUID;
RUN;
DATA UFNGV_SUMRY (KEEP=FY NET);
	SET UFNGV END=LAST;
	NET+NET_GUAR_AMT;
	IF LAST THEN DO;
		FY = "&FY";
		OUTPUT;
	END;
RUN;
/*ENDRSUBMIT;*/
/*DATA UFNGV_SUMRY ;*/
/*	SET WORKLOCL.UFNGV_SUMRY;*/
/*RUN;*/
PROC PRINTTO PRINT=REPORT2 NEW;
RUN;
OPTIONS ORIENTATION = LANDSCAPE;
OPTIONS PS=39 LS=127 CENTER DATE PAGENO=1;
TITLE 'UHEAA FYTD NET GUARANTY VOLUME';
FOOTNOTE   'JOB = UTLWQ27  	 REPORT = ULWQ27.LWQ27R2';
PROC PRINT NOOBS SPLIT='/' DATA=UFNGV_SUMRY WIDTH=UNIFORM WIDTH=MIN LABEL;
FORMAT NET DOLLAR18.2;
VAR FY NET;
LABEL FY = 'FISCAL/YEAR'
	NET = 'NET GUARANTY AMOUNT';
RUN;
PROC PRINTTO;
RUN;
/*DETAIL FILE*/
/*DATA _NULL_;*/
/*	FILE 'C:\WINDOWS\TEMP\UHEAAFYTDNetGuarantyVolume.Detail.txt' DELIMITER=',' DSD DROPOVER LRECL=32767;*/
/*	IF _N_ = 1 THEN        */
/*		DO;*/
/*			PUT "CLUID,AA_GTE_LON_AMT,AA_TOT_CAN,AC_PRC_STA,AD_PRC,NET_GUAR_AMT";*/
/*		END;*/
/*	SET  WORK.UFNGV   END=EFIEOD;*/
/*	   FORMAT CLUID $19. ;*/
/*	   FORMAT AA_GTE_LON_AMT 10.2 ;*/
/*	   FORMAT AA_TOT_CAN 10.2 ;*/
/*	   FORMAT AC_PRC_STA $1. ;*/
/*	   FORMAT AD_PRC DATE9. ;*/
/*	   FORMAT NET_GUAR_AMT 16.2 ;*/
/*	DO;*/
/*	   PUT CLUID $ @;*/
/*	   PUT AC_PRC_STA $ @;*/
/*	   PUT AD_PRC @;*/
/*	   PUT AA_GTE_LON_AMT @;*/
/*	   PUT AA_TOT_CAN @;*/
/*	   PUT NET_GUAR_AMT ;*/
/*	END;*/
/*RUN;*/
