OPTIONS
  YEARCUTOFF=1960
  MISSING=' '
  ERRORS=0
  NOCENTER
  LS=132
  PS=60;

LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;

%LET RPTLIB=%SYSGET(reportdir);

FILENAME REPORT2 "&RPTLIB/ULWG62.LWG62R2";

DATA _NULL_;
  CALL SYMPUT('BDATE',"'"||PUT(INTNX('WEEK',INTNX('MONTH',INTNX('YEAR',
    INTNX('MONTH',INTNX('WEEK',TODAY()+1,0)-2,3),-1),-3)+1,0)+1,
    MMDDYY10.)||"'");
RUN;

PROC SQL;
  CONNECT TO DB2 (DATABASE=DLGSUTWH);
  CREATE TABLE STAFFORD AS
    SELECT *
    FROM CONNECTION TO DB2 (
      SELECT
        AC_PRC_STA      AS STAT,
        AD_PRC          AS PROC,
        AA_GTE_LON_AMT  AS LNAMT
      FROM
       olwhrm1 .GA10_LON_APP
      WHERE
        AD_PRC>=&BDATE AND
        AC_LON_TYP IN('SF','SU') AND
        AC_PRC_STA IN('A','R','X')
    );
  DISCONNECT FROM DB2;
  %PUT &SQLXRC& &SQLXMSG&;
QUIT;

DATA STAFFORD;
  SET STAFFORD;
  WEEK=INTNX('WEEK',PROC-1,0)+5;
  MONTH=INTNX('MONTH',INTNX('WEEK',TODAY()+1,0)-2,-5);
  IF STAT='A' THEN APR=1;
    ELSE REJ=1;
  IF INTNX('MONTH',INTNX('YEAR',INTNX('MONTH',INTNX('WEEK',TODAY()+1,0)
    -2,3),0),-3)<=WEEK<TODAY() THEN DO;
    IF WEEK<MONTH THEN WEEK=INTNX('MONTH',WEEK,1)-1;
    APR2=APR;
    LNAMT2=LNAMT;
    REJ2=REJ;
    OUTPUT STAFFORD;
    END;
  WEEK=WEEK+364;
  IF INTNX('MONTH',INTNX('YEAR',INTNX('MONTH',INTNX('WEEK',TODAY()+1,0)
    -2,3),0),-3)<=WEEK<TODAY() THEN DO;
    IF WEEK<MONTH THEN WEEK=INTNX('MONTH',WEEK,1)-1;
    APR1=APR;
    LNAMT1=LNAMT;
    REJ1=REJ;
    OUTPUT STAFFORD;
    END;
  FORMAT WEEK MMDDYY10.;
RUN;

PROC PRINTTO
  NEW PRINT=REPORT2;
RUN;

OPTIONS
  PAGENO=1;

PROC TABULATE
  DATA=STAFFORD
  FORMAT=COMMA11.
  NOSEPS;
  CLASS WEEK;
  VAR APR1 APR2 LNAMT1 LNAMT2 REJ1 REJ2;
  TABLE WEEK='WEEK ENDING' ALL='TOTAL',
    APR1='1999'*N='NUMBER OF APPROVALS'
    APR2='2000'*N='NUMBER OF APPROVALS'
    LNAMT1='1999'*SUM='AMOUNT OF APPROVALS'*F=DOLLAR15.
    LNAMT2='2000'*SUM='AMOUNT OF APPROVALS'*F=DOLLAR15.
    REJ1='1999'*N='NUMBER OF REJECTS'
    REJ2='2000'*N='NUMBER OF REJECTS' / RTS=14;
  TITLE 'STAFFORD APPROVALS AND REJECTS';
  FOOTNOTE 'PJS, JOB=LWG62, REPORT=LWG62R2';
RUN;

DATA _NULL_;
  FILE PRINT;
  PUT
  / @1  '***** END OF REPORT *****'
    #59
    @1  'PJS, JOB=LWG62, REPORT=LWG62R2';
RUN;

PROC PRINTTO
  PRINT=PRINT;
RUN;
