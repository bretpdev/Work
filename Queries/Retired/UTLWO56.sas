*------------------------*
| UTLWO56 REJECTED LOANS |
*------------------------*;
LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;
%LET RPTLIB = %SYSGET(reportdir);
/*%LET RPTLIB = T:\SAS;*/
FILENAME REPORT2 "&RPTLIB/ULWO56.LWO56R2";
FILENAME REPORTZ "&RPTLIB/ULWO56.LWO56RZ";
/*LIBNAME  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=WORK;*/
/*RSUBMIT;*/
%MACRO SQLCHECK (SQLRPT= );
%IF &SQLXRC NE 0 %THEN %DO;
	DATA _NULL_;
    FILE REPORTZ NOTITLES;
    PUT @01 " ********************************************************************* "
      / @01 " ****  THE SQL CODE ABOVE HAS EXPERIENCED AN ERROR.               **** "
      / @01 " ****  THE SAS LOG IN &SQLRPT SHOULD BE REVIEWED.          **** "       
      / @01 " ********************************************************************* "
      / @01 " ****  THE SQL ERROR CODE IS  &SQLXRC  AND THE SQL ERROR MESSAGE  **** "
      / @01 " ****  &SQLXMSG   **** "
      / @01 " ********************************************************************* ";
	RUN;
%END;
%MEND;
PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE REJLNS AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT DISTINCT C.DF_SPE_ACC_ID
	,B.AC_LON_TYP
	,A.AF_APL_OPS_SCL
	,B.AD_PRC
FROM OLWHRM1.GA01_APP A
INNER JOIN OLWHRM1.GA10_LON_APP B
	ON A.AF_APL_ID = B.AF_APL_ID
INNER JOIN OLWHRM1.PD01_PDM_INF C
	ON A.DF_PRS_ID_BR = C.DF_PRS_ID
WHERE B.AC_PRC_STA = 'R'
AND (
	AC_APL_REJ_REA_1 IN ('C','F','H','I','U') OR 
	AC_APL_REJ_REA_2 IN ('C','F','H','I','U') OR 
	AC_APL_REJ_REA_3 IN ('C','F','H','I','U') OR 
	AC_APL_REJ_REA_4 IN ('C','F','H','I','U') OR 
	AC_APL_REJ_REA_5 IN ('C','F','H','I','U') 
	)
AND DAYS(B.AD_PRC) > DAYS(CURRENT DATE) - 60
FOR READ ONLY WITH UR
);
DISCONNECT FROM DB2;
%PUT  SQLXRC= >>> &SQLXRC <<< ||| SQLXMSG= >>> &SQLXMSG >>>  ;  * INCLUDES ERROR MESSAGES TO SAS LOG  ;
%SQLCHECK (SQLRPT=ULWO56.LWO56RZ);
QUIT;
/*ENDRSUBMIT;*/
/**/
/*DATA REJLNS;*/
/*SET WORKLOCL.REJLNS;*/
/*RUN;*/

PROC SORT DATA=REJLNS;
BY AF_APL_OPS_SCL DF_SPE_ACC_ID AC_LON_TYP;
RUN;

PROC PRINTTO PRINT=REPORT2 NEW;
RUN;
OPTIONS ORIENTATION = PORTRAIT;
OPTIONS PS=52 LS=96 PAGENO=1 DATE CENTER;
TITLE 'APPLICATIONS WITH REJECT C, F, H, I OR U';
FOOTNOTE 'JOB = UTLWO56  	 REPORT = ULWO56.LWO56R2';
PROC CONTENTS DATA=REJLNS OUT=EMPTYSET NOPRINT;
DATA _NULL_;
SET EMPTYSET;
FILE PRINT;
IF  NOBS=0 AND _N_ =1 THEN DO;
	PUT // 95*'-';
	PUT      //////////
		@35 '**** NO OBSERVATIONS FOUND ****';
	PUT /////////
		@41 '-- END OF REPORT --';
	PUT /////////////////
		@31 "JOB = UTLWO56  	 REPORT = ULWO56.LWO56R2";
	END;
RETURN;
RUN;
PROC PRINT NOOBS SPLIT='/' DATA=REJLNS WIDTH=UNIFORM WIDTH=MIN;
VAR DF_SPE_ACC_ID AC_LON_TYP AF_APL_OPS_SCL AD_PRC;
LABEL DF_SPE_ACC_ID = 'ACCT #'
	AC_LON_TYP = 'LOAN TYPE' 
	AF_APL_OPS_SCL = 'SCHOOL ID'
	AD_PRC = 'PROCESSING DATE';
RUN;
PROC PRINTTO;
RUN;
