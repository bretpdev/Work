/*LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;*/
/*%LET RPTLIB = %SYSGET(reportdir);*/
/*FILENAME REPORT2 "&RPTLIB/ULW___.LW___R2";*/

libname  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=work  ;
RSUBMIT;
PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE UVSCDB AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT INTEGER(A.BF_SSN) AS BF_SSN
	,A.AN_SEQ
	,B.LN_LON_DSB_SEQ
  	,A.AF_CNL||''||A.AF_CNL_SFX AS CLUID 
	,A.IC_LON_PGM
	,A.AD_SCL_LON_TRM_BEG  
	,B.LD_DSB
	,B.LA_DSB - COALESCE(LA_DSB_CAN,0) AS DSB_AMT
FROM OLWHRM1.AP03_MASTER_APL A  
INNER JOIN OLWHRM1.LN15_DSB B
	ON A.AF_APL_ID = B.AF_APL_ID
INNER JOIN OLWHRM1.GA01_APP GA01
	ON A.AF_CNL = GA01.AF_APL_ID
WHERE A.AF_DOE_SCL = '00367000' 
AND A.AD_SCL_LON_TRM_BEG = '04/27/2004' 
AND B.LC_STA_LON15 IN ('1','3')
AND B.LC_DSB_TYP = '1'
AND B.LN_LON_DSB_SEQ = 1
AND (B.LA_DSB_CAN IS NULL
    OR B.LA_DSB_CAN <> B.LA_DSB)
AND B.LC_LDR_DSB_MDM = ' '
AND (GA01.AD_APL_DSB_1 = '04/22/2004'
	OR GA01.AX_APL_DSB_1_IAD = '04/22/2004')
);
DISCONNECT FROM DB2;
ENDRSUBMIT;

DATA UVSCDB; 
SET WORKLOCL.UVSCDB; 
RUN;

PROC SORT DATA=UVSCDB;
BY BF_SSN AN_SEQ;
RUN;

DATA _NULL_;
CALL SYMPUT('RUNDATE',PUT(INTNX('DAY',TODAY(),0,'beginning'), MMDDYY10.));
RUN;

OPTIONS CENTER NODATE NUMBER PAGENO=1 LS=132;
TITLE 'UVSC ANTICIPATED DISB SCHEDULED IN ERROR';
TITLE2 "RUN DATE:  &RUNDATE";

PROC CONTENTS DATA=UVSCDB OUT=EMPTYSET NOPRINT;
DATA _NULL_;
SET EMPTYSET;
FILE PRINT;
IF  NOBS=0 AND _N_ =1 THEN DO;
	PUT // 132 *'-';
	PUT      ////////
		@51 '**** NO OBSERVATIONS FOUND ****';
	PUT ////////
		@57 '-- END OF REPORT --';
	PUT ////////////////
		@46 'JOB = DSASG02     REPORT = DSASG02.R2';
	END;
RETURN;
run;
PROC PRINT NOOBS SPLIT='/' DATA=UVSCDB WIDTH=UNIFORM WIDTH=MIN;
VAR BF_SSN AN_SEQ LN_LON_DSB_SEQ CLUID IC_LON_PGM AD_SCL_LON_TRM_BEG LD_DSB DSB_AMT;
LABEL BF_SSN='SSN' AN_SEQ='APP SEQ #' LN_LON_DSB_SEQ='DISB #'
CLUID='CL UNIQUE ID' IC_LON_PGM='LOAN TYPE' AD_SCL_LON_TRM_BEG='LOAN PERIOD BEGIN'
LD_DSB='DISB DATE' DSB_AMT='DISB AMOUNT';
FORMAT BF_SSN SSN11. AD_SCL_LON_TRM_BEG MMDDYY10. DSB_AMT DOLLAR10.2;
FOOTNOTE 'JOB = DSASG02     REPORT = DSASG02.R2';
RUN;