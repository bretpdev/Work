
LIBNAME DUSTER REMOTE SERVER=DUSTER SLIBREF=WORK;
RSUBMIT;
LIBNAME OLWHRM1 DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;

PROC SQL;
	CREATE TABLE R2GT0 AS
		SELECT 
			LN10.BF_SSN,
			LN10.LN_SEQ
		FROM
			OLWHRM1.LN10_LON LN10
		WHERE
			LN10.LC_STA_LON10 = 'R'
			AND LN10.LA_CUR_PRI > 0
			AND LN10.IF_GTR = '000749'
			AND LN10.IC_LON_PGM IN ('STFFRD', 'UNSTFD', 'PLUS', 'PLUSGB')
			AND LN10.LD_LON_1_DSB GE '01JAN2008'D
			AND LN10.LD_LON_1_DSB LE '30APR2008'D
	;


	CREATE TABLE R2EQ0 AS
		SELECT 
			LN10.BF_SSN,
			LN10.LN_SEQ
		FROM
			OLWHRM1.LN10_LON LN10
		WHERE
			LN10.LC_STA_LON10 = 'R'
			AND LN10.LA_CUR_PRI = 0
			AND LN10.IF_GTR = '000749'
			AND LN10.IC_LON_PGM IN ('STFFRD', 'UNSTFD', 'PLUS', 'PLUSGB')
			AND LN10.LD_LON_1_DSB GE '01JAN2008'D
			AND LN10.LD_LON_1_DSB LT '30APR2008'D
	;

	CREATE TABLE R3 AS
		SELECT 
			LN10.BF_SSN,
			LN10.LN_SEQ
		FROM
			OLWHRM1.LN10_LON LN10
			JOIN OLWHRM1.LN54_LON_BBS LN54
				ON LN10.BF_SSN = LN54.BF_SSN
				AND LN10.LN_SEQ = LN54.LN_SEQ
		WHERE
			LN10.LC_STA_LON10 = 'R'
			AND LN10.LA_CUR_PRI > 0
			AND LN10.IF_GTR = '000749'
			AND LN54.PM_BBS_PGM = 'R48'
			AND LN54.LC_STA_LN54 = 'A'
	;

	CREATE TABLE R4 AS
		SELECT 
			LN10.BF_SSN,
			LN10.LN_SEQ,
			LN54.LD_BBS_DSQ,
			LN54.LC_BBS_DSQ_REA,
			LN55.LN_LON_BBT_PAY
		FROM
			OLWHRM1.LN10_LON LN10
			JOIN OLWHRM1.LN54_LON_BBS LN54
				ON LN10.BF_SSN = LN54.BF_SSN
				AND LN10.LN_SEQ = LN54.LN_SEQ
				AND LN54.LC_STA_LN54 = 'A'
			JOIN OLWHRM1.LN55_LON_BBS_TIR LN55
				ON LN54.BF_SSN = LN55.BF_SSN
				AND LN54.LN_SEQ = LN55.LN_SEQ
				AND LN55.LC_STA_LN55 = 'A'
		WHERE
			LN10.LC_STA_LON10 = 'R'
			AND LN10.LA_CUR_PRI > 0
			AND LN10.IF_GTR = '000749'
			AND LN54.PM_BBS_PGM = 'R48'
			AND LN54.LD_BBS_DSQ IS NOT NULL
	;

	CREATE TABLE R5 AS
		SELECT 
			LN10.BF_SSN,
			LN10.LN_SEQ,
			LN10.LA_CUR_PRI,
			LN55.LN_LON_BBT_PAY
		FROM
			OLWHRM1.LN10_LON LN10
			JOIN OLWHRM1.LN54_LON_BBS LN54
				ON LN10.BF_SSN = LN54.BF_SSN
				AND LN10.LN_SEQ = LN54.LN_SEQ
				AND LN54.LC_STA_LN54 = 'A'
			JOIN OLWHRM1.LN55_LON_BBS_TIR LN55
				ON LN54.BF_SSN = LN55.BF_SSN
				AND LN54.LN_SEQ = LN55.LN_SEQ
				AND LN55.LC_STA_LN55 = 'A'
		WHERE
			LN10.LC_STA_LON10 = 'R'
			AND LN10.LA_CUR_PRI > 0
			AND LN10.IF_GTR = '000749'
			AND LN54.PM_BBS_PGM = 'R48'
			AND LN54.LD_BBS_DSQ IS NULL
			AND LN55.LN_LON_BBT_PAY < 48
	;

	CREATE TABLE R6 AS
		SELECT DISTINCT
			LN10.BF_SSN,
			LN10.LN_SEQ,
			LN90.LD_FAT_EFF,
			LN90.LA_FAT_CUR_PRI,
			LN10.LA_CUR_PRI
		FROM
			OLWHRM1.LN10_LON LN10
			JOIN OLWHRM1.LN54_LON_BBS LN54
				ON LN10.BF_SSN = LN54.BF_SSN
				AND LN10.LN_SEQ = LN54.LN_SEQ
				AND LN54.LC_STA_LN54 = 'A'
			JOIN OLWHRM1.LN55_LON_BBS_TIR LN55
				ON LN54.BF_SSN = LN55.BF_SSN
				AND LN54.LN_SEQ = LN55.LN_SEQ
				AND LN55.LC_STA_LN55 = 'A'
			JOIN OLWHRM1.LN90_FIN_ATY LN90
				ON LN10.BF_SSN = LN90.BF_SSN
				AND LN10.LN_SEQ = LN90.LN_SEQ
				AND LN90.PC_FAT_TYP = '18' 
				AND LN90.PC_FAT_SUB_TYP = '01' 
				AND LN90.LC_STA_LON90 = 'A'
				AND LN90.LC_FAT_REV_REA = ''
		WHERE
			LN10.LC_STA_LON10 = 'R'
			AND LN10.IF_GTR = '000749'
			AND LN54.PM_BBS_PGM = 'R48'
			AND LN54.LD_BBS_DSQ IS NULL
			AND LN55.LN_LON_BBT_PAY > 47
	;

	CREATE TABLE R6GT0 AS
		SELECT
			BF_SSN,
			LN_SEQ,
			LD_FAT_EFF,
			LA_FAT_CUR_PRI
		FROM
			R6
		WHERE
			LA_CUR_PRI > 0
	;

	CREATE TABLE R6EQ0 AS
		SELECT
			BF_SSN,
			LN_SEQ,
			LD_FAT_EFF,
			LA_FAT_CUR_PRI
		FROM
			R6
		WHERE
			LA_CUR_PRI = 0
	;
QUIT;
ENDRSUBMIT;

DATA R2GT0; SET DUSTER.R2GT0; RUN;
DATA R2EQ0; SET DUSTER.R2EQ0; RUN;
DATA R3; SET DUSTER.R3; RUN;
DATA R4; SET DUSTER.R4; RUN;
DATA R5; SET DUSTER.R5; RUN;
DATA R6GT0; SET DUSTER.R6GT0; RUN;
DATA R6EQ0; SET DUSTER.R6EQ0; RUN;

PROC EXPORT
		DATA=R2GT0
		OUTFILE='T:\SAS\R48 Queries.XLSX'
		REPLACE;
RUN;

PROC EXPORT
		DATA=R2EQ0
		OUTFILE='T:\SAS\R48 Queries.XLSX'
		REPLACE;
RUN;

PROC EXPORT
		DATA=R3
		OUTFILE='T:\SAS\R48 Queries.XLSX'
		REPLACE;
RUN;

PROC EXPORT
		DATA=R4
		OUTFILE='T:\SAS\R48 Queries.XLSX'
		REPLACE;
RUN;

PROC EXPORT
		DATA=R5
		OUTFILE='T:\SAS\R48 Queries.XLSX'
		REPLACE;
RUN;

PROC EXPORT
		DATA=R6GT0
		OUTFILE='T:\SAS\R48 Queries.XLSX'
		REPLACE;
RUN;

PROC EXPORT
		DATA=R6EQ0
		OUTFILE='T:\SAS\R48 Queries.XLSX'
		REPLACE;
RUN;
