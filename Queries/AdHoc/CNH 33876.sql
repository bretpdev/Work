USE CDW
GO

DECLARE @ACH_COUNT DECIMAL(XX,X)
DECLARE @TOTAL_COUNT DECIMAL(XX,X)
DECLARE @TOTAL_COUNT_REPAY DECIMAL(XX,X)

SELECT DISTINCT	
	@ACH_COUNT = COUNT(DISTINCT BRXX.BF_SSN)
FROM 
	CDW..BRXX_BR_EFT BRXX
	INNER JOIN CDW..LNXX_EFT_TO_LON LNXX
		ON LNXX.BF_SSN = BRXX.BF_SSN
		AND LNXX.BN_EFT_SEQ = BRXX.BN_EFT_SEQ
	INNER JOIN CDW..LNXX_LON LNXX
		ON LNXX.BF_SSN = BRXX.BF_SSN
WHERE
	BRXX.BC_EFT_STA = 'A'
	AND LNXX.LC_STA_LONXX = 'R'
	AND LNXX.LA_CUR_PRI > X.XX
	AND LNXX.LC_STA_LNXX = 'A'


SELECT DISTINCT
	@TOTAL_COUNT = COUNT(DISTINCT LNXX.BF_SSN)
FROM
		CDW..LNXX_LON LNXX
WHERE
	LNXX.LC_STA_LONXX = 'R'
	AND LNXX.LA_CUR_PRI > X.XX


SELECT DISTINCT
	@TOTAL_COUNT_REPAY = COUNT(DISTINCT LNXX.BF_SSN)
FROM
	CDW..DWXX_DW_CLC_CLU DWXX
	INNER JOIN CDW..LNXX_LON LNXX
		ON LNXX.BF_SSN = DWXX.BF_SSN
		AND LNXX.LN_SEQ = DWXX.LN_SEQ
WHERE
	DWXX.WC_DW_LON_STA = 'XX'
	AND LNXX.LC_STA_LONXX = 'R'
	AND LNXX.LA_CUR_PRI > X.XX

SELECT 
	@ACH_COUNT AS ACH_COUNT

SELECT
	@TOTAL_COUNT_REPAY AS REPAY_COUNT

SELECT 
	@TOTAL_COUNT AS TOTAL_COUNT


SELECT CAST((CAST(@ACH_COUNT AS DECIMAL(XX,X)) / CAST(@TOTAL_COUNT_REPAY AS DECIMAL(XX,X))) AS DECIMAL(XX,X)) * XXX
SELECT CAST((CAST(@ACH_COUNT AS DECIMAL(XX,X))/ CAST(@TOTAL_COUNT AS DECIMAL(XX,X))) AS DECIMAL(XX,X))* XXX