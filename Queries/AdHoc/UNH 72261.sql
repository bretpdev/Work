DROP TABLE IF EXISTS #DATA
SELECT 
	PD10.DF_PRS_ID,
	pd10.DM_PRS_1,
	pd10.DM_PRS_LST,
	COMBINED_COMMENT.LX_ATY,
	LD_ATY_REQ_RCV,
	LF_USR_REQ_ATY
INTO #DATA
FROM
	PD10_PRS_NME PD10
	INNER JOIN
	(
		SELECT DISTINCT
			AY20.BF_SSN,
			STUFF(
			(
				SELECT 
					 SUB.LX_ATY AS [text()]
				FROM 
					AY20_ATY_TXT SUB
				WHERE
					SUB.BF_SSN = AY20.BF_SSN
					AND SUB.LN_ATY_SEQ = AY20.LN_ATY_SEQ
			FOR XML PATH('')
			)
			,1,0, '') AS LX_ATY,
			LD_ATY_REQ_RCV,
			LF_USR_REQ_ATY
		FROM	
			AY10_BR_LON_ATY AY10
			INNER JOIN AY15_ATY_CMT AY15
				ON AY10.BF_SSN = AY15.BF_SSN
				AND AY10.LN_ATY_SEQ = AY15.LN_ATY_SEQ
			INNER JOIN AY20_ATY_TXT AY20
				ON AY15.BF_SSN = AY20.BF_SSN
				AND AY15.LN_ATY_SEQ = AY20.LN_ATY_SEQ
				AND AY15.LN_ATY_CMT_SEQ = AY20.LN_ATY_CMT_SEQ
			INNER JOIN PD10_PRS_NME PD10
				ON PD10.DF_PRS_ID = AY20.BF_SSN
		WHERE
			AY10.LC_STA_ACTY10 = 'A'
			AND AY10.LD_ATY_REQ_RCV BETWEEN '04/01/2021' AND '08/01/2021'
			AND AY15.LC_STA_AY15 = 'A'
	) COMBINED_COMMENT
		ON COMBINED_COMMENT.BF_SSN = PD10.DF_PRS_ID

SELECT 
	* 
FROM 
	#DATA		
WHERE
	LX_ATY LIKE '%pslf%'	

UNION

SELECT 
	* 
FROM 
	#DATA		
WHERE
	LX_ATY LIKE '%public service%'	

UNION

SELECT 
	* 
FROM 
	#DATA		
WHERE
	LX_ATY LIKE '%public service loan forgiveness%'	