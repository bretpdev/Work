set transaction isolation level read uncommitted

SELECT DISTINCT
	PDXX.DF_SPE_ACC_ID --comment out for total count
	--COUNT(DISTINCT RSXX.BF_SSN) --uncomment for total count
FROM
	CDW..PDXX_PRS_NME PDXX
	INNER JOIN CDW..RSXX_BR_RPD RSXX
		ON PDXX.DF_PRS_ID = RSXX.BF_SSN	
	INNER JOIN CDW..LNXX_LON LNXX
		ON LNXX.BF_SSN = RSXX.BF_SSN
	INNER JOIN CDW..LNXX_LON_BIL_CRF LNXX --only include installment bills due between 'XX/XX/XXXX' AND 'XX/XX/XXXX'
		ON LNXX.BF_SSN = LNXX.BF_SSN
		AND LNXX.LN_SEQ = LNXX.LN_SEQ
		AND LNXX.LC_BIL_TYP_LON = 'P'
		AND LNXX.LD_BIL_DU_LON BETWEEN 'XX/XX/XXXX' AND 'XX/XX/XXXX'
	INNER JOIN CDW..DWXX_DW_CLC_CLU DWXX
		ON DWXX.BF_SSN = LNXX.BF_SSN
		AND DWXX.LN_SEQ = LNXX.LN_SEQ
	INNER JOIN CDW..LNXX_LON_DLQ_HST LNXX -- only include delinquent borrowers
		ON LNXX.BF_SSN = LNXX.BF_SSN
		AND LNXX.LN_SEQ = LNXX.LN_SEQ
		AND LNXX.LC_STA_LONXX = X 
	LEFT JOIN CDW..LNXX_FIN_ATY LNXX
		ON LNXX.BF_SSN = RSXX.BF_SSN
		--AND LNXX.LD_FAT_EFF >= RSXX.LD_RPS_X_PAY_DU
		AND LNXX.PC_FAT_TYP = 'XX'
		AND LNXX.PC_FAT_SUB_TYP = 'XX'
	LEFT JOIN --deferments
		(
			SELECT 
				DFXX.BF_SSN,
				LNXX.LN_SEQ
			FROM
				CDW..DFXX_BR_DFR_REQ DFXX
				INNER JOIN CDW..LNXX_BR_DFR_APV LNXX
		 			ON DFXX.BF_SSN = LNXX.BF_SSN
			WHERE DFXX.LC_DFR_STA = 'A'
				AND DFXX.LC_STA_DFRXX = 'A'
				AND LNXX.LC_STA_LONXX = 'A' 
		)	DEF --forbearances
			ON LNXX.BF_SSN = DEF.BF_SSN
			AND LNXX.LN_SEQ = DEF.LN_SEQ
	LEFT JOIN
		(
			SELECT
				LNXX.BF_SSN,
				LNXX.LN_SEQ
			FROM
				CDW..FBXX_BR_FOR_REQ FBXX
				INNER JOIN CDW..LNXX_BR_FOR_APV LNXX
					ON FBXX.BF_SSN = LNXX.BF_SSN
			WHERE
				FBXX.LC_FOR_STA = 'A'
				AND FBXX.LC_STA_FORXX = 'A'
				AND LNXX.LC_STA_LONXX = 'A' 
		) FORB
			ON LNXX.BF_SSN = FORB.BF_SSN
			AND LNXX.LN_SEQ = FORB.LN_SEQ
WHERE
	RSXX.LD_RPS_X_PAY_DU BETWEEN 'XX/XX/XXXX' AND 'XX/XX/XXXX'
	AND RSXX.LC_STA_RPSTXX = 'A'
	AND LNXX.BF_SSN IS NULL
	AND LNXX.LA_CUR_PRI > X.XX
	AND LNXX.LC_STA_LONXX = 'R'
	AND DWXX.WC_DW_LON_STA = 'XX'
	AND DEF.BF_SSN IS NULL --exclude borrowers with deferments
	AND FORB.BF_SSN IS NULL --exclude borrowers with forbearances
	--AND LTRIM(RTRIM(ISNULL(LNXX.LC_FAT_REV_REA, ''))) = ''