--TODO CHANGE THESE DATES TO BE WHEN AES IMPLEMTS THE PROCESS
DECLARE @BEGINDATE DATE
DECLARE @ENDDATE DATE

SELECT
	COUNT(DISTINCT POP.BF_SSN) AS BORROWER_COUNT,
	COUNT(*) AS LOAN_COUNT
FROM
(
	SELECT DISTINCT
		LNXX.BF_SSN,
		LNXX.LN_SEQ
	FROM
		CDW..FBXX_BR_FOR_REQ FBXX
		INNER JOIN CDW..LNXX_BR_FOR_APV LNXX
			ON LNXX.BF_SSN = FBXX.BF_SSN
			AND LNXX.LF_FOR_CTL_NUM = FBXX.LF_FOR_CTL_NUM
		INNER JOIN CDW..LNXX_LON LNXX
			ON LNXX.BF_SSN = LNXX.BF_SSN
			AND LNXX.LN_SEQ = LNXX.LN_SEQ
			AND LNXX.LA_CUR_PRI > X
			AND LNXX.LC_STA_LONXX = 'R'
	WHERE
		LNXX.LC_STA_LONXX = 'A'
		AND FBXX.LC_STA_FORXX = 'A'
		AND FBXX.LC_FOR_STA = 'A' --denied records cant have this active
		AND LNXX.LC_FOR_RSP != 'XXX'
		AND FBXX.LC_FOR_TYP IN  ('XX')
		AND	FBXX.LD_CRT_REQ_FOR BETWEEN @BEGINDATE AND @ENDDATE
)POP