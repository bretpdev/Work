USE CDW

GO
--XXXXX
--XXXXX


SELECT DISTINCT
	FSXX.BF_SSN,
	FSXX.LN_SEQ,
	CNH.[AWARD ID],
	ISNULL(FORB.LC_FOR_TYP, 'NO FORBEARANCE') AS FORB_TYPE
FROM
	CDW..[CNH XXXXX] CNH	
	INNER JOIN CDW..FSXX_DL_LON FSXX
		ON (FSXX.LF_FED_AWD + RIGHT('XXX' + CAST(FSXX.LN_FED_AWD_SEQ AS VARCHAR(XX)), X)) = CNH.[AWARD ID]
	INNER JOIN CDW..LNXX_LON LNXX
		ON LNXX.BF_SSN = FSXX.BF_SSN
		AND LNXX.LN_SEQ = FSXX.LN_SEQ 
	LEFT JOIN
	(
		SELECT 
			LNXX.BF_SSN,
			LNXX.LN_SEQ,
			FBXX.LC_FOR_TYP
		FROM
			CDW..FBXX_BR_FOR_REQ FBXX
			INNER JOIN CDW..LNXX_BR_FOR_APV LNXX
				ON LNXX.BF_SSN = FBXX.BF_SSN
				AND LNXX.LF_FOR_CTL_NUM = FBXX.LF_FOR_CTL_NUM
			INNER JOIN CDW..LNXX_LON LNXX
				ON LNXX.BF_SSN = LNXX.BF_SSN
				AND LNXX.LN_SEQ = LNXX.LN_SEQ
				AND LNXX.LA_CUR_PRI > X
				AND LNXX.LC_STA_LONXX = 'R'
		WHERE
			LNXX.LC_STA_LONXX = 'A'
			AND FBXX.LC_STA_FORXX = 'A'
			AND FBXX.LC_FOR_STA = 'A' --denied records cant have this active
			AND LNXX.LC_FOR_RSP != 'XXX'
	
			AND	CAST(GETDATE() AS DATE) BETWEEN LNXX.LD_FOR_BEG AND LNXX.LD_FOR_END
	) FORB 
		ON FORB.BF_SSN = FSXX.BF_SSN
		AND FORB.LN_SEQ = FSXX.LN_SEQ

--SELECT 
--	(FSXX.LF_FED_AWD + LEFT('XX' + CAST(FSXX.LN_FED_AWD_SEQ AS VARCHAR(XX)), X)),
--	* 
--FROM 
--	CDW..FSXX_DL_LON FSXX
--WHERE LF_FED_AWD = 'XXXXXXXXXSXXGXXXXX'