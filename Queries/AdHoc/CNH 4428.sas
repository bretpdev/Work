PROC IMPORT OUT = WORK.SOURCE
            DATAFILE = "T:\sas\XXX + EOM NOVEMBER.xlsx" 
            DBMS = xlsx REPLACE;
   			SHEET = 'SheetX'; 
RUN;

PROC IMPORT OUT = WORK.AWARD
            DATAFILE = "T:\Award IDs Not Found.xlsx" 
            DBMS = xlsx REPLACE;
   			SHEET = 'SheetX'; 
RUN;

DATA AWARD;
SET AWARD;
LF_FED_AWD=SUBSTR(AWARD_ID, X, XX);
LN_FED_AWD_SEQ=INPUT(SUBSTR(AWARD_ID, XX, X), bestX.);
RUN;


LIBNAME  LEGEND  REMOTE  SERVER=LEGEND SLIBREF=WORK;
DATA LEGEND.AWARD; *Send data to Duster;
SET AWARD;
RUN;


LIBNAME  LEGEND  REMOTE  SERVER=LEGEND SLIBREF=WORK;
DATA LEGEND.SOURCE; *Send data to Duster;
SET SOURCE;
RUN;

RSUBMIT LEGEND;
LIBNAME PKUB DBX DATABASE=DNFPUTDL OWNER=PKUB;
PROC SQL;
	CREATE TABLE NHXXXX AS
		SELECT distinct
			lnXX.bf_ssn,
			s.*,
			FSXX.LF_FED_AWD || PUT(FSXX.LN_FED_AWD_SEQ,ZX.) AS AWARD_ID,
			DWXX.WC_DW_LON_STA AS STATUS,
			ayXX.PF_REQ_ACT,
			lnXX.LC_STA_LONXX,
			lnXX.LC_SST_LONXX 
		FROM
			 SOURCE S
		INNER JOIN PKUB.LNXX_LON LNXX
			ON LNXX.BF_SSN = put(S.SSN, zX.)
		left JOIN PKUB.FSXX_DL_LON FSXX
			ON FSXX.BF_SSN = LNXX.BF_SSN
			AND FSXX.LN_SEQ = LNXX.LN_SEQ
		left JOIN PKUB.DWXX_DW_CLC_CLU DWXX
			ON DWXX.BF_SSN = LNXX.BF_SSN
			AND DWXX.LN_SEQ = LNXX.LN_SEQ
		left join pkub.AYXX_BR_LON_ATY ayXX
			on ayXX.bf_ssn = lnXX.bf_ssn
			and ayXX.PF_REQ_ACT = 'DLFDL'
		where
			lnXX.LC_STA_LONXX = 'D'
			and lnXX.LC_SST_LONXX in ('X','X','X','X','X')
;
QUIT;
ENDRSUBMIT;

RSUBMIT LEGEND;
LIBNAME PKUB DBX DATABASE=DNFPUTDL OWNER=PKUB;
PROC SQL;
	CREATE TABLE missing AS
		SELECT distinct
			lnXX.BF_SSN,
			LNXX.LN_SEQ,
			LNXX.LA_CUR_PRI,
			DWXX.WC_DW_LON_STA AS STATUS
		 from PKUB.FSXX_DL_LON FSXX
		 inner join award a
		 	on a.LF_FED_AWD = fsXX.LF_FED_AWD
			and a.LN_FED_AWD_SEQ = fsXX.LN_FED_AWD_SEQ
		 INNER JOIN PKUB.LNXX_LON LNXX
		 	ON LNXX.BF_SSN = FSXX.BF_SSN
			AND LNXX.LN_SEQ = FSXX.LN_SEQ
		left JOIN PKUB.DWXX_DW_CLC_CLU DWXX
			ON DWXX.BF_SSN = LNXX.BF_SSN
			AND DWXX.LN_SEQ = LNXX.LN_SEQ
		;
QUIT;
ENDRSUBMIT;

PROC EXPORT DATA = LEGEND.missing 
            OUTFILE = "T:\SAS\NH XXXX missing award ids.xls" 
            DBMS = EXCEL
			REPLACE;
     SHEET="A"; 
RUN;



RSUBMIT LEGEND;
LIBNAME PKUB DBX DATABASE=DNFPUTDL OWNER=PKUB;
PROC SQL;
	CREATE TABLE DLFDL AS
		SELECT distinct
			lnXX.bf_ssn,
			lnXX.ln_seq,
			ayXX.PF_REQ_ACT

		 from PKUB.LNXX_LON LNXX
		 inner join pkub.AYXX_BR_LON_ATY ayXX
			on ayXX.bf_ssn = lnXX.bf_ssn
			and ayXX.PF_REQ_ACT = 'DLFDL'
		;
QUIT;
ENDRSUBMIT;

RSUBMIT LEGEND;
LIBNAME PKUB DBX DATABASE=DNFPUTDL OWNER=PKUB;
PROC SQL;
	CREATE TABLE fsXX AS
		SELECT distinct
			lnXX.*
		 from PKUB.FSXX_DL_LON LNXX
			
		where
			lnXX.bf_ssn = 'XXXXXXXXX'
		;
QUIT;
ENDRSUBMIT;

RSUBMIT LEGEND;
LIBNAME PKUB DBX DATABASE=DNFPUTDL OWNER=PKUB;
PROC SQL;
	CREATE TABLE dwXX AS
		SELECT distinct
			lnXX.*
		 from PKUB.DWXX_DW_CLC_CLU LNXX
			
		where
			lnXX.bf_ssn = 'XXXXXXXXX'
		;
QUIT;
ENDRSUBMIT;

data NHXXXX;
set legend.NHXXXX;
where PF_REQ_ACT is not null;
run;

/*export to Excel spreadsheet*/
PROC EXPORT DATA = LEGEND.NHXXXX 
            OUTFILE = "T:\SAS\NH XXXX dX.xls" 
            DBMS = EXCEL
			REPLACE;
     SHEET="A"; 
RUN;

PROC EXPORT DATA = LEGEND.lnXX 
            OUTFILE = "T:\SAS\NH XXXX XXXXXXXXXX.xls" 
            DBMS = EXCEL
			REPLACE;
     SHEET="lnXX"; 
RUN;

PROC EXPORT DATA = LEGEND.fsXX 
            OUTFILE = "T:\SAS\NH XXXX XXXXXXXXXX.xls" 
            DBMS = EXCEL
			REPLACE;
     SHEET="fsXX"; 
RUN;

PROC EXPORT DATA = LEGEND.dwXX 
            OUTFILE = "T:\SAS\NH XXXX XXXXXXXXXX.xls" 
            DBMS = EXCEL
			REPLACE;
     SHEET="dwXX"; 
RUN;

PROC EXPORT DATA = LEGEND.DLFDL 
            OUTFILE = "T:\SAS\NH XXXX DLFDL.xls" 
            DBMS = EXCEL
			REPLACE;
     SHEET="DLFDL"; 
RUN;
