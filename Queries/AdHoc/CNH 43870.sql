USE CDW
GO
--QUERY X
SELECT DISTINCT
	COUNT(*)
FROM
	CDW..LNXX_FIN_ATY LNXX
WHERE
	LNXX.LC_STA_LONXX = 'A'
	AND COALESCE(rtrim(LNXX.LC_FAT_REV_REA),'') = ''
	AND LNXX.PC_FAT_TYP = 'XX'
	AND LNXX.PC_FAT_SUB_TYP = 'XX'
	AND LNXX.LD_FAT_EFF IN ('XX/XX/XXXX','XX/XX/XXXX','XX/XX/XXXX','XX/XX/XXXX')

--QUERY X
SELECT
	COUNT(*)
FROM
	CDW..CS_TRANSFERPIFLOANS

-- QUERY X
SELECT
	COUNT(*)
FROM
(
SELECT DISTINCT
	LNXX.BF_SSN,
	LNXX.LN_SEQ
FROM
	CDW..LNXX_LON LNXX
	LEFT JOIN
	(
		SELECT DISTINCT
			LNXX.BF_SSN,
			LNXX.LN_SEQ
		FROM
			CDW..LNXX_FIN_ATY LNXX
		WHERE
			LNXX.LC_STA_LONXX = 'A'
			AND COALESCE(rtrim(LNXX.LC_FAT_REV_REA),'') = ''
			AND LNXX.PC_FAT_TYP = 'XX'
			AND LNXX.PC_FAT_SUB_TYP = 'XX'
			AND LNXX.LD_FAT_EFF IN ('XX/XX/XXXX','XX/XX/XXXX','XX/XX/XXXX','XX/XX/XXXX')

		UNION

		SELECT DISTINCT
			BF_SSN,
			LN_SEQ
		FROM
			CDW..CS_TRANSFERPIFLOANS
	) TL
		ON TL.BF_SSN = LNXX.BF_SSN
		AND TL.LN_SEQ = LNXX.LN_SEQ
WHERE
	LNXX.LC_STA_LONXX = 'D'
	AND TL.BF_SSN IS NULL
) P

--query X
SELECT
	COUNT(*)
FROM
(
SELECT DISTINCT
	LNXX.BF_SSN,
	LNXX.LN_SEQ
FROM
	CDW..LNXX_LON LNXX
	LEFT JOIN
	(
		SELECT DISTINCT
			LNXX.BF_SSN,
			LNXX.LN_SEQ
		FROM
			CDW..LNXX_FIN_ATY LNXX
		WHERE
			LNXX.LC_STA_LONXX = 'A'
			AND COALESCE(rtrim(LNXX.LC_FAT_REV_REA),'') = ''
			AND LNXX.PC_FAT_TYP = 'XX'
			AND LNXX.PC_FAT_SUB_TYP = 'XX'
			AND LNXX.LD_FAT_EFF IN ('XX/XX/XXXX','XX/XX/XXXX','XX/XX/XXXX','XX/XX/XXXX')

		UNION

		SELECT DISTINCT
			BF_SSN,
			LN_SEQ
		FROM
			CDW..CS_TRANSFERPIFLOANS
	) TL
		ON TL.BF_SSN = LNXX.BF_SSN
		AND TL.LN_SEQ = LNXX.LN_SEQ
WHERE
	LNXX.LC_STA_LONXX = 'R'
	AND TL.BF_SSN IS NULL
) P