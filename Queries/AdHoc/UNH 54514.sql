USE UDW
GO

SELECT DISTINCT
	LN10.BF_SSN
	--,LN10.LN_SEQ
	--,LN16.LN_DLQ_SEQ
	,LN10.LC_CAM_LON_STA
	,LN16.LN_DLQ_MAX
	,LN10.LC_STA_LON10
	,CASE
		WHEN LN10.LA_CUR_PRI > 0.00
		THEN '>0'
		ELSE NULL
	END AS LA_CUR_PRI
FROM
	LN10_LON LN10
	INNER JOIN LN16_LON_DLQ_HST LN16
		ON LN10.BF_SSN = LN16.BF_SSN
		AND LN10.LN_SEQ = LN16.LN_SEQ
	INNER JOIN 
	(
		SELECT
			BF_SSN
			,LN_SEQ
			,MAX(LN_DLQ_SEQ) OVER(PARTITION BY BF_SSN, LN_SEQ) [LN_DLQ_SEQ]
		FROM
			LN16_LON_DLQ_HST
	) LN16_MAX
		ON LN16.BF_SSN = LN16_MAX.BF_SSN
		AND LN16.LN_SEQ = LN16_MAX.LN_SEQ
		AND LN16.LN_DLQ_SEQ = LN16_MAX.LN_DLQ_SEQ
WHERE
	LN10.LC_STA_LON10 = 'R'
	AND LN10.LA_CUR_PRI > 0.00
ORDER BY
	LN10.BF_SSN
