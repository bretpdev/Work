PROC IMPORT OUT = WORK.FILEX
            DATAFILE = "T:\Xerox-Cornerstone Scrub.xlsx" 
            DBMS = EXCEL REPLACE;
     RANGE="File X$"; 
     GETNAMES=YES; 
RUN;

PROC IMPORT OUT = WORK.FILEX
            DATAFILE = "T:\Xerox-Cornerstone Scrub.xlsx" 
            DBMS = EXCEL REPLACE;
     RANGE="File X$"; 
     GETNAMES=YES; 
RUN;

/*convert number type SSN to character type*/
DATA FILEX (DROP=SSN);
	SET FILEX ;
	SSNC = PUT(SSN,ZX.);
RUN;

LIBNAME  LEGEND  REMOTE  SERVER=LEGEND SLIBREF=WORK;
DATA LEGEND.FILEX; SET FILEX; RUN;
DATA LEGEND.FILEX; SET FILEX; RUN;


RSUBMIT LEGEND;
LIBNAME PKUB DBX DATABASE=DNFPUTDL OWNER=PKUB;
PROC SQL;
	CREATE TABLE FILEX_OUT AS
		SELECT DISTINCT
			FX.*,
			PDXX.DF_SPE_ACC_ID AS Account_Number,
			CASE
				WHEN LNXX.BF_SSN IS NULL THEN ''
				ELSE 'D'
			END AS Borrower_Status
		FROM
			FILEX FX
		LEFT JOIN PKUB.PDXX_PRS_NME PDXX
			ON PDXX.DF_PRS_ID = FX.SSN
		LEFT JOIN PKUB.LNXX_LON LNXX
			ON LNXX.BF_SSN = PDXX.DF_PRS_ID
			AND LNXX.LC_STA_LONXX = 'D'
		;
QUIT;

PROC SQL;
	CREATE TABLE FILEX_OUT AS
		SELECT DISTINCT
			FX.CHECK_NUM,
			FX.PAYMENT_DT,
			FX.PAYMENT_ID,
			FX.PAYER_NAME,
			FX.PAYER_ADDR_X,
			FX.PAYER_CITY,
			FX.PAYER_STATE_PROV,
			FX.PAYER_POSTAL_CODE,
			FX.TRANSACTION_AMOUNT,
			FX.ORIGINAL_BILLER_BUSINESS_ID,
			FX.SCANLINE_BILLER_BUSINESS_ID,
			FX.ORIGINAL_PAYEE_NAME,
			FX.PAYEE_ADDR_X,
			FX.PAYEE_ADDR_X,
			FX.PAYEE_CITY,
			FX.PAYEE_STATE_PROV,
			FX.PAYEE_POSTAL_CODE,
			FX.ORIGINAL_PAYER_ACCT_WITH_PAYEE,
			FX.SCANLINE_PAYER_ACCT_WITH_PAYEE,
			FX.UPDATED_CORRECTED_ACCT_,
			FX.SSNC AS SSN,
			FX.Servicer_ID,
			FX.Servicer_Name,
			FX.Updated_Address,
			FX.SCANLINE_STATUS_DESCRIPTION,
			FX.ORIGINATOR_BUSINESS_ID,
			FX.ORIGINATOR_NAME,
			FX.PAYMENT_TYPE,
			PDXX.DF_SPE_ACC_ID AS Account_Number,
			CASE
				WHEN LNXX.BF_SSN IS NULL THEN ''
				ELSE 'D'
			END AS Borrower_Status
		FROM
			FILEX FX
		LEFT JOIN PKUB.PDXX_PRS_NME PDXX
			ON PDXX.DF_PRS_ID = FX.SSNC
		LEFT JOIN PKUB.LNXX_LON LNXX
			ON LNXX.BF_SSN = PDXX.DF_PRS_ID
			AND LNXX.LC_STA_LONXX = 'D'
		;
QUIT;
ENDRSUBMIT;

PROC EXPORT DATA = LEGEND.FILEX_OUT
            OUTFILE = "T:\SAS\NH XXXX.xls" 
            DBMS = EXCEL
			REPLACE;
     SHEET="File_X"; 
RUN;

PROC EXPORT DATA = LEGEND.FILEX_OUT
            OUTFILE = "T:\SAS\NH XXXX.xls" 
            DBMS = EXCEL
			REPLACE;
     SHEET="File_X"; 
RUN;
