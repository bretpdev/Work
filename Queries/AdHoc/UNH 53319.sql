USE UDW
GO

--borrowers
SELECT DISTINCT
	PD10.DF_SPE_ACC_ID
	,LN10.LC_STA_LON10
	,CASE
		WHEN LN10.LA_CUR_PRI > 0.00
		THEN '>0'
		ELSE NULL
	END AS LA_CUR_PRI
	,PD30.DC_DOM_ST
	,PD30.DI_VLD_ADR
FROM
	..LN10_LON LN10
	INNER JOIN ..PD10_PRS_NME PD10
		ON LN10.BF_SSN = PD10.DF_PRS_ID
	INNER JOIN ..PD30_PRS_ADR PD30
		ON LN10.BF_SSN = PD30.DF_PRS_ID
WHERE
	LN10.LC_STA_LON10 = 'R'
	AND LN10.LA_CUR_PRI > 0.00
	AND PD30.DC_DOM_ST = 'DC'
	AND PD30.DI_VLD_ADR = 'Y'

--loans
SELECT DISTINCT
	PD10.DF_SPE_ACC_ID
	,LN10.LN_SEQ
	,LN10.LC_STA_LON10
	,CASE
		WHEN LN10.LA_CUR_PRI > 0.00
		THEN '>0'
		ELSE NULL
	END AS LA_CUR_PRI
	,PD30.DC_DOM_ST
	,PD30.DI_VLD_ADR
FROM
	..LN10_LON LN10
	INNER JOIN ..PD10_PRS_NME PD10
		ON LN10.BF_SSN = PD10.DF_PRS_ID
	INNER JOIN ..PD30_PRS_ADR PD30
		ON LN10.BF_SSN = PD30.DF_PRS_ID

WHERE
	LN10.LC_STA_LON10 = 'R'
	AND LN10.LA_CUR_PRI > 0.00
	AND PD30.DC_DOM_ST = 'DC'
	AND PD30.DI_VLD_ADR = 'Y'



--# of borrowers
SELECT
	'BORROWERS' [TYPE],
	COUNT(DISTINCT LN10.BF_SSN) [TOTAL]
FROM
	..LN10_LON LN10
	INNER JOIN ..PD30_PRS_ADR PD30
		ON LN10.BF_SSN = PD30.DF_PRS_ID
WHERE
	LN10.LC_STA_LON10 = 'R'
	AND LN10.LA_CUR_PRI > 0.00
	AND PD30.DC_DOM_ST = 'DC'
	AND PD30.DI_VLD_ADR = 'Y'

UNION ALL

--# of loans
SELECT
	'LOANS' [TYPE],
	COUNT(LN10.LN_SEQ) [TOTAL]
FROM
	..LN10_LON LN10
	INNER JOIN ..PD30_PRS_ADR PD30
		ON LN10.BF_SSN = PD30.DF_PRS_ID
WHERE
	LN10.LC_STA_LON10 = 'R'
	AND LN10.LA_CUR_PRI > 0.00
	AND PD30.DC_DOM_ST = 'DC'
	AND PD30.DI_VLD_ADR = 'Y'
