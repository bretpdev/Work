USE CDW
GO

SELECT
	YEAR(LD_ATY_REQ_RCV) AS [YEAR],
	MONTH(LD_ATY_REQ_RCV) AS [MONTH],
	COUNT(*) AS [COUNT]
FROM
	(
	SELECT DISTINCT
		AYXX.BF_SSN,
		AYXX.LD_ATY_REQ_RCV ,
		STUFF(
		(
			SELECT 
					' ' + SUB.LX_ATY AS [text()]
			FROM 
				AYXX_ATY_TXT SUB
			WHERE
				SUB.BF_SSN = AYXX.BF_SSN
				AND SUB.LN_ATY_SEQ = AYXX.LN_ATY_SEQ
		FOR XML PATH('')
		)
		,X,X, '') AS LX_ATY
			
	FROM	
		AYXX_BR_LON_ATY AYXX
		INNER JOIN AYXX_ATY_TXT AYXX
			ON AYXX.BF_SSN = AYXX.BF_SSN
			AND AYXX.LN_ATY_SEQ = AYXX.LN_ATY_SEQ
		left JOIN PDXX_PRS_NME PDXX
			ON PDXX.DF_PRS_ID = AYXX.BF_SSN
	WHERE
		AYXX.PF_REQ_ACT IN ('FBDNY','FBAPV')
		AND AYXX.LD_ATY_REQ_RCV BETWEEN 'XX/XX/XXXX' AND 'XX/XX/XXXX'
	) AYXX
	WHERE
		(AYXX.LX_ATY LIKE '%VERFORBFED%'
		OR
		AYXX.LX_ATY LIKE '%DASFORBFED%')
GROUP BY
	YEAR(LD_ATY_REQ_RCV),
	MONTH(LD_ATY_REQ_RCV)

SELECT
	YEAR(WF_CRT_DTS_WQXX) AS [YEAR],
	MONTH(WF_CRT_DTS_WQXX) AS [MONTH],
	COUNT(*) AS [COUNT]
FROM
	(
SELECT DISTINCT
	WN_CTL_TSK,
	BF_SSN,
	WF_CRT_DTS_WQXX
FROM
	CDW..WQXX_TSK_QUE_HST WQXX
WHERE
(
	(WF_QUE = 'SF' AND WF_SUB_QUE = 'XX')
	OR
	(WF_QUE = 'VB' AND WF_SUB_QUE = 'FB')
	OR
	(WF_QUE = 'SX' AND WF_SUB_QUE = 'XX')
	OR
	(WF_QUE = 'XX' AND WF_SUB_QUE = 'XX')
)
AND WQXX.WF_CRT_DTS_WQXX BETWEEN 'XX/XX/XXXX' AND 'XX/XX/XXXX'
) POP
GROUP BY
	YEAR(WF_CRT_DTS_WQXX) ,
	MONTH(WF_CRT_DTS_WQXX)
order by 
		YEAR(WF_CRT_DTS_WQXX) desc ,
	MONTH(WF_CRT_DTS_WQXX)



SELECT
	YEAR(WF_CRT_DTS_WQXX) AS [YEAR],
	MONTH(WF_CRT_DTS_WQXX) AS [MONTH],
	COUNT(*) AS [COUNT]
FROM
	(
SELECT DISTINCT
	WN_CTL_TSK,
	BF_SSN,
	WF_CRT_DTS_WQXX
FROM
	CDW..WQXX_TSK_QUE_HST WQXX
WHERE
(
	(WF_QUE = 'SX' AND WF_SUB_QUE = 'XX')
	OR
	(WF_QUE = 'XP' AND WF_SUB_QUE = 'XX')

)
AND WQXX.WF_CRT_DTS_WQXX BETWEEN 'XX/XX/XXXX' AND 'XX/XX/XXXX'
) POP
GROUP BY
	YEAR(WF_CRT_DTS_WQXX) ,
	MONTH(WF_CRT_DTS_WQXX)
order by 
		YEAR(WF_CRT_DTS_WQXX) desc ,
	MONTH(WF_CRT_DTS_WQXX)
