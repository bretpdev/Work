LIBNAME  LEGEND  REMOTE  SERVER=LEGEND SLIBREF=work  ;
RSUBMIT LEGEND;

%let DB = DNFPUTDL;  *This is live;

LIBNAME PKUB DB2 DATABASE=&DB OWNER=PKUB;


PROC SQL;
	CONNECT TO DB2 (DATABASE=&DB);

	CREATE TABLE DEMO AS
		SELECT	
			*
		FROM	
			CONNECTION TO DB2 
				(
					SELECT DISTINCT
						PD10.DF_SPE_ACC_ID,
						PD24.DC_BKR_TYP,
						PD24.DD_BKR_FIL,
						CASE
							WHEN LN10.LC_STA_LON10 = 'D' THEN 'DECONVERTED'
							ELSE ' '
						END AS STATUS,
						0 AS COUNT
						
					FROM
						PKUB.PD10_PRS_NME PD10
					INNER JOIN PKUB.LN10_LON LN10
						ON LN10.BF_SSN = PD10.DF_PRS_ID
					INNER JOIN PKUB.PD24_PRS_BKR PD24
						ON PD24.DF_PRS_ID = PD10.DF_PRS_ID
					INNER JOIN PKUB.AY10_BR_LON_ATY AY10
						ON AY10.BF_SSN = PD10.DF_PRS_ID
						AND AY10.PF_REQ_ACT = 'BPOCR'
						AND AY10.LC_STA_ACTY10 = 'A'

					FOR READ ONLY WITH UR
				)
	;

	DISCONNECT FROM DB2;

	/*%PUT  SQLXRC= >>> &SQLXRC <<< ||| SQLXMSG= >>> &SQLXMSG >>> ;  ** INCLUDES ERROR MESSAGES TO SAS LOG  ;*/
	/*%SQLCHECK;*/
QUIT;

ENDRSUBMIT;

DATA BK7;
SET LEGEND.DEMO; 
WHERE DC_BKR_TYP = '07';
RUN;

DATA BK13;
SET LEGEND.DEMO; 
WHERE DC_BKR_TYP = '13';
RUN;

PROC EXPORT DATA= WORK.BK7 
            OUTFILE= "T:\SAS\NH 4919.xls" 
            DBMS=EXCEL REPLACE;
     SHEET="CHAPTER 7"; 
RUN;

PROC EXPORT DATA= WORK.BK13 
            OUTFILE= "T:\SAS\NH 4919.xls" 
            DBMS=EXCEL REPLACE;
     SHEET="CHAPTER 13"; 
RUN;


