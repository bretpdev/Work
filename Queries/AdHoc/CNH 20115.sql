
SELECT
	*,
	CASE
		WHEN LNXX.IC_LON_PGM IN ('DLSTFD', 'DLUNST') THEN 'Stafford'
		WHEN LNXX.IC_LON_PGM IN ('DLCNSL', 'DLSCCN', 'DLSCNS', 'DLSCSC', 'DLSCSL', 'DLSCST', 'DLSCUC', 'DLSCUN', 'DLSPCN', 'DLSSPL', 'DLUCNS', 'DLUSPL', 'DSCON') THEN 'Consolidation'
		ELSE 'ERROR:  LNXX.IC_LON_PGM of ' + LNXX.IC_LON_PGM + ' is unaccounted for.'
	END [LoanType],
	DATEADD(DAY, XXX, LNXX.LD_END_GRC_PRD) [StaffordStart],
	DATEADD(DAY, X, LNXX.LD_LON_X_DSB) [ConsolidationStart]
FROM
	LNXX_LON LNXX
	INNER JOIN 
	(
		SELECT
			*
		FROM
			LNXX_LON_RPS LNXX
		WHERE
			LNXX.LC_STA_LONXX = 'A'
	) LNXX ON LNXX.BF_SSN = LNXX.BF_SSN AND LNXX.LN_SEQ = LNXX.LN_SEQ
WHERE
	LNXX.LA_CUR_PRI > X.XX
	AND
	LNXX.LC_STA_LONXX = 'R'
	AND
	LNXX.IC_LON_PGM NOT IN ('DGPLUS', 'DLPCNS', 'DLPLGB', 'DLPLUS', 'DLSCPG', 'DLSCPL', 'DPLUS')
	AND
	LNXX.LC_TYP_SCH_DIS IN ('CX', 'CX', 'CX', 'IX')
	AND
	(
		( -- stafford
			LNXX.IC_LON_PGM IN ('DLSTFD', 'DLUNST') 
			AND
			DATEDIFF(YEAR, DATEADD(DAY, XXX, LNXX.LD_END_GRC_PRD), 'XXXX-XX-XX') > XX
		)
		OR
		( -- consolidation
			LNXX.IC_LON_PGM IN ('DLCNSL', 'DLSCCN', 'DLSCNS', 'DLSCSC', 'DLSCSL', 'DLSCST', 'DLSCUC', 'DLSCUN', 'DLSPCN', 'DLSSPL', 'DLUCNS', 'DLUSPL', 'DSCON')
			AND
			DATEDIFF(YEAR, DATEADD(DAY, X, LNXX.LD_LON_X_DSB), 'XXXX-XX-XX') > XX
		)
	)
ORDER BY
	LNXX.BF_SSN,
	LNXX.LN_SEQ