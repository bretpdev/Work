LIBNAME DUSTER REMOTE SERVER=DUSTER SLIBREF=WORK;
RSUBMIT;
LIBNAME OLWHRM1 DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;
PROC SQL;
	CREATE TABLE RPS AS
		SELECT DISTINCT
			LN10.BF_SSN,
			RS10.LN_RPS_SEQ
		FROM
			OLWHRM1.LN10_LON LN10
			JOIN OLWHRM1.RS10_BR_RPD RS10
				ON LN10.BF_SSN = RS10.BF_SSN
				AND LN10.IF_GTR IN ('000706', '000708', '000730', '000731', '000751', '000755', '000800', '000951')
				AND RS10.LC_STA_RPST10 = 'A'
			LEFT JOIN OLWHRM1.LN65_LON_RPS LN65
				ON RS10.BF_SSN = LN65.BF_SSN
				AND RS10.LN_RPS_SEQ = LN65.LN_RPS_SEQ
				AND LN65.LC_STA_LON65 = 'A'
		WHERE
			LN65.BF_SSN IS NULL
	;

	CREATE TABLE LN65 AS
		SELECT DISTINCT
			LN65.*
		FROM
			RPS
			JOIN OLWHRM1.LN65_LON_RPS LN65
				ON RPS.BF_SSN = LN65.BF_SSN
				AND RPS.LN_RPS_SEQ = LN65.LN_RPS_SEQ
	;

	CREATE TABLE LN66 AS
		SELECT DISTINCT
			LN66.*
		FROM
			RPS
			JOIN OLWHRM1.LN66_LON_RPS_SPF LN66
				ON RPS.BF_SSN = LN66.BF_SSN
				AND RPS.LN_RPS_SEQ = LN66.LN_RPS_SEQ
	;

	CREATE TABLE RS10 AS
		SELECT DISTINCT
			RS10.*
		FROM
			RPS
			JOIN OLWHRM1.RS10_BR_RPD RS10
				ON RPS.BF_SSN = RS10.BF_SSN
				AND RPS.LN_RPS_SEQ = RS10.LN_RPS_SEQ
	;

	CREATE TABLE RS05 AS
		SELECT
			RS05.*
		FROM
			RS10
			JOIN OLWHRM1.RS05_IBR_RPS RS05
				ON RS10.BF_SSN = RS05.BF_SSN
				AND RS10.BD_CRT_RS05 = RS05.BD_CRT_RS05
				AND RS10.BN_IBR_SEQ = RS05.BN_IBR_SEQ
	;
QUIT;
ENDRSUBMIT;

DATA LN65; SET DUSTER.LN65; RUN;
DATA LN66; SET DUSTER.LN66; RUN;
DATA RS10; SET DUSTER.RS10; RUN;
DATA RS05; SET DUSTER.RS05; RUN;

PROC EXPORT
		DATA=LN65
		OUTFILE='T:\SAS\RPS ABEND ERROR.XLSX'
		REPLACE;
RUN;

PROC EXPORT
		DATA=LN66
		OUTFILE='T:\SAS\RPS ABEND ERROR.XLSX'
		REPLACE;
RUN;

PROC EXPORT
		DATA=RS10
		OUTFILE='T:\SAS\RPS ABEND ERROR.XLSX'
		REPLACE;
RUN;

PROC EXPORT
		DATA=RS05
		OUTFILE='T:\SAS\RPS ABEND ERROR.XLSX'
		REPLACE;
RUN;


