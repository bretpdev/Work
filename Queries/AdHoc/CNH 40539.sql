USE CDW
GO

--exclude accounts already reviewed in CNH_XXXXXX.xlsx and CNH_XXXXX.xlsx spreadsheet
DECLARE @ALREADY_REVIEWED TABLE
(
	BF_SSN VARCHAR(X),
	DF_SPE_ACC_ID VARCHAR(XX)
);

INSERT INTO @ALREADY_REVIEWED
(
	BF_SSN,
	DF_SPE_ACC_ID
)
VALUES
--BF_SSN	DF_SPE_ACC_ID --CNH_XXXXXX.xlsx 
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),

--BF_SSN	DF_SPE_ACC_ID --CNH_XXXXXX.xlsx 
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX'),
('XXXXXXXXX','XXXXXXXXXX')

;
--SELECT distinct * FROM @ALREADY_REVIEWED

DROP TABLE IF EXISTS #BASE_DATA;

SELECT
	*
INTO 
	#BASE_DATA
FROM
	(
		SELECT
			PDXX.DF_SPE_ACC_ID,
			LNXX.BF_SSN,
			LNXX.LN_SEQ,
			LNXX.IC_LON_PGM,
			RS.LC_TYP_SCH_DIS AS CUR_SCH,
			LNXX.LC_TYP_SCH_DIS AS MAX_SCH,
			LKXX.PX_DSC_LNG,
			LNXX.LD_LON_X_DSB,
			COUNT(*) OVER (PARTITION BY LNXX.BF_SSN) AS LOANCOUNT,
			DENSE_RANK() OVER (PARTITION BY LNXX.BF_SSN ORDER BY LNXX.BF_SSN ) AS RNK
		FROM	
			CDW..LNXX_LON LNXX
			INNER JOIN CDW..PDXX_PRS_NME PDXX
				ON PDXX.DF_PRS_ID = LNXX.BF_SSN
			INNER JOIN CDW..DWXX_DW_CLC_CLU DWXX
				ON DWXX.BF_SSN = LNXX.BF_SSN
				AND DWXX.LN_SEQ = LNXX.LN_SEQ
			INNER JOIN CDW..LKXX_LS_CDE_LKP LKXX
				ON LKXX.PM_ATR = 'WC-DW-LON-STA'
				AND LKXX.PX_ATR_VAL = DWXX.WC_DW_LON_STA
			LEFT JOIN CDW.calc.RepaymentSchedules RS
				ON RS.BF_SSN = LNXX.BF_SSN
				AND RS.LN_SEQ = LNXX.LN_SEQ
				AND RS.CurrentGradation = X
			LEFT JOIN 
			(
				SELECT	
					LNXX.*
				FROM
					CDW..LNXX_LON_RPS LNXX
					INNER JOIN 
					(
						SELECT
							BF_SSN,
							LN_SEQ,
							MAX(LN_RPS_SEQ) AS LN_RPS_SEQ
						FROM
							CDW..LNXX_LON_RPS
						GROUP BY
							BF_SSN,
							LN_SEQ
					) MLNXX
						ON MLNXX.BF_SSN = LNXX.BF_SSN
						AND MLNXX.LN_SEQ = LNXX.LN_SEQ
						AND MLNXX.LN_RPS_SEQ = LNXX.LN_RPS_SEQ
			) LNXX	
				ON LNXX.BF_SSN = LNXX.BF_SSN
				AND LNXX.LN_SEQ = LNXX.LN_SEQ
			LEFT JOIN @ALREADY_REVIEWED AR --exclude accounts already reviewed
				ON LNXX.BF_SSN = AR.BF_SSN
				AND PDXX.DF_SPE_ACC_ID = AR.DF_SPE_ACC_ID
		WHERE
			AR.BF_SSN IS NULL
			AND LNXX.IC_LON_PGM IN 
			(--all consol loans
				 'DLUSPL'
				,'DLUCNS'
				,'DLSSPL'
				,'DLSCNS' 
				,'BAPCNS'  
				,'CNSLDN'  
				,'DLCNSL'  
				,'DLPCNS'  
				,'DLSCCN'  
				,'DLSCPG'  
				,'DLSCPL'  
				,'DLSCSC'  
				,'DLSCSL'  
				,'DLSCST'  
				,'DLSCUC'  
				,'DLSCUN'  
				,'DLSPCN'  
				,'DSCON'  
				,'DUCON'  
				,'HEALTH'  
				,'LAPCNS'  
				,'MAPCNS'  
				,'SPCNSL'  
				,'SUBCNS'  
				,'SUBSPC'  
				,'UNCNS'  
				,'UNSPC'  
			)  
			AND LNXX.LC_STA_LONXX = 'R'
			AND LNXX.LA_CUR_PRI > X.XX
		) P
WHERE 
	P.LOANCOUNT > X
--ORDER BY
--	DF_SPE_ACC_ID,
--	LN_SEQ
;
--select distinct * from #BASE_DATA 
--ORDER BY DF_SPE_ACC_ID, LN_SEQ

--nth iteration output sent as: CNH_XXXXXX.xlsx
SELECT DISTINCT
	BD.BF_SSN,
	BD.DF_SPE_ACC_ID,
	BD.LN_SEQ,
	BD.IC_LON_PGM, --added to Xth iteration output sent
	BD.LD_LON_X_DSB, --added to Xth iteration output sent
	BD.CUR_SCH AS CURRENT_SCHEDULE,
	BD.MAX_SCH AS OLD_SCHEDULE,
	BD.PX_DSC_LNG AS LOAN_STATUS
FROM
	#BASE_DATA BD
	INNER JOIN
	(
		SELECT
			DF_SPE_ACC_ID,
			COUNT(*) AS COUNTS
		FROM
			(
				SELECT DISTINCT
					DF_SPE_ACC_ID,
					MAX_SCH,
					CUR_SCH
				FROM
					#BASE_DATA
			)POP
		GROUP BY 
			DF_SPE_ACC_ID
		HAVING
			COUNT(*) > X
		--ORDER BY
		--	DF_SPE_ACC_ID
	) COUNTS
		ON BD.DF_SPE_ACC_ID = COUNTS.DF_SPE_ACC_ID
ORDER BY
	BD.DF_SPE_ACC_ID,
	BD.LN_SEQ
;



/************************************************************************************************************

Eliezer Cadena - XX/XX/XXXX XX:XX AM - In Progress

Using the resultes found in "CNH_XXXXXX" I need the following tables/fields. This is going to be used to complete a DCR, and reactivate the IDR schedules. 

LNXX
BF_SSN
LN_SEQ
LN_RPS_SEQ
OC_STA_LONXX

RSXX
BF_SSN
LN_RPS_SEQ
LC_STA_RPSTXX
*/

--from CNH_XXXXXX.xlsx
DECLARE @ACCTS TABLE (BF_SSN VARCHAR(X), DF_SPE_ACC_ID VARCHAR(XX), LN_SEQ VARCHAR(X));
INSERT INTO @ACCTS (BF_SSN, DF_SPE_ACC_ID, LN_SEQ) VALUES
--BF_SSN	DF_SPE_ACC_ID	LN_SEQ
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','XX'),
('XXXXXXXXX','XXXXXXXXXX','XX'),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','XX'),
('XXXXXXXXX','XXXXXXXXXX','XX'),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X '),
('XXXXXXXXX','XXXXXXXXXX','X ')

;
--SELECT * FROM @ACCTS

SELECT DISTINCT
	A.DF_SPE_ACC_ID,
	LNXX.BF_SSN,
	LNXX.LN_SEQ,
	LNXX.LN_RPS_SEQ,
	LNXX.LC_STA_LONXX
FROM
	CDW..LNXX_LON_RPS LNXX
	INNER JOIN @ACCTS A
		ON LNXX.BF_SSN = A.BF_SSN
		AND LNXX.LN_SEQ = A.LN_SEQ
ORDER BY
	A.DF_SPE_ACC_ID,
	--LNXX.LN_SEQ,
	LNXX.LN_RPS_SEQ
;

SELECT DISTINCT
	A.DF_SPE_ACC_ID,
	RSXX.BF_SSN,
	RSXX.LN_RPS_SEQ,
	RSXX.LC_STA_RPSTXX
FROM
	CDW..RSXX_BR_RPD RSXX
	INNER JOIN CDW..LNXX_LON_RPS LNXX
		ON LNXX.BF_SSN = RSXX.BF_SSN
		AND LNXX.LN_RPS_SEQ = RSXX.LN_RPS_SEQ
	INNER JOIN @ACCTS A
		ON LNXX.BF_SSN = A.BF_SSN
		AND LNXX.LN_SEQ = A.LN_SEQ
ORDER BY
	A.DF_SPE_ACC_ID,
	RSXX.LN_RPS_SEQ
;