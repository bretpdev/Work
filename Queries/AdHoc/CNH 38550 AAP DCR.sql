USE NobleCalls

GO

BEGIN TRANSACTION
	DECLARE @ERROR INT = X
	DECLARE @ROWCOUNT INT = X
	DECLARE @ExpectedCount INT = XXXXX

UPDATE
	AAP
SET
	AAP.ArcResponseCodeId = X
FROM
	NobleCalls..NobleCallHistory NCH
	INNER JOIN CLS..ArcAddProcessing AAP
		ON AAP.ArcAddProcessingId = NCH.ArcAddProcessingId
	INNER JOIN CDW..PDXX_PRS_NME PDXX
		ON PDXX.DF_SPE_ACC_ID = AAP.AccountNumber
	INNER JOIN CDW..AYXX_BR_LON_ATY AYXX
		ON AYXX.LN_ATY_SEQ = AAP.LN_ATY_SEQ
		AND AYXX.BF_SSN = PDXX.DF_PRS_ID
	INNER JOIN CDW..AYXX_ATY_CMT AYXX
		ON AYXX.BF_SSN = AYXX.BF_SSN
		AND AYXX.LN_ATY_SEQ = AYXX.LN_ATY_SEQ
	INNER JOIN CDW..AYXX_ATY_TXT AYXX
		ON AYXX.BF_SSN = AYXX.BF_SSN
		AND AYXX.LN_ATY_SEQ = AYXX.LN_ATY_SEQ
		AND AYXX.LN_ATY_CMT_SEQ = AYXX.LN_ATY_CMT_SEQ
WHERE
	NCH.DispositionCode = 'RP'
	AND NCH.RegionId = X --FED
	AND AYXX.PF_REQ_ACT = 'DDPHN'
	AND AYXX.PF_RSP_ACT = 'CNTCT'
	AND AYXX.LX_ATY LIKE '%contact-refuse%'

	SELECT @ROWCOUNT = @@ROWCOUNT, @ERROR = @@ERROR

IF @ROWCOUNT = @ExpectedCount AND @ERROR = X
	BEGIN
		PRINT 'Transaction committed'
		COMMIT TRANSACTION
		--ROLLBACK TRANSACTION
	END
ELSE
	BEGIN
		PRINT 'ROWCOUNT:  ' + CAST(@ROWCOUNT as VARCHAR(XX))
		PRINT 'ERROR:  ' + CAST(@ERROR as VARCHAR(XX))
		PRINT '!!!  Transaction NOT committed.  Contact a member of Application Development to have this error corrected.'
		ROLLBACK TRANSACTION
	END





  
  
 
  
