%LET NN = %STR(REQUIRED="FILEDSN=X:\PADR\ODBC\NelNetImport.dsn; update_lock_typ=nolock; bl_keepnulls=no");
LIBNAME NN ODBC &NN ;

LIBNAME  DUSTER  REMOTE  SERVER=DUSTER  SLIBREF=WORK;
RSUBMIT;
/*LIBNAME OLWHRM1 DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;*/
PROC SQL;
	CONNECT TO DB2 (DATABASE=DLGSUTWH);

	CREATE TABLE LN10 AS
		SELECT 
			*
		FROM 
			CONNECTION TO DB2 
				(
					SELECT
						LN10.BF_SSN,
						LN10.LN_SEQ,
						LN10.IF_GTR,
						LN10.LF_LON_ALT
						
					FROM	
						OLWHRM1.LN10_LON LN10
					WHERE	
						LN10.IF_GTR = '000749'
						AND LN10.LF_LON_ALT = ''
						AND LN10.LC_STA_LON10 = 'R'
/*						AND LN10.LA_CUR_PRI > 0*/

					FOR READ ONLY WITH UR
				)
	;

	DISCONNECT FROM DB2;

QUIT;
ENDRSUBMIT;

DATA LN10;
SET DUSTER.LN10;
RUN;

PROC SQL;
	CREATE TABLE NN_CLUID AS
		SELECT
			LN10.BF_SSN AS SSN,
			LN10.LN_SEQ AS LOAN_SEQ,
			LN10.IF_GTR AS GUARANTOR,
			LOANS.ln_cml_unique_loan_id AS CLUID
		FROM
			LN10 LN10
		LEFT JOIN NN.Loans LNS
			ON LNS.br_ssn = LN10.BF_SSN
			AND LNS.comp_ln_seq = LN10.LN_SEQ
		LEFT JOIN NN.ITELSQLDF_Loan LOANS
			ON LOANS.br_ssn = LNS.BR_SSN
			AND INPUT(LOANS.ln_num,best12.) = LNS.nn_ln_seq


;
QUIT;


PROC EXPORT DATA= WORK.NN_CLUID 
            OUTFILE= "T:\SAS\NH 16581.xls" 
            DBMS=EXCEL REPLACE;
     SHEET="A"; 
RUN;
