USE CDW
GO

DECLARE @StartDate DATE = 'XXXX-X-X'
DECLARE @EndDate DATE = GETDATE()

SELECT DISTINCT 
	PDXX.DF_SPE_ACC_ID,
	LNXX.BF_SSN
FROM
	CDW..PDXX_PRS_NME PDXX
	INNER JOIN CDW..LNXX_LON LNXX ON PDXX.DF_PRS_ID = LNXX.BF_SSN
	INNER JOIN CDW..DWXX_DW_CLC_CLU DWXX ON LNXX.BF_SSN = DWXX.BF_SSN AND LNXX.LN_SEQ = DWXX.LN_SEQ
	INNER JOIN OPENQUERY
	( -- not in local warehouse
		LEGEND,
		'
			SELECT
				PDXX.DF_PRS_ID,
				PDXX.DD_BKR_FIL
			FROM
				PKUB.PDXX_PRS_BKR PDXX
		'
	) PDXX ON PDXX.DF_PRS_ID = PDXX.DF_PRS_ID
WHERE	
	DWXX.WC_DW_LON_STA = 'XX'
	AND 
	LNXX.LA_CUR_PRI > X
	AND 
	PDXX.DD_BKR_FIL BETWEEN @StartDate AND @EndDate
