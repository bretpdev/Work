DECLARE @UheaaQueues TABLE
(
	UheaaQueueId INT IDENTITY(1,1),
	BusinessUnit VARCHAR(30) NOT NULL,
	Que CHAR(2) NOT NULL,
	ComplianceDays INT DEFAULT(30)
)

INSERT INTO @UheaaQueues
	(
		BusinessUnit,
		Que
	)
VALUES
	('Asset Management','4K'),
	('Asset Management','4X'),
	('Asset Management','AD'),
	('Asset Management','AQ'),
	('Asset Management','BC'),
	('Asset Management','DR'),
	('Asset Management','ED'),
	('Asset Management','EE'),
	('Asset Management','F0'),
	('Asset Management','F2'),
	('Asset Management','FA'),
	('Asset Management','GF'),
	('Asset Management','GG'),
	('Asset Management','H0'),
	('Asset Management','H1'),
	('Asset Management','HB'),
	('Asset Management','HF'),
	('Asset Management','HV'),
	('Asset Management','NA'),
	('Asset Management','NB'),
	('Asset Management','O6'),
	('Asset Management','OF'),
	('Asset Management','OK'),
	('Asset Management','OU'),
	('Asset Management','OV'),
	('Asset Management','OW'),
	('Asset Management','OZ'),
	('Asset Management','P0'),
	('Asset Management','RB'),
	('Asset Management','RZ'),
	('Asset Management','T0'),
	('Asset Management','TW'),
	('Asset Management','TX'),
	('Asset Management','U0'),
	('Asset Management','U1'),
	('Asset Management','U2'),
	('Asset Management','U4'),
	('Asset Management','US'),
	('Asset Management','V5'),
	('Asset Management','YZ'),
	('Asset Management','Z9'),
	('Asset Management','ZA'),
	('Asset Management','3A'),
	('Asset Management','20'),
	('Asset Management','21'),
	('Asset Management','22'),
	('Asset Management','23'),
	('Asset Management','24'),
	('Asset Management','25'),
	('Asset Management','26'),
	('Asset Management','27'),
	('Asset Management','28'),
	('Asset Management','29'),
	('Asset Management','30'),
	('Asset Management','31'),
	('Asset Management','32'),
	('Asset Management','34'),
	('Asset Management','3B'),
	('Asset Management','3I'),
	('Asset Management','3K'),
	('Asset Management','3L'),
	('Asset Management','3W'),
	('Asset Management','3X'),
	('Asset Management','3Z'),
	('Asset Management','44'),
	('Asset Management','4P'),
	('Asset Management','OB'),
	('Asset Management','P1'),
	('Asset Management','T1'),
	('Asset Management','T2'),
	('Asset Management','XB'),
	('Asset Management','4D'),
	('Asset Management','ER'),
	('Asset Management','F3'),
	('Asset Management','F8'),
	('Asset Management','GT'),
	('Asset Management','H7'),
	('Asset Management','LR'),
	('Asset Management','NC'),
	('Asset Management','NE'),
	('Asset Management','NF'),
	('Asset Management','NG'),
	('Asset Management','NH'),
	('Asset Management','O9'),
	('Asset Management','OC'),
	('Asset Management','OH'),
	('Asset Management','OL'),
	('Asset Management','R4'),
	('Asset Management','SV'),
	('Asset Management','ZP'),
	('Asset Management','55'),
	('Asset Management','BK'),
	('Asset Management','CQ'),
	('Asset Management','TB'),
	('Asset Management','I9'),
	('Asset Management','3B'),
	('Skip','JN'),
	('Skip','K8'),
	('Skip','IE'),
	('Skip','1R'),
	('Skip','7A'),
	('Skip','B2'),
	('Skip','BI'),
	('Skip','CO'),
	('Skip','CU'),
	('Skip','DV'),
	('Skip','E1'),
	('Skip','FJ'),
	('Skip','FY'),
	('Skip','GV'),
	('Skip','I1'),
	('Skip','I2'),
	('Skip','IA'),
	('Skip','IB'),
	('Skip','IC'),
	('Skip','IG'),
	('Skip','IH'),
	('Skip','II'),
	('Skip','IP'),
	('Skip','IR'),
	('Skip','IT'),
	('Skip','JL'),
	('Skip','JR'),
	('Skip','LX'),
	('Skip','PK'),
	('Skip','PU'),
	('Skip','TC'),
	('Skip','V1'),
	('Skip','V9'),
	('Skip','IJ'),
	('Skip','IK'),
	('Skip','D1'),
	('Skip','IS'),
	('Skip','IM'),
	('Skip','IQ'),
	('Skip','IO'),
	('Skip','B1'),
	('Skip','PC'),
	('Skip','KE'),
	('Skip','SR'),
	('Loan Servicing','1P'),
	('Loan Servicing','2A'),
	('Loan Servicing','5C'),
	('Loan Servicing','99'),
	('Loan Servicing','AP'),
	('Loan Servicing','AT'),
	('Loan Servicing','AW'),
	('Loan Servicing','CN'),
	('Loan Servicing','PM'),
	('Loan Servicing','PR'),
	('Loan Servicing','R0'),
	('Loan Servicing','RO'),
	('Loan Servicing','R1'),
	('Loan Servicing','R8'),
	('Loan Servicing','RX'),
	('Loan Servicing','SA'),
	('Loan Servicing','SF'),
	('Loan Servicing','SI'),
	('Loan Servicing','TU'),
	('Loan Servicing','V8'),
	('Loan Servicing','VB'),
	('Loan Servicing','VC'),
	('Loan Servicing','VR'),
	('Loan Servicing','X9'),
	('Loan Servicing','3A'),
	('Loan Servicing','1M'),
	('Loan Servicing','2M'),
	('Loan Servicing','2P'),
	('Loan Servicing','36'),
	('Loan Servicing','37'),
	('Loan Servicing','BR'),
	('Loan Servicing','GP'),
	('Loan Servicing','SO'),
	('Loan Servicing','60'),
	('Loan Servicing','CP'),
	('Loan Servicing','CV'),
	('Loan Servicing','DU'),
	('Loan Servicing','G8'),
	('Loan Servicing','MF'),
	('Loan Servicing','MS'),
	('Loan Servicing','R7'),
	('Loan Servicing','RR'),
	('Loan Servicing','YB'),
	('Loan Servicing','AH'),
	('Loan Servicing','BD'),
	('Loan Servicing','NO'),
	('Loan Servicing','S4'),
	('Loan Servicing','IR') --UheaaQueues


DECLARE @Queues TABLE (Que CHAR(2), ExistingInventory INT, NewlyReceived INT, Processed INT, RemainingInventory INT, ComplianceDeadline INT, EarliestUnprocessedDate Datetime, ReportDate Datetime)

INSERT INTO @Queues
EXEC(
	'
		DECLARE GLOBAL TEMPORARY TABLE SESSION.DATES (ReportDate  DATE) ON COMMIT PRESERVE ROWS; 
		INSERT INTO SESSION.DATES(ReportDate) VALUES(CURRENT DATE);
		INSERT INTO SESSION.DATES(ReportDate) VALUES(CURRENT DATE - 1 DAY);
		INSERT INTO SESSION.DATES(ReportDate) VALUES(CURRENT DATE - 2 DAYS);
		INSERT INTO SESSION.DATES(ReportDate) VALUES(CURRENT DATE - 3 DAYS);
		INSERT INTO SESSION.DATES(ReportDate) VALUES(CURRENT DATE - 4 DAYS);
		INSERT INTO SESSION.DATES(ReportDate) VALUES(CURRENT DATE - 5 DAYS);
		INSERT INTO SESSION.DATES(ReportDate) VALUES(CURRENT DATE - 6 DAYS);

		SELECT
			WQ21.WF_QUE AS Que,
			SUM(CASE WHEN DAYS(WQ21.WD_ACT_REQ) < DAYS(D.ReportDate) AND DAYS(COALESCE(AY10.LD_ATY_RSP, ''2099-01-01'')) >= DAYS(D.ReportDate) THEN 1 ELSE 0 END) AS ExistingInventory,
			SUM(CASE WHEN DAYS(WQ21.WD_ACT_REQ) = DAYS(D.ReportDate) THEN 1 ELSE 0 END) AS NewlyReceived,
			SUM(CASE WHEN DAYS(AY10.LD_ATY_RSP) = DAYS(D.ReportDate) THEN 1 ELSE 0 END) AS Processed,
			SUM(CASE WHEN DAYS(WQ21.WD_ACT_REQ) <= DAYS(D.ReportDate) AND DAYS(COALESCE(AY10.LD_ATY_RSP, ''2099-01-01'')) > DAYS(D.ReportDate) THEN 1 ELSE 0 END) AS RemainingInventory,
			30 AS ComplianceDeadline,
			MIN(CASE WHEN WQ21.WC_STA_WQUE20 NOT IN (''X'',''C'') THEN WQ21.WD_ACT_REQ ELSE ''2099-01-01'' END) AS EarliestUnprocessedDate,
			D.ReportDate
		FROM
			SESSION.DATES D
			CROSS JOIN OLWHRM1.WQ21_TSK_QUE_HST WQ21
			INNER JOIN OLWHRM1.AY10_BR_LON_ATY AY10
				ON AY10.BF_SSN = WQ21.BF_SSN 
				AND AY10.LN_ATY_SEQ = WQ21.LN_ATY_SEQ
		WHERE
			WQ21.WF_QUE IN (''1P'',''2A'',''5C'',''99'',''AP'',''AT'',''AW'',''CN'',''PM'',''PR'',''R0'',''RO'',''R1'',''R8'',''RX'',''SA'',''SF'',
			''SI'',''TU'',''V8'',''VB'',''VC'',''VR'',''X9'',''3A'',''1M'',''2M'',''2P'',''36'',''37'',''BR'',''GP'',''SO'',''60'',''CP'',''CV'',''DU'',
			''G8'',''MF'',''MS'',''R7'',''RR'',''YB'',''AH'',''BD'',''NO'',''S4'',''IR'',''JN'',''K8'',''IE'',''1R'',''7A'',''B2'',''BI'',''CO'',''CU'',
			''DV'',''E1'',''FJ'',''FY'',''GV'',''I1'',''I2'',''IA'',''IB'',''IC'',''IG'',''IH'',''II'',''IP'',''IR'',''IT'',''JL'',''JR'',''LX'',''PK'',
			''PU'',''TC'',''V1'',''V9'',''IJ'',''IK'',''D1'',''IS'',''IM'',''IQ'',''IO'',''B1'',''PC'',''KE'',''SR'',''4K'',''4X'',''AD'',''AQ'',''BC'',
			''DR'',''ED'',''EE'',''F0'',''F2'',''FA'',''GF'',''GG'',''H0'',''H1'',''HB'',''HF'',''HV'',''NA'',''NB'',''O6'',''OF'',''OK'',''OU'',''OV'',
			''OW'',''OZ'',''P0'',''RB'',''RZ'',''T0'',''TW'',''TX'',''U0'',''U1'',''U2'',''U4'',''US'',''V5'',''YZ'',''Z9'',''ZA'',''3A'',''20'',''21'',
			''22'',''23'',''24'',''25'',''26'',''27'',''28'',''29'',''30'',''31'',''32'',''34'',''3B'',''3I'',''3K'',''3L'',''3W'',''3X'',''3Z'',''44'',
			''4P'',''OB'',''P1'',''T1'',''T2'',''XB'',''4D'',''ER'',''F3'',''F8'',''GT'',''H7'',''LR'',''NC'',''NE'',''NF'',''NG'',''NH'',''O9'',''OC'',
			''OH'',''OL'',''R4'',''SV'',''ZP'',''55'',''BK'',''CQ'',''TB'',''I9'',''3B'')
		GROUP BY
			WQ21.WF_QUE,
			D.ReportDate;
	'
) AT DUSTER

SELECT
	UQ.BusinessUnit, 
	UQ.Que,
	ISNULL(Q.ExistingInventory,0) AS ExistingInventory, 
	ISNULL(Q.NewlyReceived,0) AS NewlyReceived,
	ISNULL(Q.Processed,0) AS Processed,
	ISNULL(Q.RemainingInventory,0) AS RemainingInventory,
	ISNULL(Q.ComplianceDeadline,0) AS ComplianceDeadline,
	Q.EarliestUnprocessedDate AS EarliestUnprocessedDate,
	CASE WHEN Q.EarliestUnprocessedDate = '2099-01-01' THEN 0 ELSE CentralData.dbo.BusinessDaysDiff(Q.EarliestUnprocessedDate, GETDATE()) END AS BusinessDaysInProcess,
	Q.ReportDate
FROM
	@UheaaQueues UQ
	LEFT OUTER JOIN @Queues Q
	ON Q.Que = UQ.Que
