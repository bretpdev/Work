SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;
GO

USE CDW;
GO

--interest rate
SELECT DISTINCT
	LNXX.BF_SSN AS BorrowerSSN
	,LNXX.LN_SEQ AS LoanSequenceNumber
	,LNXX.IC_LON_PGM AS LoanProgramCode
	,LNXX.LD_ITR_EFF_BEG AS InterestRateBeginningEffectiveDate
	,LNXX.LR_ITR AS InterestRate
FROM
	LNXX_LON LNXX
	INNER JOIN WQXX_TSK_QUE WQXX
		ON LNXX.BF_SSN = WQXX.BF_SSN
	INNER JOIN LNXX_INT_RTE_HST LNXX
		ON LNXX.BF_SSN = LNXX.BF_SSN
		AND LNXX.LN_SEQ = LNXX.LN_SEQ
WHERE
	LNXX.LA_CUR_PRI > X.XX
	AND LNXX.LC_STA_LONXX = 'R'
	AND WQXX.WF_QUE = 'XX'
	AND WQXX.WF_SUB_QUE = 'XX'
	AND LNXX.LC_STA_LONXX = 'A'
ORDER BY
	LNXX.BF_SSN
	,LNXX.LN_SEQ
	,LNXX.LD_ITR_EFF_BEG
;

--repayment
SELECT DISTINCT
	LNXX.BF_SSN AS BorrowerSSN
	,DWXX.WD_LON_RPD_SR AS RepaymentStartDate
FROM
	LNXX_LON LNXX
	INNER JOIN WQXX_TSK_QUE WQXX
		ON LNXX.BF_SSN = WQXX.BF_SSN
	INNER JOIN DWXX_DW_CLC_CLU DWXX
		ON LNXX.BF_SSN = DWXX.BF_SSN
		AND LNXX.LN_SEQ = DWXX.LN_SEQ
WHERE
	LNXX.LA_CUR_PRI > X.XX
	AND LNXX.LC_STA_LONXX = 'R'
	AND WQXX.WF_QUE = 'XX'
	AND WQXX.WF_SUB_QUE = 'XX'
ORDER BY
	LNXX.BF_SSN
	,DWXX.WD_LON_RPD_SR
;

--deferment
SELECT DISTINCT
	LNXX.BF_SSN AS BorrowerSSN
	,DFXX.LD_DFR_REQ_BEG AS DefermentBeginDate
	,DFXX.LD_DFR_REQ_END AS DefermentEndDate
FROM
	LNXX_LON LNXX
	INNER JOIN WQXX_TSK_QUE WQXX
		ON LNXX.BF_SSN = WQXX.BF_SSN
	INNER JOIN DFXX_BR_DFR_REQ DFXX
		ON LNXX.BF_SSN = DFXX.BF_SSN		
WHERE
	LNXX.LA_CUR_PRI > X.XX
	AND LNXX.LC_STA_LONXX = 'R'
	AND WQXX.WF_QUE = 'XX'
	AND WQXX.WF_SUB_QUE = 'XX'
	AND DFXX.LC_STA_DFRXX = 'A'
	AND DFXX.LC_DFR_STA = 'A'
ORDER BY
	LNXX.BF_SSN
	,DFXX.LD_DFR_REQ_BEG
	,DFXX.LD_DFR_REQ_END
;

--disbursement
SELECT 
	LNXX.BF_SSN AS BorrowerSSN
	,LNXX.LD_DSB AS DisbursementDate
	,SUM(LNXX.LA_DSB) AS DisbursementAmount
FROM
	LNXX_LON LNXX
	INNER JOIN WQXX_TSK_QUE WQXX
		ON LNXX.BF_SSN = WQXX.BF_SSN
	LEFT JOIN LNXX_DSB LNXX
		ON LNXX.BF_SSN = LNXX.BF_SSN
		AND LNXX.LN_SEQ = LNXX.LN_SEQ
WHERE
	LNXX.LA_CUR_PRI > X.XX
	AND LNXX.LC_STA_LONXX = 'R'
	AND WQXX.WF_QUE = 'XX'
	AND WQXX.WF_SUB_QUE = 'XX'
GROUP BY
	LNXX.BF_SSN
	,LNXX.LD_DSB
ORDER BY
	LNXX.BF_SSN
	,LNXX.LD_DSB
;
