USE UDW
GO

SELECT DISTINCT
	'CURRENT' AS [PERIOD],
	CASE 
		WHEN FB10.LC_FOR_TYP IN ('02','09','10','14','15','11') THEN 'ADMIN'
		WHEN FB10.LC_FOR_TYP IN ('05','28','31') THEN 'DISCRETIONARY'
		ELSE 'MANDATORY'
	END AS [TYPE],
	COUNT(DISTINCT FB10.BF_SSN) AS BC
	
FROM
	UDW..FB10_BR_FOR_REQ FB10
	INNER JOIN UDW..LK10_LS_CDE_LKP LK10
		ON LK10.PM_ATR = 'LC-FOR-TYP'
		AND LK10.PX_ATR_VAL = FB10.LC_FOR_TYP
	INNER JOIN UDW..LN60_BR_FOR_APV LN60
		ON LN60.BF_SSN = FB10.BF_SSN
		AND LN60.LF_FOR_CTL_NUM = FB10.LF_FOR_CTL_NUM
	INNER JOIN UDW..LN10_LON LN10
		ON LN10.BF_SSN = LN60.BF_SSN
		AND LN10.LN_SEQ = LN60.LN_SEQ
		AND LN10.LA_CUR_PRI > 0
		AND LN10.LC_STA_LON10 = 'R'
WHERE
	LN60.LC_STA_LON60 = 'A'
	AND FB10.LC_STA_FOR10 = 'A'
	AND FB10.LC_FOR_STA = 'A' --denied records cant have this active
	AND LN60.LC_FOR_RSP != '003'
	AND	cast(GETDATE() as date) BETWEEN LN60.LD_FOR_BEG AND LN60.LD_FOR_END
group by
CASE 
		WHEN FB10.LC_FOR_TYP IN ('02','09','10','14','15','11') THEN 'ADMIN'
		WHEN FB10.LC_FOR_TYP IN ('05','28','31') THEN 'DISCRETIONARY'
		ELSE 'MANDATORY'
	END

	
	UNION ALL
SELECT
'CURRENT' AS [PERIOD],
	CASE 
		WHEN DF10.LC_DFR_TYP IN ('13') THEN 'UNEMPLOYMENT DEFERMENT'
		WHEN DF10.LC_DFR_TYP IN ('29') THEN 'ECONOMIC HARDSHIP DEFERMENT'
		WHEN DF10.LC_DFR_TYP IN ('04','40','38') THEN 'MILITARY DEFERMENT'
		ELSE 'OTHER DEFERMENT'
	END AS [TYPE],
	COUNT(DISTINCT DF10.BF_SSN) AS BC
FROM
	UDW..DF10_BR_DFR_REQ DF10
	INNER JOIN UDW..LN50_BR_DFR_APV LN50
		ON LN50.BF_SSN = DF10.BF_SSN
		AND LN50.LF_DFR_CTL_NUM = DF10.LF_DFR_CTL_NUM
	INNER JOIN UDW..LN10_LON LN10
		ON LN10.BF_SSN = LN50.BF_SSN
		AND LN10.LN_SEQ = LN50.LN_SEQ
		AND LN10.LA_CUR_PRI > 0
		AND LN10.LC_STA_LON10 = 'R'
WHERE
	LN50.LC_STA_LON50 = 'A'
	AND DF10.LC_STA_DFR10 = 'A'
	AND DF10.LC_DFR_STA = 'A' --denied records cant have this active
	AND LN50.LC_DFR_RSP != '003'
	AND	cast(GETDATE() as date) BETWEEN LN50.LD_DFR_BEG AND LN50.LD_DFR_END
group by
CASE 
		WHEN DF10.LC_DFR_TYP IN ('13') THEN 'UNEMPLOYMENT DEFERMENT'
		WHEN DF10.LC_DFR_TYP IN ('29') THEN 'ECONOMIC HARDSHIP DEFERMENT'
		WHEN DF10.LC_DFR_TYP IN ('04','40','38') THEN 'MILITARY DEFERMENT'
		ELSE 'OTHER DEFERMENT'
	END


	UNION ALL

SELECT DISTINCT
'2019 - 2020' AS [PERIOD],
	CASE 
		WHEN FB10.LC_FOR_TYP IN ('02','09','10','14','15','11') THEN 'ADMIN'
		WHEN FB10.LC_FOR_TYP IN ('05','28','31') THEN 'DISCRETIONARY'
		ELSE 'MANDATORY'
	END AS [TYPE],
	COUNT(DISTINCT FB10.BF_SSN) AS BC
FROM
	UDW..FB10_BR_FOR_REQ FB10
		INNER JOIN UDW..LK10_LS_CDE_LKP LK10
		ON LK10.PM_ATR = 'LC-FOR-TYP'
		AND LK10.PX_ATR_VAL = FB10.LC_FOR_TYP
	INNER JOIN UDW..LN60_BR_FOR_APV LN60
		ON LN60.BF_SSN = FB10.BF_SSN
		AND LN60.LF_FOR_CTL_NUM = FB10.LF_FOR_CTL_NUM
	INNER JOIN UDW..LN10_LON LN10
		ON LN10.BF_SSN = LN60.BF_SSN
		AND LN10.LN_SEQ = LN60.LN_SEQ
		AND LN10.LA_CUR_PRI > 0
		AND LN10.LC_STA_LON10 = 'R'
WHERE
	LN60.LC_STA_LON60 = 'A'
	AND FB10.LC_STA_FOR10 = 'A'
	AND FB10.LC_FOR_STA = 'A' --denied records cant have this active
	AND LN60.LC_FOR_RSP != '003'
	AND	cast('04/30/2019' as date) BETWEEN LN60.LD_FOR_BEG AND LN60.LD_FOR_END
group by 
CASE 
		WHEN FB10.LC_FOR_TYP IN ('02','09','10','14','15','11') THEN 'ADMIN'
		WHEN FB10.LC_FOR_TYP IN ('05','28','31') THEN 'DISCRETIONARY'
		ELSE 'MANDATORY'
	END

	UNION ALL

SELECT
'2019 - 2020' AS [PERIOD],
	CASE 
		WHEN DF10.LC_DFR_TYP IN ('13') THEN 'UNEMPLOYMENT DEFERMENT'
		WHEN DF10.LC_DFR_TYP IN ('29') THEN 'ECONOMIC HARDSHIP DEFERMENT'
		WHEN DF10.LC_DFR_TYP IN ('04','40','38') THEN 'MILITARY DEFERMENT'
		ELSE 'OTHER DEFERMENT'
	END AS [TYPE],
	COUNT(DISTINCT DF10.BF_SSN) AS BC
FROM
	UDW..DF10_BR_DFR_REQ DF10
	INNER JOIN UDW..LN50_BR_DFR_APV LN50
		ON LN50.BF_SSN = DF10.BF_SSN
		AND LN50.LF_DFR_CTL_NUM = DF10.LF_DFR_CTL_NUM
	INNER JOIN UDW..LN10_LON LN10
		ON LN10.BF_SSN = LN50.BF_SSN
		AND LN10.LN_SEQ = LN50.LN_SEQ
		AND LN10.LA_CUR_PRI > 0
		AND LN10.LC_STA_LON10 = 'R'
WHERE
	LN50.LC_STA_LON50 = 'A'
	AND DF10.LC_STA_DFR10 = 'A'
	AND DF10.LC_DFR_STA = 'A' --denied records cant have this active
	AND LN50.LC_DFR_RSP != '003'
	AND	cast('04/30/2019' as date) BETWEEN LN50.LD_DFR_BEG AND LN50.LD_DFR_END
group by
CASE 
		WHEN DF10.LC_DFR_TYP IN ('13') THEN 'UNEMPLOYMENT DEFERMENT'
		WHEN DF10.LC_DFR_TYP IN ('29') THEN 'ECONOMIC HARDSHIP DEFERMENT'
		WHEN DF10.LC_DFR_TYP IN ('04','40','38') THEN 'MILITARY DEFERMENT'
		ELSE 'OTHER DEFERMENT'
	END