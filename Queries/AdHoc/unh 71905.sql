SELECT DISTINCT
	pd01.DF_PRS_ID,
	PD01.DF_SPE_ACC_ID AS AccountNumber,
	DC11.AF_APL_ID AS ApplicationId,
	DC11.AF_APL_ID_SFX AS ApplicationSuffix,
	DC01.LF_CLM_ID AS ClaimId,
	LK01.PX_MDM_DSC AS LoanStatus
FROM 
	ODW..DC11_LON_FAT DC11 
	INNER JOIN ODW..PD01_PDM_INF PD01
		ON PD01.DF_PRS_ID = DC11.BF_SSN
	INNER JOIN
	(
		SELECT
			DC01.*
		FROM
			ODW..DC01_LON_CLM_INF DC01
			INNER JOIN 
			(
				SELECT 
					AF_APL_ID,
					AF_APL_ID_SFX,
					MAX(LF_CRT_DTS_DC10) AS LF_CRT_DTS_DC10
				FROM
					ODW..DC01_LON_CLM_INF
				WHERE
					LC_STA_DC10 IN ('03','04')
				GROUP BY
					AF_APL_ID,
					AF_APL_ID_SFX
			) MDC01
				ON MDC01.AF_APL_ID = DC01.AF_APL_ID
				AND MDC01.AF_APL_ID_SFX = DC01.AF_APL_ID_SFX
				AND MDC01.LF_CRT_DTS_DC10 = DC01.LF_CRT_DTS_DC10
	)DC01
		ON DC01.AF_APL_ID = DC11.AF_APL_ID
		AND DC01.AF_APL_ID_SFX = DC11.AF_APL_ID_SFX
	INNER JOIN ODW..LK01_LGS_CDE_LKP LK01
		ON LK01.PM_ATR = 'LC-STA-DC10'
		AND LK01.PX_CDE_VAL = DC01.LC_STA_DC10
	INNER JOIN 
	(
		SELECT
			DC11.*
		FROM
			ODW..DC11_LON_FAT DC11
			INNER JOIN
			(
				SELECT
					AF_APL_ID,
					AF_APL_ID_SFX,
					MAX(LF_CRT_DTS_DC11) AS LF_CRT_DTS_DC11
				FROM
					ODW..DC11_LON_FAT
				GROUP BY
					AF_APL_ID,
					AF_APL_ID_SFX
			)MDC11
				ON MDC11.AF_APL_ID = DC11.AF_APL_ID
				AND MDC11.AF_APL_ID_SFX = DC11.AF_APL_ID_SFX
				AND MDC11.LF_CRT_DTS_DC11 = DC11.LF_CRT_DTS_DC11
	) MP
		ON MP.AF_APL_ID = DC11.AF_APL_ID
		AND MP.AF_APL_ID_SFX = DC11.AF_APL_ID_SFX

WHERE 
	DC11.LD_TRX_ADJ > '03/12/2020'
	AND DC11.LC_REV_IND_TYP != ''
	AND MP.LC_REV_IND_TYP = ''


