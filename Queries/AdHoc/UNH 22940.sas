LIBNAME DUSTER REMOTE SERVER=DUSTER SLIBREF=WORK;
RSUBMIT;
LIBNAME OLWHRM1 DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;
PROC SQL;
	CREATE TABLE RF10 AS
		SELECT DISTINCT
			PD10.DF_SPE_ACC_ID as AccountNumber,
			PD10.DM_PRS_1 as BorrowerFirst,
			PD10.DM_PRS_MID as BorrowerMid,
			PD10.DM_PRS_LST as BorrowerLast,
			RF10.BF_SSN as BorrowerSSN,
			RF10.BF_RFR as RefSSN,
			RF10.BC_RFR_REL_BR as RefRelation,
			PD10R.DM_PRS_1 as RefFirst,
			PD10R.DM_PRS_MID as RefMid,
			PD10R.DM_PRS_LST as RefLast
		FROM
			OLWHRM1.RF10_RFR RF10
			INNER JOIN OLWHRM1.PD10_PRS_NME PD10
				ON PD10.DF_PRS_ID = RF10.BF_SSN
			LEFT OUTER JOIN OLWHRM1.PD10_PRS_NME PD10R
				on PD10R.DF_PRS_ID = RF10.BF_RFR
		GROUP BY PD10.DF_PRS_ID
		HAVING Count(RF10.BF_RFR) < 2
	;
QUIT;

ENDRSUBMIT;

DATA RF10; SET DUSTER.RF10; RUN;

PROC EXPORT
		DATA=RF10
		OUTFILE='T:\SAS\RF10 without 2 references.XLSX'
		REPLACE;
RUN;
