use udw
go

DECLARE @TARGET_DATE DATE = '01/01/2020';
DECLARE @SSN CHAR(9) = '';

WITH BAL AS
(
SELECT 
	BF_SSN,
	LN_SEQ,
	CAST(LD_FAT_EFF AS DATE) AS START_DATE,
	ISNULL(DATEADD(DAY, -1,CAST(LEAD(LD_FAT_EFF) OVER (PARTITION BY BF_SSN, LN_SEQ ORDER BY LN_FAT_SEQ) AS DATE)), '01/01/2099') AS END_DATE,
	SUM(LA_FAT_CUR_PRI) OVER(PARTITION BY BF_SSN, LN_SEQ ORDER BY LN_FAT_SEQ) AS BALANCE
FROM 
	UDW..LN90_FIN_ATY 
WHERE 
	BF_SSN = @SSN
	AND 
	(
		LC_FAT_REV_REA = ''
		OR LC_FAT_REV_REA IS NULL
	)
	AND LC_STA_LON90 = 'A'
)
SELECT
	* 
FROM
	BAL
WHERE
	@TARGET_DATE BETWEEN START_DATE AND END_DATE

	