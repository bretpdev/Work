SELECT	* FROM OPENQUERY(LEGEND,'
	SELECT DISTINCT
		LNXX.BF_SSN,
		LNXX.LN_SEQ,
		LNXX.LD_TRM_BEG,
		LNXX.LF_DOE_SCL_ORG,
		SDXX.LF_DOE_SCL_ENR_CUR,
		CASE
			WHEN LNXX.LF_DOE_SCL_ORG IN (
				 ''XXXXXXXX''
				,''XXXXXXXX''
				,''XXXXXXXX''
			)
			AND SDXX.LF_DOE_SCL_ENR_CUR IN (
				 ''XXXXXXXX''
				,''XXXXXXXX''
				,''XXXXXXXX''
			)
			THEN ''BOTH''
			WHEN LNXX.LF_DOE_SCL_ORG IN (
				 ''XXXXXXXX''
				,''XXXXXXXX''
				,''XXXXXXXX''
			)
			THEN ''ORIGINAL''
			WHEN SDXX.LF_DOE_SCL_ENR_CUR IN (
				 ''XXXXXXXX''
				,''XXXXXXXX''
				,''XXXXXXXX''
			)
			THEN ''TRANSFER''
		END AS MATCH
		,WQXX.PF_REQ_ACT
	FROM
		PKUB.LNXX_LON LNXX
		INNER JOIN PKUB.WQXX_TSK_QUE WQXX
			ON LNXX.BF_SSN = WQXX.BF_SSN
			AND WQXX.PF_REQ_ACT = ''DIFCR''
		LEFT JOIN PKUS.SDXX_STU_SPR SDXX
			ON LNXX.BF_SSN = SDXX.LF_STU_SSN
	WHERE
		DAYS(LNXX.LD_TRM_BEG) BETWEEN DAYS(''XXXX-XX-XX'') AND DAYS(''XXXX-XX-XX'')
		AND (
				LNXX.LF_DOE_SCL_ORG IN (
					 ''XXXXXXXX''
					,''XXXXXXXX''
					,''XXXXXXXX''
				)
				OR SDXX.LF_DOE_SCL_ENR_CUR IN (
					 ''XXXXXXXX''
					,''XXXXXXXX''
					,''XXXXXXXX''
				)
		)
	ORDER BY
		LNXX.LD_TRM_BEG
') 