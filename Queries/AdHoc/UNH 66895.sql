DROP TABLE IF EXISTS #POP
DROP TABLE IF EXISTS #POP1
select 
	FORB.*
	--PQ.* 
INTO #POP
 
	FROM
	(
		SELECT DISTINCT
			FB10.BF_SSN,
			FB10.LF_FOR_CTL_NUM,
			FB10.LC_FOR_TYP AS OLD_LC_FOR_TYP,
			PD10.DF_SPE_ACC_ID,
			CAST(LN60.LD_FOR_BEG AS DATE) AS LD_FOR_BEG,
			FB10.LF_LST_DTS_FB10
		FROM
			UDW..FB10_BR_FOR_REQ FB10
			INNER JOIN UDW..PD10_PRS_NME PD10
				ON PD10.DF_PRS_ID = FB10.BF_SSN
			INNER JOIN UDW..LN60_BR_FOR_APV LN60
				ON LN60.BF_SSN = FB10.BF_SSN
				AND LN60.LF_FOR_CTL_NUM = FB10.LF_FOR_CTL_NUM
			INNER JOIN UDW..LN10_LON LN10
				ON LN10.BF_SSN = LN60.BF_SSN
				AND LN10.LN_SEQ = LN60.LN_SEQ
				AND LN10.LA_CUR_PRI > 0
				AND LN10.LC_STA_LON10 = 'R'
		WHERE
			LN60.LC_STA_LON60 = 'A'
			AND FB10.LC_STA_FOR10 = 'A'
			AND FB10.LC_FOR_STA = 'A' --denied records cant have this active
			AND LN60.LC_FOR_RSP != '003'
			AND FB10.LC_FOR_TYP = '39'
			AND CAST(GETDATE() AS DATE)  BETWEEN CAST(LN60.LD_FOR_BEG AS DATE) AND CAST(LN60.LD_FOR_END AS DATE)
		
	) FORB

		


SELECT DISTINCT
	POP.BF_SSN, 
	--POP.LD_FOR_BEG,
	--LN60.LD_FOR_BEG,
	--LN60.LD_FOR_END,
	--fb10.LD_CRT_REQ_FOR,
	--fb10.LF_USR_CRT_REQ_FOR,
	LN60.LN_SEQ,
	FB10.LF_FOR_CTL_NUM,
	FB10.LC_FOR_TYP,
	pop.LF_LST_DTS_FB10
FROM 
	#POP POP
	INNER JOIN UDW..FB10_BR_FOR_REQ FB10
		ON POP.BF_SSN = FB10.BF_SSN
	INNER JOIN UDW..PD10_PRS_NME PD10
		ON PD10.DF_PRS_ID = FB10.BF_SSN
	INNER JOIN UDW..LN60_BR_FOR_APV LN60
		ON LN60.BF_SSN = FB10.BF_SSN
		AND LN60.LF_FOR_CTL_NUM = FB10.LF_FOR_CTL_NUM
	INNER JOIN UDW..LN10_LON LN10
		ON LN10.BF_SSN = LN60.BF_SSN
		AND LN10.LN_SEQ = LN60.LN_SEQ
		AND LN10.LA_CUR_PRI > 0
		AND LN10.LC_STA_LON10 = 'R'
WHERE
	FB10.LC_FOR_TYP = '09'
	--AND DATEADD(DAY, 1, LN60.LD_FOR_END) = POP.LD_FOR_BEG
	AND FB10.LD_CRT_REQ_FOR >= '03/13/2020'



select 
	FORB.*
	--PQ.* 
INTO #POP1
 
	FROM
	(
		SELECT DISTINCT
			FB10.BF_SSN,
			FB10.LF_FOR_CTL_NUM,
			FB10.LC_FOR_TYP AS OLD_LC_FOR_TYP,
			PD10.DF_SPE_ACC_ID,
			CAST(LN60.LD_FOR_BEG AS DATE) AS LD_FOR_BEG,
			FB10.LF_LST_DTS_FB10
		FROM
			UDW..FB10_BR_FOR_REQ FB10
			INNER JOIN UDW..PD10_PRS_NME PD10
				ON PD10.DF_PRS_ID = FB10.BF_SSN
			INNER JOIN UDW..LN60_BR_FOR_APV LN60
				ON LN60.BF_SSN = FB10.BF_SSN
				AND LN60.LF_FOR_CTL_NUM = FB10.LF_FOR_CTL_NUM
			INNER JOIN UDW..LN10_LON LN10
				ON LN10.BF_SSN = LN60.BF_SSN
				AND LN10.LN_SEQ = LN60.LN_SEQ
				AND LN10.LA_CUR_PRI > 0
				AND LN10.LC_STA_LON10 = 'R'
		WHERE
			LN60.LC_STA_LON60 = 'A'
			AND FB10.LC_STA_FOR10 = 'A'
			AND FB10.LC_FOR_STA = 'A' --denied records cant have this active
			AND LN60.LC_FOR_RSP != '003'
			AND FB10.LC_FOR_TYP = '40'
			AND CAST(GETDATE() AS DATE)  BETWEEN CAST(LN60.LD_FOR_BEG AS DATE) AND CAST(LN60.LD_FOR_END AS DATE)
		
	) FORB

		


