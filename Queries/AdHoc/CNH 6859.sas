LIBNAME XL 'T:\Split Loan Transfer.xlsx';

DATA SOURCE;
      SET XL.'SHEETX$'N;
      BF_SSN = STRIP(COMPRESS(BORROWER_SSN,'-'));
      FORMAT BF_SSN $X.;
RUN;


LIBNAME  LEGEND  REMOTE  SERVER=LEGEND SLIBREF=WORK;
DATA LEGEND.SOURCE; *Send data to legend;
SET SOURCE;
RUN;


RSUBMIT LEGEND;
LIBNAME PKUB DBX DATABASE=DNFPUTDL OWNER=PKUB;

PROC SQL;
	CREATE TABLE POP AS
		SELECT DISTINCT	
			S.*,
			LNXX.LD_LON_GTR FORMAT MMDDYYXX.,
			FSXX.LF_FED_AWD || PUT(FSXX.LN_FED_AWD_SEQ, ZX.) AS AWARD_ID,
			LNXX.LC_FED_PGM_YR 
		FROM
			SOURCE S
			INNER JOIN PKUB.PDXX_PRS_NME PDXX
				ON S.BF_SSN = PDXX.DF_PRS_ID
			INNER JOIN PKUB.LNXX_LON LNXX	
				ON LNXX.BF_SSN = PDXX.DF_PRS_ID
			INNER JOIN PKUB.FSXX_DL_LON FSXX
				ON FSXX.BF_SSN = LNXX.BF_SSN
				AND FSXX.LN_SEQ = LNXX.LN_SEQ
;
QUIT;
ENDRSUBMIT;

DATA POP;
	SET LEGEND.POP;
RUN;

PROC EXPORT DATA = WORK.POP 
            OUTFILE = "T:\NH XXXX.xlsx" 
            DBMS = EXCEL
			REPLACE;
     SHEET="SheetX"; 
RUN;
