SELECT
	PDXX.DF_SPE_ACC_ID,
	--LNXX.BF_SSN,
	LNXX.LN_SEQ,
	LNXX.IC_LON_PGM,
	LNXX.LD_LON_X_DSB,
	DWXX.WC_DW_LON_STA
	--DWXXDiff.LN_SEQ AS DIFF_SEQ,
	--DWXXDiff.IC_LON_PGM AS DIFF_PGM,
	--DWXXDiff.LD_LON_X_DSB as DIFF_DSB,
	--DWXXDiff.WC_DW_LON_STA AS DIFF_STA

FROM
	CDW..PDXX_PRS_NME PDXX	
	INNER JOIN CDW..LNXX_LON LNXX
		ON LNXX.BF_SSN = PDXX.DF_PRS_ID
	INNER JOIN CDW..DWXX_DW_CLC_CLU DWXX
		ON LNXX.BF_SSN = DWXX.BF_SSN
		AND LNXX.LN_SEQ = DWXX.LN_SEQ
--This is grabbing loans of different statuses for the same borrower
	INNER JOIN
	( 
		SELECT
			DWXXInner.BF_SSN,
			DWXXInner.LN_SEQ,
			LNXXInner.LD_LON_X_DSB,
			DWXXInner.WC_DW_LON_STA,
			LNXXInner.IC_LON_PGM
			--,LNXXInner.LF_STU_SSN
		FROM
			CDW..DWXX_DW_CLC_CLU DWXXInner
			INNER JOIN CDW..LNXX_LON LNXXInner
				ON DWXXInner.BF_SSN = LNXXInner.BF_SSN
				AND DWXXInner.LN_SEQ = LNXXInner.LN_SEQ
				AND LNXXInner.IC_LON_PGM IN ('DLUCNS','DLSCNS')
				AND LNXXInner.LA_CUR_PRI > X
				AND LNXXInner.LC_STA_LONXX = 'R'
	) DWXXDiff
		ON DWXX.BF_SSN = DWXXDiff.BF_SSN
		AND DWXX.LN_SEQ != DWXXDiff.LN_SEQ
		AND LNXX.LD_LON_X_DSB = DWXXDiff.LD_LON_X_DSB
		AND DWXX.WC_DW_LON_STA != DWXXDiff.WC_DW_LON_STA
WHERE
	LNXX.IC_LON_PGM IN ('DLUCNS','DLSCNS')
	AND LNXX.LA_CUR_PRI > X
	AND LNXX.LC_STA_LONXX = 'R'
ORDER BY
	PDXX.DF_SPE_ACC_ID,
	LNXX.LN_SEQ