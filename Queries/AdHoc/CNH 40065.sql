SELECT * into #data FROM OPENQUERY(LEGEND,
'
SELECT DISTINCT
	PDXX.DF_SPE_ACC_ID,
	WQXX.WF_CRT_DTS_WQXX AS DATE_TASK_CREATED,
	LKXX.PX_DSC_MDM AS CURRENT_STATUS,
	MAX(LN_DLQ_MAX) OVER (PARTITION BY LNXX.BF_SSN) AS LN_DLQ_MAX,
	LNXX.LD_RPT_CRB,
	LNXX.LC_RPT_STA_CRB
FROM
	PKUB.WQXX_TSK_QUE WQXX
	INNER JOIN PKUB.AYXX_BR_LON_ATY AYXX
		ON AYXX.BF_SSN = WQXX.BF_SSN
		AND AYXX.LN_ATY_SEQ = WQXX.LN_ATY_SEQ
	INNER JOIN PKUB.LNXX_LON_ATY LNXX
		ON LNXX.BF_SSN = AYXX.BF_SSN
		AND LNXX.LN_ATY_SEQ = AYXX.LN_ATY_SEQ
	INNER JOIN PKUB.PDXX_PRS_NME PDXX
		ON PDXX.DF_PRS_ID = WQXX.BF_SSN
	INNER JOIN PKUB.DWXX_DW_CLC_CLU DWXX
		ON DWXX.BF_SSN = WQXX.BF_SSN
		AND DWXX.LN_SEQ = LNXX.LN_SEQ
	INNER JOIN PKUB.LKXX_LS_CDE_LKP LKXX
		ON LKXX.PM_ATR = ''WC-DW-LON-STA''
		AND LKXX.PX_ATR_VAL = DWXX.WC_DW_LON_STA
	LEFT JOIN PKUB.LNXX_LON_DLQ_HST LNXX
		ON LNXX.BF_SSN = WQXX.BF_SSN
		AND LNXX.LC_STA_LONXX = ''X''
	LEFT JOIN PKUB.LNXX_LON_CRB_RPT LNXX
		ON LNXX.BF_SSN = WQXX.BF_SSN
		AND LNXX.LC_RPT_STA_CRB IN (''XX'',''XX'',''XX'',''XX'',''XX'')
		AND LNXX.LD_RPT_CRB >= ''XX/XX/XXXX''
		AND LNXX.LD_RPT_CRB <= ''XX/XX/XXXX''
WHERE
	WF_QUE = ''XX''
	AND WF_SUB_QUE = ''XX''

WITH UR
')