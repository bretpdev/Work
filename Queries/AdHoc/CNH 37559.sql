SELECT
	PDXX.DF_SPE_ACC_ID,
	LNXX.LN_SEQ,
	LNXX.LD_END_GRC_PRD,
	SDXX.LD_SCL_SPR,
	DATEDIFF(DAY,SDXX.LD_SCL_SPR,LNXX.LD_END_GRC_PRD)
FROM
	CDW..PDXX_PRS_NME PDXX
	INNER JOIN CDW..LNXX_LON LNXX
		ON LNXX.BF_SSN = PDXX.DF_PRS_ID
	INNER JOIN 
	(
		SELECT
			LF_STU_SSN,
			MAX(LD_SCL_SPR) AS LD_SCL_SPR
		FROM
			CDW..SDXX_STU_SPR 
		WHERE
			LC_STA_STUXX = 'A'
		GROUP BY
			LF_STU_SSN
	) SDXX
		ON SDXX.LF_STU_SSN = LNXX.LF_STU_SSN
		--AND DATEDIFF(DAY,SDXX.LD_SCL_SPR,LNXX.LD_END_GRC_PRD) >= XXX
WHERE
	LNXX.IC_LON_PGM IN ('DLSTFD','DLUNST')
	AND LNXX.LD_END_GRC_PRD >= SDXX.LD_SCL_SPR
