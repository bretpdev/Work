LIBNAME LEGEND REMOTE SERVER=LEGEND SLIBREF=WORK;
RSUBMIT;
LIBNAME PKUB DBX DATABASE=DNFPUTDL OWNER=PKUB;

DATA REDEF;
	SET LNXX_LON;
	WHERE LC_STA_LONXX = 'L';
RUN;

PROC SQL;
	CREATE TABLE DETAIL AS
		SELECT DISTINCT
			LNXX.BF_SSN,
			LNXX.LN_SEQ,
			LNXX.LA_CUR_PRI,
			DWXX.WA_TOT_BRI_OTS,
			LNXX.LD_STA_LONXX
		FROM
			PKUB.LNXX_LON LNXX
			JOIN PKUB.DWXX_DW_CLC_CLU DWXX
				ON LNXX.BF_SSN = DWXX.BF_SSN
				AND LNXX.LN_SEQ = DWXX.LN_SEQ
		WHERE 
			LNXX.LC_STA_LONXX = 'L'
			AND LNXX.LD_STA_LONXX BETWEEN 'XXOCTXXXX'D AND 'XXOCTXXXX'D
	;

	CREATE TABLE SUMMARY AS
		SELECT
			COUNT(DISTINCT BF_SSN) AS BORROWERS,
			COUNT(BF_SSN) AS LOANS,
			SUM(LA_CUR_PRI+WA_TOT_BRI_OTS) AS PRINC_INT
		FROM
			DETAIL
	;
QUIT;

ENDRSUBMIT;

PROC EXPORT
		DATA=LEGEND.DETAIL
		OUTFILE='T:\SAS\REDEFS.XLSX'
		REPLACE;
RUN;

PROC EXPORT
		DATA=LEGEND.SUMMARY
		OUTFILE='T:\SAS\REDEFS.XLSX'
		REPLACE;
RUN;
