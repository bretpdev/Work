USE [CentralData]
GO
--Population 1 includes outstanding loans on which a default claim was paid prior to March 13, 2020, 
--that are not subject to an active bankruptcy filing,and are still in default as of 05/24/2021.

DROP TABLE IF EXISTS #POP1
DROP TABLE IF EXISTS #POP2
DECLARE @Start DATE = '2020-03-13'
DECLARE @End DATE = '2021-05-24'

SELECT DISTINCT
	DC01.AF_APL_ID,
	DC01.AF_APL_ID_SFX,
	DC01.LF_CRT_DTS_DC10,
	DC01.BF_SSN
INTO 
	#POP1
FROM
	ODW..DC01_LON_CLM_INF DC01
	LEFT JOIN --Had a record during covid forb date range
	(
		SELECT
			AF_APL_ID,
			AF_APL_ID_SFX,
			LF_CRT_DTS_DC10,
			BF_SSN
		FROM
			ODW..DC01_LON_CLM_INF
		WHERE
			LC_PCL_REA NOT IN('DB','DF','IN','DQ')
			AND LC_STA_DC10 != '03'
			AND CAST(LF_CRT_DTS_DC10 AS DATE) BETWEEN @Start AND @End
	) DefaultAsOf
		ON DefaultAsOf.BF_SSN = DC01.BF_SSN
		AND DefaultAsOf.AF_APL_ID = DC01.AF_APL_ID
		AND DefaultAsOf.AF_APL_ID_SFX = DC01.AF_APL_ID_SFX
		AND DefaultAsOf.LF_CRT_DTS_DC10 = DC01.LF_CRT_DTS_DC10
WHERE
    DC01.LC_STA_DC10 = '03'
    AND DC01.LD_LDR_POF < @Start
    AND DC01.LC_PCL_REA IN ('DB','DF','IN','DQ')
	AND DefaultAsOf.BF_SSN IS NULL --Doesnt have any NON defaulted status between 03/13/2020 and 05/24/2021

SELECT DISTINCT
	DC01.AF_APL_ID,
	DC01.AF_APL_ID_SFX,
	DC01.LF_CRT_DTS_DC10,
	DC01.BF_SSN
INTO 
	#POP2
FROM
	ODW..DC01_LON_CLM_INF DC01
	LEFT JOIN --Had a record during covid forb date range
	(
		SELECT
			AF_APL_ID,
			AF_APL_ID_SFX,
			LF_CRT_DTS_DC10,
			BF_SSN
		FROM
			ODW..DC01_LON_CLM_INF
		WHERE
			LC_PCL_REA NOT IN('DB','DF','IN','DQ')
			AND LC_STA_DC10 != '03'
			AND CAST(LF_CRT_DTS_DC10 AS DATE) BETWEEN @Start AND @End
	) DefaultAsOf
		ON DefaultAsOf.BF_SSN = DC01.BF_SSN
		AND DefaultAsOf.AF_APL_ID = DC01.AF_APL_ID
		AND DefaultAsOf.AF_APL_ID_SFX = DC01.AF_APL_ID_SFX
		AND DefaultAsOf.LF_CRT_DTS_DC10 = DC01.LF_CRT_DTS_DC10
WHERE
    DC01.LC_STA_DC10 = '03'
    AND DC01.LD_LDR_POF >= @Start
    AND DC01.LC_PCL_REA IN ('DB','DF','IN','DQ')
	AND DefaultAsOf.BF_SSN IS NULL --Doesnt have any NON defaulted status between 03/13/2020 and 05/24/2021

SELECT
	'Pop 1' AS POP,
	COUNT(DISTINCT P.BF_SSN) AS BORROWER_COUNT,
	COUNT(*) AS LOAN_COUNT,
	ISNULL(SUM(ISNULL(LA_CLM_BAL,0.00) - ISNULL(LA_CLM_PRJ_COL_CST,0.00)),0.00) AS TotalBalance
FROM
(
	SELECT 
		DC02.AF_APL_ID,
		DC02.AF_APL_ID_SFX,
		DC02.BF_SSN,
		DC02.LA_CLM_BAL,
		DC02.LA_CLM_PRJ_COL_CST
	FROM 
		#POP1 P
		INNER JOIN 
		(
			SELECT
				DC01.AF_APL_ID,
				DC01.AF_APL_ID_SFX,
				DC01.BF_SSN,
				DC01.LF_CRT_DTS_DC10
			FROM
				ODW..DC01_LON_CLM_INF DC01
				INNER JOIN 
				(
					SELECT DISTINCT
						DC01.BF_SSN,
						DC01.AF_APL_ID,
						DC01.AF_APL_ID_SFX,
						MAX(DC01.LF_CRT_DTS_DC10) AS MaxDate
					FROM
						ODW..DC01_LON_CLM_INF DC01
					GROUP BY
						DC01.BF_SSN,
						DC01.AF_APL_ID,
						DC01.AF_APL_ID_SFX
				) DC01M
					ON DC01.AF_APL_ID = DC01M.AF_APL_ID
					AND DC01.AF_APL_ID_SFX = DC01M.AF_APL_ID_SFX
					AND DC01.LF_CRT_DTS_DC10 = DC01M.MaxDate
			WHERE
				DC01.LC_PCL_REA IN('DF','DB','IN','DQ')
				AND DC01.LC_STA_DC10 = '03'
				AND DC01.LD_CLM_ASN_DOE IS NULL
				AND ISNULL(DC01.LC_REA_CLM_ASN_DOE,'') = ''
		) DC01
			ON DC01.BF_SSN = P.BF_SSN
			AND DC01.AF_APL_ID = P.AF_APL_ID
			AND DC01.AF_APL_ID_SFX = P.AF_APL_ID_SFX
		INNER JOIN ODW..DC02_BAL_INT DC02 --STILL CURRENTLY IN DEFAULT
			ON DC02.AF_APL_ID = P.AF_APL_ID
			AND DC02.AF_APL_ID_SFX = P.AF_APL_ID_SFX
			AND DC02.LF_CRT_DTS_DC10 = P.LF_CRT_DTS_DC10
			AND ISNULL(DC02.LA_CLM_BAL,0.00) - ISNULL(DC02.LA_CLM_PRJ_COL_CST,0.00) > 0.00
) P

UNION ALL

--Population 2 includes outstanding loans on which a default claim was paid after to March 13, 2020, 
--that are not subject to an active bankruptcy filing,and are still in default as of 05/24/2021.
SELECT
	'Pop 2' AS POP,
	COUNT(DISTINCT P.BF_SSN) AS BORROWER_COUNT,
	COUNT(*) AS LOAN_COUNT,
	ISNULL(SUM(ISNULL(LA_CLM_BAL,0.00) - ISNULL(LA_CLM_PRJ_COL_CST,0.00)),0.00) AS TotalBalance
FROM
(
	SELECT 
		DC02.AF_APL_ID,
		DC02.AF_APL_ID_SFX,
		DC02.BF_SSN,
		DC02.LA_CLM_BAL,
		DC02.LA_CLM_PRJ_COL_CST
	FROM 
		#POP2 P
		INNER JOIN 
		(
			SELECT
				DC01.AF_APL_ID,
				DC01.AF_APL_ID_SFX,
				DC01.BF_SSN,
				DC01.LF_CRT_DTS_DC10
			FROM
				ODW..DC01_LON_CLM_INF DC01
				INNER JOIN 
				(
					SELECT DISTINCT
						DC01.BF_SSN,
						DC01.AF_APL_ID,
						DC01.AF_APL_ID_SFX,
						MAX(DC01.LF_CRT_DTS_DC10) AS MaxDate
					FROM
						ODW..DC01_LON_CLM_INF DC01
					GROUP BY
						DC01.BF_SSN,
						DC01.AF_APL_ID,
						DC01.AF_APL_ID_SFX
				) DC01M
					ON DC01.AF_APL_ID = DC01M.AF_APL_ID
					AND DC01.AF_APL_ID_SFX = DC01M.AF_APL_ID_SFX
					AND DC01.LF_CRT_DTS_DC10 = DC01M.MaxDate
			WHERE
				DC01.LC_PCL_REA IN('DF','DB','IN','DQ')
				AND DC01.LC_STA_DC10 = '03'
				AND DC01.LD_CLM_ASN_DOE IS NULL
				AND ISNULL(DC01.LC_REA_CLM_ASN_DOE,'') IN('','04','08')
		) DC01
			ON DC01.BF_SSN = P.BF_SSN
			AND DC01.AF_APL_ID = P.AF_APL_ID
			AND DC01.AF_APL_ID_SFX = P.AF_APL_ID_SFX
		INNER JOIN ODW..DC02_BAL_INT DC02 --STILL CURRENTLY IN DEFAULT
			ON DC02.AF_APL_ID = P.AF_APL_ID
			AND DC02.AF_APL_ID_SFX = P.AF_APL_ID_SFX
			AND DC02.LF_CRT_DTS_DC10 = P.LF_CRT_DTS_DC10
			AND ISNULL(DC02.LA_CLM_BAL,0.00) - ISNULL(DC02.LA_CLM_PRJ_COL_CST,0.00) > 0.00
) P

UNION ALL

SELECT
	'Pop 3' AS POP,
	COUNT(DISTINCT DC01.BF_SSN) AS BORROWER_COUNT,
	COUNT(*) AS LOAN_COUNT,
	ISNULL(SUM(PMT.PRIN + PMT.INTEREST),0.00) AS TotalBalance
FROM
	ODW..DC01_LON_CLM_INF DC01
	INNER JOIN 
	(
		SELECT DISTINCT
			DC01.BF_SSN,
			DC01.AF_APL_ID,
			DC01.AF_APL_ID_SFX,
			MAX(DC01.LF_CRT_DTS_DC10) AS MaxDate
		FROM
			ODW..DC01_LON_CLM_INF DC01
		GROUP BY
			DC01.BF_SSN,
			DC01.AF_APL_ID,
			DC01.AF_APL_ID_SFX
		) DC01M
			ON DC01.AF_APL_ID = DC01M.AF_APL_ID
			AND DC01.AF_APL_ID_SFX = DC01M.AF_APL_ID_SFX
			AND DC01.LF_CRT_DTS_DC10 = DC01M.MaxDate
		INNER JOIN 
		(
			 SELECT 
				AF_APL_ID, 
				AF_APL_ID_SFX, 
				SUM(ISNULL(LA_PRI_AT_PST,0.00)) AS PRIN ,
				SUM(ISNULL(LA_INT_ACR_THS_PRD,0.00)) AS INTEREST 
			FROM 
				ODW..DC11_LON_FAT 
			WHERE 
				LC_TRX_TYP IN ('RH','DC','CP') 
				AND LD_TRX_EFF BETWEEN @Start AND @End
				AND LC_REV_IND_TYP = ''
			GROUP BY
				AF_APL_ID, 
				AF_APL_ID_SFX
		) PMT
			ON PMT.AF_APL_ID = DC01.AF_APL_ID
			AND PMT.AF_APL_ID_SFX = DC01.AF_APL_ID_SFX
WHERE
	DC01.LC_STA_DC10 = '04'

--Population 1 includes outstanding loans on which a default claim was paid prior to March 13, 2020, 
--that are not subject to an active bankruptcy filing,and are still in default as of 05/24/2021.


SELECT DISTINCT
	DC01.AF_APL_ID,
	DC01.AF_APL_ID_SFX,
	DC01.LF_CRT_DTS_DC10,
	DC01.BF_SSN
INTO 
	#POP1_2
FROM
	ODW..DC01_LON_CLM_INF DC01
	LEFT JOIN --Had a record during covid forb date range
	(
		SELECT
			AF_APL_ID,
			AF_APL_ID_SFX,
			LF_CRT_DTS_DC10,
			BF_SSN
		FROM
			ODW..DC01_LON_CLM_INF
		WHERE
			LC_PCL_REA NOT IN('DB','DF','IN','DQ')
			AND LC_STA_DC10 != '03'
			AND CAST(LF_CRT_DTS_DC10 AS DATE) BETWEEN @Start AND @End
	) DefaultAsOf
		ON DefaultAsOf.BF_SSN = DC01.BF_SSN
		AND DefaultAsOf.AF_APL_ID = DC01.AF_APL_ID
		AND DefaultAsOf.AF_APL_ID_SFX = DC01.AF_APL_ID_SFX
		AND DefaultAsOf.LF_CRT_DTS_DC10 = DC01.LF_CRT_DTS_DC10
WHERE
    DC01.LC_STA_DC10 = '03'
    AND DC01.LD_LDR_POF < @Start
    AND DC01.LC_PCL_REA IN ('DB','DF','IN','DQ')
	AND DefaultAsOf.BF_SSN IS NULL --Doesnt have any NON defaulted status between 03/13/2020 and 05/24/2021

SELECT DISTINCT
	DC01.AF_APL_ID,
	DC01.AF_APL_ID_SFX,
	DC01.LF_CRT_DTS_DC10,
	DC01.BF_SSN
INTO 
	#POP2_2
FROM
	ODW..DC01_LON_CLM_INF DC01
	LEFT JOIN --Had a record during covid forb date range
	(
		SELECT
			AF_APL_ID,
			AF_APL_ID_SFX,
			LF_CRT_DTS_DC10,
			BF_SSN
		FROM
			ODW..DC01_LON_CLM_INF
		WHERE
			LC_PCL_REA NOT IN('DB','DF','IN','DQ')
			AND LC_STA_DC10 != '03'
			AND CAST(LF_CRT_DTS_DC10 AS DATE) BETWEEN @Start AND @End
	) DefaultAsOf
		ON DefaultAsOf.BF_SSN = DC01.BF_SSN
		AND DefaultAsOf.AF_APL_ID = DC01.AF_APL_ID
		AND DefaultAsOf.AF_APL_ID_SFX = DC01.AF_APL_ID_SFX
		AND DefaultAsOf.LF_CRT_DTS_DC10 = DC01.LF_CRT_DTS_DC10
WHERE
    DC01.LC_STA_DC10 = '03'
    AND DC01.LD_LDR_POF >= @Start
    AND DC01.LC_PCL_REA IN ('DB','DF','IN','DQ')
	AND DefaultAsOf.BF_SSN IS NULL --Doesnt have any NON defaulted status between 03/13/2020 and 05/24/2021


SELECT 
	DC02.AF_APL_ID,
	DC02.AF_APL_ID_SFX,
	DC02.BF_SSN,
	ISNULL(DC02.LA_CLM_BAL,0.00) - ISNULL(DC02.LA_CLM_PRJ_COL_CST,0.00) AS TotalBalance,
	'Pop 1' AS POP
FROM 
	#POP1_2 P
	INNER JOIN 
	(
		SELECT
			DC01.AF_APL_ID,
			DC01.AF_APL_ID_SFX,
			DC01.BF_SSN,
			DC01.LF_CRT_DTS_DC10
		FROM
			ODW..DC01_LON_CLM_INF DC01
			INNER JOIN 
			(
				SELECT DISTINCT
					DC01.BF_SSN,
					DC01.AF_APL_ID,
					DC01.AF_APL_ID_SFX,
					MAX(DC01.LF_CRT_DTS_DC10) AS MaxDate
				FROM
					ODW..DC01_LON_CLM_INF DC01
				GROUP BY
					DC01.BF_SSN,
					DC01.AF_APL_ID,
					DC01.AF_APL_ID_SFX
			) DC01M
				ON DC01.AF_APL_ID = DC01M.AF_APL_ID
				AND DC01.AF_APL_ID_SFX = DC01M.AF_APL_ID_SFX
				AND DC01.LF_CRT_DTS_DC10 = DC01M.MaxDate
		WHERE
			DC01.LC_PCL_REA IN('DF','DB','IN','DQ')
			AND DC01.LC_STA_DC10 = '03'
			AND DC01.LD_CLM_ASN_DOE IS NULL
			AND ISNULL(DC01.LC_REA_CLM_ASN_DOE,'') = ''
	) DC01
		ON DC01.BF_SSN = P.BF_SSN
		AND DC01.AF_APL_ID = P.AF_APL_ID
		AND DC01.AF_APL_ID_SFX = P.AF_APL_ID_SFX
	INNER JOIN ODW..DC02_BAL_INT DC02 --STILL CURRENTLY IN DEFAULT
		ON DC02.AF_APL_ID = P.AF_APL_ID
		AND DC02.AF_APL_ID_SFX = P.AF_APL_ID_SFX
		AND DC02.LF_CRT_DTS_DC10 = P.LF_CRT_DTS_DC10
		AND ISNULL(DC02.LA_CLM_BAL,0.00) - ISNULL(DC02.LA_CLM_PRJ_COL_CST,0.00) > 0.00

UNION ALL

--Population 2 includes outstanding loans on which a default claim was paid after to March 13, 2020, 
--that are not subject to an active bankruptcy filing,and are still in default as of 05/24/2021.
SELECT 
	DC02.AF_APL_ID,
	DC02.AF_APL_ID_SFX,
	DC02.BF_SSN,
	ISNULL(DC02.LA_CLM_BAL,0.00) - ISNULL(DC02.LA_CLM_PRJ_COL_CST,0.00) AS TotalBalance,
	'Pop 2' AS POP
FROM 
	#POP2_2 P
	INNER JOIN 
	(
		SELECT
			DC01.AF_APL_ID,
			DC01.AF_APL_ID_SFX,
			DC01.BF_SSN,
			DC01.LF_CRT_DTS_DC10
		FROM
			ODW..DC01_LON_CLM_INF DC01
			INNER JOIN 
			(
				SELECT DISTINCT
					DC01.BF_SSN,
					DC01.AF_APL_ID,
					DC01.AF_APL_ID_SFX,
					MAX(DC01.LF_CRT_DTS_DC10) AS MaxDate
				FROM
					ODW..DC01_LON_CLM_INF DC01
				GROUP BY
					DC01.BF_SSN,
					DC01.AF_APL_ID,
					DC01.AF_APL_ID_SFX
			) DC01M
				ON DC01.AF_APL_ID = DC01M.AF_APL_ID
				AND DC01.AF_APL_ID_SFX = DC01M.AF_APL_ID_SFX
				AND DC01.LF_CRT_DTS_DC10 = DC01M.MaxDate
		WHERE
			DC01.LC_PCL_REA IN('DF','DB','IN','DQ')
			AND DC01.LC_STA_DC10 = '03'
			AND DC01.LD_CLM_ASN_DOE IS NULL
			AND ISNULL(DC01.LC_REA_CLM_ASN_DOE,'') IN('','04','08')
	) DC01
		ON DC01.BF_SSN = P.BF_SSN
		AND DC01.AF_APL_ID = P.AF_APL_ID
		AND DC01.AF_APL_ID_SFX = P.AF_APL_ID_SFX
	INNER JOIN ODW..DC02_BAL_INT DC02 --STILL CURRENTLY IN DEFAULT
		ON DC02.AF_APL_ID = P.AF_APL_ID
		AND DC02.AF_APL_ID_SFX = P.AF_APL_ID_SFX
		AND DC02.LF_CRT_DTS_DC10 = P.LF_CRT_DTS_DC10
		AND ISNULL(DC02.LA_CLM_BAL,0.00) - ISNULL(DC02.LA_CLM_PRJ_COL_CST,0.00) > 0.00

UNION ALL

SELECT
	DC01.AF_APL_ID,
	DC01.AF_APL_ID_SFX,
	DC01.BF_SSN,
	ISNULL(PMT.PRIN,0.00) + ISNULL(PMT.INTEREST,0.00) AS TotalBalance,
	'Pop 3' AS POP
FROM
	ODW..DC01_LON_CLM_INF DC01
	INNER JOIN 
	(
		SELECT DISTINCT
			DC01.BF_SSN,
			DC01.AF_APL_ID,
			DC01.AF_APL_ID_SFX,
			MAX(DC01.LF_CRT_DTS_DC10) AS MaxDate
		FROM
			ODW..DC01_LON_CLM_INF DC01
		GROUP BY
			DC01.BF_SSN,
			DC01.AF_APL_ID,
			DC01.AF_APL_ID_SFX
	) DC01M
		ON DC01.AF_APL_ID = DC01M.AF_APL_ID
		AND DC01.AF_APL_ID_SFX = DC01M.AF_APL_ID_SFX
		AND DC01.LF_CRT_DTS_DC10 = DC01M.MaxDate
	INNER JOIN 
	(
			SELECT 
			AF_APL_ID, 
			AF_APL_ID_SFX, 
			SUM(ISNULL(LA_PRI_AT_PST,0.00)) AS PRIN ,
			SUM(ISNULL(LA_INT_ACR_THS_PRD,0.00)) AS INTEREST 
		FROM 
			ODW..DC11_LON_FAT 
		WHERE 
			LC_TRX_TYP IN ('RH','DC','CP') 
			AND LD_TRX_EFF BETWEEN @Start AND @End
			AND LC_REV_IND_TYP = ''
		GROUP BY
			AF_APL_ID, 
			AF_APL_ID_SFX
	) PMT
		ON PMT.AF_APL_ID = DC01.AF_APL_ID
		AND PMT.AF_APL_ID_SFX = DC01.AF_APL_ID_SFX
WHERE
	DC01.LC_STA_DC10 = '04'

SELECT DISTINCT
	'Loans at 0% interest' AS POP,
	COUNT(DISTINCT POP.BF_SSN) AS BORROWER_COUNT,
	ISNULL(SUM(POP.CUR_0),0) AS LOAN_COUNT,
	ISNULL(SUM(POP.TotalBalance),0.00) AS TotalBalance
FROM
(
	SELECT
		DC01.BF_SSN,
		ISNULL(DC02.LA_CLM_BAL,0.00) - ISNULL(DC02.LA_CLM_PRJ_COL_CST,0.00) AS TotalBalance,
		1 AS CUR_0
	FROM 
		ODW..DC01_LON_CLM_INF DC01
		INNER JOIN 
		(
			SELECT DISTINCT
				DC01.BF_SSN,
				DC01.AF_APL_ID,
				DC01.AF_APL_ID_SFX,
				MAX(DC01.LF_CRT_DTS_DC10) AS MaxDate
			FROM
				ODW..DC01_LON_CLM_INF DC01
			GROUP BY
				DC01.BF_SSN,
				DC01.AF_APL_ID,
				DC01.AF_APL_ID_SFX
		) DC01M
			ON DC01.AF_APL_ID = DC01M.AF_APL_ID
			AND DC01.AF_APL_ID_SFX = DC01M.AF_APL_ID_SFX
			AND DC01.LF_CRT_DTS_DC10 = DC01M.MaxDate
		INNER JOIN ODW..DC02_BAL_INT DC02 --STILL CURRENTLY IN DEFAULT
			ON DC02.AF_APL_ID = DC01.AF_APL_ID
			AND DC02.AF_APL_ID_SFX = DC01.AF_APL_ID_SFX
			AND DC02.LF_CRT_DTS_DC10 = DC01.LF_CRT_DTS_DC10
			AND ISNULL(DC02.LA_CLM_BAL,0.00) - ISNULL(DC02.LA_CLM_PRJ_COL_CST,0.00) > 0.00
	WHERE
		DC01.LC_PCL_REA IN('DF','DB','IN','DQ')
		AND DC01.LC_STA_DC10 = '03'
		AND DC01.LD_CLM_ASN_DOE IS NULL
		AND ISNULL(DC01.LC_REA_CLM_ASN_DOE,'') = ''
		AND LR_CUR_INT = 0.000
) POP

UNION ALL

SELECT DISTINCT
	'Loans > 0% interest' AS POP,
	COUNT(DISTINCT POP.BF_SSN) AS BORROWER_COUNT,
	ISNULL(SUM(POP.CUR_0),0) AS LOAN_COUNT,
	ISNULL(SUM(POP.TotalBalance),0.00) AS TotalBalance
FROM
(
	SELECT
		DC01.BF_SSN,
		ISNULL(DC02.LA_CLM_BAL,0.00) - ISNULL(DC02.LA_CLM_PRJ_COL_CST,0.00) AS TotalBalance,
		1 AS CUR_0
	FROM 
		ODW..DC01_LON_CLM_INF DC01
		INNER JOIN 
		(
			SELECT DISTINCT
				DC01.BF_SSN,
				DC01.AF_APL_ID,
				DC01.AF_APL_ID_SFX,
				MAX(DC01.LF_CRT_DTS_DC10) AS MaxDate
			FROM
				ODW..DC01_LON_CLM_INF DC01
			GROUP BY
				DC01.BF_SSN,
				DC01.AF_APL_ID,
				DC01.AF_APL_ID_SFX
		) DC01M
			ON DC01.AF_APL_ID = DC01M.AF_APL_ID
			AND DC01.AF_APL_ID_SFX = DC01M.AF_APL_ID_SFX
			AND DC01.LF_CRT_DTS_DC10 = DC01M.MaxDate
		INNER JOIN ODW..DC02_BAL_INT DC02 --STILL CURRENTLY IN DEFAULT
			ON DC02.AF_APL_ID = DC01.AF_APL_ID
			AND DC02.AF_APL_ID_SFX = DC01.AF_APL_ID_SFX
			AND DC02.LF_CRT_DTS_DC10 = DC01.LF_CRT_DTS_DC10
			AND ISNULL(DC02.LA_CLM_BAL,0.00) - ISNULL(DC02.LA_CLM_PRJ_COL_CST,0.00) > 0.00
	WHERE
		DC01.LC_PCL_REA IN('DF','DB','IN','DQ')
		AND DC01.LC_STA_DC10 = '03'
		AND DC01.LD_CLM_ASN_DOE IS NULL
		AND ISNULL(DC01.LC_REA_CLM_ASN_DOE,'') = ''
		AND LR_CUR_INT != 0.000 
) POP

SELECT
	DC01.AF_APL_ID,
	DC01.AF_APL_ID_SFX,
	DC01.BF_SSN,
	ISNULL(DC02.LA_CLM_BAL,0.00) - ISNULL(DC02.LA_CLM_PRJ_COL_CST,0.00) AS TotalBalance,
	'Loans at 0% interest' AS POP
FROM 
	ODW..DC01_LON_CLM_INF DC01
	INNER JOIN 
	(
		SELECT DISTINCT
			DC01.BF_SSN,
			DC01.AF_APL_ID,
			DC01.AF_APL_ID_SFX,
			MAX(DC01.LF_CRT_DTS_DC10) AS MaxDate
		FROM
			ODW..DC01_LON_CLM_INF DC01
		GROUP BY
			DC01.BF_SSN,
			DC01.AF_APL_ID,
			DC01.AF_APL_ID_SFX
	) DC01M
		ON DC01.AF_APL_ID = DC01M.AF_APL_ID
		AND DC01.AF_APL_ID_SFX = DC01M.AF_APL_ID_SFX
		AND DC01.LF_CRT_DTS_DC10 = DC01M.MaxDate
	INNER JOIN ODW..DC02_BAL_INT DC02 --STILL CURRENTLY IN DEFAULT
		ON DC02.AF_APL_ID = DC01.AF_APL_ID
		AND DC02.AF_APL_ID_SFX = DC01.AF_APL_ID_SFX
		AND DC02.LF_CRT_DTS_DC10 = DC01.LF_CRT_DTS_DC10
		AND ISNULL(DC02.LA_CLM_BAL,0.00) - ISNULL(DC02.LA_CLM_PRJ_COL_CST,0.00) > 0.00
WHERE
	DC01.LC_PCL_REA IN('DF','DB','IN','DQ')
	AND DC01.LC_STA_DC10 = '03'
	AND DC01.LD_CLM_ASN_DOE IS NULL
	AND ISNULL(DC01.LC_REA_CLM_ASN_DOE,'') = ''
	AND LR_CUR_INT = 0.000

UNION ALL

SELECT
	DC01.AF_APL_ID,
	DC01.AF_APL_ID_SFX,
	DC01.BF_SSN,
	ISNULL(DC02.LA_CLM_BAL,0.00) - ISNULL(DC02.LA_CLM_PRJ_COL_CST,0.00) AS TotalBalance,
	'Loans > 0% interest' AS POP
FROM 
	ODW..DC01_LON_CLM_INF DC01
	INNER JOIN 
	(
		SELECT DISTINCT
			DC01.BF_SSN,
			DC01.AF_APL_ID,
			DC01.AF_APL_ID_SFX,
			MAX(DC01.LF_CRT_DTS_DC10) AS MaxDate
		FROM
			ODW..DC01_LON_CLM_INF DC01
		GROUP BY
			DC01.BF_SSN,
			DC01.AF_APL_ID,
			DC01.AF_APL_ID_SFX
	) DC01M
		ON DC01.AF_APL_ID = DC01M.AF_APL_ID
		AND DC01.AF_APL_ID_SFX = DC01M.AF_APL_ID_SFX
		AND DC01.LF_CRT_DTS_DC10 = DC01M.MaxDate
	INNER JOIN ODW..DC02_BAL_INT DC02 --STILL CURRENTLY IN DEFAULT
		ON DC02.AF_APL_ID = DC01.AF_APL_ID
		AND DC02.AF_APL_ID_SFX = DC01.AF_APL_ID_SFX
		AND DC02.LF_CRT_DTS_DC10 = DC01.LF_CRT_DTS_DC10
		AND ISNULL(DC02.LA_CLM_BAL,0.00) - ISNULL(DC02.LA_CLM_PRJ_COL_CST,0.00) > 0.00
WHERE
	DC01.LC_PCL_REA IN('DF','DB','IN','DQ')
	AND DC01.LC_STA_DC10 = '03'
	AND DC01.LD_CLM_ASN_DOE IS NULL
	AND ISNULL(DC01.LC_REA_CLM_ASN_DOE,'') = ''
	AND LR_CUR_INT != 0.000 
