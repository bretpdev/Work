USE CDW
GO

SELECT
	--LNXX.*,
	LNXX.BF_SSN,
	LNXX.LN_SEQ,
	LNXX.LD_DFR_BEG,
	LNXX.LD_DFR_END,
	DATEDIFF(MONTH, LNXX.LD_DFR_BEG, LNXX.LD_DFR_END) AS DEF_LENGTH
FROM
	CDW..DFXX_BR_DFR_REQ DFXX
	INNER JOIN CDW..LNXX_BR_DFR_APV LNXX
		ON LNXX.BF_SSN = DFXX.BF_SSN
		AND LNXX.LF_DFR_CTL_NUM = DFXX.LF_DFR_CTL_NUM
	INNER JOIN CDW..LNXX_LON LNXX
		ON LNXX.BF_SSN = LNXX.BF_SSN
		AND LNXX.LN_SEQ = LNXX.LN_SEQ
WHERE
	DFXX.LC_DFR_TYP = 'XX'
	AND DATEDIFF(MONTH, LNXX.LD_DFR_BEG, LNXX.LD_DFR_END) > X
	AND LNXX.LA_CUR_PRI > X
	AND LNXX.LC_STA_LONXX = 'A'