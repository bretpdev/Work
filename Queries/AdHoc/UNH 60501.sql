USE UDW;
GO

SELECT DISTINCT
	PD10.DF_SPE_ACC_ID
	,LN10.LN_SEQ
	,PD30.DC_DOM_ST
	,PD30.DI_VLD_ADR
	,PD30.DD_VER_ADR
	,LN10.LC_STA_LON10
FROM
	LN10_LON LN10
	INNER JOIN PD10_PRS_NME PD10
		ON LN10.BF_SSN = PD10.DF_PRS_ID
	INNER JOIN PD30_PRS_ADR PD30
		ON LN10.BF_SSN = PD30.DF_PRS_ID
WHERE
	PD30.DC_DOM_ST = 'WA'
	AND PD30.DI_VLD_ADR = 'Y'
	AND PD30.DD_VER_ADR >= CONVERT(DATE,'20180131')
	AND PD30.DD_VER_ADR <= CONVERT(DATE,'20190131')
	AND LN10.LC_STA_LON10 = 'R'
	--AND LN10.LA_CUR_PRI > 0.00
	AND PD30.DF_PRS_ID NOT LIKE 'P%'
ORDER BY
	PD10.DF_SPE_ACC_ID
	,LN10.LN_SEQ
;


SELECT DISTINCT
	--LN10.BF_SSN
	--,LN10.LN_SEQ
	COUNT(PD10.DF_SPE_ACC_ID) AS LOAN_COUNT
FROM
	LN10_LON LN10
	INNER JOIN PD10_PRS_NME PD10
		ON LN10.BF_SSN = PD10.DF_PRS_ID
	INNER JOIN PD30_PRS_ADR PD30
		ON LN10.BF_SSN = PD30.DF_PRS_ID
WHERE
	PD30.DC_DOM_ST = 'WA'
	AND PD30.DI_VLD_ADR = 'Y'
	AND PD30.DD_VER_ADR >= CONVERT(DATE,'20180131')
	AND PD30.DD_VER_ADR <= CONVERT(DATE,'20190131')
	AND LN10.LC_STA_LON10 = 'R'
	--AND LN10.LA_CUR_PRI > 0.00
	AND PD30.DF_PRS_ID NOT LIKE 'P%'
;