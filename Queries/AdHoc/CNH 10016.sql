--Query X

SELECT 
	DATENAME(MONTH, DATEADD(MONTH, [Month], X) - X) AS [Month],
	[Year],
	COUNT(BF_SSN) AS NumberOfAccounts
FROM OPENQUERY
(LEGEND,
	'
		SELECT DISTINCT
			BF_SSN,
			MONTH(AYXX.LD_ATY_REQ_RCV) AS Month,
			YEAR(AYXX.LD_ATY_REQ_RCV) AS Year,
			AYXX.LD_ATY_REQ_RCV
		FROM
			PKUB.AYXX_BR_LON_ATY AYXX
		WHERE
			AYXX.PF_REQ_ACT IN(''BXPOC'',''BPOCR'')
			AND AYXX.LD_ATY_REQ_RCV BETWEEN ''XXXX-XX-XX'' AND ''XXXX-XX-XX''
	'
)
GROUP BY
	[Year],
	[Month]
ORDER BY
	[Year],
	[Month]

SELECT 
	*
FROM OPENQUERY
(LEGEND,
	'
		SELECT DISTINCT
			BF_SSN,
			MONTH(AYXX.LD_ATY_REQ_RCV) AS Month,
			YEAR(AYXX.LD_ATY_REQ_RCV) AS Year,
			AYXX.LD_ATY_REQ_RCV
		FROM
			PKUB.AYXX_BR_LON_ATY AYXX
		WHERE
			AYXX.PF_REQ_ACT IN(''BXPOC'',''BPOCR'')
			AND AYXX.LD_ATY_REQ_RCV BETWEEN ''XXXX-XX-XX'' AND ''XXXX-XX-XX''
	'
)
ORDER BY
	LD_ATY_REQ_RCV,
	BF_SSN
--Query X

SELECT 
	DATENAME(MONTH, DATEADD(MONTH, [Month], X) - X) AS [Month],
	[Year],
	COUNT(DF_PRS_ID) AS NumberOfAccounts
FROM OPENQUERY
(LEGEND,
	'
		SELECT DISTINCT
			DF_PRS_ID,
			MONTH(PDXX.DD_BKR_VER) AS Month,
			YEAR(PDXX.DD_BKR_VER) AS Year,
			PDXX.DD_BKR_VER
		FROM
			PKUB.PDXX_PRS_BKR PDXX
		WHERE
			PDXX.DD_BKR_VER BETWEEN ''XXXX-XX-XX'' AND ''XXXX-XX-XX''
			AND PDXX.DC_BKR_STA = ''XX''
	'
)
GROUP BY
	[Year],
	[Month]
ORDER BY
	[Year],
	[Month]

SELECT 
	*
FROM OPENQUERY
(LEGEND,
	'
		SELECT DISTINCT
			DF_PRS_ID,
			MONTH(PDXX.DD_BKR_VER) AS Month,
			YEAR(PDXX.DD_BKR_VER) AS Year,
			PDXX.DD_BKR_VER
		FROM
			PKUB.PDXX_PRS_BKR PDXX
		WHERE
			PDXX.DD_BKR_VER BETWEEN ''XXXX-XX-XX'' AND ''XXXX-XX-XX''
			AND PDXX.DC_BKR_STA = ''XX''
	'
)
ORDER BY
	DD_BKR_VER,
	DF_PRS_ID