BEGIN TRANSACTION
DECLARE @ERROR INT = 0
DECLARE @ROWCOUNT INT = 0
DECLARE @ExpectedRowCount INT = 31 + 60 --91

--Query Body

--Deletions--
UPDATE
	NobleCalls.dbo.NobleCallHistory
SET
	Deleted = 1, DeletedBy = 'DCR NH9830', DeletedAt = GETDATE()
WHERE
	NobleCallHistoryId IN (3158099,3158414,3158742,3159459,3159993,3160798,3161518,3162862,3163861,3164573,3165207,
						   3148785,3149105,3149537,3150137,3150823,3151937,3152440,3154040,3155323,3155966,3146015,
						   3146597,3146996,3143458,3177079,3177600,3178041,3178524,3179137,3179919) --31 IDs
						   
SELECT @ROWCOUNT = @ROWCOUNT + @@ROWCOUNT						   

DECLARE @Updates TABLE(
	NobleCallHistoryId int,
	NewIdentifier varchar(10)
)

INSERT INTO @Updates VALUES 
(3145849,'416049973'),(3146175,'572190761'),(3146236,'451530646'),(3146299,'633427366'),(3143848,'633427366'),
(3146429,'416049973'),(3146770,'572190761'),(3146822,'451530646'),(3146960,'416049973'),(3146928,'633427366'),
(3147038,'572190761'),(3147074,'451530646'),(3147095,'633427366'),(3143255,'416049973'),(3143644,'572190761'),
(3143725,'451530646'),(3150360,'608699672'),(3150412,'027551350'),(3151191,'608699672'),(3151267,'027551350'),
(3152609,'608699672'),(3152626,'5471489589'),(3152776,'027551350'),(3153599,'467908811'),(3154195,'608699672'),
(3154220,'5471489589'),(3154374,'027551350'),(3155069,'467908811'),(3155411,'608699672'),(3155421,'5471489589'),
(3155509,'027551350'),(3155904,'467908811'),(3155997,'5471489589'),(3155993,'608699672'),(3156022,'027551350'),
(3158697,'377888382'),(3159435,'377888382'),(3159918,'377888382'),(3159992,'859418911'),(3160754,'377888382'),
(3160797,'859418911'),(3161400,'377888382'),(3161517,'859418911'),(3162775,'377888382'),(3162858,'859418911'),
(3163822,'377888382'),(3163860,'859418911'),(3164512,'377888382'),(3164572,'4859418911'),(3165187,'377888382'),
(3165206,'859418911'),(3175558,'533847166'),(3176623,'533847166'),(3177111,'533847166'),(3177633,'533847166'),
(3178075,'533847166'),(3178565,'533847166'),(3179180,'533847166'),(3179980,'533847166'),(3180313,'7605686929') --60 Rows

UPDATE
	nch
SET
	nch.AccountIdentifier = u.NewIdentifier
FROM
	NobleCalls.dbo.NobleCallHistory nch
JOIN
	@Updates u ON nch.NobleCallHistoryId = u.NobleCallHistoryId

SELECT @ROWCOUNT = @ROWCOUNT + @@ROWCOUNT						   


--Query Body

SELECT @ERROR = @@ERROR

IF @ROWCOUNT = @ExpectedRowCount AND @ERROR = 0
	BEGIN
		PRINT 'Transaction committed'
		COMMIT TRANSACTION
	END
ELSE
	BEGIN
		PRINT 'ROWCOUNT:  ' + CAST(@ROWCOUNT as VARCHAR(10))
		PRINT 'ERROR:  ' + CAST(@ERROR as VARCHAR(10))
		PRINT '!!!  Transaction NOT committed.  Contact a member of Application Development to have this error corrected.'
		ROLLBACK TRANSACTION
	END

