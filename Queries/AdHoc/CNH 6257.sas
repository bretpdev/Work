LIBNAME LEGEND REMOTE SERVER=LEGEND SLIBREF=WORK;
RSUBMIT;
LIBNAME PKUB DBX DATABASE=DNFPUTDL OWNER=PKUB;
PROC SQL;
	CREATE TABLE EMLS AS
		SELECT DISTINCT
			PDXX.DF_SPE_ACC_ID,
			CATX(' ',PDXX.DM_PRS_X,PDXX.DM_PRS_LST) AS BRW_NAME,
			PDXX.DX_ADR_EML
		FROM
			PKUB.PDXX_PRS_NME PDXX
			JOIN PKUB.PDXX_PRS_ADR_EML PDXX
				ON PDXX.DF_PRS_ID = PDXX.DF_PRS_ID
		WHERE
			PDXX.DF_PRS_ID NOT LIKE ('P%')
			AND PDXX.DC_STA_PDXX = 'A' 
			AND PDXX.DI_VLD_ADR_EML = 'Y'
	;
QUIT;
ENDRSUBMIT;

DATA EMLS; SET LEGEND.EMLS; RUN;

DATA _NULL_;
	SET EMLS ;
	FILE 'T:\Quick Query for Ecorr Special Campaign.txt' DELIMITER=',' DSD DROPOVER LRECL=XXXXX;

	IF _N_ = X THEN
		DO;
			PUT "ACCOUNT_NUMBER,BORROWER_NAME,EMAIL_ADDRESS";
		END;

	DO;
	   PUT DF_SPE_ACC_ID @;
	   PUT BRW_NAME @;
	   PUT DX_ADR_EML $ ;
	END;
RUN;
