/****************CHECK ATTENDANCE********************/
USE CDW
GO

DECLARE @OPEID TABLE (OPEID VARCHAR(X));
INSERT INTO @OPEID VALUES 
('XXXXXXXX'),('XXXXXXXX'),
('XXXXXXXX'),('XXXXXXXX'),
('XXXXXXXX'),('XXXXXXXX'),
('XXXXXXXX'),('XXXXXXXX'),
('XXXXXXXX'),('XXXXXXXX'),
('XXXXXXXX'),('XXXXXXXX'),
('XXXXXXXX'),('XXXXXXXX'),
('XXXXXXXX'),('XXXXXXXX'),
('XXXXXXXX'),('XXXXXXXX'),
('XXXXXXXX'),('XXXXXXXX'),
('XXXXXXXX'),('XXXXXXXX'),
('XXXXXXXX'),('XXXXXXXX'),
('XXXXXXXX'),('XXXXXXXX'),
('XXXXXXXX')

--select * from @OPEID;

--enrolled
SELECT DISTINCT
	LNXX.BF_SSN AS SSN,
	PDXX.DM_PRS_X AS FirstName,
	PDXX.DM_PRS_LST AS LastName,
	LNXX.LF_DOE_SCL_ORG AS OPEID
FROM
	PDXX_PRS_NME PDXX
	INNER JOIN LNXX_LON LNXX
		ON LNXX.BF_SSN = PDXX.DF_PRS_ID
	INNER JOIN @OPEID O
		ON LNXX.LF_DOE_SCL_ORG = O.OPEID

UNION

--ever attended:
SELECT * FROM OPENQUERY(LEGEND,
'
	SELECT DISTINCT
		PDXX.DF_PRS_ID AS SSN,
		PDXX.DM_PRS_X AS FirstName,
		PDXX.DM_PRS_LST AS LastName,
		MRXX.LF_DOE_SCL_ENR_CUR AS OPEID
	FROM
		PKUB.PDXX_PRS_NME PDXX
		INNER JOIN PKUR.MRXX_MGT_RPT_LON MRXX
			ON PDXX.DF_PRS_ID = MRXX.BF_SSN
	WHERE		
		MRXX.LF_DOE_SCL_ENR_CUR IN
			(
				''XXXXXXXX'',
				''XXXXXXXX'',
				''XXXXXXXX'',
				''XXXXXXXX'',
				''XXXXXXXX'',
				''XXXXXXXX'',
				''XXXXXXXX'',
				''XXXXXXXX'',
				''XXXXXXXX'',
				''XXXXXXXX'',
				''XXXXXXXX'',
				''XXXXXXXX'',
				''XXXXXXXX'',
				''XXXXXXXX'',
				''XXXXXXXX'',
				''XXXXXXXX'',
				''XXXXXXXX'',
				''XXXXXXXX'',
				''XXXXXXXX'',
				''XXXXXXXX'',
				''XXXXXXXX'',
				''XXXXXXXX'',
				''XXXXXXXX'',
				''XXXXXXXX'',
				''XXXXXXXX'',
				''XXXXXXXX'',
				''XXXXXXXX''
			)
');