
DECLARE @Temp TABLE(BF_SSN VARCHAR(9), LN_SEQ INT, LN_RPS_SEQ INT)
INSERT INTO @Temp
VALUES
('003702917',1,5),('003702917',2,5),('003702917',3,5),('019702821',1,7),('019702821',2,7),('057723517',1,7),('057723517',2,7),('057723517',3,7),('057723517',4,7),('061744536',1,9),('061744536',2,9),('061744536',3,9),('063385057',1,8),('070668524',1,7),('070668524',2,7),('096769184',1,8),('096769184',2,8),('096769184',3,8),('096769184',4,8),('119765145',1,13),('119765145',2,13),('119765145',3,13),('119765145',4,13),('128802789',1,5),('132621848',1,8),('132621848',2,8),('137848985',16,17),('226197475',1,8),('226197475',2,8),('249779774',1,6),('301388927',1,33),('356740899',1,7),('356740899',2,7),('356740899',3,7),('356740899',4,7),('359664706',1,7),('359664706',2,7),('359741840',1,7),('359821462',1,9),('400083387',9,19),('400083387',11,19),('400828271',7,12),('400828271',8,12),('400828271',9,12),('400828271',10,12),('400828271',11,12),('400828271',12,12),('425272038',1,6),('425272038',2,6),('431332329',1,6),('431332329',2,6),('433778069',1,6),('443965142',1,8),('445822478',1,7),('445822478',2,7),('451134540',1,7),('451134540',2,7),('454912158',1,20),('454912158',2,20),('454977131',1,6),('454977131',2,6),('460811901',1,7),('460811901',2,7),('461895260',1,6),('461895260',2,6),('463194745',1,7),('463194745',2,7),('470191760',1,6),('475197959',1,22),('475197959',2,22),('475197959',3,22),('475197959',4,22),('476961828',2,6),('482782857',1,7),('482782857',2,7),('489821065',1,6),('489821065',2,6),('492460509',3,14),('492460509',4,14),('494768122',1,8),('494768122',2,8),('503945680',1,7),('503945680',2,7),('505047710',2,9),('505047710',3,9),('507701777',3,16),('507701777',4,16),('517191561',1,9),('517191561',2,9),('519199560',6,13),('519199560',7,13),('520042959',7,18),('520042959',8,18),('520113287',1,11),('520113287',2,11),('520785267',6,16),('520785267',7,16),('528418808',2,24),('528646191',1,7),('528646191',2,7),('528734823',5,9),('528734823',6,9),('528737639',4,14),('528737639',5,14),('528831130',7,24),('528831130',8,24),('528862248',3,14),('528862248',4,14),('528881249',12,14),('528881249',13,14),('528938320',1,10),('529067531',9,19),('529067531',10,19),('529130961',3,9),('529159974',1,12),('529218703',12,20),('529218703',13,20),('529230464',1,13),('529230464',2,13),('529258591',10,25),('529258591',11,25),('529494712',8,16),('529494712',9,16),('529537657',1,17),('529537657',2,17),('529592493',6,11),('529595914',1,13),('529596713',1,16),('529596713',2,16),('529614717',1,15),('529730301',5,8),('529730301',6,8),('529730301',7,8),('529730301',8,8),('529848500',10,16),('529848500',11,16),('529853384',7,7),('529853384',8,7),('529862887',2,12),('529950006',1,19),('529950006',2,19),('529950123',1,14),('529951292',1,14),('529951292',2,14),('529951292',3,14),('529951292',4,14),('529981700',3,17),('529981700',4,17),('530041755',11,14),('530041755',12,14),('530942638',1,7),('530942638',2,7),('533135052',1,18),('533135052',2,18),('533135052',3,18),('533137219',1,6),('535133035',4,12),('535883623',1,10),('536086514',2,16),('536234038',8,17),('536234038',9,17),('537190103',1,5),('540296134',13,25),('540296134',14,25),('542089363',1,13),('542089363',2,13),('543232111',1,24),('543232111',2,24),('543232111',3,24),('543232111',4,24),('543252495',1,8),('543842188',9,15),('543842188',10,15),('544647753',3,14),('544647753',4,14),('551716161',1,16),('551716161',2,16),('551716161',3,16),('551716161',4,16),('553499422',15,38),('553499422',16,38),('553499422',31,38),('553499422',32,38),('553499422',33,38),('553499422',34,38),('553499422',35,38),('553499422',36,38),('553499422',37,38),('553499422',38,38),('553499422',39,38),('553499422',40,38),('553499422',41,38),('553499422',42,38),('553499422',43,38),('553499422',44,38),('558538747',1,7),('558538747',2,7),('558538747',3,7),('560694583',8,11),('561318038',1,5),('561374221',1,11),('561374221',2,11),('565614209',1,10),('565614209',2,10),('565614209',3,10),('566638407',10,15),('566638407',11,15),('567619549',5,6),('570947908',1,9),('570947908',2,9),('573378605',1,10),('573378605',2,10),('573378605',3,10),('573735155',1,14),('573735155',2,14),('573735155',3,14),('573735155',4,14),('573735155',5,14),('574365938',1,19),('574365938',2,19),('574365938',3,19),('574365938',4,19),('574365938',5,19),('574365938',6,19),('574365938',7,19),('574365938',8,19),('574900642',1,12),('574900642',2,12),('574900642',3,12),('592197063',7,9),('592197063',8,9),('592197063',9,9),('592197063',10,9),('592197063',11,9),('592197063',12,9),('601210850',1,9),('601880039',1,10),('618035932',1,13),('618035932',2,13),('618035932',3,13),('618035932',4,13),('621407407',1,9),('621407407',2,9),('621407407',3,9),('621407407',4,9),('628224919',1,8),('628224919',2,8),('628224919',3,8),('628224919',4,8),('630100964',1,6),('635665058',1,20),('635665058',2,20),('636345930',6,17),('636345930',7,17),('639681381',1,6),('639681381',2,6),('639681381',3,6),('641094176',1,8),('641094176',2,8),('645063988',1,8),('645063988',2,8),('646015634',1,20),('646802947',1,18),('646802947',2,18),('646802947',3,18),('646802947',4,18),('646802947',5,18),('646802947',6,18),('647053262',1,15),('647053262',2,15)


SELECT * FROM UDW..LN65_LON_RPS LN65 INNER JOIN @Temp T ON T.BF_SSN = LN65.BF_SSN AND T.LN_SEQ = LN65.LN_SEQ AND T.LN_RPS_SEQ = LN65.LN_RPS_SEQ
SELECT * FROM UDW..LN66_LON_RPS_SPF LN66 INNER JOIN @Temp T ON T.BF_SSN = LN66.BF_SSN AND T.LN_SEQ = LN66.LN_SEQ AND T.LN_RPS_SEQ = LN66.LN_RPS_SEQ
SELECT * FROM UDW..RS05_IBR_RPS RS05 INNER JOIN @Temp T ON T.BF_SSN = RS05.BF_SSN
SELECT * FROM UDW..RS10_BR_RPD RS10 INNER JOIN @Temp T ON T.BF_SSN = RS10.BF_SSN AND T.LN_RPS_SEQ = RS10.LN_RPS_SEQ
SELECT * FROM OPENQUERY(DUSTER, 'SELECT * FROM OLWHRM1.RS20_IBR_IRL_LON') RS20 INNER JOIN @Temp T ON T.BF_SSN = RS20.BF_SSN AND T.LN_SEQ = RS20.LN_SEQ


DROP TABLE IF EXISTS #BASE 
DROP TABLE IF EXISTS #LEVEL
SELECT
	LN65.BF_SSN,
	LN65.LN_SEQ,
	LN65.LN_RPS_SEQ,
	LN65.LC_TYP_SCH_DIS
INTO #BASE
FROM
	UDW..RS10_BR_RPD RS10
	INNER JOIN UDW..LN65_LON_RPS LN65
		ON LN65.BF_SSN = RS10.BF_SSN
		AND LN65.LN_RPS_SEQ = RS10.LN_RPS_SEQ
WHERE
	LD_STA_RPST10  IN ('3/4/2019','3/5/2019')
	AND LC_TYP_SCH_DIS IN ('IB', 'IL')


SELECT
	LN65.BF_SSN,
	LN65.LN_SEQ,
	LN65.LN_RPS_SEQ,
	LN65.LC_TYP_SCH_DIS
INTO #LEVEL
FROM
	UDW..LN65_LON_RPS LN65
	INNER JOIN #BASE B
		ON B.BF_SSN = LN65.BF_SSN
		AND B.LN_SEQ = LN65.LN_SEQ
		AND LN65.LN_RPS_SEQ = B.LN_RPS_SEQ + 1
WHERE
	LN65.LC_TYP_SCH_DIS = 'L'


SELECT
	LN65.BF_SSN,
	LN65.LN_SEQ,
	LN65.LN_RPS_SEQ
FROM
	UDW..LN65_LON_RPS LN65
	INNER JOIN #LEVEL B
		ON B.BF_SSN = LN65.BF_SSN
		AND B.LN_SEQ = LN65.LN_SEQ
		AND LN65.LN_RPS_SEQ = B.LN_RPS_SEQ + 1
WHERE
	LN65.LC_TYP_SCH_DIS IN ('IB','IL')

