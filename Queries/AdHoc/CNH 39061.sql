/****************CHECK ATTENDANCE********************/

USE CDW
GO



DECLARE @OPEID TABLE (OPEID VARCHAR(X));
INSERT INTO @OPEID VALUES 
('XXXXXXXX'),
('XXXXXXXX'),
('XXXXXXXX'),
('XXXXXXXX'),
('XXXXXXXX'),
('XXXXXXXX'),
('XXXXXXXX'),
('XXXXXXXX')
;
--select * from @OPEID;

--enrolled
SELECT DISTINCT
	O.OPEID,
	PDXX.DM_PRS_X AS FirstName,
	PDXX.DM_PRS_LST AS LastName,
	LNXX.BF_SSN AS SSN,
	--LNXX.LD_TRM_BEG,
	IIF(AYXX.PF_REQ_ACT IN ('DIFCR','DICSK'), AYXX.PF_REQ_ACT, 'no') AS 'HAS_DIFCR/DICSK',
	AYXX.LD_ATY_REQ_RCV
FROM
	LNXX_LON LNXX
	INNER JOIN PDXX_PRS_NME PDXX
		ON LNXX.BF_SSN = PDXX.DF_PRS_ID
	INNER JOIN @OPEID O
		ON LNXX.LF_DOE_SCL_ORG = O.OPEID
	LEFT JOIN AYXX_BR_LON_ATY AYXX
		ON LNXX.BF_SSN = AYXX.BF_SSN
		AND AYXX.PF_REQ_ACT IN ('DIFCR','DICSK')
		AND AYXX.LC_STA_ACTYXX = 'A'
ORDER BY
	AYXX.LD_ATY_REQ_RCV
	,IIF(AYXX.PF_REQ_ACT IN ('DIFCR','DICSK'), AYXX.PF_REQ_ACT, 'no') DESC
;

