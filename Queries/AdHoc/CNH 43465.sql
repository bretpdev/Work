USE CDW

GO
SELECT
	*
FROM OPENQUERY(LEGEND,
'
SELECT DISTINCT
	PDXX.DF_SPE_ACC_ID
FROM 
	PKUB.PDXX_PRS_ADR PDXX
	INNER JOIN PKUB.PDXX_PRS_NME PDXX
		ON PDXX.DF_PRS_ID = PDXX.DF_PRS_ID
	INNER JOIN PKUB.LNXX_LON_CRB_RPT LNXX
		ON LNXX.BF_SSN = PDXX.DF_PRS_ID
WHERE
	SUBSTR(PDXX.DF_PRS_ID,X,X) != ''P'' 
	AND
	(
		DM_FGN_CNY != ''''
		OR
		DM_FGN_ST != ''''
	)
	AND PDXX.DD_VER_ADR < LNXX.LD_RPT_CRB

FOR READ ONLY WITH UR
')