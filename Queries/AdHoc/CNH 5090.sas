LIBNAME LEGEND REMOTE SERVER=LEGEND SLIBREF=WORK;
RSUBMIT;
LIBNAME PKUB DBX DATABASE=DNFPUTDL OWNER=PKUB;

%LET BEGIN = 'XXJANXXXX'D;

PROC SQL;
	CREATE TABLE TRANSXXXX AS
		SELECT DISTINCT
			BF_SSN,
			LN_SEQ,
			LD_FAT_APL
		FROM
			PKUB.LNXX_FIN_ATY
		WHERE
			LD_FAT_APL >= &BEGIN
			AND PC_FAT_TYP = 'XX'
			AND PC_FAT_SUB_TYP = 'XX'
	;

	CREATE TABLE NEWLNS AS
		SELECT DISTINCT
			LNXX.BF_SSN,
			LNXX.LN_SEQ,
			LNXX.LD_LON_ACL_ADD,
			LNXX.LD_LON_EFF_ADD,
			TRAN.LD_FAT_APL
		FROM
			PKUB.LNXX_LON LNXX
			JOIN TRANSXXXX TRAN
				ON LNXX.BF_SSN = TRAN.BF_SSN
		WHERE
			LNXX.LD_LON_EFF_ADD >= TRAN.LD_FAT_APL
			OR LNXX.LD_LON_ACL_ADD >= TRAN.LD_FAT_APL
	;
QUIT;

ENDRSUBMIT;

PROC EXPORT	
		DATA=LEGEND.TRANSXXXX
		OUTFILE='T:\SAS\SSAE XX XX and XX.xlsx'
		REPLACE;
RUN;

PROC EXPORT	
		DATA=LEGEND.NEWLNS
		OUTFILE='T:\SAS\SSAE XX XX and XX.xlsx'
		REPLACE;
RUN;
