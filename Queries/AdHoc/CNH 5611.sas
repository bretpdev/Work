LIBNAME XL 'T:\Disb Amt Mismatches.xlsx';
LIBNAME LEGEND REMOTE SERVER=LEGEND SLIBREF=WORK;

DATA LEGEND.MISMATCHES; 
	SET XL.'SHEETX$'N;
	WHERE NSL_ID <> '';
RUN;

RSUBMIT;
LIBNAME PKUB DBX DATABASE=DNFPUTDL OWNER=PKUB;

PROC SQL;
	CREATE TABLE XMISMATCHES AS
		SELECT
			MM.NSL_ID,
			MM.CS_ID,
			MM.NSL_DISB_AMT FORMAT COMMAXX.X,
			MM.CS_DISB_AMT FORMAT COMMAXX.X,
			MM.DIFF FORMAT COMMAXX.X,
			PDXX.DF_SPE_ACC_ID,
			FSXX.LN_SEQ
		FROM
			MISMATCHES MM
			LEFT JOIN PKUB.FSXX_DL_LON FSXX
				ON CATX('',FSXX.LF_FED_AWD,PUT(FSXX.LN_FED_AWD_SEQ,ZX.)) = MM.NSL_ID
			LEFT JOIN PKUB.PDXX_PRS_NME PDXX
				ON FSXX.BF_SSN = PDXX.DF_PRS_ID
	;
QUIT;
ENDRSUBMIT;

DATA XMISMATCHES; SET LEGEND.XMISMATCHES; RUN;

PROC EXPORT
		DATA=XMISMATCHES
		OUTFILE='T:\SAS\NSLDS Trigger File - mismatched disb amounts.xlsx'
		REPLACE;
RUN;
