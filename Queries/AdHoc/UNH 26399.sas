%LET RPTLIB = T:\SAS;
LIBNAME  DUSTER  REMOTE  SERVER=DUSTER  SLIBREF=WORK;
RSUBMIT;

PROC SQL;
	CONNECT TO DB2 (DATABASE=DLGSUTWH);

	CREATE TABLE DEMO AS
		SELECT 
			*
		FROM 
			CONNECTION TO DB2 
				(
					SELECT DISTINCT
						AY01.DF_PRS_ID, 
						BR03.BM_RFR_1,
						BR03.BM_RFR_LST,
						BR03.BX_RFR_STR_ADR_1,
						BR03.BX_RFR_STR_ADR_2,
						BR03.BM_RFR_CT,
						BR03.BC_RFR_ST,
						BR03.BF_RFR_ZIP,
						PD01.DM_PRS_1,
						PD01.DM_PRS_LST,
						PD01.DX_STR_ADR_1,
						PD01.DX_STR_ADR_2,
						PD01.DM_CT,
						PD01.DC_DOM_ST,
						PD01.DF_ZIP
					FROM
						OLWHRM1.AY01_BR_ATY	AY01
						INNER JOIN OLWHRM1.BR03_BR_REF BR03
							ON BR03.DF_PRS_ID_RFR = AY01.DF_PRS_ID
							AND BR03.BC_STA_BR03 = 'A'
						INNER JOIN OLWHRM1.PD01_PDM_INF PD01
							ON PD01.DF_PRS_ID = BR03.DF_PRS_ID_BR
					WHERE	
						AY01.BD_ATY_PRF = '03/10/2016'
						AND AY01.PF_ACT = 'KRREF'

					FOR READ ONLY WITH UR
				)
	;

	DISCONNECT FROM DB2;
QUIT;

ENDRSUBMIT;
DATA DEMO;
	SET DUSTER.DEMO;
RUN;
PROC EXPORT
		DATA=DEMO
		OUTFILE="&RPTLIB\UNH 26399.csv"
		DBMS = CSV
		REPLACE;
RUN;
