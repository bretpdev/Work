/*%LET RPTLIB = %SYSGET(reportdir);*/
%LET RPTLIB = T:\SAS;

%LET BEGIN 	= '01/01/2014';
%SYSLPUT BEGIN = &begin;

LIBNAME DUSTER REMOTE SERVER=DUSTER SLIBREF=WORK;
RSUBMIT;
LIBNAME OLWHRM1 DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;

PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE DEMO AS
	SELECT	*
	FROM	CONNECTION TO DB2 (
				SELECT	DISTINCT
						PD10.DF_SPE_ACC_ID
						,TRIM(PD10.DM_PRS_1) || ' ' || TRIM(PD10.DM_PRS_LST) AS NAME
						,LN90.LD_FAT_PST
						,LN90.LD_FAT_EFF
						,AD20.LC_WOF_WUP_REA
						,LK10.PX_DSC_XXL_XC
						,LN90.LA_FAT_CUR_PRI + LN90.LA_FAT_NSI AS WRITE_OFF_AMOUNT
				FROM	OLWHRM1.PD10_PRS_NME PD10
						INNER JOIN OLWHRM1.LN90_FIN_ATY LN90
							ON PD10.DF_PRS_ID = LN90.BF_SSN
						INNER JOIN OLWHRM1.AD20_PCV_ATY_ADJ AD20
							ON PD10.DF_PRS_ID = AD20.BF_SSN
						INNER JOIN OLWHRM1.LK10_LS_CDE_LKP LK10
							ON AD20.LC_WOF_WUP_REA = LK10.PX_ATR_VAL
/*							AND LK10.PM_ATR = 'LC-WOF-WUP-REA'*/
				WHERE	LN90.PC_FAT_TYP = '50'
						AND LN90.PC_FAT_SUB_TYP = '02'
						AND LN90.LD_FAT_PST >= &BEGIN
						
				FOR READ ONLY WITH UR
			);

DISCONNECT FROM DB2;

QUIT;

ENDRSUBMIT;
/*DATA DEMO; SET DUSTER.DEMO; RUN;*/
/**/
/*PROC EXPORT DATA= WORK.DEMO */
/*            OUTFILE= "T:\SAS\NH 19590.xls" */
/*            DBMS=EXCEL REPLACE;*/
/*RUN;*/
