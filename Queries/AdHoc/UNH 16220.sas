/*%LET RPTLIB = %SYSGET(reportdir);*/
%LET RPTLIB = T:\SAS;
FILENAME REPORTZ "&RPTLIB/ULWAB1.LWAB1RZ";
FILENAME REPORT2 "&RPTLIB/ULWAB1.LWAB1R2";
LIBNAME  DUSTER  REMOTE  SERVER=DUSTER  SLIBREF=WORK;
RSUBMIT;
/*LIBNAME OLWHRM1 DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;*/

PROC SQL;
	CONNECT TO DB2 (DATABASE=DLGSUTWH);

	CREATE TABLE POP1 AS
		SELECT 
			*
		FROM 
			CONNECTION TO DB2 
				(
					SELECT DISTINCT
						PD10.DF_SPE_ACC_ID,
						DF10.LD_DFR_REQ_END
						
					FROM
						OLWHRM1.LN10_LON LN10
					INNER JOIN OLWHRM1.DW01_DW_CLC_CLU DW01
						ON DW01.BF_SSN = LN10.BF_SSN
						AND DW01.LN_SEQ = LN10.LN_SEQ
						AND WC_DW_LON_STA = '03'
					INNER JOIN OLWHRM1.DF10_BR_DFR_REQ DF10
						ON DF10.BF_SSN = LN10.BF_SSN
					INNER JOIN OLWHRM1.PD10_PRS_NME PD10
						ON PD10.DF_PRS_ID = LN10.BF_SSN
					WHERE 
						IC_LON_PGM = 'TILP'
						AND LC_DFR_TYP = '06'
						AND LN10.LA_CUR_PRI > 0
						AND DAYS(DF10.LD_DFR_REQ_END) BETWEEN DAYS('09/01/2010') AND DAYS('09/30/2011')
						AND LN10.BF_SSN NOT IN (SELECT BF_SSN FROM OLWHRM1.DF10_BR_DFR_REQ DF10 WHERE DAYS(LD_DFR_REQ_BEG) > DAYS('10/01/2011'))

					
					

					FOR READ ONLY WITH UR
				)
	;

	DISCONNECT FROM DB2;

	/*%PUT  SQLXRC= >>> &SQLXRC <<< ||| SQLXMSG= >>> &SQLXMSG >>> ;  ** INCLUDES ERROR MESSAGES TO SAS LOG  ;*/
	/*%SQLCHECK;*/
QUIT;

PROC SQL;
	CONNECT TO DB2 (DATABASE=DLGSUTWH);

	CREATE TABLE POP2 AS
		SELECT 
			*
		FROM 
			CONNECTION TO DB2 
				(
					SELECT DISTINCT
						PD10.DF_SPE_ACC_ID,
						DF10.LD_DFR_REQ_END
						
					FROM
						OLWHRM1.LN10_LON LN10
					INNER JOIN OLWHRM1.DW01_DW_CLC_CLU DW01
						ON DW01.BF_SSN = LN10.BF_SSN
						AND DW01.LN_SEQ = LN10.LN_SEQ
						AND WC_DW_LON_STA = '03'
					INNER JOIN OLWHRM1.DF10_BR_DFR_REQ DF10
						ON DF10.BF_SSN = LN10.BF_SSN
					INNER JOIN OLWHRM1.PD10_PRS_NME PD10
						ON PD10.DF_PRS_ID = LN10.BF_SSN
					WHERE 
						IC_LON_PGM = 'TILP'
						AND LC_DFR_TYP = '06'
						AND LN10.LA_CUR_PRI > 0
						AND DAYS(DF10.LD_DFR_REQ_END) BETWEEN DAYS('09/01/2011') AND DAYS('09/30/2012')
						AND LN10.BF_SSN NOT IN (SELECT BF_SSN FROM OLWHRM1.DF10_BR_DFR_REQ DF10 WHERE DAYS(LD_DFR_REQ_BEG) > DAYS('10/01/2012'))

					

					FOR READ ONLY WITH UR
				)
	;

	DISCONNECT FROM DB2;

	/*%PUT  SQLXRC= >>> &SQLXRC <<< ||| SQLXMSG= >>> &SQLXMSG >>> ;  ** INCLUDES ERROR MESSAGES TO SAS LOG  ;*/
	/*%SQLCHECK;*/
QUIT;

ENDRSUBMIT;


PROC EXPORT DATA= duster.POP1 
            OUTFILE= "T:\SAS\NH 16220.xls" 
            DBMS=EXCEL REPLACE;
     SHEET="POP1"; 
RUN;

PROC EXPORT DATA= duster.POP2 
            OUTFILE= "T:\SAS\NH 16220.xls" 
            DBMS=EXCEL REPLACE;
     SHEET="POP2"; 
RUN;
