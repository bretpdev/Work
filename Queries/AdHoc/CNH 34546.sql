DECLARE @BEGIN AS DATE = 'XXXX-XX-XX'
DECLARE @END AS DATE = 'XXXX-XX-XX'


SELECT DISTINCT
	LNXX.BF_SSN
	,LNXX.LN_SEQ
	,CASE
		WHEN LTXX.InactivatedAt IS NOT NULL THEN 'FALSE'
		ELSE 'TRUE'
	END AS LETTER_SENT
FROM 
	CDW..LNXX_LON LNXX
	INNER JOIN CDW..PDXX_PRS_NME PDXX
		ON LNXX.BF_SSN = PDXX.DF_PRS_ID
	INNER JOIN CDW..LNXX_LON_ATY LNXX
		ON LNXX.BF_SSN = LNXX.BF_SSN
		AND LNXX.LN_SEQ = LNXX.LN_SEQ
	INNER JOIN CDW..AYXX_BR_LON_ATY AYXX 
		ON LNXX.BF_SSN = AYXX.BF_SSN 
		AND LNXX.LN_ATY_SEQ = AYXX.LN_ATY_SEQ
	LEFT JOIN CDW..LTXX_LTR_REQ_PRC LTXX
		ON PDXX.DF_SPE_ACC_ID = LTXX.DF_SPE_ACC_ID
		AND LTXX.RM_DSC_LTR_PRC = 'TSXXBFDLP'
		AND LTXX.CreatedAt BETWEEN @BEGIN AND @END
WHERE 
	AYXX.PF_REQ_ACT = 'DLFDL'
	AND AYXX.LD_ATY_REQ_RCV BETWEEN @BEGIN AND @END

ORDER BY
	LNXX.BF_SSN
	,LNXX.LN_SEQ
