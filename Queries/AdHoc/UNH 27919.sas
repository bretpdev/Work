%LET RPTLIB = T:\SAS;
LIBNAME XL 'T:\DC19.xlsx';
DATA WORK.XLSOURCE;
	SET XL.'DC19$'N;
	_LF_CRT_DTS_DC10=inPUT(LF_CRT_DTS_DC10,YMDDTTM27.7);
	_LF_CRT_DTS_DC19=INPUT(LF_CRT_DTS_DC19,YMDDTTM27.7);
RUN;
LIBNAME XL CLEAR;

DATA XLSOURCE;
SET XLSOURCE;
FORMAT _LF_CRT_DTS_DC10 DATETIME27.6;
FORMAT _LF_CRT_DTS_DC19 DATETIME27.6;
RUN;

LIBNAME  DUSTER  REMOTE  SERVER=DUSTER  SLIBREF=WORK; /*live*/

DATA DUSTER.XLSOURCE; *Send data to Duster;
SET XLSOURCE;
RUN;

RSUBMIT;

%LET DB = DLGSUTWH; /*live*/
LIBNAME OLWHRM1 DB2 DATABASE=&DB OWNER=OLWHRM1; /*needed for SQL queries, but not for DB2 queries*/

PROC SQL;
CREATE TABLE LoanDetail AS
	SELECT DISTINCT
		XLS.*
		,LC_DOE_LON_TYP 
		,LR_DOE_RIN_PER
		,LD_RIN_DAT_ACP_NDS
	FROM
		WORK.XLSOURCE XLS
		INNER JOIN OLWHRM1.DC19_DOE_RIN DC19
			ON XLS.AF_APL_ID = DC19.AF_APL_ID
			AND XLS.AF_APL_ID_SFX = DC19.AF_APL_ID_SFX
			AND XLS._LF_CRT_DTS_DC10 = DC19.LF_CRT_DTS_DC10
			AND XLS._LF_CRT_DTS_DC19 = DC19.LF_CRT_DTS_DC19
;
QUIT;

ENDRSUBMIT;

DATA LoanDetail (DROP=_LF_CRT_DTS_DC10 _LF_CRT_DTS_DC19);
	SET DUSTER.LoanDetail;
RUN;

PROC EXPORT
		DATA=LoanDetail
		OUTFILE="&RPTLIB\UNH 27919.xlsx"
		DBMS = EXCEL
		REPLACE;
		SHEET="DC19";
RUN;
