INSERT INTO CLS..DueDateChange(Ssn, AccountNumber, DueDate, Arc, Comment, ProcessedAt, Successful, AddedAt)
SELECT DISTINCT
	LNXX.BF_SSN AS Ssn,
	PDXX.DF_SPE_ACC_ID AS AccountNumber,
	XX AS DueDate,
	NULL AS Arc,
	NULL AS Comment,
	NULL AS ProcessedAt,
	NULL AS Successful,
	GETDATE() AS AddedAt
FROM
	CDW..PDXX_PRS_NME PDXX
	INNER JOIN CDW..LNXX_LON LNXX
		ON LNXX.BF_SSN = PDXX.DF_PRS_ID
	INNER JOIN CDW..LNXX_LON_BIL_CRF LNXX
		ON LNXX.BF_SSN = LNXX.BF_SSN
		AND LNXX.LN_SEQ = LNXX.LN_SEQ
		AND LNXX.LC_STA_LONXX = 'A'
		AND DAY(LNXX.LD_BIL_DU_LON) BETWEEN XX AND XX
	INNER JOIN CDW..PDXX_PRS_ADR PDXX
		ON PDXX.DF_PRS_ID = PDXX.DF_PRS_ID
		AND PDXX.DC_ADR = 'L'
		AND PDXX.DI_VLD_ADR = 'Y'
	LEFT JOIN CDW..LNXX_LON_DLQ_HST LNXX
		ON LNXX.BF_SSN = LNXX.BF_SSN
		AND LNXX.LN_SEQ = LNXX.LN_SEQ
		AND LNXX.LC_STA_LONXX = 'X'
		AND CAST(LNXX.LD_DLQ_MAX AS DATE) >= CAST(DATEADD(DAY,-X,GETDATE()) AS DATE) --Account for long weekends and bad refreshes
	LEFT JOIN CDW..LNXX_LON_RPS LNXX
		ON LNXX.BF_SSN = LNXX.BF_SSN
		AND LNXX.LN_SEQ = LNXX.LN_SEQ
		AND LNXX.LC_STA_LONXX = 'A'
		AND LNXX.LC_TYP_SCH_DIS IN('IB','IL','IX','IP','CX','CX','CX','CQ','CA','CP','IX','IA')
WHERE
	LNXX.LA_CUR_PRI > X.XX
	AND LNXX.LC_STA_LONXX = 'R'
	AND LNXX.BF_SSN IS NULL --NOT DELINQUENT
	AND LNXX.BF_SSN IS NULL --NOT IDR
	
