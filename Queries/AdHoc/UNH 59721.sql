SELECT distinct
	sum(la_cur_pri) as balance
	
FROM
(
SELECT *  FROM OPENQUERY(duster,
'
SELECT DISTINCT
	PD31.DF_PRS_ID
FROM 
	olwhrm1.PD31_PRS_INA PD31

WHERE
	DF_PRS_ID NOT LIKE ''P%''
	AND DI_VLD_ADR_HST = ''Y''
	AND (YEAR(DD_CRT_PD31) = 2017 OR YEAR(DF_LST_DTS_PD31) = 2017 OR YEAR(DD_VER_ADR_HST) = 2017)
	AND DC_DOM_ST_HST = ''WA''

') oq

UNION
	
SELECT
	DF_PRS_ID
FROM
	uDW..PD30_PRS_ADR
WHERE
	DC_DOM_ST = 'WA'
	AND DI_VLD_ADR = 'Y'
	AND YEAR(DF_LST_DTS_PD30) < 2018
	AND DF_PRS_ID NOT LIKE 'P%'
) OQ
	INNER JOIN AudituDW..LN10_LON_Dec2017 ln10
		on ln10.bf_ssn = oq.df_prs_id
where
	ln10.lc_sta_lon10 = 'R'



SELECT
	SUM(LA_CUR_PRI) AS BAL
FROM 
	uDW..LN10_LON LN10
	INNER JOIN uDW..PD30_PRS_ADR PD30
		ON PD30.DF_PRS_ID = LN10.BF_SSN
WHERE
	YEAR(LN10.LD_LON_ACL_ADD) = 2018 
	AND DC_DOM_ST = 'WA'
	AND DI_VLD_ADR = 'Y'
	AND DF_PRS_ID NOT LIKE 'P%'
	AND LN10.LC_STA_LON10 = 'R'
