
--Select all borrowers with an active ACH record BC_EFT_STA  = �A� 
--principal balance is greater than zero LA_CUR_PRI > X 
--active repayment schedule LC_STA_LONXX = 'A 
--State Code PDXX.DC_DOM_ST = VI, PR or FL

--Please include state code and Zip, PDXX.DF_ZIP_CDE


USE CDW
GO

SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
GO

SELECT DISTINCT
	LNXX.BF_SSN
	,BRXX.BC_EFT_STA
	,CASE
		WHEN LNXX.LA_CUR_PRI > X.XX
		THEN '> X'
		ELSE NULL
	END AS Principal_Balance
	,LNXX.LC_STA_LONXX
	,PDXX.DC_DOM_ST
	,PDXX.DF_ZIP_CDE
FROM
	..LNXX_LON LNXX
	INNER JOIN ..BRXX_BR_EFT BRXX
		ON BRXX.BF_SSN = LNXX.BF_SSN
	INNER JOIN ..LNXX_LON_RPS LNXX
		ON LNXX.BF_SSN = LNXX.BF_SSN
		AND LNXX.LN_SEQ = LNXX.LN_SEQ
	INNER JOIN ..PDXX_PRS_ADR PDXX
		ON LNXX.BF_SSN = PDXX.DF_PRS_ID
WHERE
	BRXX.BC_EFT_STA  = 'A'
	AND LNXX.LA_CUR_PRI > X.XX
	AND LNXX.LC_STA_LONXX = 'A'
	AND PDXX.DC_DOM_ST IN ('VI', 'PR', 'FL')
ORDER BY
	DC_DOM_ST DESC