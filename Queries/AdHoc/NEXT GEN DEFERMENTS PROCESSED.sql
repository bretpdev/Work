USE CDW
GO

SELECT
COUNT(*) AS [TOTAL PROCESSED],
SUM(POP.AGENT_COUNT) AS [AGENT COUNT],
SUM(POP.SCRIPT_COUNT) AS [SCRIPT COUNT],
SUM(POP.SYSTEM_COUNT) AS [SYSTEM COUNT]
FROM
	(
	SELECT DISTINCT
		DF10.BF_SSN,
		DF10.LF_DFR_CTL_NUM,
		CASE WHEN LF_USR_CRT_REQ_DFR in ('UT00204', 'UT00205', 'UT00221', 'UT00314', 'UT00553', 'UT00554', 'UT00555', 'UT00564', 'UT00801', 'UT00802', 'UT00803', 'UT00804', 'UT00805', 
'UT00806', 'UT00807', 'UT00808', 'UT00809', 'UT00810', 'UT01648', 'UT01649', 'UT01650', 'UT01651', 'UT01652') THEN 1 ELSE 0 END AS SCRIPT_COUNT,
		CASE WHEN LF_USR_CRT_REQ_DFR NOT IN ('UT00204', 'UT00205', 'UT00221', 'UT00314', 'UT00553', 'UT00554', 'UT00555', 'UT00564', 'UT00801', 'UT00802', 'UT00803', 'UT00804', 'UT00805', 
'UT00806', 'UT00807', 'UT00808', 'UT00809', 'UT00810', 'UT01648', 'UT01649', 'UT01650', 'UT01651', 'UT01652') AND LF_USR_CRT_REQ_DFR LIKE 'UT%' THEN 1 ELSE 0 END AS AGENT_COUNT,
		CASE WHEN LF_USR_CRT_REQ_DFR NOT LIKE 'UT%' THEN 1 ELSE 0 END AS SYSTEM_COUNT
	FROM
		LN50_BR_DFR_APV LN50
		INNER JOIN DF10_BR_DFR_REQ DF10
			ON DF10.BF_SSN = LN50.BF_SSN
			AND DF10.LF_DFR_CTL_NUM = LN50.LF_DFR_CTL_NUM
			
	WHERE
		--LN50.LC_STA_LON50 = 'A'
		--AND DF10.LC_STA_DFR10 = 'A'
		 DF10.LD_CRT_REQ_DFR BETWEEN '07/01/2018' AND '06/30/2019'
	) POP