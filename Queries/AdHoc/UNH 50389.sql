SELECT * FROM OPENQUERY(DUSTER,
'
	SELECT 
		PD10.DF_SPE_ACC_ID,
		LN10.BF_SSN,
		LN10.LN_SEQ,
		LN10.LA_CUR_PRI,
		AY10_1.LD_ATY_REQ_RCV AS DatePIF,
		AY10_2.LD_ATY_REQ_RCV AS DateBBAdj
	FROM
		OLWHRM1.PD10_PRS_NME PD10
		INNER JOIN OLWHRM1.LN10_LON LN10
			ON LN10.BF_SSN = PD10.DF_PRS_ID
		INNER JOIN OLWHRM1.LN85_LON_ATY LN85
			ON LN85.BF_SSN = LN10.BF_SSN
			AND LN85.LN_SEQ = LN10.LN_SEQ
		INNER JOIN 
		(
			SELECT
				AY10.BF_SSN,
				LN85.LN_SEQ,
				MIN(AY10.LN_ATY_SEQ) AS LN_ATY_SEQ,
				MIN(AY10.LD_ATY_REQ_RCV) AS LD_ATY_REQ_RCV
			FROM
				OLWHRM1.LN85_LON_ATY LN85
				INNER JOIN OLWHRM1.AY10_BR_LON_ATY AY10
					ON AY10.BF_SSN = LN85.BF_SSN
					AND AY10.LN_ATY_SEQ = LN85.LN_ATY_SEQ
			WHERE
				AY10.PF_REQ_ACT = ''LS014''
			GROUP BY
				AY10.BF_SSN,
				LN85.LN_SEQ
		) AY10_1
			ON AY10_1.BF_SSN = LN85.BF_SSN
			AND AY10_1.LN_SEQ = LN85.LN_SEQ
			AND AY10_1.LN_ATY_SEQ = LN85.LN_ATY_SEQ	
		INNER JOIN 
		(
			SELECT
				AY10.BF_SSN,
				LN85.LN_SEQ,
				MAX(AY10.LN_ATY_SEQ) AS LN_ATY_SEQ,
				MAX(AY10.LD_ATY_REQ_RCV) AS LD_ATY_REQ_RCV
			FROM
				OLWHRM1.LN85_LON_ATY LN85
				INNER JOIN OLWHRM1.AY10_BR_LON_ATY AY10
					ON AY10.BF_SSN = LN85.BF_SSN
					AND AY10.LN_ATY_SEQ = LN85.LN_ATY_SEQ
			WHERE
				AY10.PF_REQ_ACT = ''BBS01''
			GROUP BY
				AY10.BF_SSN,
				LN85.LN_SEQ
		) AY10_2
			ON AY10_2.BF_SSN = LN85.BF_SSN
			AND AY10_2.LN_SEQ = LN85.LN_SEQ
			AND AY10_2.LN_ATY_SEQ != AY10_1.LN_ATY_SEQ
			AND AY10_2.LD_ATY_REQ_RCV > ''2017-01-15''
			AND AY10_2.LD_ATY_REQ_RCV > AY10_1.LD_ATY_REQ_RCV
'
)
