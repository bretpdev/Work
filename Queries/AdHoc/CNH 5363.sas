LIBNAME LEGEND REMOTE SERVER=LEGEND SLIBREF=WORK;
LIBNAME XL 'T:\Random Sample of Borrowers.xlsx';

DATA KATH (DROP=DF_PRS_ID);
	SET XL.'SHEETX$'N ;
	SSN = PUT(DF_PRS_ID,ZX.);
RUN;

DATA LEGEND.KATH; SET KATH; RUN;

RSUBMIT;
LIBNAME PKUB DBX DATABASE=DNFPUTDL OWNER=PKUB;

PROC SQL;
	CREATE TABLE SOURCESET AS
		SELECT distinct
			PDXX.DF_PRS_ID
		FROM
			PKUB.PDXX_PRS_NME PDXX
			LEFT JOIN KATH
				ON PDXX.DF_PRS_ID = KATH.SSN
			inner join pkub.LNXX_LON lnXX
				on pdXX.df_prs_id = lnXX.bf_ssn
		WHERE
			KATH.SSN IS NULL
			AND SUBSTR(PDXX.DF_PRS_ID,X,X) <> 'P'
			and lnXX.la_cur_pri > X
			and lnXX.LC_STA_LONXX = 'R'
	;
QUIT;

DATA RSUBSET (KEEP=DF_PRS_ID);
	SAMPSIZE=XXX;
	OBSLEFT=TOTOBS;
	DO WHILE(SAMPSIZE>X);
		PICKIT+X;
		IF RANUNI(X)<SAMPSIZE/OBSLEFT THEN DO;
			SET SOURCESET POINT=PICKIT
				NOBS=TOTOBS;
			OUTPUT;
			SAMPSIZE=SAMPSIZE-X;
		END;
		OBSLEFT=OBSLEFT-X;
	END;
	STOP;
RUN;

ENDRSUBMIT;

DATA RSUBSET; SET LEGEND.RSUBSET; RUN;

PROC EXPORT
		DATA=RSUBSET
		OUTFILE='T:\RANDOM SAMPLE_BRW.XLSX'
		REPLACE;
RUN;

