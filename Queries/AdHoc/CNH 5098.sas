LIBNAME  LEGEND  REMOTE  SERVER=LEGEND SLIBREF=work  ;
RSUBMIT LEGEND;
LIBNAME PKUB DBX DATABASE=DNFPUTDL OWNER=PKUB;

%LET BEGIN = 'XXJANXXXX'D;

PROC SQL;
	CREATE TABLE IDR AS
		SELECT DISTINCT
			TRIM(PDXX.DM_PRS_X) || ' ' || TRIM(PDXX.DM_PRS_LST) AS BRW_NAME,
			LNXX.BF_SSN,
  			LNXX.LN_SEQ,
  			LNXX.IC_LON_PGM,
			LNXX.LC_TYP_SCH_DIS,
			LNXX.LD_CRT_LONXX,
			LNXX.LA_CPI_RPD_DIS,
			LNXX.LA_ACR_INT_RPD,
			LNXX.LD_LON_EFF_ADD
		FROM
			PKUB.PDXX_PRS_NME PDXX
			JOIN PKUB.LNXX_LON LNXX
				ON PDXX.DF_PRS_ID = LNXX.BF_SSN
			JOIN PKUB.LNXX_LON_RPS LNXX
				ON LNXX.BF_SSN = LNXX.BF_SSN
				AND LNXX.LN_SEQ = LNXX.LN_SEQ
		WHERE
			LNXX.IC_LON_PGM IN ('DLSTFD','DLUNST','STFFRD','UNSTFD')
			AND LNXX.LC_TYP_SCH_DIS IN ('IB', 'CX', 'CX', 'CX', 'CA')
			AND LNXX.LD_CRT_LONXX >= &BEGIN
		ORDER BY
			LNXX.BF_SSN,
  			LNXX.LN_SEQ	
	;
QUIT;

ENDRSUBMIT;

DATA IDR; SET LEGEND.IDR; RUN;

PROC EXPORT
	DATA = IDR
	OUTFILE = "T:\SAS\SSAE XX Audit Query of IDR borrowers.xlsx"
	DBMS = EXCEL
	REPLACE;
RUN;
