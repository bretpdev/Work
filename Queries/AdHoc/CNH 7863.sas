LIBNAME LEGEND REMOTE SERVER=LEGEND SLIBREF=WORK;
RSUBMIT;
LIBNAME PKUB DBX DATABASE=DNFPUTDL OWNER=PKUB;
%let DB = DNFPUTDL;  *This is live;

PROC SQL;
	CONNECT TO DBX (DATABASE=&DB);

	CREATE TABLE LNXXDUMP AS
		SELECT	
			DISTINCT DF_SPE_ACC_ID
		FROM	
			CONNECTION TO DBX 
	(
		SELECT 
			PDXX.DF_SPE_ACC_ID
		FROM
			PKUB.LNXX_LON_RPS LNXX
			INNER JOIN PKUB.BRXX_BR_EFT BRXX
			ON BRXX.BF_SSN = LNXX.BF_SSN
			INNER JOIN PKUB.PDXX_PRS_NME PDXX
			ON PDXX.DF_PRS_ID = LNXX.BF_SSN
		WHERE 
			date(LNXX.LF_LST_DTS_LNXX) BETWEEN 'X/XX/XXXX' AND 'X/XX/XXXX'
			AND LNXX.LC_RPD_INA_REA <> ''
			AND BRXX.BC_EFT_STA = 'D'
			AND date(BRXX.BF_LST_DTS_BRXX) BETWEEN 'X/XX/XXXX' AND 'X/XX/XXXX'

		FOR READ ONLY WITH UR
	)
	;
	DISCONNECT FROM DBX;
QUIT;

ENDRSUBMIT;

DATA LNXXDUMP; SET LEGEND.LNXXDUMP; RUN;

PROC EXPORT	
		DATA=LEGEND.LNXXDUMP
		OUTFILE='T:\SAS\NH XXXX data dump.xlsx'
		REPLACE;
RUN;
