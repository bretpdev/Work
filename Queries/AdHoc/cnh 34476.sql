

declare @emails table (letterid varchar(10))
insert into @emails
values('DIRLETFED'),
('LTESGEMFED'),
('DELEML04'),
('PLCSLEML02'),
('DELEML03'),
('PLCSLEML01'),
('ACHSOLBR2'),
('ACHSOLBR3'),
('ACHSOLBR1'),
('US06BMFPE'),
('CODWLCMEML'),
('DLQEM05FD'),
('DLQEM10FD'),
('DLQEM15FD'),
('DLQEM20FD'),
('DLQEM25FD'),
('DLQEM30FD'),
('DLQEM35FD'),
('DLQEM40FD'),
('DLQEM45FD'),
('DLQEM50FD'),
('DLQEM55FD'),
('DLQEM60FD'),
('DLQEM65FD'),
('DLQEM70FD'),
('DLQEM75FD'),
('DLQEM80FD'),
('BRSKIPEML'),
('WELSCHFED'),
('TAXNOTFFED'),
('CSWELCOME5'),
('CSWELCOME4'),
('CSWELCOME2'),
('CSWELCOME3'),
('MONREDFED'),
('NWACTNOFED'),
('PIFFEDMAN'),
('LTEMAILFED'),
('EPHNATTFED'),
('ERPGFED'),
('FDIOAFED'),
('EMDTENFED'),
('EMATRPTFED'),
('EFNBLNOPFD'),
('US06BMFP4'),
('EWLCOMEFED')
declare @letters table (letterid varchar(10))
insert into @letters
values('DIRLETFED'),
('LTESGEMFED'),
('DELEML04'),
('PLCSLEML02'),
('TS09B60CP'),
('DELEML03'),
('PLCSLEML01'),
('ACHSOLBR2'),
('ACHSOLBR3'),
('ACHSOLBR1'),
('US06BMFPE'),
('CODWLCMEML'),
('FM06BCPLS'),
('FM06DACMP'),
('DLQEM05FD'),
('DLQEM10FD'),
('DLQEM15FD'),
('DLQEM20FD'),
('DLQEM25FD'),
('DLQEM30FD'),
('DLQEM35FD'),
('DLQEM40FD'),
('DLQEM45FD'),
('DLQEM50FD'),
('DLQEM55FD'),
('DLQEM60FD'),
('DLQEM65FD'),
('DLQEM70FD'),
('DLQEM75FD'),
('DLQEM80FD'),
('BRSKIPEML'),
('TS09B60P'),
('TS06BD6016'),
('TS06BDMP'),
('WELSCHFED'),
('TAXINTFED'),
('TAXWOFED'),
('TAXNOTFFED'),
('CSWELCOME5'),
('CSWELCOME4'),
('CSWELCOME2'),
('CSWELCOME3'),
('CSWELCOMEP'),
('TS06BTSA'),
('TS06BTM2LM'),
('MONREDFED'),
('NWACTNOFED'),
('PIFFEDMAN'),
('INTBILFED'),
('INNOSCHFED'),
('LTEMAILFED'),
('EPHNATTFED'),
('PHNATTLFED'),
('TS06BCAP'),
('TS06BRATE'),
('TS06OTLINT'),
('TS06BTRT4'),
('TS06BNEGAM'),
('PMTMONFED'),
('PAYOFFFED'),
('FINBLNOPFD'),
('RPDISCFED'),
('SDEFWVRFED'),
('TS06BTPO'),
('TS50BAGLB1'),
('TS06BREAF'),
('TS06BR001'),
('TS06BSAPPM'),
('ERPGFED'),
('FDIOAFED'),
('EMDTENFED'),
('LDMCSTNFED'),
('TS06BDD10'),
('EASYPAY'),
('EBILLFED'),
('EMATRPTFED'),
('EFNBLNOPFD'),
('TS09BFDCP'),
('US06BMFP4'),
('240DELQFED'),
('EWLCOMEFED'),
('TS06BD10DC'),
('TS06BDD140'),
('TS06BDD20'),
('TS06BDD40'),
('TS06BDD80'),
('TS06BD80DC'),
('TS06BIDREC'),
('TS06BFNBIL'),
('TS09BFDLP'),
('TS06BD6015'),
('TS06BD6018'),
('TS50BGLB1')


select 
	YEAR(DD.DocDate) AS [Year],
	LL.letterid AS Letter,
	COUNT(dd.DocumentDetailsId) AS [Letter Count]
from 
	@letters LL
	INNER JOIN ECorrFed..Letters L
		ON L.Letter = LL.letterid
	LEFT JOIN ECorrFed..DocumentDetails DD
		ON L.LetterId = DD.LetterId
		AND YEAR(DD.DocDate) BETWEEN 2016 AND 2017
WHERE
	--YEAR(DD.DocDate) BETWEEN 2016 AND 2017
	 LL.letterid NOT IN ('TAXNOTFFED',
'DIRLETFED',
'LTESGEMFED',
'US06BMFPE',
'CODWLCMEML',
'WELSCHFED',
'CSWELCOME5',
'CSWELCOME4',
'CSWELCOME2',
'CSWELCOME3',
'MONREDFED',
'NWACTNOFED',
'PIFFEDMAN',
'LTEMAILFED',
'ERPGFED',
'FDIOAFED',
'EMDTENFED',
'US06BMFP4',
'EWLCOMEFED')
GROUP BY
	YEAR(DD.DocDate),
	LL.letterid



UNION




SELECT 
	YEAR(AY10.LD_ATY_REQ_RCV) AS [Year],
	E.letterid as Letter,
	COUNT(ay10.bf_ssn)  as [Letter Count]
FROM 
	@emails E 
	INNER JOIN CLS.emailbtcf.EmailCampaigns EC 
		ON REPLACE(EC.LetterId, '.html','') = e.letterid 
	LEFT JOIN CDW..AY10_BR_LON_ATY AY10
		ON AY10.PF_REQ_ACT = EC.Arc
		AND YEAR(AY10.LD_ATY_REQ_RCV) BETWEEN 2016 AND 2017
WHERE
	
	REPLACE(EC.LetterId, '.html','') NOT IN ('TAXNOTFFED',
'DIRLETFED',
'LTESGEMFED',
'US06BMFPE',
'CODWLCMEML',
'WELSCHFED',
'CSWELCOME5',
'CSWELCOME4',
'CSWELCOME2',
'CSWELCOME3',
'MONREDFED',
'NWACTNOFED',
'PIFFEDMAN',
'LTEMAILFED',
'ERPGFED',
'FDIOAFED',
'EMDTENFED',
'US06BMFP4',
'EWLCOMEFED')
GROUP BY
	YEAR(AY10.LD_ATY_REQ_RCV),
	E.letterid
ORDER BY
	[Year],
	Letter

--select * from cls.emailbtcf.EmailCampaigns