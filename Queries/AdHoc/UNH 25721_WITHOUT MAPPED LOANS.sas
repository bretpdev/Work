%LET BANA = %STR(REQUIRED="FILEDSN=X:\PADR\ODBC\EA27_BANA_2.dsn; update_lock_typ=nolock; bl_keepnulls=no");
LIBNAME BANA ODBC &BANA ;

PROC SQL;
	CREATE TABLE SOURCE AS 
		SELECT distinct
			DISB.BORROWERSSN,
			DISB.LOAN_NUMBER,
			DisbursementNumber,
			DisbursementDate,
			PrincipalBalanceOutstanding,
			CommonLineUniqueID,
			LoanIdentification,
			DISB.DEAL_ID
		FROM
			BANA._07_08DisbClaimEnrollRecord DISB
;
QUIT;

/*TEST*/
LIBNAME  DUSTER  REMOTE  SERVER=QADBD004 SLIBREF=WORK  ;

/*LIVE*/
/*LIBNAME  DUSTER  REMOTE  SERVER=DUSTER  SLIBREF=WORK;*/

DATA DUSTER.SOURCE; *Send data to Duster;
SET SOURCE;
RUN;


RSUBMIT;  
%let DB = DLGSWQUT;  *This is test;
/*%let DB = DLGSUTWH;  *This is live;*/
LIBNAME OLWHRM1 DB2 DATABASE=&DB OWNER=OLWHRM1;
PROC SQL;
	CREATE TABLE RESULT AS
		SELECT DISTINCT
			LN35.BF_SSN,
			LN35.LN_SEQ,
			LN35.IF_OWN,
			LN35.LN_LON_OWN_SEQ,
			LN35.IF_BND_ISS as IF_BND_ISS_OLD,
			CASE
				WHEN DEAL_ID = 'UU' THEN 'WHSE'
				WHEN DEAL_ID = 'UO' THEN '15020151'
				ELSE ''
			END AS IF_BND_ISS_NEW
		FROM
			 SOURCE S
			 LEFT JOIN OLWHRM1.LN10_LON LN10
			 	ON LN10.BF_SSN = S.BORROWERSSN
				AND LN10.LF_GTR_RFR_XTN = S.LoanIdentification
			 LEFT JOIN OLWHRM1.LN35_LON_OWN LN35
			 	ON LN35.BF_SSN = LN10.BF_SSN
				AND LN35.LN_SEQ = LN10.LN_SEQ
		WHERE
			PF_MAJ_BCH in('2016029001','2016029002','2016029003','2016029004')
		
;
QUIT;
ENDRSUBMIT;

DATA RESULT;
SET DUSTER.RESULT;
RUN;
/**/
PROC EXPORT DATA = WORK.RESULT 
            OUTFILE = "T:\NH 25721.xlsx" 
            DBMS = EXCEL
			REPLACE;
     SHEET="Sheet1"; 
RUN;
