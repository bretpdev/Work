SELECT DISTINCT
	PDXX.DF_SPE_ACC_ID, --Account Number
	DWXX.LN_SEQ,--Loan Seq #
	DWXX.WD_LON_RPD_SR AS RepaymentStartDate,--Repayment Start Date
	DFR.LC_DFR_TYP AS DeferType,--Deferment Type (if applicable)
	DFR.LD_DFR_BEG AS DeferBegin,--Deferment Begin Date (if applicable)
	DFR.LD_DFR_END AS DeferEnd,--Deferment End Date (if applicable)
	FBR.LC_FOR_TYP AS ForbType,--Forbearance Type (if applicable)
	FBR.LD_FOR_BEG AS ForbBegin,--Forbearance Begin Date (if applicable)
	FBR.LD_FOR_END AS ForbEnd--Forbearance End Date (if applicable)
FROM
	CDW..PDXX_PRS_NME PDXX
	INNER JOIN CDW..DWXX_DW_CLC_CLU DWXX
		ON PDXX.DF_PRS_ID = DWXX.BF_SSN
	LEFT JOIN
	(
		SELECT
			LNXX.BF_SSN,
			LNXX.LN_SEQ,
			DFXX.LC_DFR_TYP,
			CAST(LNXX.LD_DFR_BEG AS DATE) AS LD_DFR_BEG,
			CAST(LNXX.LD_DFR_END AS DATE) AS LD_DFR_END
		FROM
			CDW..DFXX_BR_DFR_REQ DFXX
			INNER JOIN CDW..LNXX_BR_DFR_APV LNXX
				ON DFXX.BF_SSN = LNXX.BF_SSN
				AND DFXX.LF_DFR_CTL_NUM = LNXX.LF_DFR_CTL_NUM
			WHERE
			DFXX.LC_DFR_STA = 'A'
			AND DFXX.LC_STA_DFRXX = 'A'
			AND LNXX.LC_STA_LONXX = 'A'
			AND LNXX.LC_DFR_RSP != 'XXX' --not denied
	) DFR
		ON DWXX.BF_SSN = DFR.BF_SSN
		AND DWXX.LN_SEQ = DFR.LN_SEQ
		AND DFR.LD_DFR_BEG < DWXX.WD_LON_RPD_SR
	LEFT JOIN
	(
		SELECT
			LNXX.BF_SSN,
			LNXX.LN_SEQ,
			FBXX.LC_FOR_TYP,
			CAST(LNXX.LD_FOR_BEG AS DATE) AS LD_FOR_BEG,
			CAST(LNXX.LD_FOR_END AS DATE) AS LD_FOR_END
		FROM
			CDW..FBXX_BR_FOR_REQ FBXX
			INNER JOIN CDW..LNXX_BR_FOR_APV LNXX
				ON FBXX.BF_SSN = LNXX.BF_SSN
				AND FBXX.LF_FOR_CTL_NUM = LNXX.LF_FOR_CTL_NUM
		WHERE
			LNXX.LC_STA_LONXX = 'A'
			AND FBXX.LC_FOR_STA = 'A'
			AND FBXX.LC_STA_FORXX = 'A'
			AND LNXX.LC_FOR_RSP != 'XXX' --not denied
	) FBR
		ON DWXX.BF_SSN = FBR.BF_SSN
		AND DWXX.LN_SEQ = FBR.LN_SEQ
		AND FBR.LD_FOR_BEG < DWXX.WD_LON_RPD_SR
WHERE
	DWXX.WD_LON_RPD_SR != 'XXXX-XX-XX'
	AND
	(
		DFR.BF_SSN IS NOT NULL 
		OR FBR.BF_SSN IS NOT NULL
	)


SELECT DISTINCT
	PDXX.DF_SPE_ACC_ID,
	LNXX.LN_SEQ
FROM
	CDW..PDXX_PRS_NME PDXX
	INNER JOIN CDW..LNXX_LON_RPS LNXX
		ON LNXX.BF_SSN = PDXX.DF_PRS_ID
		AND LNXX.LC_STA_LONXX = 'A'
	INNER JOIN CDW..GRXX_RPT_LON_APL GRXX
		ON GRXX.BF_SSN = LNXX.BF_SSN
		AND GRXX.LN_SEQ = LNXX.LN_SEQ
WHERE
	ISNULL(LTRIM(RTRIM(GRXX.WC_NDS_RPD_TRM_RPT)),'') = ''

SELECT DISTINCT
	PDXX.DF_SPE_ACC_ID,
	LNXX.LN_SEQ,
	RSXX.LD_SNT_RPD_DIS
FROM
	CDW..PDXX_PRS_NME PDXX
	INNER JOIN CDW..LNXX_LON_RPS LNXX
		ON LNXX.BF_SSN = PDXX.DF_PRS_ID
		AND LNXX.LC_STA_LONXX = 'A'
	INNER JOIN CDW..GRXX_RPT_LON_APL GRXX
		ON GRXX.BF_SSN = LNXX.BF_SSN
		AND GRXX.LN_SEQ = LNXX.LN_SEQ
	INNER JOIN CDW..RSXX_BR_RPD RSXX
		ON LNXX.BF_SSN = RSXX.BF_SSN
		AND LNXX.LN_RPS_SEQ = RSXX.LN_RPS_SEQ
WHERE
	ISNULL(LTRIM(RTRIM(GRXX.WC_NDS_RPD_TRM_RPT)),'') = ''