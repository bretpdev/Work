USE UDW;
GO

--Due date on the 14th or 15th
--No active ACH
--Do NOT have owner code of 829769

SELECT DISTINCT
	PD10.DF_SPE_ACC_ID,
	LN10.LF_LON_CUR_OWN,
	LN83.LC_STA_LN83,
	BR30.BC_EFT_STA,
	PH05.DI_CNC_EBL_OPI,
	--LN80.LD_BIL_DU_LON,
	IIF(DAY(LN80.LD_BIL_DU_LON) IN (14,15),'Y','N') AS DUE_1415,
	LN10.LC_STA_LON10,
	IIF(LN10.LA_CUR_PRI > 0.00,'>0','0') AS BALANCE
FROM
	LN10_LON LN10
	INNER JOIN LN80_LON_BIL_CRF LN80
		ON LN10.BF_SSN = LN80.BF_SSN
		AND LN10.LN_SEQ = LN80.LN_SEQ
	INNER JOIN LN83_EFT_TO_LON LN83
		ON LN10.BF_SSN = LN83.BF_SSN
		AND LN10.LN_SEQ = LN83.LN_SEQ
	INNER JOIN BR30_BR_EFT BR30
		ON LN83.BF_SSN = BR30.BF_SSN
		AND LN83.BN_EFT_SEQ = BR30.BN_EFT_SEQ
	INNER JOIN PD10_PRS_NME PD10
		ON LN10.BF_SSN = PD10.DF_PRS_ID
	INNER JOIN PH05_CNC_EML PH05
		ON PH05.DF_SPE_ID = PD10.DF_SPE_ACC_ID
WHERE
	LN10.LF_LON_CUR_OWN != '829769'
	AND LN83.LC_STA_LN83 = 'A'		--not on ACH
	AND BR30.BC_EFT_STA = 'A'		--not on ACH
	AND PH05.DI_CNC_EBL_OPI <> 'Y'	--not on ACH
	AND DAY(LN80.LD_BIL_DU_LON) IN (14,15) --due date on 14th or 15th
	AND LN10.LC_STA_LON10 = 'R'
	AND LN10.LA_CUR_PRI > 0.00
ORDER BY
	PD10.DF_SPE_ACC_ID
;