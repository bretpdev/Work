USE CDW
GO

DECLARE @DATA TABLE ( NUMBER INT, SERVICER VARCHAR(200), SSN VARCHAR(9), CEMS_CASE_NUMBER VARCHAR(20), [TYPE] VARCHAR(50), CASE_OPENED_DATE DATE, BORROWER_NOTIFICATION_DATE DATE, DAYS_OF_INTEREST_CREDIT INT)
INSERT INTO @DATA VALUES
(1,'CS','037662048','02145861','Ineligible','05/06/20','6/19/2020',0),
(2,'CS','064586356','01270442','Ineligible','09/25/18','6/23/2020',535),
(3,'CS','075822148','02248059','Ineligible','05/15/20','6/17/2020',0),
(4,'CS','080720557','02106170','Ineligible','02/05/20','6/25/2020',37),
(5,'CS','081706682','02049697','Ineligible','12/13/19','6/17/2020',91),
(6,'CS','102840520','01446430','Ineligible','04/16/18','6/30/2020',697),
(7,'CS','126988615','01452180','Ineligible','05/22/18','6/19/2020',661),
(8,'CS','145045069','02114967','Ineligible','02/23/20','6/17/2020',19),
(9,'CS','152746362','01285032','Ineligible','11/05/18','6/30/2020',494),
(10,'CS','163781123','01599828','Ineligible','05/28/19','6/23/2020',290),
(11,'CS','170720497','01793052','Ineligible','07/30/19','6/16/2020',227),
(12,'CS','202620139','01596989','Ineligible','05/20/19','6/23/2020',298),
(13,'CS','216905327','01242733','Ineligible','07/02/18','6/16/2020',620),
(14,'CS','232319144','01438782','Ineligible','05/16/18','6/24/2020',667),
(15,'CS','240815985','01594807','Ineligible','05/14/19','6/23/2020',304),
(16,'CS','245259969','01536600','Ineligible','01/28/19','6/16/2020',410),
(17,'CS','245878592','02147878','Ineligible','05/08/20','6/26/2020',0),
(18,'CS','260437587','02109862','Ineligible','02/12/20','6/17/2020',30),
(19,'CS','286022575','02142030','Ineligible','04/26/20','6/16/2020',0),
(20,'CS','292862890','01484125','Ineligible','05/25/18','6/29/2020',658),
(21,'CS','313908339','01792432','Ineligible','07/29/19','6/24/2020',228),
(22,'CS','324907227','01258731','Ineligible','08/20/18','6/17/2020',571),
(23,'CS','333845235','01286145','Ineligible','11/07/18','6/22/2020',492),
(24,'CS','336640246','01254454','Ineligible','08/08/18','6/17/2020',583),
(25,'CS','338920463','02239878','Ineligible','05/11/20','6/26/2020',0),
(26,'CS','347685455','01369150','Ineligible','04/03/17','6/24/2020',1075),
(27,'CS','349944833','01595878','Ineligible','05/16/19','6/26/2020',302),
(28,'CS','353926025','01901071','Ineligible','08/31/19','6/24/2020',195),
(29,'CS','354768690','01411446','Ineligible','02/26/18','6/23/2020',746),
(30,'CS','358566198','01518432','Ineligible','12/17/18','6/19/2020',452),
(31,'CS','365178098','01267547','Ineligible','09/16/18','6/29/2020',544),
(32,'CS','375986781','01538416','Ineligible','01/31/19','6/23/2020',407),
(33,'CS','400234726','01278168','Ineligible','10/17/18','6/24/2020',513),
(34,'CS','408758261','01289865','Ineligible','11/19/18','6/23/2020',480),
(35,'CS','411891224','02145217','Ineligible','05/06/20','6/26/2020',0),
(36,'CS','421312865','01567872','Ineligible','03/26/19','6/23/2020',353),
(37,'CS','428453906','01561974','Ineligible','03/14/19','6/23/2020',365),
(38,'CS','438950145','01345386','Ineligible','01/05/17','6/30/2020',1163),
(39,'CS','463577700','01413456','Ineligible','12/15/17','6/29/2020',819),
(40,'CS','521750438','01245842','Ineligible','07/11/18','6/30/2020',611),
(41,'CS','527872287','02085974','Ineligible','12/28/19','6/19/2020',76),
(42,'CS','542211861','01292661','Ineligible','11/28/18','6/23/2020',471),
(43,'CS','542511877','01624698','Ineligible','06/25/19','6/16/2020',262),
(44,'CS','542574989','02310292','Ineligible','06/16/20','6/30/2020',0),
(45,'CS','545317574','01605021','Ineligible','06/11/19','6/23/2020',276),
(46,'CS','548191712','02003583','Ineligible','10/08/19','6/29/2020',157),
(47,'CS','565375147','01241801','Ineligible','06/28/18','6/23/2020',624),
(48,'CS','575354138','02097290','Ineligible','01/18/20','6/24/2020',55),
(49,'CS','589303266','01592171','Ineligible','05/08/19','6/16/2020',310),
(50,'CS','589848688','01392501','Ineligible','07/17/17','6/29/2020',970),
(51,'CS','591547733','01965306','Ineligible','09/20/19','6/26/2020',175),
(52,'CS','601143325','01260039','Ineligible','08/23/18','6/16/2020',568),
(53,'CS','602842549','01603155','Ineligible','06/06/19','6/22/2020',281),
(54,'CS','608052591','01544806','Ineligible','02/13/19','6/29/2020',394),
(55,'CS','612044044','01573062','Ineligible','04/03/19','6/22/2020',345),
(56,'CS','625767491','01420229','Ineligible','04/15/18','6/19/2020',698),
(57,'CS','651039432','01592670','Ineligible','05/09/19','6/26/2020',309)


SELECT DISTINCT
	D.*,
	'',
	LN72.LN_SEQ,
	LN72.LR_INT_RDC_PGM_ORG as LR_ITR,
	LN10.LA_CUR_PRI,
	--'' AS ITS2R,
	CAST(ROUND(((LN72.LR_INT_RDC_PGM_ORG / 365) * LN10.LA_CUR_PRI / 100) * D.DAYS_OF_INTEREST_CREDIT, 2,1) AS DECIMAL(12,2))  INT_CALCULATOR,
	FS10.LF_FED_AWD + RIGHT('000' + CAST(LN_FED_AWD_SEQ AS VARCHAR(3)), 3) AS AWARD_ID
	--'' AS TOTAL_INT_TO_ADJ_ITS2R
	--CASE WHEN LN90.BF_SSN IS NOT NULL THEN 'Y' ELSE 'N' END AS MADE_PAYMENT
FROM
	CDW..LN72_INT_RTE_HST LN72
	INNER JOIN @DATA D
		ON D.SSN = LN72.BF_SSN
	INNER JOIN CDW..LN10_LON LN10
		ON LN10.BF_SSN = LN72.BF_SSN
		AND LN10.LN_SEQ = LN72.LN_SEQ
	INNER JOIN CDW..FS10_DL_LON FS10
		ON FS10.BF_SSN = LN10.BF_SSN
		AND FS10.LN_SEQ = LN10.LN_SEQ
	--LEFT JOIN CDW..LN90_FIN_ATY LN90
	--	ON LN90.BF_SSN = LN10.BF_SSN
	--	AND LN90.LN_SEQ = LN10.LN_SEQ
	--	AND LN90.LD_FAT_EFF >= D.CASE_OPENED_DATE
	--	AND LN90.LC_STA_LON90 = 'A'
	--	AND ISNULL(LN90.LC_FAT_REV_REA,'') = ''
	--	AND LN90.PC_FAT_TYP = '10'
WHERE
	LN72.LC_STA_LON72 = 'A'
	AND CAST(GETDATE() AS DATE) BETWEEN LN72.LD_ITR_EFF_BEG AND LD_ITR_EFF_END
ORDER BY
	d.NUMBER,
	LN72.LN_SEQ