LIBNAME LEGEND REMOTE SERVER=LEGEND SLIBREF=WORK;
RSUBMIT;
LIBNAME PKUB DBX DATABASE=DNFPUTDL OWNER=PKUB;
PROC SQL;
	CREATE TABLE COLLSUSPFORB AS
		SELECT DISTINCT
			PDXX.DF_SPE_ACC_ID
		FROM
			PKUB.PDXX_PRS_NME PDXX
			JOIN PKUB.LNXX_LON LNXX
				ON PDXX.DF_PRS_ID = LNXX.BF_SSN
			JOIN PKUB.FBXX_BR_FOR_REQ FBXX
				ON LNXX.BF_SSN = FBXX.BF_SSN
			JOIN PKUB.LNXX_BR_FOR_APV LNXX
				ON LNXX.BF_SSN = LNXX.BF_SSN
				AND LNXX.LN_SEQ = LNXX.LN_SEQ
				AND FBXX.LF_FOR_CTL_NUM = LNXX.LF_FOR_CTL_NUM
		WHERE
		   LNXX.LC_STA_LONXX = 'R'
		   AND LNXX.LA_CUR_PRI > X
		   AND FBXX.LC_FOR_TYP = 'XX'
		   AND FBXX.LC_FOR_STA = 'A'
		   AND FBXX.LC_STA_FORXX = 'A'
		   AND LNXX.LC_STA_LONXX = 'A'
		   AND LNXX.LD_FOR_BEG < Today()
		   AND LNXX.LD_FOR_END > Today()
	;
QUIT;
ENDRSUBMIT;

PROC EXPORT
		DATA=LEGEND.COLLSUSPFORB
		OUTFILE='T:\SAS\Collection Suspension Query.xlsx'
		REPLACE;
RUN;

   
