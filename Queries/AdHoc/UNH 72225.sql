USE NobleCalls
GO

SELECT
	CAST(NCH.ActivityDate AS DATE) AS CALL_DATE, 
	CAST(NCH.ActivityDate AS TIME) AS CALL_TIME,
	NCH.AccountIdentifier AS ACCOUNT_NUMBER, 
	NCH.PhoneNumber AS PHONE_CALLED,
	NCH.DispositionCode AS DISPOSITION_CODE,
	NCH.CallCampaign AS CALL_CAMPAIGN, 
	PD30.DF_ZIP_CDE AS BORROWERS_ZIP,
	PD30.DC_DOM_ST AS BORROWERS_STATE
FROM
	NobleCalls..NobleCallHistory NCH
	INNER JOIN UDW..PD10_PRS_NME PD10
		ON PD10.DF_SPE_ACC_ID = NCH.AccountIdentifier
	INNER JOIN UDW..PD30_PRS_ADR PD30
		ON PD30.DF_PRS_ID = PD10.DF_PRS_ID
		AND PD30.DC_DOM_ST IN ('WA','MA')
		AND PD30.DI_VLD_ADR = 'Y'
		AND PD30.DC_ADR = 'L'
WHERE
	CreatedAt BETWEEN '07/01/2021' AND '07/30/2021'
	AND IsInbound = 0
	AND DeletedAt IS NULL
	--AND RegionId = 2
ORDER BY
	NCH.ActivityDate