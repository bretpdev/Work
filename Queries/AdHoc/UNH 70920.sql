SELECT DISTINCT
P.DF_SPE_ACC_ID,
P.LN_SEQ,
P.LN_DLQ_MAX AS DAYS_PAST_DUE
FROM
(
SELECT DISTINCT
		LN10.BF_SSN,
		PD10.DF_SPE_ACC_ID,
		LN10.LN_SEQ,
		LN16.LN_DLQ_MAX,
		COALESCE(LN10.LA_CUR_PRI,0.00) AS LA_CUR_PRI,
		CASE WHEN LN16.LN_DLQ_MAX < 30 THEN 1
			 WHEN LN16.LN_DLQ_MAX < 60 THEN 2
			 WHEN LN16.LN_DLQ_MAX < 90 THEN 3
			 WHEN LN16.LN_DLQ_MAX < 120 THEN 4
			 WHEN LN16.LN_DLQ_MAX < 150 THEN 5
			 WHEN LN16.LN_DLQ_MAX < 180 THEN 6
			 WHEN LN16.LN_DLQ_MAX < 210 THEN 7
			 WHEN LN16.LN_DLQ_MAX < 240 THEN 8
			 WHEN LN16.LN_DLQ_MAX < 270 THEN 9
			 WHEN LN16.LN_DLQ_MAX < 300 THEN 10
			 WHEN LN16.LN_DLQ_MAX >= 300 THEN 11
		END AS Ord
	FROM
		UDW..PD10_PRS_NME PD10
		INNER JOIN UDW..LN10_LON LN10
			ON LN10.BF_SSN = PD10.DF_PRS_ID
		INNER JOIN UDW..LN16_LON_DLQ_HST LN16
			ON LN16.BF_SSN = LN10.BF_SSN
			AND LN16.LN_SEQ = LN10.LN_SEQ
			AND LN16.LC_STA_LON16 = '1'
			AND DATEDIFF(DAY, LN16.LD_DLQ_MAX, GETDATE()) < 5
	WHERE
		LN10.LC_STA_LON10 = 'R'
) P
LEFT JOIN 
(
	SELECT 
		FB10.LC_FOR_TYP,
		LN60.LD_FOR_BEG,
		LN60.LD_FOR_END,
		FB10.LD_CRT_REQ_FOR,
		FB10.LF_LST_DTS_FB10,
		FB10.LC_FOR_STA,
		LN60.BF_SSN,
		LN60.LN_SEQ
	FROM
		UDW..FB10_BR_FOR_REQ FB10
		INNER JOIN UDW..LN60_BR_FOR_APV LN60
			ON LN60.BF_SSN = FB10.BF_SSN
			AND LN60.LF_FOR_CTL_NUM = FB10.LF_FOR_CTL_NUM
	WHERE
		LN60.LC_STA_LON60 = 'A'
		AND FB10.LC_STA_FOR10 = 'A'
		AND FB10.LC_FOR_TYP = '40'
		AND LN60.LD_FOR_BEG >= '03-1-2020'
		--AND FB10.LC_FOR_STA = 'A' removing this so denied records will pick up
) FB
	ON FB.BF_SSN = P.BF_SSN
	AND FB.LN_SEQ = P.LN_SEQ
WHERE 
	P.Ord >= 8 
	AND P.Ord != 11
	AND FB.BF_SSN IS NULL