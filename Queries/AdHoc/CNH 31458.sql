USE CDW	
GO	
	
DECLARE @StartDate DATE = 'XXXX-X-X'	
DECLARE @EndDate DATE = 'XXXX-X-XX'	

SELECT
	LNXX.BF_SSN,
	LNXX.LN_SEQ,
	--LNXX.LN_FAT_SEQ,
	LNXX.PC_FAT_TYP,
	LNXX.PC_FAT_SUB_TYP,
	COALESCE(LNXXX.LD_FAT_APL, LNXX.LD_FAT_APL) [LD_FAT_APL],
	LNXX.LA_FAT_CUR_PRI,
	LNXX.LA_FAT_NSI,
	LNXX.LC_FAT_REV_REA
	--LNXX.LD_FAT_PST,
	--LNXX.LN_FAT_SEQ_REV
FROM	
	CDW..LNXX_FIN_ATY LNXX
	LEFT JOIN CDW..LNXX_FIN_ATY LNXXX
		ON LNXXX.BF_SSN  = LNXX.BF_SSN
		AND LNXXX.LN_SEQ = LNXX.LN_SEQ
		AND LNXXX.LN_FAT_SEQ = LNXX.LN_FAT_SEQ_REV
		AND LNXXX.LD_FAT_APL BETWEEN @StartDate AND @EndDate 
WHERE	
	LNXX.PC_FAT_TYP = 'XX'
	AND 
	LNXX.PC_FAT_SUB_TYP IN ('XX','XX')
	AND 
	LNXX.LC_FAT_REV_REA != ''	
	AND	
	LNXX.LC_FAT_REV_REA IS NOT NULL
	AND 
	LNXX.LD_FAT_APL BETWEEN @StartDate AND @EndDate
	AND 
	LNXXX.LD_FAT_APL BETWEEN  @StartDate AND @EndDate