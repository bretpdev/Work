
LIBNAME  DUSTER  REMOTE  SERVER=DUSTER  SLIBREF=WORK;
RSUBMIT;

PROC SQL;
	CONNECT TO DB2 (DATABASE=DLGSUTWH);

	CREATE TABLE DEMO AS
		SELECT 
			*
		FROM 
			CONNECTION TO DB2 
				(
					SELECT DISTINCT
						BR01.BF_SSN,
						MAX(LD_TRX_EFF) AS PAYMENT_DATE

					FROM	
						OLWHRM1.DC01_LON_CLM_INF DC01	
					INNER JOIN OLWHRM1.BR01_BR_CRF BR01
						ON BR01.BF_SSN = DC01.BF_SSN
					INNER JOIN OLWHRM1.DC11_LON_FAT DC11
						ON DC11.AF_APL_ID = DC01.AF_APL_ID
						AND DC11.AF_APL_ID_SFX = DC01.AF_APL_ID_SFX
					INNER JOIN OLWHRM1.DC18_BKR DC18
						ON DC18.AF_APL_ID = DC01.AF_APL_ID
						AND DC18.AF_APL_ID_SFX = DC01.AF_APL_ID_SFX
					WHERE
						DC11.LC_TRX_TYP = 'BR'
						AND DC01.LC_STA_DC10 = '03'
						AND DC01.LC_AUX_STA = ''
/*						AND MAX(LD_TRX_EFF) < '06/01/2012'*/
						AND DAYS(DC01.LD_LDR_POF) < DAYS('04/15/2008')
						AND DC01.LC_REA_CLM_ASN_DOE = ''
					GROUP BY 
						BR01.BF_SSN

					

					FOR READ ONLY WITH UR
				)
	;

	DISCONNECT FROM DB2;


QUIT;

ENDRSUBMIT;

DATA FINAL;
SET DUSTER.DEMO;
WHERE PAYMENT_DATE < INPUT('06/01/2012',MMDDYY10.);
RUN;

PROC EXPORT DATA = WORK.FINAL 
            OUTFILE = "T:\SAS\NH 16711.xls" 
            DBMS = EXCEL
			REPLACE;
     SHEET="A"; 
RUN;

