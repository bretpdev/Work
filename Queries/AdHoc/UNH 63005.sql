--1) Query for all accounts that have the ARC CTDFB
--2) Query for all accounts that have the word 'Cancer'  in the history     comments that are left under the ARC FDUPD.
--3) Query all accounts that have a  type 28 Forb (Collection susp.) 
--    with the the word 'Cancer' in the histroy comments left under the ARC      FBAPV
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

SELECT DISTINCT
	AY10.BF_SSN,
	AY10.PF_REQ_ACT AS TriggerCondition
FROM
	UDW..AY10_BR_LON_ATY AY10
WHERE
	AY10.PF_REQ_ACT = 'CTDFB'
	AND AY10.LC_STA_ACTY10 = 'A'

SELECT DISTINCT
	OQ.BF_SSN,
	OQ.LX_ATY AS TriggerCondition
FROM OPENQUERY
(DUSTER,
'
SELECT DISTINCT
	AY10.BF_SSN,
	AY20.LX_ATY
FROM
	OLWHRM1.AY10_BR_LON_ATY AY10
	INNER JOIN OLWHRM1.AY15_ATY_CMT AY15
		ON AY15.BF_SSN = AY10.BF_SSN
		AND AY15.LN_ATY_SEQ = AY10.LN_ATY_SEQ
		AND AY15.LC_STA_AY15 = ''A''
	INNER JOIN OLWHRM1.AY20_ATY_TXT AY20
		ON AY20.BF_SSN = AY15.BF_SSN
		AND AY20.LN_ATY_SEQ = AY15.LN_ATY_SEQ
		AND AY20.LN_ATY_CMT_SEQ = AY15.LN_ATY_CMT_SEQ
WHERE
	AY10.LC_STA_ACTY10 = ''A''
	AND AY10.PF_REQ_ACT = ''FDUPD''
	AND AY20.LX_ATY LIKE ''%Cancer%''
'
) OQ

SELECT DISTINCT
	OQ.BF_SSN,
	OQ.LX_ATY AS TriggerCondition
FROM OPENQUERY
	(DUSTER,
	'
		SELECT DISTINCT
			AY10.BF_SSN,
			AY20.LX_ATY
		FROM
			OLWHRM1.AY10_BR_LON_ATY AY10
			INNER JOIN OLWHRM1.AY15_ATY_CMT AY15
				ON AY15.BF_SSN = AY10.BF_SSN
				AND AY15.LN_ATY_SEQ = AY10.LN_ATY_SEQ
				AND AY15.LC_STA_AY15 = ''A''
			INNER JOIN OLWHRM1.AY20_ATY_TXT AY20
				ON AY20.BF_SSN = AY15.BF_SSN
				AND AY20.LN_ATY_SEQ = AY15.LN_ATY_SEQ
				AND AY20.LN_ATY_CMT_SEQ = AY15.LN_ATY_CMT_SEQ
			INNER JOIN OLWHRM1.LN60_BR_FOR_APV LN60
				ON LN60.BF_SSN = AY10.BF_SSN
			INNER JOIN OLWHRM1.FB10_BR_FOR_REQ FB10
				ON FB10.BF_SSN = LN60.BF_SSN
				AND FB10.LF_FOR_CTL_NUM = LN60.LF_FOR_CTL_NUM
		WHERE
			AY10.LC_STA_ACTY10 = ''A''
			AND AY10.PF_REQ_ACT = ''FBAPV''
			AND AY20.LX_ATY LIKE ''%Cancer%''
			AND LN60.LC_FOR_RSP != ''003''
			AND LN60.LC_STA_LON60 = ''A''
			AND FB10.LC_FOR_STA = ''A''
			AND FB10.LC_STA_FOR10 = ''A''
			AND FB10.LC_FOR_TYP = ''28''
	'
	) OQ
