select 
	LN65.BF_SSN,
	LN65.LN_SEQ, 
	LN65.LN_RPS_SEQ,
	LN65.LF_LST_DTS_LN65,
	LN60.LD_FOR_BEG,
	LN60.LD_FOR_END
from
	cdw..ln65_lon_rps ln65
	inner join cdw..LN10_LON ln10
		on ln10.bf_ssn = ln65.bf_ssn
		and ln10.ln_seq = ln65.ln_seq
	inner join 
	(
		select 
			BF_SSN,
			LN_SEQ,
			MAX(LN_RPS_SEQ) AS LN_RPS_SEQ
		from
			cdw..ln65_lon_rps ln65
		GROUP BY
			BF_SSN,
			LN_SEQ
	) M
		ON M.BF_SSN = LN65.BF_SSN
		AND M.LN_SEQ = LN65.LN_SEQ
		AND M.LN_RPS_SEQ = LN65.LN_RPS_SEQ
	LEFT JOIN
	(
		SELECT
			LN60.*,
			FB10.LN_RPS_SEQ
		FROM
			CDW..LN60_BR_FOR_APV LN60
			INNER JOIN CDW..FB10_BR_FOR_REQ FB10
				ON FB10.BF_SSN = LN60.BF_SSN
				AND FB10.LF_FOR_CTL_NUM = LN60.LF_FOR_CTL_NUM
		WHERE
			LN60.LC_STA_LON60 = 'A'
			AND FB10.LC_FOR_STA =  'A'
			AND FB10.LC_STA_FOR10 = 'A'
			AND LN60.LC_FOR_RSP != '003' --003 = FORBEARANCE REQUEST DENIED

	) LN60
		ON LN60.BF_SSN = LN65.BF_SSN
		AND LN60.LN_SEQ = LN65.LN_SEQ 
		AND LD_FOR_BEG > LN65.LF_LST_DTS_LN65
WHERE 
	LN65.LC_TYP_SCH_DIS IN ('C1', 'C2' ,'C3','CA','CP','I3','IB', 'IL', 'IP','I5','J5')
	AND LC_STA_LON65 = 'I'
	AND LA_CUR_PRI > 0
	AND LC_STA_LON10 = 'R'