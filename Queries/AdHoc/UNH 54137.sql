SELECT DISTINCT
	PD10.DF_SPE_ACC_ID AS AccountNumber,
	LN10.LN_SEQ AS LoanSequence,
	PD10.DM_PRS_1 AS FirstName,
	PD10.DM_PRS_LST AS LastName,
	ISNULL(PD32.DX_ADR_EML,'') AS Email,
	LN16.LN_DLQ_MAX + 1 AS DaysDelinquent,
	PD30.DX_STR_ADR_1 AS Address1,
	PD30.DX_STR_ADR_2 AS Address2,
	PD30.DX_STR_ADR_3 AS Address3,
	PD30.DM_CT AS City,
	PD30.DC_DOM_ST AS State,
	PD30.DF_ZIP_CDE AS Zip,
	PD30.DI_VLD_ADR AS AddressValid,
	PD30.DD_VER_ADR AS AddressVerifiedDate,
	PD30.DC_ADR AS AddressType,
	PD42.DN_DOM_PHN_ARA + PD42.DN_DOM_PHN_XCH + PD42.DN_DOM_PHN_LCL AS Phone,
	PD42.DC_PHN AS PhoneType
FROM
	UDW..PD10_PRS_NME PD10
	INNER JOIN UDW..PD30_PRS_ADR PD30
		ON PD30.DF_PRS_ID = PD10.DF_PRS_ID
		AND LEFT(PD30.DF_ZIP_CDE,5) IN('78114','78121','78143','78147','78160','78161')
	INNER JOIN UDW..LN10_LON LN10
		ON PD10.DF_PRS_ID = LN10.BF_SSN
	INNER JOIN UDW..DW01_DW_CLC_CLU DW01
		ON DW01.BF_SSN = LN10.BF_SSN
		AND DW01.LN_SEQ = LN10.LN_SEQ
		AND DW01.WC_DW_LON_STA = '03'
	INNER JOIN UDW..LN16_LON_DLQ_HST LN16
		ON LN16.BF_SSN = LN10.BF_SSN
		AND LN16.LN_SEQ = LN10.LN_SEQ
		AND LN16.LC_STA_LON16 = '1'
		AND CAST(LN16.LD_DLQ_MAX AS DATE) BETWEEN CAST(DATEADD(DAY,-4,GETDATE()) AS DATE) AND CAST(GETDATE() AS DATE)
	LEFT JOIN UDW..PD32_PRS_ADR_EML PD32
		ON PD32.DF_PRS_ID = PD10.DF_PRS_ID
		AND PD32.DI_VLD_ADR_EML ='Y'
	LEFT JOIN UDW..PD42_PRS_PHN PD42
		ON PD42.DF_PRS_ID = PD10.DF_PRS_ID
		AND PD42.DI_PHN_VLD = 'Y'
WHERE
	LN10.LC_STA_LON10 = 'R'