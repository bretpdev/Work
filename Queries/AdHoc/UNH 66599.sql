USE [uDW]
GO
/****** Object:  StoredProcedure [dbo].[LT_TS06BD101_Loans]    Script Date: 4/8/2020 7:51:46 AM ******/

		
				SELECT DISTINCT
					PD10.DF_PRS_ID AS SSN,
					LTRIM(RTRIM(PD10.DM_PRS_1)) + ' ' + LTRIM(RTRIM(PD10.DM_PRS_LST)) AS [NAME],
					LN50.LD_DFR_APL,
					LN50.LD_DFR_BEG,
					LN50.LD_DFR_END
				FROM
					LN50_BR_DFR_APV LN50
					INNER JOIN DF10_BR_DFR_REQ DF10
						ON DF10.BF_SSN = LN50.BF_SSN
						AND DF10.LF_DFR_CTL_NUM = LN50.LF_DFR_CTL_NUM
					INNER JOIN PD10_PRS_NME PD10
						ON PD10.DF_PRS_ID = DF10.BF_SSN
					
				WHERE
					LN50.LC_STA_LON50 = 'A'
					AND DF10.LC_STA_DFR10 = 'A'
					AND DF10.LC_DFR_STA = 'A' --Denied requests are valid
					and LN50.LC_DFR_RSP != '003'
					AND DF10.LC_DFR_TYP = '37'
					AND LN50.LD_DFR_APL >= '10-01-2019'


				SELECT DISTINCT
					PD10.DF_PRS_ID AS SSN,
					LTRIM(RTRIM(PD10.DM_PRS_1)) + ' ' + LTRIM(RTRIM(PD10.DM_PRS_LST)) AS [NAME],
					LN60.LD_FOR_APL,
					LN60.LD_FOR_BEG,
					LN60.LD_FOR_END
				FROM
					LN60_BR_FOR_APV LN60
					INNER JOIN FB10_BR_FOR_REQ FB10
						ON FB10.BF_SSN = LN60.BF_SSN
						AND FB10.LF_FOR_CTL_NUM = LN60.LF_FOR_CTL_NUM
					INNER JOIN PD10_PRS_NME PD10
						ON PD10.DF_PRS_ID = FB10.BF_SSN
					
				WHERE
					LN60.LC_STA_LON60 = 'A'
					AND FB10.LC_STA_FOR10 = 'A'
					AND FB10.LC_FOR_STA = 'A' --Denied requests are valid
					and LN60.LC_FOR_RSP != '003'
					AND FB10.LC_FOR_TYP = '34'
					AND LN60.LD_FOR_APL >= '10-01-2019'
