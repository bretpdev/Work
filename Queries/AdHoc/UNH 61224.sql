--details tab
SELECT DISTINCT
	 LN10.BF_SSN
	,LN10.LN_SEQ
	,LN10.IC_LON_PGM
	,LN10.LA_CUR_PRI
	,LN10.LA_NSI_OTS
	,LN10.LC_STA_LON10
	,PD30.DC_DOM_ST
FROM
	AuditUDW..LN10_LON_Dec2018 LN10
	INNER JOIN UDW..PD30_PRS_ADR PD30
		ON LN10.BF_SSN = PD30.DF_PRS_ID
WHERE
	PD30.DC_DOM_ST = 'IL'
	AND LN10.LA_CUR_PRI > 0.00
	AND LN10.LC_STA_LON10 = 'R'
ORDER BY
	LN10.BF_SSN
	,LN10.LN_SEQ
;

--total borrowers
SELECT
	COUNT(DISTINCT BF_SSN) AS TotalBorrowerCount
FROM
	(
		SELECT DISTINCT
			 LN10.BF_SSN
			,LN10.LN_SEQ
			,LN10.IC_LON_PGM
			,LN10.LA_CUR_PRI
			,LN10.LA_NSI_OTS
			,LN10.LC_STA_LON10
			,PD30.DC_DOM_ST
		FROM
			AuditUDW..LN10_LON_Dec2018 LN10
			INNER JOIN UDW..PD30_PRS_ADR PD30
				ON LN10.BF_SSN = PD30.DF_PRS_ID
		WHERE
			PD30.DC_DOM_ST = 'IL'
			AND LN10.LA_CUR_PRI > 0.00
			AND LN10.LC_STA_LON10 = 'R'
	) details
;

--borrowers by loan type
SELECT DISTINCT
	IC_LON_PGM
	,COUNT(DISTINCT BF_SSN) AS BorrowerCountByLoanProgram
FROM
	(
		SELECT DISTINCT
			 LN10.BF_SSN
			,LN10.LN_SEQ
			,LN10.IC_LON_PGM
			,LN10.LA_CUR_PRI
			,LN10.LA_NSI_OTS
			,LN10.LC_STA_LON10
			,PD30.DC_DOM_ST
		FROM
			AuditUDW..LN10_LON_Dec2018 LN10
			INNER JOIN UDW..PD30_PRS_ADR PD30
				ON LN10.BF_SSN = PD30.DF_PRS_ID
		WHERE
			PD30.DC_DOM_ST = 'IL'
			AND LN10.LA_CUR_PRI > 0.00
			AND LN10.LC_STA_LON10 = 'R'
	) details
GROUP BY
	IC_LON_PGM
ORDER BY
	IC_LON_PGM
;

--total balance owed
SELECT
	SUM(LA_CUR_PRI + LA_NSI_OTS) AS TotalBalanceOwed
FROM
	(
		SELECT DISTINCT
			 LN10.BF_SSN
			,LN10.LN_SEQ
			,LN10.IC_LON_PGM
			,LN10.LA_CUR_PRI
			,LN10.LA_NSI_OTS
			,LN10.LC_STA_LON10
			,PD30.DC_DOM_ST
		FROM
			AuditUDW..LN10_LON_Dec2018 LN10
			INNER JOIN UDW..PD30_PRS_ADR PD30
				ON LN10.BF_SSN = PD30.DF_PRS_ID
		WHERE
			PD30.DC_DOM_ST = 'IL'
			AND LN10.LA_CUR_PRI > 0.00
			AND LN10.LC_STA_LON10 = 'R'
	) details
;
