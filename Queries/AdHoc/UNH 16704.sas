
LIBNAME  DUSTER  REMOTE  SERVER=DUSTER  SLIBREF=WORK;
RSUBMIT;
/*LIBNAME OLWHRM1 DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;*/

PROC SQL;
	CONNECT TO DB2 (DATABASE=DLGSUTWH);

	CREATE TABLE NH16704 AS
		SELECT 
			*
		FROM 
			CONNECTION TO DB2 
				(
					SELECT DISTINCT
						SD10.*
					FROM	
						OLWHRM1.SD10_STU_SPR SD10
						INNER JOIN OLWHRM1.LN10_LON LN10
							ON LN10.BF_SSN = SD10.LF_STU_SSN
						LEFT JOIN OLWHRM1.DF10_BR_DFR_REQ DF10
							ON DF10.BF_SSN = LN10.BF_SSN
						LEFT JOIN OLWHRM1.LN50_BR_DFR_APV LN50
							ON LN50.BF_SSN = LN10.BF_SSN
					WHERE	
						SD10.LC_STA_STU10 = 'A'
						AND (SD10.LD_SCL_CER_STU_STA IS NULL)
						AND LN10.LA_CUR_PRI > 0
						AND LN10.LC_STA_LON10 = 'R'
						AND (DF10.LD_DFR_CER IS NULL OR LN50.LD_DFR_APL IS NULL)

					FOR READ ONLY WITH UR
				)
	;

	DISCONNECT FROM DB2;

	/*%PUT  SQLXRC= >>> &SQLXRC <<< ||| SQLXMSG= >>> &SQLXMSG >>> ;  ** INCLUDES ERROR MESSAGES TO SAS LOG  ;*/
	/*%SQLCHECK;*/
QUIT;

ENDRSUBMIT;

/*PROC EXPORT DATA = DUSTER.NH16704 */
/*            OUTFILE = "T:\SAS\NH 16704.xlsx" */
/*            DBMS = EXCEL*/
/*			REPLACE;*/
/*     SHEET="Sheet1"; */
/*RUN;*/
