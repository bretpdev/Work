USE CDW;
GO

SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

SELECT
	PDXX.DF_SPE_ACC_ID,
	(ISNULL(LNXX.LA_FAT_CUR_PRI,X) + ISNULL(LNXX.LA_FAT_NSI,X)) AS PaymentAmount,
	LNXX.LD_FAT_EFF AS PaymentDate,
	--validation fields:
	--LNXX.BF_SSN,
	LNXX.LN_SEQ,
	LNXX.LA_FAT_CUR_PRI,
	LNXX.LA_FAT_NSI,
	LNXX.LC_STA_LONXX,
	LNXX.PC_FAT_TYP,
	LNXX.LC_FAT_REV_REA
FROM
	LNXX_FIN_ATY LNXX
	INNER JOIN PDXX_PRS_NME PDXX
		ON LNXX.BF_SSN = PDXX.DF_PRS_ID
WHERE
	(
		ABS((ISNULL(LNXX.LA_FAT_CUR_PRI,X) + ISNULL(LNXX.LA_FAT_NSI,X))) = 'XXX.XX'
		OR ABS(LNXX.LA_FAT_CUR_PRI) = 'XXX.XX'
		OR ABS(LNXX.LA_FAT_NSI) = 'XXX.XX'
	)
	AND LNXX.LD_FAT_EFF > CONVERT(DATE,'XXXXXXXX')
	--AND ISNULL(LNXX.LC_FAT_REV_REA,'') = ''
	--AND LNXX.LC_STA_LONXX = 'A'
	AND LNXX.PC_FAT_TYP = 'XX' --PAYMENT
	AND PDXX.DF_PRS_ID LIKE '[X-X]%'
;