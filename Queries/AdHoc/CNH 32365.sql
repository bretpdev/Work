USE CDW
GO

--enrolled
SELECT DISTINCT
	PDXX.DF_SPE_ACC_ID,
	LNXX.LN_SEQ,
	LNXX.LD_TRM_BEG
FROM
	..LNXX_LON LNXX
	INNER JOIN ..PDXX_PRS_NME PDXX
	ON LNXX.BF_SSN = PDXX.DF_PRS_ID
WHERE
	LNXX.LF_DOE_SCL_ORG = 'XXXXXXXX'
	AND LNXX.LD_TRM_BEG BETWEEN 'XXXX-XX-XX' AND 'XXXX-XX-XX'
ORDER BY
	PDXX.DF_SPE_ACC_ID,
	LNXX.LD_TRM_BEG


--ever attended:
SELECT	* FROM OPENQUERY(LEGEND,'
	SELECT DISTINCT
		PDXX.DF_SPE_ACC_ID,
		LNXX.LN_SEQ,
		LNXX.LD_TRM_BEG,
		LNXX.LF_DOE_SCL_ORG AS LNXX_LF_DOE_SCL_ORG,
		MRXX.LF_DOE_SCL_ENR_CUR AS MRXX_LF_DOE_SCL_ENR_CUR,
		CASE
			WHEN LNXX.LF_DOE_SCL_ORG = ''XXXXXXXX''
				AND MRXX.LF_DOE_SCL_ENR_CUR = ''XXXXXXXX''
			THEN ''BOTH''
			WHEN LNXX.LF_DOE_SCL_ORG = ''XXXXXXXX'' 
			THEN ''LNXX_LF_DOE_SCL_ORG''
			WHEN MRXX.LF_DOE_SCL_ENR_CUR = ''XXXXXXXX'' 
			THEN ''MRXX_LF_DOE_SCL_ENR_CUR''
		END AS MATCH
	FROM
		PKUB.LNXX_LON LNXX
		INNER JOIN PKUB.PDXX_PRS_NME PDXX
			ON LNXX.BF_SSN = PDXX.DF_PRS_ID
		LEFT JOIN PKUR.MRXX_MGT_RPT_LON MRXX
			ON LNXX.BF_SSN = MRXX.BF_SSN
	WHERE
		DAYS(LNXX.LD_TRM_BEG) BETWEEN DAYS(''XXXX-XX-XX'') AND DAYS(''XXXX-XX-XX'')
		AND 
		(
				LNXX.LF_DOE_SCL_ORG = ''XXXXXXXX'' 
				OR MRXX.LF_DOE_SCL_ENR_CUR = ''XXXXXXXX'' 
			)
') 
ORDER BY
	DF_SPE_ACC_ID,
	LN_SEQ,
	LD_TRM_BEG