/*%LET RPTLIB = %SYSGET(reportdir);*/
%LET RPTLIB = T:\SAS;


LIBNAME  LEGEND  REMOTE  SERVER=LEGEND SLIBREF=work  ;
RSUBMIT LEGEND;
/*%let DB = DNFPRQUT;  *This is test;*/
/*%let DB = DNFPRUUT;  *This is VUKX test;*/
%let DB = DNFPUTDL;  *This is live;


PROC SQL;
CONNECT TO DBX (DATABASE=&DB);
CREATE TABLE PRECONV AS
	SELECT 
		*
	FROM CONNECTION TO DBX 
	(
/*	---------------------------------------------------------------------------*/
SELECT
	PDXX.DF_SPE_ACC_ID AS Account_number,
	LNXX.LN_SEQ AS Loan_Sequence,
	ADXX.LF_USR_PCV_ADJ_REQ AS User_,
	ADXX.LD_PCV_ADJ_REQ AS Date_,
	LNXX.LA_FAT_CUR_PRI AS Amount_Principal,
	LNXX.LA_FAT_NSI AS Amount_Interest
FROM
	PKUB.ADXX_PCV_FIN_ADJ ADXX
	INNER JOIN PKUB.LNXX_PCV_FIN_FAT LNXX
		ON ADXX.BF_SSN = LNXX.BF_SSN
		AND ADXX.LN_SEQ_PCV_ADJ_REQ = LNXX.LN_SEQ_PCV_ADJ_REQ
	INNER JOIN PKUB.LNXX_FIN_ATY LNXX
		ON LNXX.BF_SSN = LNXX.BF_SSN
		AND LNXX.LN_FAT_SEQ = LNXX.LN_FAT_SEQ
	INNER JOIN PKUB.PDXX_PRS_NME PDXX
		ON ADXX.BF_SSN = PDXX.DF_PRS_ID
WHERE
	((LNXX.PC_FAT_TYP = XX AND LNXX.PC_FAT_SUB_TYP = XX) OR (LNXX.PC_FAT_TYP = XX AND LNXX.PC_FAT_SUB_TYP = XX) OR (LNXX.PC_FAT_TYP = XX AND LNXX.PC_FAT_SUB_TYP = XX))
	AND ADXX.LD_PCV_ADJ_REQ >= 'XXXX-XX-XX' 

/*----------------------------------------------------------------------*/
		FOR READ ONLY WITH UR
		)
;

DISCONNECT FROM DBX;
QUIT;

ENDRSUBMIT;

/* export to XL */
PROC EXPORT 
	DATA= WORK.PRECONV
	OUTFILE= "T:\SAS\PRE CONVERSION QUERY.XLSX" 
	DBMS=XLSX
	REPLACE
	;
	SHEET="A"; 
RUN;
