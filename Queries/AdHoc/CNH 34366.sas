
/*import data from spreadsheet provided by requester*/
LIBNAME XL XLSX 'T:\CNH XXXXX\recalc_rehab_history_cornerstone.xlsx';
DATA XLDATA; SET XL.SHEETX; RUN;

/*create libname for Legend and copy Excel data to Legend*/
LIBNAME  LEGEND  REMOTE  SERVER=LEGEND SLIBREF=work  ;
DATA LEGEND.XLDATA; SET XLDATA; RUN;


RSUBMIT LEGEND;
/*%let DB = DNFPRQUT;  *This is test;*/
%let DB = DNFPUTDL;  *This is live;

LIBNAME PKUB DBX DATABASE=&DB OWNER=PKUB;

PROC SQL;
	CONNECT TO DBX (DATABASE=&DB);

	CREATE TABLE XL_GRXX AS
		SELECT	
			DBXDATA.BF_SSN
			,DBXDATA.WN_SEQ_GRXX
			,DBXDATA.LI_RCL_LON_STA_HST
		FROM	
			CONNECTION TO DBX 
				(
					SELECT
						GRXX.BF_SSN
						,GRXX.WN_SEQ_GRXX
						,GRXX.LI_RCL_LON_STA_HST
					FROM
						PKUB.GRXX_RPT_LON_APL GRXX
				) DBXDATA
			INNER JOIN XLDATA
			ON DBXDATA.BF_SSN = XLDATA.BF_SSN
			AND DBXDATA.WN_SEQ_GRXX = INPUT(XLDATA.WN_SEQ_GRXX, X.)

	;

	DISCONNECT FROM DBX;

QUIT;

ENDRSUBMIT;

DATA XL_GRXX; SET LEGEND.XL_GRXX; RUN;

/*export to Excel spreadsheet*/
PROC EXPORT 
	DATA= WORK.XL_GRXX
	OUTFILE= "T:\SAS\REHAB_RECALC.XLSX" 
	DBMS=XLSX
	REPLACE
	;
	SHEET="A"; 
RUN;
