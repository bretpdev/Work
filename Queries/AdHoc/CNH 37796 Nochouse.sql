DECLARE @Letters TABLE(CountLetter INT, LetterId VARCHAR(XX))
DECLARE @Emails TABLE(CountEmail INT, LetterId VARCHAR(XX))
INSERT INTO @Letters (CountLetter, LetterId) VALUES(XXX,'XPACONFFED'),(X,'XPADENFED'),(XXX,'ACHPMERFED'),(XXX,'APAPPRXFED'),(XX,'APBNKFED'),(XXX,'APDNYFED'),(XXX,'APREQFED'),(XXXX,'CBPCNFFED'),(XXXX,'CLSCNOTFED'),(X,'CRDCORFED'),(XXX,'DEFDNFED'),(XX,'DISAPPREC'),(XXX,'DSCRCVXRVW'),(XXX,'DSCSCHFED'),(XXXXXX,'EBILLFED'),(XXXXXX,'ENRDEFNFED'),(XXX,'FINBLNOPFD'),(XX,'FORAPPREC'),(XXX,'FORDNFED'),(XXXX,'GRADLETFED'),(XXX,'IBRDENFED'),(XXX,'ICRDENFED'),(XX,'IDRAPRCVD'),(X,'IDRDN'),(XXXX,'IDRPNDD'),(XXXX,'IDRPNDO'),(XXX,'IDRPNDS'),(XX,'INTBILFED'),(X,'LDAFCXFED'),(X,'LDAFCXFED'),(XX,'LDAFCXFED'),(XXX,'LDAURFED'),(XX,'LDDENXFED'),(XXXX,'LDMCSTNFED'),(XXX,'PAYEDENFED'),(XX,'PAYOFFFED'),(XXXXX,'PLRPYMTFED'),(XXX,'PMTMONFED'),(XX,'PSLFFED'),(XXX,'REQRCVFED'),(XXXX,'RPAYDENFED'),(XXXXX,'RPDISCFED'),(X,'SCRANAFED'),(X,'SPCNREQFED'),(XX,'TAXINTFED'),(X,'TAXWOFED'),(XX,'TCHLFFED'),(X,'TLFAPFED'),(X,'TLFDENFED'),(XX,'TLFFBFED'),(X,'TSXXBCRLTR'),(XXXX,'TSXXBAPIDR'),(X,'TSXXBBAPP'),(XX,'TSXXBBCANC'),(XXXX,'TSXXBCARQT'),(XXXX,'TSXXBCNSWL'),(XX,'TSXXBCP'),(XXXXX,'TSXXBDXXX'),(XXX,'TSXXBDXXX'),(XXXXX,'TSXXBDDXX'),(XXXXX,'TSXXBDDXXX'),(XXXXX,'TSXXBDDXX'),(XXX,'TSXXBDDXX'),(XXXXX,'TSXXBDDXX'),(X,'TSXXBDDEFP'),(XXX,'TSXXBDDIDR'),(XXX,'TSXXBDHRD'),(XX,'TSXXBDMIL'),(XXXXX,'TSXXBDMP'),(XXX,'TSXXBDSCH'),(XXX,'TSXXBDUNEM'),(XXXXX,'TSXXBFXXX'),(XXXXX,'TSXXBFXXXC'),(XXX,'TSXXBFXXX'),(XXXX,'TSXXBFNBIL'),(XX,'TSXXBFORB'),(X,'TSXXBGRDFL'),(XXXX,'TSXXBIBR'),(XX,'TSXXBIBRXX'),(XXXX,'TSXXBIBRXP'),(XX,'TSXXBICR'),(XX,'TSXXBICRXX'),(XXX,'TSXXBICREX'),(XXXX,'TSXXBIDREC'),(XXXX,'TSXXBIDRPS'),(XXX,'TSXXBIL'),(XXX,'TSXXBLSXXX'),(XX,'TSXXBPSTFR'),(XX,'TSXXBPYED'),(XXX,'TSXXBPYEXP'),(XXXXXX,'TSXXBQRTLY'),(XXX,'TSXXBREXXX'),(XXX,'TSXXBRPYXX'),(XXXX,'TSXXBRPYXP'),(XXX,'TSXXBRSMRY'),(XXXXXX,'TSXXBSAPPM'),(XX,'TSXXBSCRAA'),(XX,'TSXXBSCRAE'),(XX,'TSXXBSPLIT'),(XXX,'TSXXBTMXC'),(XXXXX,'TSXXBTMXLM'),(XXX,'TSXXBTPDSS'),(XX,'TSXXBTPERM'),(XXXXX,'TSXXBTRTX'),(XXX,'TSXXBTSA'),(X,'TSXXIDAPBR'),(X,'TSXXIDINED'),(XX,'TSXXIDMDBR'),(X,'TSXXIDMDED'),(X,'TSXXIDRVBR'),(X,'TSXXIDTFRB'),(XXX,'TSXXIDTINB'),(XX,'TSXXBDSBAX'),(XXXXX,'TSXXBFDLP'),(XXXX,'TSXXBISF'),(XX,'TSXXSKPBOR'),(XXXXX,'TSXXBGLBX'),(XXXXX,'WTHDRWFED')
INSERT INTO @Emails(CountEmail, LetterId) VALUES(XXXXX,'XXDLACHFED'),(XXXXX,'XXDLQPSFED'),(XXXXX,'ACYREMLFED'),(XXXX,'ALTRPYXFED'),(XXXXX,'BRSKIPEML'),(XXXXXX,'BRTHDYFED'),(XXXXX,'CHTNEMLFED'),(XXXXX,'DEXXIDRFED'),(XXXXX,'DELEMLXX'),(XXXXX,'DEMUPDNFED'),(XXXXX,'DIREMLFED'),(XXX,'DISEMLFED'),(XXXXX,'DLXXXDFFED'),(XXXXX,'DLIDREMFED'),(XXXXX,'DLQEMXXFD'),(XXXXX,'DLQEMXXFD'),(XXXXX,'DLQEMXXFD'),(XXXXX,'DLQEMXXFD'),(XXXXX,'DLQEMXXFD'),(XXXX,'DLQEMXXFD'),(XXXX,'DLQEMXXFD'),(XXXX,'DLQEMXXFD'),(XXXX,'DLQEMXXFD'),(XXX,'DLRCIDRFED'),(XXXXX,'DUEDATEFED'),(XXXXX,'DUEDTEML'),(XXXX,'EFNBLNOPFD'),(XXXXX,'FINDEMEFED'),(XXXX,'FOREMLFED'),(XXXXXX,'FRDEEMFED'),(XXXXX,'FRYDRPYFED'),(XXXX,'IDREMRCVD'),(XXXXX,'MANEMLFED'),(XXX,'NDSTDF'),(XXXX,'NDSTRF'),(XXXXX,'NWCODEMFED'),(XXXXX,'ONLACNTFED'),(XXXXX,'PLCSLEMLXX'),(XXXXX,'PYMNTDFED'),(XXX,'RETMAILFED'),(XXX,'SCRANEFEDE'),(XXXXX,'SKPEMLFED'),(XXXX,'TXCRDEMFED')

SELECT
	DD.DocName AS DocumentName,
	L.LetterId AS LetterId,
	DD.DocTyp AS DocumentType,
	DD.Description AS DocumentDescription,
	MaxRequest.Request AS RecentLetterRequest,
	L.CountLetter AS CountTriggeredInLastXXDays
FROM
	@Letters L
	INNER JOIN BSYS..LTDB_DAT_DocDetail DD
		ON DD.ID = L.LetterId
	INNER JOIN 
	(
		SELECT
			MAX(Request) AS Request,
			DocName
		FROM
			BSYS..LTDB_DAT_Requests
		GROUP BY
			DocName
	) MaxRequest
		ON MaxRequest.DocName = DD.DocName
WHERE
	DD.DocTyp != 'Form'

SELECT
	DD.DocName AS DocumentName,
	E.LetterId AS LetterId,
	'Email' AS DocumentType,
	DD.Description AS DocumentDescription,
	MaxRequest.Request AS RecentLetterRequest,
	E.CountEmail AS CountTriggeredInLastXXDays
FROM
	@Emails E
	INNER JOIN BSYS..LTDB_DAT_DocDetail DD
		ON DD.ID = E.LetterId
	INNER JOIN 
	(
		SELECT
			MAX(Request) AS Request,
			DocName
		FROM
			BSYS..LTDB_DAT_Requests
		GROUP BY
			DocName
	) MaxRequest
		ON MaxRequest.DocName = DD.DocName
WHERE
	DD.DocTyp != 'Form'