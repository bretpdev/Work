LIBNAME XL 'T:\VA discharge - Cornerstone.xlsx';
DATA XLSOURCE;
	SET XL.'SHEETX$'N (DROP=FX);
RUN;
LIBNAME XL CLEAR;

LIBNAME LEGEND REMOTE SERVER=LEGEND SLIBREF=WORK;
DATA LEGEND.XLSOURCE; *Send data to legend;
	SET XLSOURCE;
RUN;

RSUBMIT LEGEND;
LIBNAME PKUB DBX DATABASE=DNFPUTDL OWNER=PKUB;
PROC SQL;
	CREATE TABLE DCR AS
		SELECT
			 GRXX.BF_SSN
			,GRXX.WN_SEQ_GRXX
			,GRXX.LN_SEQ
			,GRXX.WC_NDS_RPT_STA AS current_WC_NDS_RPT_STA
			,GRXX.WC_NDS_LN_STA_RPT AS current_WC_NDS_LN_STA_RPT
			,GRXX.LD_LON_STA_SR_RPT AS current_LD_LON_STA_SR_RPT
			,GRXX.WC_NDS_LN_DCH_RPT AS current_WC_NDS_LN_DCH_RPT
			,CASE
				WHEN GRXX.WC_NDS_RPT_STA = 'C'
				THEN ' '
				ELSE GRXX.WC_NDS_RPT_STA
			END 			AS new_WC_NDS_RPT_STA
			,'F' 			AS new_WC_NDS_LN_STA_RPT
			,XL.Report_From AS new_LD_LON_STA_SR_RPT
			,XL.Report_From AS new_WC_NDS_LN_DCH_RPT
		FROM
			PKUB.GRXX_RPT_LON_APL GRXX
			INNER JOIN XLSOURCE XL
				ON GRXX.BF_SSN = XL.BF_SSN
				AND GRXX.WN_SEQ_GRXX = INPUT(XL.WN_SEQ_GRXX,X.)
				AND GRXX.LN_SEQ = INPUT(XL.LN_SEQ,X.)
		ORDER BY
			 GRXX.BF_SSN
			,GRXX.WN_SEQ_GRXX
			,GRXX.LN_SEQ
;QUIT;
ENDRSUBMIT;

DATA DCR; 
	SET LEGEND.DCR; 
RUN;

PROC EXPORT
		DATA=DCR
		OUTFILE='T:\CNH XXXXX.xlsx'
		REPLACE;
RUN;	
