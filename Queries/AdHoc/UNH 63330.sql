SELECT DISTINCT 
	PD10.DF_SPE_ACC_ID, 
	CAST(LN90.LD_FAT_EFF AS DATE) AS LAST_PAYMENT
FROM 
	UDW..DW01_DW_CLC_CLU DW01 
	INNER JOIN UDW..PD10_PRS_NME PD10 
		ON PD10.DF_PRS_ID = DW01.BF_SSN 
	LEFT JOIN
	(
		SELECT
			LN90.*
		FROM
			UDW..LN90_FIN_ATY LN90
			INNER JOIN
			(
				SELECT
					BF_SSN,
					LN_SEQ,
					MAX(LN_FAT_SEQ) AS LN_FAT_SEQ
				FROM
					UDW..LN90_FIN_ATY
				WHERE
					PC_FAT_TYP = '10'
					AND PC_FAT_SUB_TYP = '70'
					AND ISNULL(LC_FAT_REV_REA,'') = ''
				GROUP BY
					BF_SSN,
					LN_SEQ
			)MSEQ
				ON MSEQ.BF_SSN = LN90.BF_SSN
				AND MSEQ.LN_SEQ	= LN90.LN_SEQ
				AND MSEQ.LN_FAT_SEQ = LN90.LN_FAT_SEQ
		) LN90
			ON LN90.BF_SSN = DW01.BF_SSN
			AND LN90.LN_SEQ = DW01.LN_SEQ
WHERE 
	WX_OVR_DW_LON_STA = 'CNSLD-STOP PURSUIT'