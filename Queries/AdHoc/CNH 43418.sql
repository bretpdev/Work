SELECT 
	POP.DF_SPE_ACC_ID,
	POP.LN_SEQ
FROM
(
SELECT
	PDXX.DF_SPE_ACC_ID,
	LNXX.BF_SSN,
	LNXX.LN_SEQ
FROM
	CDW..FBXX_BR_FOR_REQ FBXX
	INNER JOIN CDW..PDXX_PRS_NME PDXX
		ON PDXX.DF_PRS_ID = FBXX.BF_SSN
	INNER JOIN CDW..LNXX_BR_FOR_APV LNXX
		ON LNXX.BF_SSN = FBXX.BF_SSN
		AND LNXX.LF_FOR_CTL_NUM = FBXX.LF_FOR_CTL_NUM
	INNER JOIN CDW..LNXX_LON LNXX
		ON LNXX.BF_SSN = LNXX.BF_SSN
		AND LNXX.LN_SEQ = LNXX.LN_SEQ
		AND LNXX.LA_CUR_PRI > X
		AND LNXX.LC_STA_LONXX = 'R'
WHERE
	LNXX.LC_STA_LONXX = 'A'
	AND FBXX.LC_STA_FORXX = 'A'
	AND FBXX.LC_FOR_STA = 'A' --denied records cant have this active
	AND LNXX.LC_FOR_RSP != 'XXX'
	AND FBXX.LC_FOR_TYP = 'XX'
	AND CAST(GETDATE() AS DATE) BETWEEN CAST(LNXX.LD_FOR_BEG AS DATE) AND CAST(LNXX.LD_FOR_END AS DATE)
) POP
LEFT JOIN CDW.calc.RepaymentSchedules RS
	ON RS.BF_SSN = POP.BF_SSN
	AND RS.LN_SEQ = POP.LN_SEQ
WHERE
	RS.BF_SSN IS NULL


--SELECT 
--	POP.*
--FROM
--(
--SELECT
--	LNXX.BF_SSN,
--	LNXX.LN_SEQ
--FROM
--	CDW..FBXX_BR_FOR_REQ FBXX
--	INNER JOIN CDW..LNXX_BR_FOR_APV LNXX
--		ON LNXX.BF_SSN = FBXX.BF_SSN
--		AND LNXX.LF_FOR_CTL_NUM = FBXX.LF_FOR_CTL_NUM
--	INNER JOIN CDW..LNXX_LON LNXX
--		ON LNXX.BF_SSN = LNXX.BF_SSN
--		AND LNXX.LN_SEQ = LNXX.LN_SEQ
--		AND LNXX.LA_CUR_PRI > X
--		AND LNXX.LC_STA_LONXX = 'R'
--WHERE
--	LNXX.LC_STA_LONXX = 'A'
--	AND FBXX.LC_STA_FORXX = 'A'
--	AND FBXX.LC_FOR_STA = 'A' --denied records cant have this active
--	AND LNXX.LC_FOR_RSP != 'XXX'
--	AND FBXX.LC_FOR_TYP = 'XX'
--	AND CAST(GETDATE() AS DATE) BETWEEN CAST(LNXX.LD_FOR_BEG AS DATE) AND CAST(LNXX.LD_FOR_END AS DATE)
--) POP
--LEFT JOIN
--(
--	SELECT 
--		LNXX.BF_SSN,
--		LNXX.LN_SEQ
--	FROM
--		CDW..RSXX_BR_RPD RSXX
--		INNER JOIN CDW..LNXX_LON_RPS LNXX
--			ON LNXX.BF_SSN = RSXX.BF_SSN
--			AND LNXX.LN_RPS_SEQ = RSXX.LN_RPS_SEQ
--	WHERE
--		RSXX.LC_STA_RPSTXX = 'A'
--		AND LNXX.LC_STA_LONXX = 'A'
--) RS
--	ON RS.BF_SSN = POP.BF_SSN
--	AND RS.LN_SEQ = POP.LN_SEQ
--WHERE
--	RS.BF_SSN IS NULL