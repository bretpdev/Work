

RSUBMIT DUSTER;
LIBNAME OLWHRM1 DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;
PROC SQL;
	CREATE TABLE GAUR AS
		SELECT
			PD10.DF_SPE_ACC_ID,	
			LN10.BF_SSN,
			LN10.LN_SEQ,
			LN10.IF_GTR,
			CASE
				WHEN LN10.LF_LON_ALT IS NOT NULL THEN
					LN10.LF_LON_ALT || PUT(LN10.LN_LON_ALT_SEQ, Z3.) 
				ELSE
					' '
			END AS CLUID,
			'04' AS FORWARDING_CODE

		FROM
			OLWHRM1.LN10_LON LN10
		INNER JOIN OLWHRM1.PD10_PRS_NME PD10
			ON PD10.DF_PRS_ID = LN10.BF_SSN
		WHERE 
			LN10.IF_GTR NOT IN ('I00059', '000749')
			AND LN10.LA_CUR_PRI > 0
;
QUIT;
ENDRSUBMIT;

DATA GAUR ;
SET DUSTER.GAUR;
RUN;


DATA _NULL_;
	SET GAUR;
	FILE "T:\FORWARDING_CODE_DCR.sql" DSD DROPOVER LRECL=32767;
	IF _N_ = 1 THEN DO;
		PUT "USE UDW";
		PUT "GO" ;
		PUT "INSERT INTO [dbo].[GA10_CallForwarding]([DF_SPE_ACC_ID],[BF_SSN],[CLUID],[LN_SEQ],[FORWARDING])" ;
		PUT "VALUES" ;
	END;
	DO;
		PUT "('"@;
		PUT DF_SPE_ACC_ID @;
		PUT "','"@;
		PUT BF_SSN @;
		PUT "','"@;
		PUT CLUID @;
		PUT "','"@;
		PUT LN_SEQ @;
		PUT "','"@;
		PUT FORWARDING_CODE @;
		PUT "'),"  ;
	END;
RUN;
