%LET INFILE = T:\SAS\IPAC Payments XXXXXX.csv;
%LET OUTFILE = T:\SAS\IPAC Payments XXXXXX_with email.csv;


LIBNAME  LEGEND  REMOTE  SERVER=LEGEND SLIBREF=work  ;

DATA IPACIN;
	INFILE "&INFILE" DLM = ',' DSD FIRSTOBS = X;
	LENGTH
		SSN $X
		Borr_Name $XX
		RD_Deposit_Date $XX
		Refund_Amt $XX
	;
	INPUT SSN $ Borr_Name $ RD_Deposit_Date $ Refund_Amt $;
RUN;

DATA LEGEND.IPACIN; SET IPACIN; RUN;

RSUBMIT LEGEND;
%let DB = DNFPUTDL;  *This is live;

LIBNAME PKUB DBX DATABASE=&DB OWNER=PKUB;

PROC SQL;
	CREATE TABLE IPAC AS
		SELECT	
			INFI.*,
			PDXX.DX_ADR_EML
		FROM	
			IPACIN INFI
			JOIN PKUB.PDXX_PRS_ADR_EML PDXX
				ON INFI.SSN = PDXX.DF_PRS_ID
		ORDER BY
			SSN
	;
QUIT;

ENDRSUBMIT;

DATA IPAC; SET LEGEND.IPAC; RUN;

PROC EXPORT DATA = WORK.IPAC
            OUTFILE = "&OUTFILE"
            DBMS = CSV 
			REPLACE;
     PUTNAMES = YES;
RUN;
