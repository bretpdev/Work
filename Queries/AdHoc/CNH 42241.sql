USE CDW
GO

DECLARE @BEGIN DATE = 'XX/XX/XXXX'
DECLARE @END DATE = 'XX/XX/XXXX'

SELECT
	PDXX.DF_SPE_ACC_ID AS ACCOUNT_NUMBER,
	AYXX.LD_ATY_REQ_RCV AS ACTIVITY_DATE,
	CASE 
		WHEN AYXX.PF_REQ_ACT = 'FCFSA' THEN 'FALSE CERT'
		WHEN AYXX.PF_REQ_ACT = 'TLFSA' THEN 'TLF'
		WHEN AYXX.PF_REQ_ACT = 'CSFSA' THEN 'CLS'
		WHEN AYXX.PF_REQ_ACT = 'UPFSA' THEN 'UPR'
		WHEN AYXX.PF_REQ_ACT = 'IDBFS' THEN 'ID THEFT'
	END AS [TYPE],
	'SENT' AS [ACTION]
FROM
	CDW..AYXX_BR_LON_ATY AYXX
	INNER JOIN 
	(
		SELECT
			*
		FROM
			CDW..AYXX_BR_LON_ATY AYXX
		WHERE
			AYXX.PF_REQ_ACT IN ('FCDNY','TLDNY','CLDNY','UPDNY','FCDNY','ADFCR','ADTLF','ADCSH','ADUPR','IDAPB') 
			AND AYXX.LC_STA_ACTYXX = 'A'
			and AYXX.LD_ATY_REQ_RCV BETWEEN @BEGIN AND @END
	) POP 
		ON POP.BF_SSN = AYXX.BF_SSN
	INNER JOIN CDW..PDXX_PRS_NME PDXX
		ON PDXX.DF_PRS_ID = AYXX.BF_SSN
WHERE
	AYXX.PF_REQ_ACT IN ('FCFSA','TLFSA','CSFSA','UPFSA','IDBFS')
	AND AYXX.LC_STA_ACTYXX = 'A' 
UNION ALL

SELECT
	PDXX.DF_SPE_ACC_ID AS ACCOUNT_NUMBER,
	AYXX.LD_ATY_REQ_RCV AS ACTIVITY_DATE,
	CASE 
		WHEN AYXX.PF_REQ_ACT = 'FCDNY' THEN 'FALSE CERT'
		WHEN AYXX.PF_REQ_ACT = 'TLDNY' THEN 'TLF'
		WHEN AYXX.PF_REQ_ACT = 'CLDNY' THEN 'CLS'
		WHEN AYXX.PF_REQ_ACT = 'UPDNY' THEN 'UPR'
		WHEN AYXX.PF_REQ_ACT = 'FCDNY' THEN 'ID THEFT'
	END AS [TYPE],
	'DENIED' AS [ACTION]
FROM
	CDW..AYXX_BR_LON_ATY AYXX
	INNER JOIN CDW..PDXX_PRS_NME PDXX
		ON PDXX.DF_PRS_ID = AYXX.BF_SSN
WHERE
	AYXX.PF_REQ_ACT IN ('FCDNY','TLDNY','CLDNY','UPDNY','FCDNY')
	AND AYXX.LC_STA_ACTYXX = 'A'
	AND AYXX.LD_ATY_REQ_RCV BETWEEN @BEGIN AND @END

UNION ALL

SELECT
	PDXX.DF_SPE_ACC_ID AS ACCOUNT_NUMBER,
	AYXX.LD_ATY_REQ_RCV AS ACTIVITY_DATE,
	CASE 
		WHEN AYXX.PF_REQ_ACT = 'ADFCR' THEN 'FALSE CERT'
		WHEN AYXX.PF_REQ_ACT = 'ADTLF' THEN 'TLF'
		WHEN AYXX.PF_REQ_ACT = 'ADCSH' THEN 'CLS'
		WHEN AYXX.PF_REQ_ACT = 'ADUPR' THEN 'UPR'
		WHEN AYXX.PF_REQ_ACT = 'IDAPB' THEN 'ID THEFT'
	END AS [TYPE],
	'DENIED' AS [ACTION]
FROM
	CDW..AYXX_BR_LON_ATY AYXX
	INNER JOIN CDW..PDXX_PRS_NME PDXX
		ON PDXX.DF_PRS_ID = AYXX.BF_SSN
WHERE
	AYXX.PF_REQ_ACT IN ('ADFCR','ADTLF','ADCSH','ADUPR','IDAPB')
	AND AYXX.LC_STA_ACTYXX = 'A'
	AND AYXX.LD_ATY_REQ_RCV BETWEEN @BEGIN AND @END
ORDER BY
	ACCOUNT_NUMBER,
	ACTIVITY_DATE