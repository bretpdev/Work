SELECT distinct
	sum(la_cur_pri) as balance
	
FROM
(
SELECT *  FROM OPENQUERY(LEGEND,
'
SELECT DISTINCT
	PDXX.DF_PRS_ID
FROM 
	PKUB.PDXX_PRS_INA PDXX

WHERE
	DF_PRS_ID NOT LIKE ''P%''
	AND DI_VLD_ADR_HST = ''Y''
	AND (YEAR(DD_CRT_PDXX) = XXXX OR YEAR(DF_LST_DTS_PDXX) = XXXX OR YEAR(DD_VER_ADR_HST) = XXXX)
	AND DC_DOM_ST_HST = ''WA''

') oq

UNION
	
SELECT
	DF_PRS_ID
FROM
	CDW..PDXX_PRS_ADR
WHERE
	DC_DOM_ST = 'WA'
	AND DI_VLD_ADR = 'Y'
	AND YEAR(DF_LST_DTS_PDXX) < XXXX
	AND DF_PRS_ID NOT LIKE 'P%'
) OQ
	INNER JOIN AuditCDW..LNXX_LON_DecXXXX lnXX
		on lnXX.bf_ssn = oq.df_prs_id
where
	lnXX.lc_sta_lonXX = 'R'



SELECT
	SUM(LA_CUR_PRI) AS BAL
FROM 
	CDW..LNXX_LON LNXX
	INNER JOIN CDW..PDXX_PRS_ADR PDXX
		ON PDXX.DF_PRS_ID = LNXX.BF_SSN
WHERE
	YEAR(LNXX.LD_LON_ACL_ADD) = XXXX 
	AND DC_DOM_ST = 'WA'
	AND DI_VLD_ADR = 'Y'
	AND DF_PRS_ID NOT LIKE 'P%'
	AND LNXX.LC_STA_LONXX = 'R'
