SELECT distinct
	LTRIM(RTRIM(PDXX.DM_PRS_X)) + ' ' + LTRIM(RTRIM(PDXX.DM_PRS_LST)) as Name,
	DF_SPE_ACC_ID AS AccountNumber,
	LNXX.LD_DFR_BEG AS DefermentBegin,
	LNXX.LD_DFR_END AS DefermentEnd,
	WQXX.WD_ACT_REQ AS AppRecDate,
	lnXX.LD_DFR_APL AS ProcessedDate,
	LNXX.LA_CUR_PRI AS Balance
FROM
	CDW..DFXX_BR_DFR_REQ DFXX
	INNER JOIN CDW..LNXX_BR_DFR_APV LNXX
		ON DFXX.BF_SSN = LNXX.BF_SSN
		AND DFXX.LF_DFR_CTL_NUM = LNXX.LF_DFR_CTL_NUM
	INNER JOIN CDW..PDXX_PRS_NME PDXX
		ON PDXX.DF_PRS_ID = DFXX.BF_SSN
	INNER JOIN 
	(
		SELECT
			BF_SSN,
			SUM(LA_CUR_PRI) AS LA_CUR_PRI
		FROM
			CDW..LNXX_LON
		GROUP BY
			BF_SSN
	) LNXX
		ON LNXX.BF_SSN = DFXX.BF_SSN
	LEFT JOIN
	(
		SELECT
			BF_SSN,
			MAX(WD_ACT_REQ) AS WD_ACT_REQ
		FROM
			CDW..WQXX_TSK_QUE
		WHERE
			WF_QUE = 'SX'
		GROUP BY
			BF_SSN
	)WQXX
		ON WQXX.BF_SSN = DFXX.BF_SSN
WHERE
	DFXX.LC_DFR_TYP = 'XX'
	AND DFXX.LC_DFR_STA = 'A'
	AND LNXX.LC_STA_LONXX = 'A'
	AND DFXX.LC_STA_DFRXX = 'A'
	AND 
		(
			YEAR(LNXX.LD_DFR_APL) = XXXX
			--OR
			--YEAR(LNXX.LD_DFR_END) = XXXX
		)