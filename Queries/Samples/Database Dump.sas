/*Specify the database as target.  If bsys, then it will connect to bsys.dsn.*/

%LET TARGET = CDW;
%LET DB = %STR(REQUIRED="FILEDSN=X:\PADR\ODBC\&TARGET..dsn;");
%LET OUTFILE = T:\SAS\&TARGET..PDF;
%LET ST = sansprinter;

PROC SQL;
CONNECT TO ODBC AS DB (&DB);
CREATE TABLE TABLE_LIST AS
SELECT *
FROM CONNECTION TO DB (
SELECT DISTINCT NAME AS TABLE_NAME
FROM SYS.TABLES
WHERE SUBSTRING(NAME,1,4) != 'ZDEL'
UNION
SELECT DISTINCT TABLE_NAME
FROM INFORMATION_SCHEMA.VIEWS
);
QUIT;
PROC SQL NOPRINT;
SELECT TABLE_NAME INTO: TB_LIST SEPARATED BY ' '
FROM TABLE_LIST;
SELECT COUNT(DISTINCT TABLE_NAME) INTO: TB_CT
FROM TABLE_LIST;
QUIT;
%PUT &TB_LIST &TB_CT;

LIBNAME DUDE ODBC USER="sqlserver;" PASSWORD="procauto;" &DB ;
LIBNAME DUMP EXCEL "Q:\SUPPORT SERVICES\TEST FILES\SAS\&TARGET._DUMP_&SYSDATE..XLS";

%MACRO DUMP(TBL);
PROC SQL ;
CREATE TABLE DUMP.&TBL AS
SELECT *
FROM DUDE.&TBL;
QUIT;
%MEND;

%MACRO DUMP_ALL;
%DO I = 1 %TO &TB_CT;
	%DUMP(%SCAN(&TB_LIST,&I));
%END;
%MEND;
%DUMP_ALL;
LIBNAME DUMP CLEAR;
