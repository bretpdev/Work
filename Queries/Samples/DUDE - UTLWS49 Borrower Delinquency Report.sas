%LET OUTLIB = X:\REPORTS\LSS\OUTPUT;
%LET MD = %STR(REQUIRED="FILEDSN=X:\PADR\ODBC\MD.dsn;");
LIBNAME DUDE ODBC &MD ;

DATA _null_;
	CALL SYMPUT('TODAYS',PUT(TODAY(),WEEKDATE31.));
RUN;

PROC SQL;
CREATE TABLE DLQBKT AS
SELECT distinct CASE 
		WHEN INT(LN_DLQ_MAX/30) >= 10 THEN '300+'
		ELSE PUT(INT(LN_DLQ_MAX/30)*30,4.0) || ' - ' || PUT(INT(LN_DLQ_MAX/30)*30 + 29,4.0)
	END AS PERIOD
	,SUM(LA_CUR_PRI) AS LA_CUR_PRI LABEL='TOTAL AMOUNT'
	,COUNT(*) AS NUM_LOANS LABEL='TOTAL NUMBER OF LOANS'
FROM DUDE.LOAN
WHERE LA_CUR_PRI > 0
	AND INPUT(LD_DLQ_MAX,MMDDYY10.) = TODAY()-1
GROUP BY 1
;
QUIT;

ODS HTML BODY="&OUTLIB\DELQ_RPT_run_off_DUDE.HTML";
TITLE 'BORROWER DELINQUENCY SUMMARY REPORT';
TITLE2	&TODAYS;

PROC PRINT NOOBS SPLIT='/' DATA=DLQBKT WIDTH=UNIFORM WIDTH=MIN LABEL;
FORMAT NUM_LOANS COMMA8. LA_CUR_PRI DOLLAR18.2;
VAR PERIOD NUM_LOANS LA_CUR_PRI;
LABEL PERIOD = 'Days Delinquent'
	NUM_LOANS = 'Total Number of Loans'
	LA_CUR_PRI = 'Total Amount of Loans';
RUN;

ODS _ALL_ CLOSE;
