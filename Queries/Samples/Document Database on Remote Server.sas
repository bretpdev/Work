%SYSLPUT DB = DNFPUTDL;
%LET OUTFILE = T:\SAS\CornerStone Remote Warehouse.PDF;
%LET ST = sansprinter;

LIBNAME  LEGEND REMOTE  SERVER=LEGEND  SLIBREF=WORK;
RSUBMIT;
%PUT &DB;
%let DB = DNFPRQUT;  *This is test;
/*%let DB = DNFPUTDL;  *This is live;*/
PROC SQL;
CONNECT TO DB2 (DATABASE=&DB);
CREATE TABLE TESTQUERY AS
SELECT *
FROM CONNECTION TO DB2 (
/*SELECT **/
SELECT B.tabschema 
  ,B.tabname AS TABLE
  ,B.COLNAME AS NAME
  ,B.TYPENAME
  ,B.LENGTH
  ,B.SCALE
  ,CASE WHEN B.KEYSEQ IS NOT NULL THEN 'X' ELSE '' END AS PK
  ,CASE WHEN B.NULLS = 'Y' THEN 'X' ELSE '' END AS MANDATORY
  ,CASE WHEN B.DEFAULT != '' THEN 'X' END AS WITH_DEFAULT
  ,B.COLNO AS ordinal_position
FROM SYSCAT.COLUMNS B
where B.TABSCHEMA NOT IN ('ASN','SYSTOOLS','ZDBA')
/*    AND TABNAME = 'FS10_DL_LON'*/
/*	AND TABSCHEMA = 'PKUB'*/
ORDER BY COLNO
FOR READ ONLY WITH UR
);
DISCONNECT FROM DB2;

/*%PUT  SQLXRC= >>> &SQLXRC <<< ||| SQLXMSG= >>> &SQLXMSG >>> ;  ** INCLUDES ERROR MESSAGES TO SAS LOG  ;*/
/*%SQLCHECK;*/
/*QUIT;*/

ENDRSUBMIT;
DATA TESTQUERY;
    SET LEGEND.TESTQUERY;
RUN;

DATA TESTQUERY; 
SET TESTQUERY;
IF SCALE > 0 THEN DATA_TYPE = TRIM(TYPENAME) || '(' || TRIM(LEFT(PUT(LENGTH,4.0))) || ',' || TRIM(LEFT(PUT(SCALE,2.0))) || ')';
ELSE IF TYPENAME = 'CHARACTER' THEN DATA_TYPE = TRIM(TYPENAME) || '(' || TRIM(LEFT(PUT(LENGTH,4.0))) || ')';
ELSE DATA_TYPE = TYPENAME;
RUN;

PROC SORT DATA=TESTQUERY; BY  TABLE tabschema ORDINAL_POSITION; RUN;

ODS _ALL_ CLOSE;
TITLE "&TARGET Data Model";
/*TITLE2 "&st";*/
ODS PDF FILE="&OUTFILE" UNIFORM  PDFTOC=2 STYLE=&st  ;
PROC PRINT DATA=TESTQUERY noobs;
BY  TABLE TABSCHEMA;
VAR NAME DATA_TYPE PK MANDATORY WITH_DEFAULT;
RUN;
ODS PDF CLOSE;
ODS LISTING;
