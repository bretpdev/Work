USE CDW
GO

MERGE
	dbo.BORR_PendingDisb ExistingData
USING
(
	SELECT DISTINCT 
		PD10.DF_SPE_ACC_ID, 
		'Y' AS PendDisb
	FROM 
		LN15_DSB LN15
		INNER JOIN PD10_PRS_NME PD10
			ON PD10.DF_PRS_ID = LN15.BF_SSN
	WHERE
		LC_DSB_TYP = '1'
		AND COALESCE(LC_DSB_CAN_TYP,'') = ''
		AND LC_STA_LON15 = '1'
) NewData
	ON NewData.DF_SPE_ACC_ID = ExistingData.DF_SPE_ACC_ID
WHEN NOT MATCHED THEN
	INSERT
	(
		DF_SPE_ACC_ID,
		PendDisb
	)
	VALUES
	(
		NewData.DF_SPE_ACC_ID,
		NewData.PendDisb
	)
WHEN NOT MATCHED BY SOURCE THEN
	DELETE;