USE CDW
GO

--SELECT
--	*
--INTO 
--	dbo.LN10_LON
--FROM
--	OPENQUERY
--	(
--		LEGEND,
--		'
--			SELECT
--				*
--			FROM
--				PKUB.LN10_LON
--		'
--	) 

DECLARE @LastRefresh VARCHAR(30) = (SELECT CONVERT(VARCHAR(30), ISNULL(MAX(LN10.LF_LST_DTS_LN10), '1-1-1900 00:00:00'), 21) FROM LN10_LON LN10)
PRINT 'Last Refreshed at: ' + @LastRefresh

DECLARE @SQLStatement VARCHAR(MAX) = 
'
	MERGE 
		dbo.LN10_LON LN10
	USING
		(
			SELECT
				*
			FROM
				OPENQUERY
				(
					LEGEND,
					''
						SELECT
							LN10.*
						FROM
							PKUB.LN10_LON LN10
						-- comment WHERE clause for full table refresh
						WHERE
							LN10.LF_LST_DTS_LN10 > ''''' + @LastRefresh + '''''
					''
				) 
		) L ON L.BF_SSN = LN10.BF_SSN AND L.LN_SEQ = LN10.LN_SEQ
	WHEN MATCHED THEN 
		UPDATE SET 
			LN10.LC_STA_LON10 = L.LC_STA_LON10,
			LN10.LI_FGV_PGM = L.LI_FGV_PGM,
			LN10.LF_LON_SLE_PND = L.LF_LON_SLE_PND,
			LN10.LA_CUR_PRI = L.LA_CUR_PRI,
			LN10.LI_ELG_CPN_BOK = L.LI_ELG_CPN_BOK,
			LN10.LA_LON_AMT_GTR = L.LA_LON_AMT_GTR,
			LN10.LD_LON_GTR = L.LD_LON_GTR,
			LN10.LD_PIF_PNT_RTN = L.LD_PIF_PNT_RTN,
			LN10.LD_PNT_SIG = L.LD_PNT_SIG,
			LN10.LC_INT_BIL_OPT = L.LC_INT_BIL_OPT,
			LN10.LI_CAP_ALW = L.LI_CAP_ALW,
			LN10.LD_END_GRC_PRD = L.LD_END_GRC_PRD,
			LN10.LN_MTH_GRC_PRD_DSC = L.LN_MTH_GRC_PRD_DSC,
			LN10.LA_R78_INT_PD = L.LA_R78_INT_PD,
			LN10.LA_R78_INT_MAX = L.LA_R78_INT_MAX,
			LN10.LD_CAP_LST_PIO_CVN = L.LD_CAP_LST_PIO_CVN,
			LN10.LD_TRM_END = L.LD_TRM_END,
			LN10.LD_TRM_BEG = L.LD_TRM_BEG,
			LN10.LI_GTR_NAT = L.LI_GTR_NAT,
			LN10.LF_GTR_RFR = L.LF_GTR_RFR,
			LN10.LI_ELG_SPA = L.LI_ELG_SPA,
			LN10.LD_GTE_LOS = L.LD_GTE_LOS,
			LN10.LA_SCL_CLS = L.LA_SCL_CLS,
			LN10.LA_CUR_ILG = L.LA_CUR_ILG,
			LN10.LA_ILG = L.LA_ILG,
			LN10.LD_PIF_RPT = L.LD_PIF_RPT,
			LN10.LA_NSI_OTS = L.LA_NSI_OTS,
			LN10.LD_NSI_ACR_THU = L.LD_NSI_ACR_THU,
			LN10.LD_STA_LON10 = L.LD_STA_LON10,
			LN10.LD_LON_ACL_ADD = L.LD_LON_ACL_ADD,
			LN10.LD_LON_EFF_ADD = L.LD_LON_EFF_ADD,
			LN10.LF_DOE_SCL_ORG = L.LF_DOE_SCL_ORG,
			LN10.LC_PCV_DIS_STA = L.LC_PCV_DIS_STA,
			LN10.LC_RPR_TYP = L.LC_RPR_TYP,
			LN10.LF_RGL_CAT_LP19 = L.LF_RGL_CAT_LP19,
			LN10.LF_RGL_CAT_LP18 = L.LF_RGL_CAT_LP18,
			LN10.LF_RGL_CAT_LP17 = L.LF_RGL_CAT_LP17,
			LN10.LF_RGL_CAT_LP13 = L.LF_RGL_CAT_LP13,
			LN10.LF_RGL_CAT_LP12 = L.LF_RGL_CAT_LP12,
			LN10.LF_RGL_CAT_LP11 = L.LF_RGL_CAT_LP11,
			LN10.LF_RGL_CAT_LP10 = L.LF_RGL_CAT_LP10,
			LN10.LF_RGL_CAT_LP08 = L.LF_RGL_CAT_LP08,
			LN10.LF_RGL_CAT_LP07 = L.LF_RGL_CAT_LP07,
			LN10.LF_RGL_CAT_LP06 = L.LF_RGL_CAT_LP06,
			LN10.LF_RGL_CAT_LP05 = L.LF_RGL_CAT_LP05,
			LN10.LF_RGL_CAT_LP04 = L.LF_RGL_CAT_LP04,
			LN10.LF_RGL_CAT_LP03 = L.LF_RGL_CAT_LP03,
			LN10.LF_RGL_CAT_LP02 = L.LF_RGL_CAT_LP02,
			LN10.LF_RGL_CAT_LP01 = L.LF_RGL_CAT_LP01,
			LN10.LD_SCL_CLS_NTF = L.LD_SCL_CLS_NTF,
			LN10.LD_ILG_NTF = L.LD_ILG_NTF,
			LN10.LF_LON_CUR_OWN = L.LF_LON_CUR_OWN,
			LN10.LF_LST_DTS_LN10 = L.LF_LST_DTS_LN10,
			LN10.LC_STA_NEW_BR = L.LC_STA_NEW_BR,
			LN10.LC_SCY_PGA = L.LC_SCY_PGA,
			LN10.LD_SIN_LST_PD_PCV = L.LD_SIN_LST_PD_PCV,
			LN10.LD_SIN_ACR_THU_PCV = L.LD_SIN_ACR_THU_PCV,
			LN10.LA_SIN_OTS_PCV = L.LA_SIN_OTS_PCV,
			LN10.IC_LON_PGM = L.IC_LON_PGM,
			LN10.PF_MAJ_BCH = L.PF_MAJ_BCH,
			LN10.PF_MNR_BCH = L.PF_MNR_BCH,
			LN10.IF_DOE_LDR = L.IF_DOE_LDR,
			LN10.IF_GTR = L.IF_GTR,
			LN10.LF_STU_SSN = L.LF_STU_SSN,
			LN10.LD_LON_1_DSB = L.LD_LON_1_DSB,
			LN10.LC_ACA_GDE_LEV = L.LC_ACA_GDE_LEV,
			LN10.LD_NEW_SYS_CVN = L.LD_NEW_SYS_CVN,
			LN10.LC_SCY_PGA_PGM_YR = L.LC_SCY_PGA_PGM_YR,
			LN10.IC_HSP_CSE = L.IC_HSP_CSE,
			LN10.LI_TL4_793_XCL_CON = L.LI_TL4_793_XCL_CON,
			LN10.LI_DFR_REQ_ON_APL = L.LI_DFR_REQ_ON_APL,
			LN10.LI_LN_PT_COM_APL = L.LI_LN_PT_COM_APL,
			LN10.LN_SEQ_RPR = L.LN_SEQ_RPR,
			LN10.LR_WIR_CON_LON = L.LR_WIR_CON_LON,
			LN10.LR_INT_RDC_PGM_DSU = L.LR_INT_RDC_PGM_DSU,
			LN10.LI_1_TME_BR = L.LI_1_TME_BR,
			LN10.BF_SSN_RPR = L.BF_SSN_RPR,
			LN10.LC_ELG_RDC_PGM = L.LC_ELG_RDC_PGM,
			LN10.LD_ELG_RDC_PGM = L.LD_ELG_RDC_PGM,
			LN10.LC_RPD_SLE = L.LC_RPD_SLE,
			LN10.LR_ITR_ORG = L.LR_ITR_ORG,
			LN10.LC_ITR_TYP_ORG = L.LC_ITR_TYP_ORG,
			LN10.LC_RDC_PGM = L.LC_RDC_PGM,
			LN10.LC_TIR_GRP = L.LC_TIR_GRP,
			LN10.LD_SER_RSB_BEG = L.LD_SER_RSB_BEG,
			LN10.LC_EFT_RDC = L.LC_EFT_RDC,
			LN10.LD_LTS_STS_BIL = L.LD_LTS_STS_BIL,
			LN10.IF_TIR_PCE = L.IF_TIR_PCE,
			LN10.LF_RGL_CAT_LP20 = L.LF_RGL_CAT_LP20,
			LN10.LN_RDC_PGM_PAY_PCV = L.LN_RDC_PGM_PAY_PCV,
			LN10.LC_REA_PIF_PCV = L.LC_REA_PIF_PCV,
			LN10.LD_FAT_PIF_TOL_PCV = L.LD_FAT_PIF_TOL_PCV,
			LN10.LA_FAT_PIF_TOL_PCV = L.LA_FAT_PIF_TOL_PCV,
			LN10.LI_RTE_RDC_ELG = L.LI_RTE_RDC_ELG,
			LN10.LD_LTE_FEE_ELG = L.LD_LTE_FEE_ELG,
			LN10.LA_LTE_FEE_OTS = L.LA_LTE_FEE_OTS,
			LN10.LD_LON_LTE_FEE_WAV = L.LD_LON_LTE_FEE_WAV,
			LN10.LC_CUR_RDC_PGM_NME = L.LC_CUR_RDC_PGM_NME,
			LN10.LI_RIR_SCY_ELG = L.LI_RIR_SCY_ELG,
			LN10.LD_END_RIR_DSQ_OVR = L.LD_END_RIR_DSQ_OVR,
			LN10.LF_LON_ALT = L.LF_LON_ALT,
			LN10.LN_LON_ALT_SEQ = L.LN_LON_ALT_SEQ,
			LN10.LI_LDR_LST_RST_DSB = L.LI_LDR_LST_RST_DSB,
			LN10.LC_ST_BR_RSD_APL = L.LC_ST_BR_RSD_APL,
			LN10.LI_PIF_RPT_REQ = L.LI_PIF_RPT_REQ,
			LN10.LD_AMR_BEG = L.LD_AMR_BEG,
			LN10.LD_ORG_XPC_GRD = L.LD_ORG_XPC_GRD,
			LN10.LD_CON_LST_RPY_BEG = L.LD_CON_LST_RPY_BEG,
			LN10.LN_CON_MTH_DFR_FOR = L.LN_CON_MTH_DFR_FOR,
			LN10.LD_LON_APL_RCV = L.LD_LON_APL_RCV,
			LN10.LR_SCL_SUB = L.LR_SCL_SUB,
			LN10.LI_BLL_PAY_SES_OVR = L.LI_BLL_PAY_SES_OVR,
			LN10.LC_MPN_TYP = L.LC_MPN_TYP,
			LN10.LD_MPN_EXP = L.LD_MPN_EXP,
			LN10.LC_MPN_SRL_LON = L.LC_MPN_SRL_LON,
			LN10.LC_MPN_REV_REA = L.LC_MPN_REV_REA,
			LN10.LF_ORG_RGN = L.LF_ORG_RGN,
			LN10.LC_CAM_LON_STA = L.LC_CAM_LON_STA,
			LN10.LD_DFR_FOR_END = L.LD_DFR_FOR_END,
			LN10.LC_DFR_FOR_TYP = L.LC_DFR_FOR_TYP,
			LN10.LF_CAM_DFR_SCL_ENR = L.LF_CAM_DFR_SCL_ENR,
			LN10.LD_DFR_FOR_BEG = L.LD_DFR_FOR_BEG,
			LN10.LD_CAM_DFR_INF_CER = L.LD_CAM_DFR_INF_CER,
			LN10.LI_BR_DET_RPD_XTN = L.LI_BR_DET_RPD_XTN,
			LN10.DD_DTH_VER = L.DD_DTH_VER,
			LN10.DD_DSA_VER = L.DD_DSA_VER,
			LN10.LI_CON_PAY_STP_PUR = L.LI_CON_PAY_STP_PUR,
			LN10.LD_FSE_CER_NTF = L.LD_FSE_CER_NTF,
			LN10.LA_TOT_EDU_DET = L.LA_TOT_EDU_DET,
			LN10.LI_LDR_BG_APL = L.LI_LDR_BG_APL,
			LN10.LD_RIR_CSC_BIL_STS = L.LD_RIR_CSC_BIL_STS,
			LN10.LI_ESG = L.LI_ESG,
			LN10.LC_RIR_DSQ_REA = L.LC_RIR_DSQ_REA,
			LN10.LF_MN_MST_NTE = L.LF_MN_MST_NTE,
			LN10.LN_MN_MST_NTE_SEQ = L.LN_MN_MST_NTE_SEQ,
			LN10.LC_LON_SND_CHC = L.LC_LON_SND_CHC,
			LN10.LC_SST_LON10 = L.LC_SST_LON10,
			LN10.LF_RGL_CAT_LP09 = L.LF_RGL_CAT_LP09,
			LN10.LI_MN_PSD_BS = L.LI_MN_PSD_BS,
			LN10.LF_CRD_RTE_SRE = L.LF_CRD_RTE_SRE,
			LN10.LF_ESG_SRC = L.LF_ESG_SRC,
			LN10.PC_PNT_YR = L.PC_PNT_YR,
			LN10.LF_OWN_BND_ISS_TE1 = L.LF_OWN_BND_ISS_TE1,
			LN10.LF_OWN_BND_ISS_TE2 = L.LF_OWN_BND_ISS_TE2,
			LN10.LF_OWN_BND_ISS_TE3 = L.LF_OWN_BND_ISS_TE3,
			LN10.LD_MPN_STM_SNT = L.LD_MPN_STM_SNT,
			LN10.LI_MNT_BIL_RCP = L.LI_MNT_BIL_RCP,
			LN10.LX_BS_POI = L.LX_BS_POI,
			LN10.LA_BS_POI = L.LA_BS_POI,
			LN10.LA_INT_FEE_URP_IRS = L.LA_INT_FEE_URP_IRS,
			LN10.LC_BR_ALW_SCL_DFR = L.LC_BR_ALW_SCL_DFR,
			LN10.LD_BR_ALW_SCL_DFR = L.LD_BR_ALW_SCL_DFR,
			LN10.LC_LON_DFR_SUB_TYP = L.LC_LON_DFR_SUB_TYP,
			LN10.LD_FAT_PRI_BAL_ZRO = L.LD_FAT_PRI_BAL_ZRO,
			LN10.LC_ST_SCL_ATD_APL = L.LC_ST_SCL_ATD_APL,
			LN10.LD_EFT_DSQ_NSF_LMT = L.LD_EFT_DSQ_NSF_LMT,
			LN10.LD_CLM_PD = L.LD_CLM_PD,
			LN10.LC_STP_PUR = L.LC_STP_PUR,
			LN10.LD_CON_PAY_EFF = L.LD_CON_PAY_EFF,
			LN10.LD_CON_PAY_APL = L.LD_CON_PAY_APL,
			LN10.LC_ESG = L.LC_ESG,
			LN10.LC_LON_RPE_CVN_REA = L.LC_LON_RPE_CVN_REA,
			LN10.LC_UDL_DSB_COF = L.LC_UDL_DSB_COF,
			LN10.LI_BR_LT_HT = L.LI_BR_LT_HT,
			LN10.LI_ALL_PAY_FLG_SPS = L.LI_ALL_PAY_FLG_SPS,
			LN10.LN_MFY_GRS_PAY = L.LN_MFY_GRS_PAY,
			LN10.LC_ESP_RPD_OPT_SEL = L.LC_ESP_RPD_OPT_SEL,
			LN10.LC_ELG_95_SPA_BIL = L.LC_ELG_95_SPA_BIL,
			LN10.LC_SGM_COS_PRC = L.LC_SGM_COS_PRC,
			LN10.LD_GTR_DR_DCH_CER = L.LD_GTR_DR_DCH_CER,
			LN10.LD_RPD_ELY_CL_BEG = L.LD_RPD_ELY_CL_BEG,
			LN10.LD_RPD_ELY_CL_END = L.LD_RPD_ELY_CL_END,
			LN10.LF_GTR_RFR_XTN = L.LF_GTR_RFR_XTN,
			LN10.LA_MSC_FEE_OTS = L.LA_MSC_FEE_OTS,
			LN10.LA_MSC_FEE_PCV_OTS = L.LA_MSC_FEE_PCV_OTS,
			LN10.LF_LON_GRP_WI_BR = L.LF_LON_GRP_WI_BR,
			LN10.LC_TL4_IBR_ELG = L.LC_TL4_IBR_ELG,
			LN10.LD_LON_IBR_ENT = L.LD_LON_IBR_ENT,
			LN10.LC_LON_IBR_RPY_TYP = L.LC_LON_IBR_RPY_TYP,
			LN10.LI_BYP_COL_OUT_SRC = L.LI_BYP_COL_OUT_SRC,
			LN10.LI_BR_GRP_RLP = L.LI_BR_GRP_RLP,
			LN10.LI_OO_PST_ENR_DFR = L.LI_OO_PST_ENR_DFR,
			LN10.LD_OO_PST_ENR_DFR = L.LD_OO_PST_ENR_DFR,
			LN10.LF_FED_CLC_RSK = L.LF_FED_CLC_RSK,
			LN10.LF_FED_FFY_1_DSB = L.LF_FED_FFY_1_DSB,
			LN10.LF_PRV_GTR = L.LF_PRV_GTR,
			LN10.LC_FED_PGM_YR = L.LC_FED_PGM_YR,
			LN10.LA_INT_RCV_GOV = L.LA_INT_RCV_GOV,
			LN10.LC_WOF_WUP_REA = L.LC_WOF_WUP_REA,
			LN10.LC_VRS_ALT_APL = L.LC_VRS_ALT_APL,
			LN10.LF_LON_DCV_CLI = L.LF_LON_DCV_CLI,
			LN10.LN_LON_SEQ_DCV_CLI = L.LN_LON_SEQ_DCV_CLI,
			LN10.LI_EDS_BKR_STP_PUR = L.LI_EDS_BKR_STP_PUR,
			LN10.LF_EDS = L.LF_EDS,
			LN10.LD_EFF_LBR_RTE = L.LD_EFF_LBR_RTE,
			LN10.LA_STD_STD_PAY = L.LA_STD_STD_PAY,
			LN10.LI_FRC_IBR = L.LI_FRC_IBR,
			LN10.LC_STP_PUR_REA = L.LC_STP_PUR_REA,
			LN10.LD_IDR_ELG_CHG = L.LD_IDR_ELG_CHG,
			LN10.LC_IDR_ELG_CRI = L.LC_IDR_ELG_CRI
	WHEN NOT MATCHED THEN
		INSERT 
		(
			BF_SSN,
			LN_SEQ,
			LC_STA_LON10,
			LI_FGV_PGM,
			LF_LON_SLE_PND,
			LA_CUR_PRI,
			LI_ELG_CPN_BOK,
			LA_LON_AMT_GTR,
			LD_LON_GTR,
			LD_PIF_PNT_RTN,
			LD_PNT_SIG,
			LC_INT_BIL_OPT,
			LI_CAP_ALW,
			LD_END_GRC_PRD,
			LN_MTH_GRC_PRD_DSC,
			LA_R78_INT_PD,
			LA_R78_INT_MAX,
			LD_CAP_LST_PIO_CVN,
			LD_TRM_END,
			LD_TRM_BEG,
			LI_GTR_NAT,
			LF_GTR_RFR,
			LI_ELG_SPA,
			LD_GTE_LOS,
			LA_SCL_CLS,
			LA_CUR_ILG,
			LA_ILG,
			LD_PIF_RPT,
			LA_NSI_OTS,
			LD_NSI_ACR_THU,
			LD_STA_LON10,
			LD_LON_ACL_ADD,
			LD_LON_EFF_ADD,
			LF_DOE_SCL_ORG,
			LC_PCV_DIS_STA,
			LC_RPR_TYP,
			LF_RGL_CAT_LP19,
			LF_RGL_CAT_LP18,
			LF_RGL_CAT_LP17,
			LF_RGL_CAT_LP13,
			LF_RGL_CAT_LP12,
			LF_RGL_CAT_LP11,
			LF_RGL_CAT_LP10,
			LF_RGL_CAT_LP08,
			LF_RGL_CAT_LP07,
			LF_RGL_CAT_LP06,
			LF_RGL_CAT_LP05,
			LF_RGL_CAT_LP04,
			LF_RGL_CAT_LP03,
			LF_RGL_CAT_LP02,
			LF_RGL_CAT_LP01,
			LD_SCL_CLS_NTF,
			LD_ILG_NTF,
			LF_LON_CUR_OWN,
			LF_LST_DTS_LN10,
			LC_STA_NEW_BR,
			LC_SCY_PGA,
			LD_SIN_LST_PD_PCV,
			LD_SIN_ACR_THU_PCV,
			LA_SIN_OTS_PCV,
			IC_LON_PGM,
			PF_MAJ_BCH,
			PF_MNR_BCH,
			IF_DOE_LDR,
			IF_GTR,
			LF_STU_SSN,
			LD_LON_1_DSB,
			LC_ACA_GDE_LEV,
			LD_NEW_SYS_CVN,
			LC_SCY_PGA_PGM_YR,
			IC_HSP_CSE,
			LI_TL4_793_XCL_CON,
			LI_DFR_REQ_ON_APL,
			LI_LN_PT_COM_APL,
			LN_SEQ_RPR,
			LR_WIR_CON_LON,
			LR_INT_RDC_PGM_DSU,
			LI_1_TME_BR,
			BF_SSN_RPR,
			LC_ELG_RDC_PGM,
			LD_ELG_RDC_PGM,
			LC_RPD_SLE,
			LR_ITR_ORG,
			LC_ITR_TYP_ORG,
			LC_RDC_PGM,
			LC_TIR_GRP,
			LD_SER_RSB_BEG,
			LC_EFT_RDC,
			LD_LTS_STS_BIL,
			IF_TIR_PCE,
			LF_RGL_CAT_LP20,
			LN_RDC_PGM_PAY_PCV,
			LC_REA_PIF_PCV,
			LD_FAT_PIF_TOL_PCV,
			LA_FAT_PIF_TOL_PCV,
			LI_RTE_RDC_ELG,
			LD_LTE_FEE_ELG,
			LA_LTE_FEE_OTS,
			LD_LON_LTE_FEE_WAV,
			LC_CUR_RDC_PGM_NME,
			LI_RIR_SCY_ELG,
			LD_END_RIR_DSQ_OVR,
			LF_LON_ALT,
			LN_LON_ALT_SEQ,
			LI_LDR_LST_RST_DSB,
			LC_ST_BR_RSD_APL,
			LI_PIF_RPT_REQ,
			LD_AMR_BEG,
			LD_ORG_XPC_GRD,
			LD_CON_LST_RPY_BEG,
			LN_CON_MTH_DFR_FOR,
			LD_LON_APL_RCV,
			LR_SCL_SUB,
			LI_BLL_PAY_SES_OVR,
			LC_MPN_TYP,
			LD_MPN_EXP,
			LC_MPN_SRL_LON,
			LC_MPN_REV_REA,
			LF_ORG_RGN,
			LC_CAM_LON_STA,
			LD_DFR_FOR_END,
			LC_DFR_FOR_TYP,
			LF_CAM_DFR_SCL_ENR,
			LD_DFR_FOR_BEG,
			LD_CAM_DFR_INF_CER,
			LI_BR_DET_RPD_XTN,
			DD_DTH_VER,
			DD_DSA_VER,
			LI_CON_PAY_STP_PUR,
			LD_FSE_CER_NTF,
			LA_TOT_EDU_DET,
			LI_LDR_BG_APL,
			LD_RIR_CSC_BIL_STS,
			LI_ESG,
			LC_RIR_DSQ_REA,
			LF_MN_MST_NTE,
			LN_MN_MST_NTE_SEQ,
			LC_LON_SND_CHC,
			LC_SST_LON10,
			LF_RGL_CAT_LP09,
			LI_MN_PSD_BS,
			LF_CRD_RTE_SRE,
			LF_ESG_SRC,
			PC_PNT_YR,
			LF_OWN_BND_ISS_TE1,
			LF_OWN_BND_ISS_TE2,
			LF_OWN_BND_ISS_TE3,
			LD_MPN_STM_SNT,
			LI_MNT_BIL_RCP,
			LX_BS_POI,
			LA_BS_POI,
			LA_INT_FEE_URP_IRS,
			LC_BR_ALW_SCL_DFR,
			LD_BR_ALW_SCL_DFR,
			LC_LON_DFR_SUB_TYP,
			LD_FAT_PRI_BAL_ZRO,
			LC_ST_SCL_ATD_APL,
			LD_EFT_DSQ_NSF_LMT,
			LD_CLM_PD,
			LC_STP_PUR,
			LD_CON_PAY_EFF,
			LD_CON_PAY_APL,
			LC_ESG,
			LC_LON_RPE_CVN_REA,
			LC_UDL_DSB_COF,
			LI_BR_LT_HT,
			LI_ALL_PAY_FLG_SPS,
			LN_MFY_GRS_PAY,
			LC_ESP_RPD_OPT_SEL,
			LC_ELG_95_SPA_BIL,
			LC_SGM_COS_PRC,
			LD_GTR_DR_DCH_CER,
			LD_RPD_ELY_CL_BEG,
			LD_RPD_ELY_CL_END,
			LF_GTR_RFR_XTN,
			LA_MSC_FEE_OTS,
			LA_MSC_FEE_PCV_OTS,
			LF_LON_GRP_WI_BR,
			LC_TL4_IBR_ELG,
			LD_LON_IBR_ENT,
			LC_LON_IBR_RPY_TYP,
			LI_BYP_COL_OUT_SRC,
			LI_BR_GRP_RLP,
			LI_OO_PST_ENR_DFR,
			LD_OO_PST_ENR_DFR,
			LF_FED_CLC_RSK,
			LF_FED_FFY_1_DSB,
			LF_PRV_GTR,
			LC_FED_PGM_YR,
			LA_INT_RCV_GOV,
			LC_WOF_WUP_REA,
			LC_VRS_ALT_APL,
			LF_LON_DCV_CLI,
			LN_LON_SEQ_DCV_CLI,
			LI_EDS_BKR_STP_PUR,
			LF_EDS,
			LD_EFF_LBR_RTE,
			LA_STD_STD_PAY,
			LI_FRC_IBR,
			LC_STP_PUR_REA,
			LD_IDR_ELG_CHG,
			LC_IDR_ELG_CRI
		)
		VALUES 
		(
			L.BF_SSN,
			L.LN_SEQ,
			L.LC_STA_LON10,
			L.LI_FGV_PGM,
			L.LF_LON_SLE_PND,
			L.LA_CUR_PRI,
			L.LI_ELG_CPN_BOK,
			L.LA_LON_AMT_GTR,
			L.LD_LON_GTR,
			L.LD_PIF_PNT_RTN,
			L.LD_PNT_SIG,
			L.LC_INT_BIL_OPT,
			L.LI_CAP_ALW,
			L.LD_END_GRC_PRD,
			L.LN_MTH_GRC_PRD_DSC,
			L.LA_R78_INT_PD,
			L.LA_R78_INT_MAX,
			L.LD_CAP_LST_PIO_CVN,
			L.LD_TRM_END,
			L.LD_TRM_BEG,
			L.LI_GTR_NAT,
			L.LF_GTR_RFR,
			L.LI_ELG_SPA,
			L.LD_GTE_LOS,
			L.LA_SCL_CLS,
			L.LA_CUR_ILG,
			L.LA_ILG,
			L.LD_PIF_RPT,
			L.LA_NSI_OTS,
			L.LD_NSI_ACR_THU,
			L.LD_STA_LON10,
			L.LD_LON_ACL_ADD,
			L.LD_LON_EFF_ADD,
			L.LF_DOE_SCL_ORG,
			L.LC_PCV_DIS_STA,
			L.LC_RPR_TYP,
			L.LF_RGL_CAT_LP19,
			L.LF_RGL_CAT_LP18,
			L.LF_RGL_CAT_LP17,
			L.LF_RGL_CAT_LP13,
			L.LF_RGL_CAT_LP12,
			L.LF_RGL_CAT_LP11,
			L.LF_RGL_CAT_LP10,
			L.LF_RGL_CAT_LP08,
			L.LF_RGL_CAT_LP07,
			L.LF_RGL_CAT_LP06,
			L.LF_RGL_CAT_LP05,
			L.LF_RGL_CAT_LP04,
			L.LF_RGL_CAT_LP03,
			L.LF_RGL_CAT_LP02,
			L.LF_RGL_CAT_LP01,
			L.LD_SCL_CLS_NTF,
			L.LD_ILG_NTF,
			L.LF_LON_CUR_OWN,
			L.LF_LST_DTS_LN10,
			L.LC_STA_NEW_BR,
			L.LC_SCY_PGA,
			L.LD_SIN_LST_PD_PCV,
			L.LD_SIN_ACR_THU_PCV,
			L.LA_SIN_OTS_PCV,
			L.IC_LON_PGM,
			L.PF_MAJ_BCH,
			L.PF_MNR_BCH,
			L.IF_DOE_LDR,
			L.IF_GTR,
			L.LF_STU_SSN,
			L.LD_LON_1_DSB,
			L.LC_ACA_GDE_LEV,
			L.LD_NEW_SYS_CVN,
			L.LC_SCY_PGA_PGM_YR,
			L.IC_HSP_CSE,
			L.LI_TL4_793_XCL_CON,
			L.LI_DFR_REQ_ON_APL,
			L.LI_LN_PT_COM_APL,
			L.LN_SEQ_RPR,
			L.LR_WIR_CON_LON,
			L.LR_INT_RDC_PGM_DSU,
			L.LI_1_TME_BR,
			L.BF_SSN_RPR,
			L.LC_ELG_RDC_PGM,
			L.LD_ELG_RDC_PGM,
			L.LC_RPD_SLE,
			L.LR_ITR_ORG,
			L.LC_ITR_TYP_ORG,
			L.LC_RDC_PGM,
			L.LC_TIR_GRP,
			L.LD_SER_RSB_BEG,
			L.LC_EFT_RDC,
			L.LD_LTS_STS_BIL,
			L.IF_TIR_PCE,
			L.LF_RGL_CAT_LP20,
			L.LN_RDC_PGM_PAY_PCV,
			L.LC_REA_PIF_PCV,
			L.LD_FAT_PIF_TOL_PCV,
			L.LA_FAT_PIF_TOL_PCV,
			L.LI_RTE_RDC_ELG,
			L.LD_LTE_FEE_ELG,
			L.LA_LTE_FEE_OTS,
			L.LD_LON_LTE_FEE_WAV,
			L.LC_CUR_RDC_PGM_NME,
			L.LI_RIR_SCY_ELG,
			L.LD_END_RIR_DSQ_OVR,
			L.LF_LON_ALT,
			L.LN_LON_ALT_SEQ,
			L.LI_LDR_LST_RST_DSB,
			L.LC_ST_BR_RSD_APL,
			L.LI_PIF_RPT_REQ,
			L.LD_AMR_BEG,
			L.LD_ORG_XPC_GRD,
			L.LD_CON_LST_RPY_BEG,
			L.LN_CON_MTH_DFR_FOR,
			L.LD_LON_APL_RCV,
			L.LR_SCL_SUB,
			L.LI_BLL_PAY_SES_OVR,
			L.LC_MPN_TYP,
			L.LD_MPN_EXP,
			L.LC_MPN_SRL_LON,
			L.LC_MPN_REV_REA,
			L.LF_ORG_RGN,
			L.LC_CAM_LON_STA,
			L.LD_DFR_FOR_END,
			L.LC_DFR_FOR_TYP,
			L.LF_CAM_DFR_SCL_ENR,
			L.LD_DFR_FOR_BEG,
			L.LD_CAM_DFR_INF_CER,
			L.LI_BR_DET_RPD_XTN,
			L.DD_DTH_VER,
			L.DD_DSA_VER,
			L.LI_CON_PAY_STP_PUR,
			L.LD_FSE_CER_NTF,
			L.LA_TOT_EDU_DET,
			L.LI_LDR_BG_APL,
			L.LD_RIR_CSC_BIL_STS,
			L.LI_ESG,
			L.LC_RIR_DSQ_REA,
			L.LF_MN_MST_NTE,
			L.LN_MN_MST_NTE_SEQ,
			L.LC_LON_SND_CHC,
			L.LC_SST_LON10,
			L.LF_RGL_CAT_LP09,
			L.LI_MN_PSD_BS,
			L.LF_CRD_RTE_SRE,
			L.LF_ESG_SRC,
			L.PC_PNT_YR,
			L.LF_OWN_BND_ISS_TE1,
			L.LF_OWN_BND_ISS_TE2,
			L.LF_OWN_BND_ISS_TE3,
			L.LD_MPN_STM_SNT,
			L.LI_MNT_BIL_RCP,
			L.LX_BS_POI,
			L.LA_BS_POI,
			L.LA_INT_FEE_URP_IRS,
			L.LC_BR_ALW_SCL_DFR,
			L.LD_BR_ALW_SCL_DFR,
			L.LC_LON_DFR_SUB_TYP,
			L.LD_FAT_PRI_BAL_ZRO,
			L.LC_ST_SCL_ATD_APL,
			L.LD_EFT_DSQ_NSF_LMT,
			L.LD_CLM_PD,
			L.LC_STP_PUR,
			L.LD_CON_PAY_EFF,
			L.LD_CON_PAY_APL,
			L.LC_ESG,
			L.LC_LON_RPE_CVN_REA,
			L.LC_UDL_DSB_COF,
			L.LI_BR_LT_HT,
			L.LI_ALL_PAY_FLG_SPS,
			L.LN_MFY_GRS_PAY,
			L.LC_ESP_RPD_OPT_SEL,
			L.LC_ELG_95_SPA_BIL,
			L.LC_SGM_COS_PRC,
			L.LD_GTR_DR_DCH_CER,
			L.LD_RPD_ELY_CL_BEG,
			L.LD_RPD_ELY_CL_END,
			L.LF_GTR_RFR_XTN,
			L.LA_MSC_FEE_OTS,
			L.LA_MSC_FEE_PCV_OTS,
			L.LF_LON_GRP_WI_BR,
			L.LC_TL4_IBR_ELG,
			L.LD_LON_IBR_ENT,
			L.LC_LON_IBR_RPY_TYP,
			L.LI_BYP_COL_OUT_SRC,
			L.LI_BR_GRP_RLP,
			L.LI_OO_PST_ENR_DFR,
			L.LD_OO_PST_ENR_DFR,
			L.LF_FED_CLC_RSK,
			L.LF_FED_FFY_1_DSB,
			L.LF_PRV_GTR,
			L.LC_FED_PGM_YR,
			L.LA_INT_RCV_GOV,
			L.LC_WOF_WUP_REA,
			L.LC_VRS_ALT_APL,
			L.LF_LON_DCV_CLI,
			L.LN_LON_SEQ_DCV_CLI,
			L.LI_EDS_BKR_STP_PUR,
			L.LF_EDS,
			L.LD_EFF_LBR_RTE,
			L.LA_STD_STD_PAY,
			L.LI_FRC_IBR,
			L.LC_STP_PUR_REA,
			L.LD_IDR_ELG_CHG,
			L.LC_IDR_ELG_CRI
		)
	-- !!! uncomment lines below ONLY when doing a full table refresh 
	--WHEN NOT MATCHED BY SOURCE THEN
	--    DELETE
	;
'

PRINT @SQLStatement
EXEC (@SQLStatement)


-- ###### VALIDATION
DECLARE 
	@CountDifference INT

SELECT
	@CountDifference = L.LocalCount - R.RemoteCount
FROM
	OPENQUERY
	(
		LEGEND,
		'
			SELECT
				COUNT(*) AS "RemoteCount"
			FROM
				PKUB.LN10_LON LN10
		'	
	) R
	FULL OUTER JOIN
	(
		SELECT
			COUNT(*) [LocalCount]
		FROM
			PKUB.LN10_LON LN10
	) L ON 1 = 1
	
IF @CountDifference != 0
BEGIN
	RAISERROR('LN10_LON - The remote and local record counts do not match.  The local count is off by %i records.  A full refresh of the table is required.', 16, 11, @CountDifference)
END