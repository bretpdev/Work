
CREATE VIEW  DataImage.BorrowerDemographics WITH SCHEMABINDING
AS

SELECT
	PD10.DF_SPE_ACC_ID [AccountNumber],
	PD10.BF_SSN [SSN],
	ISNULL(PD10.DM_PRS_1, '') [FirstName],
	ISNULL(PD10.DM_PRS_MID, '') [MiddleName],
	ISNULL(PD10.DM_PRS_LST, '') [LastName],
	ISNULL(CASE
		WHEN LEN(LTRIM(PD30.DX_STR_ADR_2)) > 0 
			THEN PD30.DX_STR_ADR_1 + ', ' + PD30.DX_STR_ADR_2 
			ELSE PD30.DX_STR_ADR_1
	END, '') [StreetAddress],
	ISNULL(PD30.DM_CT, '') [City],
	ISNULL(PD30.DM_FGN_ST, '') [State],
	ISNULL(PD30.DF_ZIP_CDE_IVR, '') [Zip],
	ISNULL(PD32_H.DX_ADR_EML, '') [HomeEmail],
	ISNULL(PD32_A.DX_ADR_EML, '') [AlternatEmail],
	ISNULL(PD42_H.DN_DOM_PHN_ARA + PD42_H.DN_DOM_PHN_XCH + PD42_H.DN_DOM_PHN_LCL, '') [HomePhone],
	ISNULL(PD42_M.DN_DOM_PHN_ARA + PD42_M.DN_DOM_PHN_XCH + PD42_M.DN_DOM_PHN_LCL, '') [MobilePhone],
	ISNULL(PD42_W.DN_DOM_PHN_ARA + PD42_W.DN_DOM_PHN_XCH + PD42_W.DN_DOM_PHN_LCL, '') [WorkPhone],
	ISNULL(PD42_A.DN_DOM_PHN_ARA + PD42_A.DN_DOM_PHN_XCH + PD42_A.DN_DOM_PHN_LCL, '') [AlternatePhone]
FROM
	dbo.PD10_Borrower PD10
	LEFT JOIN dbo.PD30_Address PD30 on PD30.DF_SPE_ACC_ID = PD10.DF_SPE_ACC_ID AND PD30.DI_VLD_ADR = 'Y'
	LEFT JOIN dbo.PD32_Email PD32_H on PD32_H.DF_SPE_ACC_ID = PD10.DF_SPE_ACC_ID AND PD32_H.DC_ADR_EML = 'H' AND PD32_H.DI_VLD_ADR_EML = 'Y'
	LEFT JOIN dbo.PD32_Email PD32_A on PD32_A.DF_SPE_ACC_ID = PD10.DF_SPE_ACC_ID AND PD32_A.DC_ADR_EML = 'H' AND PD32_A.DI_VLD_ADR_EML = 'Y'
	LEFT JOIN dbo.PD42_Phone PD42_H on PD42_H.DF_SPE_ACC_ID = PD10.DF_SPE_ACC_ID AND PD42_H.DC_PHN = 'H' AND PD42_H.DI_PHN_VLD = 'Y'
	LEFT JOIN dbo.PD42_Phone PD42_M on PD42_M.DF_SPE_ACC_ID = PD10.DF_SPE_ACC_ID AND PD42_M.DC_PHN = 'M' AND PD42_M.DI_PHN_VLD = 'Y'
	LEFT JOIN dbo.PD42_Phone PD42_W on PD42_W.DF_SPE_ACC_ID = PD10.DF_SPE_ACC_ID AND PD42_W.DC_PHN = 'W' AND PD42_W.DI_PHN_VLD = 'Y'
	LEFT JOIN dbo.PD42_Phone PD42_A on PD42_A.DF_SPE_ACC_ID = PD10.DF_SPE_ACC_ID AND PD42_A.DC_PHN = 'A' AND PD42_A.DI_PHN_VLD = 'Y'
GO
GRANT SELECT
    ON OBJECT::[DataImage].[BorrowerDemographics] TO [UHEAA\Img-UHEAA_CS_Doc_Svc]
    AS [dbo];


GO
GRANT SELECT
    ON OBJECT::[DataImage].[BorrowerDemographics] TO [UHEAA\imaging]
    AS [dbo];

