

CREATE PROCEDURE [dbo].[LT_US06BIDRDP_FormFields]
		 @BF_SSN  CHAR(9) 
AS

DECLARE @PF_REQ_ACT VARCHAR(5) = (SELECT AC11.PF_REQ_ACT FROM AC11_ACT_REQ_LTR AC11 WHERE PF_LTR = 'US06BIDRD')

	SELECT DISTINCT
		'$' + CONVERT(VARCHAR(15), RS05.BA_PMN_STD_TOT_PAY, 1) as PaymentAmount,
		CONVERT(VARCHAR(10), RS10.LD_RPS_1_PAY_DU, 101) as DueDate
	FROM
		UDW..LN10_LON LN10
		INNER JOIN UDW..PD10_PRS_NME PD10
			ON LN10.BF_SSN = PD10.DF_PRS_ID
		INNER JOIN
		(
			SELECT DISTINCT
				LN85.BF_SSN,
				LN85.LN_SEQ
			FROM
				UDW..LN85_LON_ATY LN85
				INNER JOIN --GETS THE MOST RECENT ARC LEFT ON THE BORROWERS ACCOUNT TO GET THE LOAN SEQ'S THE LETTER APPLIES TO
				(
					SELECT
						AY10.BF_SSN,
						MAX(AY10.LN_ATY_SEQ) AS LN_ATY_SEQ,
						MAX(AY10.LD_ATY_REQ_RCV) AS LD_ATY_REQ_RCV
					FROM 
						UDW..AY10_BR_LON_ATY AY10
					WHERE
						AY10.PF_REQ_ACT = @PF_REQ_ACT
					GROUP BY
						AY10.BF_SSN
				)AY10
					ON AY10.BF_SSN = LN85.BF_SSN
					AND AY10.LN_ATY_SEQ = LN85.LN_ATY_SEQ
		)LN85
			ON LN85.BF_SSN = LN10.BF_SSN
			AND LN85.LN_SEQ = LN10.LN_SEQ
		INNER JOIN RS10_BR_RPD RS10
			ON RS10.BF_SSN = LN10.BF_SSN
		INNER JOIN LN65_LON_RPS LN65
			ON LN65.BF_SSN = LN10.BF_SSN
			AND LN65.LN_SEQ = LN10.LN_SEQ
			AND LN65.LN_RPS_SEQ = RS10.LN_RPS_SEQ
		INNER JOIN 
		(
			SELECT
				BF_SSN,
				BA_PMN_STD_TOT_PAY,
				MAX(BD_CRT_RS05) IBR_CREATE_DATE
			FROM
				UDW..RS05_IBR_RPS	
			WHERE
				BC_STA_RS05 = 'A'
			GROUP BY
				BF_SSN,
				BA_PMN_STD_TOT_PAY

		)RS05
			ON RS05.BF_SSN = LN10.BF_SSN
	WHERE
		LN65.LC_STA_LON65 = 'A'
		AND RS10.LC_STA_RPST10 = 'A'
RETURN 0