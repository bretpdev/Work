/*UTLWQ05 - FISCAL YEAR GROSS GUARANTY VOLUME BY MONTH*/

/*LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;
%LET RPTLIB = %SYSGET(reportdir);
FILENAME REPORT2 "&RPTLIB/ULWQ05.LWQ05R2";*/

libname  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=work  ;
RSUBMIT;
OPTIONS SYMBOLGEN;
PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE GRSGTY AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT COUNT(B.AF_APL_ID||B.AF_APL_ID_SFX) AS LON_CT
	,COUNT(DISTINCT A.DF_PRS_ID_BR) AS BWR_CT
	,SUM(B.AA_GTE_LON_AMT) AS GRS_GTY

FROM  OLWHRM1.GA01_APP A 
INNER JOIN OLWHRM1.GA10_LON_APP B
	ON A.AF_APL_ID = B.AF_APL_ID

WHERE B.AC_PRC_STA = 'A'
);
DISCONNECT FROM DB2;
endrsubmit  ;

DATA GRSGTY; 
SET WORKLOCL.GRSGTY; 
RUN;

DATA _NULL_;
CALL SYMPUT('RUNDATE',PUT(INTNX('DAY',TODAY(),0,'beginning'), MMDDYY10.));
RUN;

/*PROC PRINTTO PRINT=REPORT2;
RUN;*/
OPTIONS CENTER NODATE NUMBER PAGENO=1 LS=132;
PROC REPORT DATA=GRSGTY NOWD SPACING=1 HEADSKIP SPLIT='/';
TITLE "UHEAA GROSS GUARANTY VOLUME";
TITLE2 "RUN DATE: &RUNDATE";
FOOTNOTE  'JOB = UTLWQ05     REPORT = ULWQ05.LWQ05R2';
COLUMN /*YRMO*/ GRS_GTY LON_CT BWR_CT;
/*DEFINE YRMO / DISPLAY "MONTH" WIDTH=7;*/
DEFINE GRS_GTY / ANALYSIS FORMAT=DOLLAR18.2 "GROSS GUARANTY/AMOUNT";
DEFINE LON_CT / ANALYSIS FORMAT=COMMA20. "APPROVED LOANS/ON ONELINK";
DEFINE BWR_CT / ANALYSIS FORMAT=COMMA20. "BORROWERS WITH/APPROVED LOANS/ON ONELINK";
RUN;

/* *TEST STUFF;
libname  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=work  ;
RSUBMIT;
OPTIONS SYMBOLGEN;
PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE DEMOTEST AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT A.DF_PRS_ID_BR
	,B.AF_APL_ID||B.AF_APL_ID_SFX AS LON_CT
	,B.AA_GTE_LON_AMT

FROM  OLWHRM1.GA01_APP A 
INNER JOIN OLWHRM1.GA10_LON_APP B
	ON A.AF_APL_ID = B.AF_APL_ID

WHERE B.AC_PRC_STA = 'A'
ORDER BY A.DF_PRS_ID_BR
);
DISCONNECT FROM DB2;
endrsubmit  ;

DATA DEMOTEST; 
SET WORKLOCL.DEMOTEST (OBS=10000); 
RUN;

PROC EXPORT DATA= DEMOTEST 
            OUTFILE= "T:\SAS\ULWQ05R2 Test.xls" 
            DBMS=EXCEL2000 REPLACE;
RUN;

*/
