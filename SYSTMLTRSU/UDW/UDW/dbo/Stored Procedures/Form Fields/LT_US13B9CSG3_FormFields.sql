CREATE PROCEDURE [dbo].[LT_US13B9CSG3_FormFields]
	@BF_SSN VARCHAR(9),
	@IsCoborrower BIT = 0,
	@RN_ATY_SEQ_PRC INT
AS
BEGIN

SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED

DECLARE @PF_REQ_ACT VARCHAR(5) = (SELECT AC11.PF_REQ_ACT FROM AC11_ACT_REQ_LTR AC11 WHERE PF_LTR = 'US13B9CSG3')

--Special case letter.  No coborrower processing needed as it is a letter to borrowers to get coborrower demos
	SELECT DISTINCT
		PD10.DM_PRS_1 AS PL1STNAMEE,
		PD10.DM_PRS_LST AS PLLSTNAMEE,
		PD30.DX_STR_ADR_1 AS PLSTREET1E,
		PD30.DX_STR_ADR_2 AS PLSTREET2E,
		PD30.DM_CT AS PLCITYE,
		PD30.DC_DOM_ST AS PLSTATEE,
		PD30.DF_ZIP_CDE AS PLZIPE,
		PD30.DM_FGN_CNY AS PLFRGNCNTE
	FROM 
		LN20_EDS LN20
		INNER JOIN PD10_PRS_NME PD10 
			ON PD10.DF_PRS_ID = LN20.LF_EDS
		INNER JOIN PD30_PRS_ADR PD30 
			ON PD30.DF_PRS_ID = LN20.LF_EDS
			AND PD30.DC_ADR = 'L'
		INNER JOIN
		(
			SELECT
				LN85.BF_SSN,
				LN85.LN_SEQ
			FROM
				LN85_LON_ATY LN85
				INNER JOIN AY10_BR_LON_ATY AY10
					ON AY10.BF_SSN = LN85.BF_SSN
					AND AY10.LN_ATY_SEQ = LN85.LN_ATY_SEQ
			WHERE   
				AY10.PF_REQ_ACT = @PF_REQ_ACT
				AND AY10.BF_SSN = @BF_SSN
				AND AY10.LN_ATY_SEQ = @RN_ATY_SEQ_PRC
				--Active flag ignored, as LT20 provides the exact record that is tied to this request
		)LN85
			ON LN85.BF_SSN = LN20.BF_SSN
			AND LN85.LN_SEQ = LN20.LN_SEQ 
	WHERE 
		LN20.LC_EDS_TYP = 'M'
		AND LN20.LC_STA_LON20 = 'A'
		AND	LN20.BF_SSN = @BF_SSN
END