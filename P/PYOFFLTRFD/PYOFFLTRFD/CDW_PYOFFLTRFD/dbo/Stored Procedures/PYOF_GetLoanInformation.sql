CREATE PROCEDURE [dbo].[PYOF_GetLoanInformation] 
	@DF_SPE_ACC_ID VARCHAR(10),
	@CoBorrower INT = 0
AS
BEGIN
	SET NOCOUNT ON;
IF @CoBorrower = 0
	BEGIN
		SELECT
			ROW_NUMBER() OVER (PARTITION BY LN10.BF_SSN ORDER BY LN10.BF_SSN, LN10.LN_SEQ ASC) AS RowId, 
			LN10.LN_SEQ AS LoanSequence,
			CONVERT(VARCHAR(16), CAST(LN10.LA_CUR_PRI AS MONEY), 2) AS CurrentPrincipal,
			LN10.IC_LON_PGM AS LoanProgram
		FROM
			CDW..LN10_LON LN10
			INNER JOIN CDW..PD10_PRS_NME PD10
				ON LN10.BF_SSN = PD10.DF_PRS_ID
		WHERE
			PD10.DF_SPE_ACC_ID = @DF_SPE_ACC_ID
			AND LN10.LA_CUR_PRI > 0
			AND LN10.LC_STA_LON10 != 'D'
	END
ELSE
	BEGIN
		SELECT
			ROW_NUMBER() OVER (PARTITION BY LN10.BF_SSN ORDER BY LN10.BF_SSN, LN10.LN_SEQ ASC) AS RowId, 
			LN10.LN_SEQ AS LoanSequence,
			CONVERT(VARCHAR(16), CAST(LN10.LA_CUR_PRI AS MONEY), 2) AS CurrentPrincipal,
			LN10.IC_LON_PGM AS LoanProgram
		FROM
			CDW..PD10_PRS_NME PD10
			INNER JOIN LN20_EDS LN20
					ON LN20.BF_SSN = PD10.DF_PRS_ID
					AND LN20.LC_STA_LON20 = 'A'
					AND LN20.LC_EDS_TYP = 'M' --Coborrower
			INNER JOIN CDW..LN10_LON LN10
				ON LN10.BF_SSN = LN20.BF_SSN
				AND LN10.LN_SEQ = LN20.LN_SEQ
		WHERE
			PD10.DF_SPE_ACC_ID = @DF_SPE_ACC_ID
			AND LN10.LA_CUR_PRI > 0
			AND LN10.LC_STA_LON10 != 'D'
	END
END