USE CDW
GO

MERGE
	dbo.BORR_Endorser ExistingData
USING
	(
		SELECT DISTINCT 
			PD10.DF_SPE_ACC_ID, 
			'Y' AS COBORROWER
		FROM 
			PD10_PRS_NME PD10
			INNER JOIN LN20_EDS LN20
				ON LN20.BF_SSN = PD10.DF_PRS_ID
				AND LN20.LC_EDS_TYP = 'M'
				AND LN20.LC_STA_LON20 = 'A'
	) NewData
		ON NewData.DF_SPE_ACC_ID = ExistingData.DF_SPE_ACC_ID
WHEN NOT MATCHED THEN
	INSERT
	(
		DF_SPE_ACC_ID,
		COBORROWER
	)
	VALUES
	(
		NewData.DF_SPE_ACC_ID,
		NewData.COBORROWER
	)
WHEN NOT MATCHED BY SOURCE THEN
	DELETE;