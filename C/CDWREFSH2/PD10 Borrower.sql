USE CDW
GO

MERGE 
	CDW.dbo.PD10_Borrower PD10
USING
	(
		SELECT DISTINCT
			PD10.DF_SPE_ACC_ID,
			PD10.DF_PRS_ID AS BF_SSN,
			ISNULL(CentralData.dbo.TRIM(PD10.DM_PRS_1),'') AS DM_PRS_1,
			ISNULL(CentralData.dbo.TRIM(PD10.DM_PRS_LST),'') AS DM_PRS_LST,
			ISNULL(PD10.DM_PRS_MID,'') AS DM_PRS_MID,
			ISNULL(CONVERT(VARCHAR(10),PD10.DD_BRT,101),'') AS DD_BRT
		FROM
			CDW..PD10_PRS_NME PD10
		WHERE
			LEFT(PD10.DF_PRS_ID, 1) != 'P'
			AND CentralData.dbo.TRIM(PD10.DF_SPE_ACC_ID) != ''
	) NewData 
		ON NewData.DF_SPE_ACC_ID = PD10.DF_SPE_ACC_ID
WHEN MATCHED THEN 
	UPDATE SET 
		PD10.BF_SSN = NewData.BF_SSN,
		PD10.DM_PRS_1 = NewData.DM_PRS_1,
		PD10.DM_PRS_LST = NewData.DM_PRS_LST,
		PD10.DM_PRS_MID = NewData.DM_PRS_MID,
		PD10.DD_BRT = NewData.DD_BRT
WHEN NOT MATCHED THEN
	INSERT 
	(
		DF_SPE_ACC_ID,
		BF_SSN,
		DM_PRS_1,
		DM_PRS_LST,
		DM_PRS_MID,
		DD_BRT
	)
	VALUES 
	(
		NewData.DF_SPE_ACC_ID,
		NewData.BF_SSN,
		NewData.DM_PRS_1,
		NewData.DM_PRS_LST,
		NewData.DM_PRS_MID,
		NewData.DD_BRT
	)
WHEN NOT MATCHED BY SOURCE THEN
	DELETE
;
