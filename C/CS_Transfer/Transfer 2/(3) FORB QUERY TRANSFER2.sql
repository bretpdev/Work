DECLARE @CURRENT_COUNT INT = (SELECT COUNT(*) FROM CDW..CS_Transfer2)

DECLARE @NUMBER_TO_PULL INT =  (300000 - @CURRENT_COUNT)
--INSERT INTO CDW..CS_Transfer2
SELECT
	POP.*,
	SUM(CASE WHEN LN10.LC_FED_PGM_YR = 'LNC' THEN 1 ELSE 0 END) AS LNC_Count,
	SUM(CASE WHEN LN10.LC_FED_PGM_YR = 'DLO' THEN 1 ELSE 0 END) AS DLO_Count,
	NULL AS LNC_SaleId,
	NULL AS DLO_SaleId
FROM
(
SELECT DISTINCT TOP (@NUMBER_TO_PULL)
	FB10.BF_SSN,
	'TYPE 41 FORB' AS [POPULATION]
FROM
	CDW..FB10_BR_FOR_REQ FB10
	INNER JOIN CDW..LN60_BR_FOR_APV LN60
		ON LN60.BF_SSN = FB10.BF_SSN
		AND LN60.LF_FOR_CTL_NUM = FB10.LF_FOR_CTL_NUM
	INNER JOIN CDW..LN10_LON LN10
		ON LN10.BF_SSN = LN60.BF_SSN
		AND LN10.LN_SEQ = LN60.LN_SEQ
		AND LN10.LA_CUR_PRI > 0
		AND LN10.LC_STA_LON10 = 'R'
	LEFT JOIN CDW..CS_Transfer1 T1
		ON T1.BF_SSN = FB10.BF_SSN
	LEFT JOIN CDW..CS_Transfer2 T2
		ON T2.BF_SSN = FB10.BF_SSN
	LEFT JOIN CDW..CS_Transfer2_Exclusions EX
		ON EX.BF_SSN = FB10.BF_SSN
WHERE
	LN60.LC_STA_LON60 = 'A'
	AND FB10.LC_STA_FOR10 = 'A'
	AND FB10.LC_FOR_STA = 'A' --denied records cant have this active
	AND LN60.LC_FOR_RSP != '003'
	AND FB10.LC_FOR_TYP = '41'
	AND CAST(GETDATE() AS DATE) BETWEEN CAST(LN60.LD_FOR_BEG AS DATE) AND CAST(LN60.LD_FOR_END AS DATE)
	AND T1.BF_SSN IS NULL
	AND T2.BF_SSN IS NULL
	AND EX.BF_SSN IS NULL
) POP
INNER JOIN CDW..LN10_LON LN10
	ON LN10.BF_SSN = POP.BF_SSN
	AND LN10.LA_CUR_PRI > 0
	AND LN10.LC_STA_LON10 = 'R'
GROUP BY
	POP.BF_SSN,
	POP.[POPULATION]
