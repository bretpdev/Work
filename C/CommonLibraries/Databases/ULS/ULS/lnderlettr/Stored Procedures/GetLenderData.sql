CREATE PROCEDURE [lnderlettr].[GetLenderData]
	@TestMode bit,
	@WF_ORG_LDR char(8)
AS
DECLARE @Query VARCHAR(Max)
IF @TestMode = 0
	SET @Query = 'SELECT * FROM OPENQUERY(DUSTER,'
ELSE 
	SET @Query = 'SELECT * FROM OPENQUERY(QADBD004,'

SELECT @Query = @Query + 
		'''
		SELECT Distinct
			LR25.IF_DOE_LDR,
			LR10.IM_LDR_FUL,
			LR25.IX_LDR_STR_ADR_1,
			LR25.IX_LDR_STR_ADR_2,
			LR25.IM_LDR_CT,
			LR25.IC_LDR_DOM_ST,
			LR25.IF_LDR_ZIP_CDE,
			LR25.IM_LDR_FGN_CNY,
			LR25.II_LDR_VLD_ADR,
			CONCAT(LR25.IN_LDR_DOM_FAX_ARA, CONCAT(LR25.IN_LDR_DOM_FAX_XCH, LR25.IN_LDR_DOM_FAX_LCL)) AS LDR_FAX
		FROM
			OLWHRM1.LR25_LDR_DPT LR25
			INNER JOIN OLWHRM1.LR10_LDR_DMO LR10
				ON LR10.IF_DOE_LDR = LR25.IF_DOE_LDR
		WHERE
			LR25.IF_DOE_LDR = ''''' + CAST(@WF_ORG_LDR AS CHAR(8)) + '''''
			AND LR25.IC_LDR_DPT = ''''000''''
			'')'
EXEC(@Query)
GO
GRANT EXECUTE
    ON OBJECT::[lnderlettr].[GetLenderData] TO [db_executor]
    AS [dbo];

