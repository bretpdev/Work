/*UTLWU24 - QC Rpt - No Phone - Validity Indicator a Y*/
%LET RPTLIB = T:\SAS;
FILENAME REPORT2 "&RPTLIB/ULWU24.LWU24R2";
FILENAME REPORT3 "&RPTLIB/ULWU24.LWU24R3";
FILENAME REPORT4 "&RPTLIB/ULWU24.LWU24R4";
FILENAME REPORT5 "&RPTLIB/ULWU24.LWU24R5";

LIBNAME  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=WORK;
RSUBMIT;

PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE COMPASS_BORROWER AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT DISTINCT
	A.DF_SPE_ACC_ID,
	A.DM_PRS_1,
	A.DM_PRS_LST
FROM	OLWHRM1.PD10_PRS_NME A
	INNER JOIN OLWHRM1.PD42_PRS_PHN B
		ON A.DF_PRS_ID = B.DF_PRS_ID
	INNER JOIN OLWHRM1.LN10_LON C
		ON B.DF_PRS_ID = C.BF_SSN
WHERE	C.LA_CUR_PRI > 0
	AND C.LC_STA_LON10 = 'R'
	AND B.DC_PHN = 'H'
	AND B.DN_DOM_PHN_XCH = '555'
	AND B.DN_DOM_PHN_LCL = '1212'
	AND B.DI_PHN_VLD = 'Y'
FOR READ ONLY WITH UR
);

CREATE TABLE COMPASS_REFERENCE AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT DISTINCT
	C.BF_RFR,
	A.DM_PRS_1,
	A.DM_PRS_LST
FROM	OLWHRM1.PD10_PRS_NME A
	INNER JOIN OLWHRM1.PD42_PRS_PHN B
		ON A.DF_PRS_ID = B.DF_PRS_ID
	INNER JOIN OLWHRM1.RF10_RFR C
		ON B.DF_PRS_ID = C.BF_RFR
WHERE	C.BC_STA_REFR10 = 'A'
	AND B.DC_PHN = 'H'
	AND B.DN_DOM_PHN_XCH = '555'
	AND B.DN_DOM_PHN_LCL = '1212'
	AND B.DI_PHN_VLD = 'Y'
	AND C.BF_SSN IN
	(
		SELECT X.BF_SSN
		FROM OLWHRM1.LN10_LON X
		WHERE	X.LA_CUR_PRI > 0
		AND X.LC_STA_LON10 = 'R'
	)
FOR READ ONLY WITH UR
);

CREATE TABLE ONELINK_BORROWER AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT DISTINCT
	A.DF_SPE_ACC_ID,
	A.DM_PRS_1,
	A.DM_PRS_LST
FROM	OLWHRM1.PD01_PDM_INF A
	INNER JOIN OLWHRM1.GA01_APP X
		ON A.DF_PRS_ID IN (X.DF_PRS_ID_BR, X.DF_PRS_ID_EDS)
	INNER JOIN OLWHRM1.GA14_LON_STA B
		ON X.AF_APL_ID = B.AF_APL_ID
	INNER JOIN OLWHRM1.GA10_LON_APP C
		ON B.AF_APL_ID = C.AF_APL_ID
		AND B.AF_APL_ID_SFX = C.AF_APL_ID_SFX
	INNER JOIN OLWHRM1.DC01_LON_CLM_INF D
		ON C.AF_APL_ID = D.AF_APL_ID
		AND C.AF_APL_ID_SFX = D.AF_APL_ID_SFX
WHERE	(B.AC_LON_STA_TYP IN ('DA', 'FB', 'IA', 'ID', 'IG', 'IM', 'RP', 'UA', 'UB')
		OR (B.AC_LON_STA_TYP IN ('CP', 'DN') AND D.LC_STA_DC10 = '03' AND (D.LC_REA_CLM_ASN_DOE IS NULL OR D.LC_REA_CLM_ASN_DOE = ''))
		OR (B.AC_LON_STA_TYP = 'CR' AND D.LC_STA_DC10 = '01' AND D.LC_PCL_REA IN ('DF', 'RS', 'DB', 'DQ')))
	AND RTRIM(A.DN_PHN) LIKE '%5551212'
	AND A.DI_PHN_VLD = 'Y'
FOR READ ONLY WITH UR
);

CREATE TABLE ONELINK_REFERENCE AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT DISTINCT
	A.DF_PRS_ID_RFR,
	A.BM_RFR_1,
	A.BM_RFR_LST
FROM	OLWHRM1.BR03_BR_REF A
WHERE	A.BC_STA_BR03 = 'A'
	AND A.BC_HME_CNC_RSL <> '04'
	AND RTRIM(A.BN_RFR_DOM_PHN) LIKE '5551212'
	AND A.BI_DOM_PHN_VLD = 'Y'
	AND A.DF_PRS_ID_BR IN
	(
		SELECT X.DF_PRS_ID_BR
		FROM OLWHRM1.GA01_APP X
			INNER JOIN OLWHRM1.GA14_LON_STA Y
				ON X.AF_APL_ID = Y.AF_APL_ID
			INNER JOIN OLWHRM1.GA10_LON_APP Z
				ON Y.AF_APL_ID = Z.AF_APL_ID
				AND Y.AF_APL_ID_SFX = Z.AF_APL_ID_SFX
			INNER JOIN OLWHRM1.DC01_LON_CLM_INF THETA
				ON Z.AF_APL_ID = THETA.AF_APL_ID
				AND Z.AF_APL_ID_SFX = THETA.AF_APL_ID_SFX
		WHERE	(Y.AC_LON_STA_TYP IN ('DA', 'FB', 'IA', 'ID', 'IG', 'IM', 'RP', 'UA', 'UB')
				OR (Y.AC_LON_STA_TYP IN ('CP', 'DN') AND THETA.LC_STA_DC10 = '03' AND (THETA.LC_REA_CLM_ASN_DOE IS NULL OR THETA.LC_REA_CLM_ASN_DOE = ''))
				OR (Y.AC_LON_STA_TYP = 'CR' AND THETA.LC_STA_DC10 = '01' AND THETA.LC_PCL_REA IN ('DF', 'RS', 'DB', 'DQ')))
	)
FOR READ ONLY WITH UR
);
DISCONNECT FROM DB2;

ENDRSUBMIT;
DATA ONELINK_BORROWER;
SET WORKLOCL.ONELINK_BORROWER;
RUN;
DATA ONELINK_REFERENCE;
SET WORKLOCL.ONELINK_REFERENCE;
RUN;
DATA COMPASS_BORROWER;
SET WORKLOCL.COMPASS_BORROWER;
RUN;
DATA COMPASS_REFERENCE;
SET WORKLOCL.COMPASS_REFERENCE;
RUN;

PROC SORT DATA=ONELINK_BORROWER;
BY DF_SPE_ACC_ID;
RUN;
PROC SORT DATA=ONELINK_REFERENCE;
BY DF_PRS_ID_RFR;
RUN;
PROC SORT DATA=COMPASS_BORROWER;
BY DF_SPE_ACC_ID;
RUN;
PROC SORT DATA=COMPASS_REFERENCE;
BY BF_RFR;
RUN;

PROC PRINTTO PRINT=REPORT2 NEW;
RUN;
OPTIONS CENTER PAGENO=1 ORIENTATION=PORTRAIT ;
OPTIONS LS=96 PS=52;
PROC PRINT NOOBS SPLIT='' DATA=COMPASS_BORROWER WIDTH=UNIFORM WIDTH=MIN;
VAR DF_SPE_ACC_ID
	DM_PRS_1
	DM_PRS_LST;
LABEL	DF_SPE_ACC_ID = 'Account Number'
		DM_PRS_1 = 'First Name'
		DM_PRS_LST = 'Last Name';
TITLE	'Compass Borrower No Phone';
FOOTNOTE1  	"This document may contain borrowers' sensitive information that UHEAA has pledged to protect.";
FOOTNOTE2	"Please take appropriate precautions to safeguard this information.";
FOOTNOTE3	;
FOOTNOTE4 	'JOB = UTLWU24     REPORT = ULWU24.LWU24R2';
RUN;

PROC PRINTTO PRINT=REPORT3 NEW;
RUN;
OPTIONS CENTER PAGENO=1 ORIENTATION=PORTRAIT ;
OPTIONS LS=96 PS=52;
PROC PRINT NOOBS SPLIT='/' DATA=COMPASS_REFERENCE WIDTH=UNIFORM WIDTH=MIN;
VAR BF_RFR
	DM_PRS_1
	DM_PRS_LST;
LABEL	BF_RFR = 'Reference ID'
		DM_PRS_1 = 'Reference First Name'
		DM_PRS_LST = 'Reference Last Name';
TITLE	'Compass Reference No Phone';
FOOTNOTE1  	"This document may contain borrowers' sensitive information that UHEAA has pledged to protect.";
FOOTNOTE2	"Please take appropriate precautions to safeguard this information.";
FOOTNOTE3	;
FOOTNOTE4 	'JOB = UTLWU24     REPORT = ULWU24.LWU24R3';
RUN;

PROC PRINTTO PRINT=REPORT4 NEW;
RUN;
OPTIONS CENTER PAGENO=1 ORIENTATION=PORTRAIT ;
OPTIONS LS=96 PS=52;
PROC PRINT NOOBS SPLIT='' DATA=ONELINK_BORROWER WIDTH=UNIFORM WIDTH=MIN;
VAR DF_SPE_ACC_ID
	DM_PRS_1
	DM_PRS_LST;
LABEL	DF_SPE_ACC_ID = 'Borrower, Co-maker/Endorser Account Number'
		DM_PRS_1 = 'Borrower, Co-Maker/Endorser First Name'
		DM_PRS_LST = 'Borrower, Co-Maker/Endorser Last Name';
TITLE	'Onelink Borrower No Phone';
FOOTNOTE1  	"This document may contain borrowers' sensitive information that UHEAA has pledged to protect.";
FOOTNOTE2	"Please take appropriate precautions to safeguard this information.";
FOOTNOTE3	;
FOOTNOTE4 	'JOB = UTLWU24     REPORT = ULWU24.LWU24R4';
RUN;

PROC PRINTTO PRINT=REPORT5 NEW;
RUN;
OPTIONS CENTER PAGENO=1 ORIENTATION=PORTRAIT ;
OPTIONS LS=96 PS=52;
PROC PRINT NOOBS SPLIT='/' DATA=ONELINK_REFERENCE WIDTH=UNIFORM WIDTH=MIN;
VAR DF_PRS_ID_RFR
	BM_RFR_1
	BM_RFR_LST;
LABEL	DF_PRS_ID_RFR = 'Reference ID'
		BM_RFR_1 = 'Reference First Name'
		BM_RFR_LST = 'Reference Last Name';
TITLE	'Onelink Reference No Phone';
FOOTNOTE1  	"This document may contain borrowers' sensitive information that UHEAA has pledged to protect.";
FOOTNOTE2	"Please take appropriate precautions to safeguard this information.";
FOOTNOTE3	;
FOOTNOTE4 	'JOB = UTLWU24     REPORT = ULWU24.LWU24R5';
RUN;

PROC PRINTTO;
RUN;
