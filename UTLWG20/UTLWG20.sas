/*LIBNAME DLGSUTWH DB2 DATABASE=DLGSUTWH OWNER=OLWHRM1;
%LET RPTLIB = %SYSGET(reportdir);
FILENAME REPORT2 "&RPTLIB/ULWG20.LWG20R2";*/

LIBNAME  WORKLOCL  REMOTE  SERVER=CYPRUS  SLIBREF=WORK;
%LET RPTLIB = T:\SAS;
FILENAME REPORT2 "&RPTLIB/ULWG20.LWG20R2.txt";
RSUBMIT;
PROC SQL;
CONNECT TO DB2 (DATABASE=DLGSUTWH);
CREATE TABLE NOUIDO AS
SELECT *
FROM CONNECTION TO DB2 (
SELECT   A.BF_SSN AS CSSN
		,D.DF_SPE_ACC_ID as ACCTNUM
		,RTRIM(D.DM_PRS_LST)||' '||RTRIM(D.DM_PRS_1)||' '||D.DM_PRS_MID AS NAME
		,A.LN_SEQ
		,CASE 
		 WHEN A.LN_LON_ALT_SEQ < 10 
		 THEN RTRIM(CHAR(A.LF_LON_ALT))||'0'||CHAR(A.LN_LON_ALT_SEQ)
		 ELSE RTRIM(CHAR(A.LF_LON_ALT))||''||CHAR(A.LN_LON_ALT_SEQ) 
		 END AS C_UID
		,A.LF_LON_CUR_OWN
		,A.LD_LON_GTR
		,E.LD_DSB
		,A.LF_DOE_SCL_ORG

FROM	 OLWHRM1.LN10_LON A
		INNER JOIN OLWHRM1.GA01_APP B
		 ON A.BF_SSN = B.DF_PRS_ID_BR
		INNER JOIN OLWHRM1.GA10_LON_APP C
		 ON B.AF_APL_ID = C.AF_APL_ID
		INNER JOIN OLWHRM1.PD10_PRS_NME D
		 ON A.BF_SSN = D.DF_PRS_ID
		INNER JOIN OLWHRM1.LN15_DSB E
		 ON A.BF_SSN = E.BF_SSN
		 AND A.LN_SEQ = E.LN_SEQ

WHERE	A.LC_STA_LON10 = 'R'
AND		A.IF_GTR = '000749'
AND 	A.LA_CUR_PRI > 0
AND NOT EXISTS (SELECT *
				FROM  OLWHRM1.GA10_LON_APP X 
					 ,OLWHRM1.GA01_APP Y 
				WHERE X.AF_APL_ID = Y.AF_APL_ID
				AND   A.LF_LON_ALT = X.AF_APL_ID
				AND   A.LN_LON_ALT_SEQ = INT(X.AF_APL_ID_SFX))
);
DISCONNECT FROM DB2;
ENDRSUBMIT;

DATA NOUIDO;
SET WORKLOCL.NOUIDO;
RUN;

PROC SORT DATA=NOUIDO NODUPKEY;
BY CSSN C_UID;
RUN;

PROC PRINTTO PRINT=REPORT2 NEW;
RUN;
OPTIONS PAGENO=1 LS=126;
PROC PRINT NOOBS SPLIT='/' DATA=NOUIDO WIDTH=MIN;
FORMAT LD_LON_GTR MMDDYY10. LD_DSB MMDDYY10.;
VAR ACCTNUM
	NAME
	LN_SEQ
	C_UID
	LF_LON_CUR_OWN
	LD_LON_GTR
	LD_DSB
	LF_DOE_SCL_ORG;
LABEL	ACCTNUM = 'ACCT NUM'
		LN_SEQ = 'LOAN SEQ'
		C_UID = 'COMPASS UNIQUE ID'
		LF_LON_CUR_OWN = 'CURRENT OWNER'
		LD_LON_GTR = 'GUARANTEE DATE'
		LD_DSB = 'FIRST DISBURSEMENT DATE'
		LF_DOE_SCL_ORG = 'ORIGINAL SCHOOL ID';
TITLE	'BORROWERS WITH NO MATCHING COMMONLINE UNIQUE ID ON ONELINK';
FOOTNOTE  'JOB = UTLWG20  	 REPORT = ULWG20.LWG20R2';
RUN;

PROC PRINTTO;
RUN;
